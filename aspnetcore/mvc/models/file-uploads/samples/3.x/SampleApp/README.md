# <a name="upload-files-sample-app"></a>上傳檔案範例應用程式

這個範例應用程式會示範在[ASP.NET Core 中上傳](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads)檔案主題中所述的概念。

## <a name="security-considerations"></a>安全性考量

提供使用者將檔案上傳到伺服器的能力時，請務必小心。 攻擊者可能會執行阻絕[服務](/windows-hardware/drivers/ifs/denial-of-service)攻擊、嘗試上傳病毒或惡意程式碼，或嘗試以其他方式入侵網路和伺服器。

降低成功攻擊的可能性的安全性步驟如下：

* 將檔案上傳到系統上的專用檔案上傳區域，最好是在非系統磁片磁碟機上。 使用專用的位置，可讓您更輕鬆地對上傳的檔案強加安全性措施。 停用檔案上傳位置的執行許可權。 &dagger;
* 絕對不要將上傳的檔案保存在與應用程式相同的目錄樹狀結構中。 &dagger;
* 使用應用程式所決定的安全檔案名。 請勿使用使用者輸入所提供的檔案名或上傳檔案的不受信任檔案名。 &dagger;
* 只允許一組特定的已核准副檔名。 &dagger;
* 請檢查檔案格式簽章，以防止使用者上傳回報偽裝檔（例如，上傳副檔名為 *.txt*的 *.exe*檔案）。 &dagger;
* 確認用戶端檢查也會在伺服器上執行。 用戶端檢查很容易規避。 &dagger;
* 請檢查上傳的大小，並防止上傳超過預期。 &dagger;
* 當使用相同名稱的上傳檔案覆寫檔案時，請在上傳檔案之前，檢查資料庫或實體儲存體的檔案名。
* **在儲存檔案之前，在上傳的內容上執行病毒/惡意程式碼掃描器。**

@no__t 0The 範例應用程式示範符合準則的方法。

> [!WARNING]
> 將惡意程式碼上傳至系統經常是執行程式碼的第一步，該程式碼可能：
>
> * 完全侵占系統。
> * 使用系統損毀的結果來多載系統。
> * 洩漏使用者或系統資料。
> * 將刻套用至公用 UI。
>
> 如需在接受來自使用者的檔案時減少攻擊介面區的資訊，請參閱下列資源：
>
> * [不受限制的檔案上傳](https://www.owasp.org/index.php/Unrestricted_File_Upload)
> * @no__t 0Azure 安全性：在接受來自使用者 @ no__t-0 的檔案時，確保適當的控制項已就緒

如需詳細資訊，請參閱[ASP.NET Core 中的上傳](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads)檔案。

## <a name="how-to-use-the-sample"></a>如何使用範例

在*appsettings json*檔案中：

1. 設定儲存檔案的路徑（`StoredFilesPath`）。

   * 範例應用程式會將值設定為 `c:\\files`，這會假設名為*files*的資料夾存在於系統的 C：磁片磁碟機根目錄中。
   * 路徑必須存在。 在系統的 C：磁片磁碟機上建立*files*資料夾，或將路徑設定為適當的位置。
   * 應用程式的進程需要路徑的讀取/寫入權限。
   * **重大!** 停用路徑上所有使用者的執行許可權。

1. 設定檔案大小限制（`FileSizeLimit`）（以位元組為單位）。 範例應用程式的預設值 `2097152` （2097152個位元組），最多允許上傳 2 MB 的檔案。
