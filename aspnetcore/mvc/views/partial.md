---
title: ASP.NET Core 中的部分檢視
author: ardalis
description: 了解部分檢視如何在另一個檢視內呈現，以及何時應該在 ASP.NET Core 應用程式中使用它們。
manager: wpickett
ms.author: riande
ms.date: 03/14/2018
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: mvc/views/partial
ms.openlocfilehash: 3deaaeb666e5443d0784f2ac6977e58e1b25d711
ms.sourcegitcommit: 71b93b42cbce8a9b1a12c4d88391e75a4dfb6162
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/20/2018
---
# <a name="partial-views-in-aspnet-core"></a><span data-ttu-id="0531c-103">ASP.NET Core 中的部分檢視</span><span class="sxs-lookup"><span data-stu-id="0531c-103">Partial Views in ASP.NET Core</span></span>

<span data-ttu-id="0531c-104">作者：[Steve Smith](https://ardalis.com/)、[Maher JENDOUBI](https://twitter.com/maherjend)、[Rick Anderson](https://twitter.com/RickAndMSFT) 和 [Scott Sauber](https://twitter.com/scottsauber)</span><span class="sxs-lookup"><span data-stu-id="0531c-104">By [Steve Smith](https://ardalis.com/), [Maher JENDOUBI](https://twitter.com/maherjend), [Rick Anderson](https://twitter.com/RickAndMSFT), and [Scott Sauber](https://twitter.com/scottsauber)</span></span>

<span data-ttu-id="0531c-105">當您想要在不同檢視之間共用網頁的可重複使用組件時，ASP.NET Core MVC 支援的部分檢視就相當實用。</span><span class="sxs-lookup"><span data-stu-id="0531c-105">ASP.NET Core MVC supports partial views, which are useful when you have reusable parts of web pages you want to share between different views.</span></span>

<span data-ttu-id="0531c-106">[檢視或下載範例程式碼](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/views/partial/sample) \(英文\) ([如何下載](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="0531c-106">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/views/partial/sample) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="what-are-partial-views"></a><span data-ttu-id="0531c-107">什麼是部分檢視？</span><span class="sxs-lookup"><span data-stu-id="0531c-107">What are Partial Views?</span></span>

<span data-ttu-id="0531c-108">部分檢視是一種可在其他檢視中進行轉譯的檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-108">A partial view is a view that's rendered within another view.</span></span> <span data-ttu-id="0531c-109">系統會將執行部分檢視所產生的 HTML 輸出，轉譯成呼叫檢視 (或父檢視)。</span><span class="sxs-lookup"><span data-stu-id="0531c-109">The HTML output generated by executing the partial view is rendered into the calling (or parent) view.</span></span> <span data-ttu-id="0531c-110">部分檢視和其他檢視一樣都使用 *.cshtml* 副檔名。</span><span class="sxs-lookup"><span data-stu-id="0531c-110">Like views, partial views use the *.cshtml* file extension.</span></span>

## <a name="when-should-i-use-partial-views"></a><span data-ttu-id="0531c-111">何時應該使用部分檢視？</span><span class="sxs-lookup"><span data-stu-id="0531c-111">When Should I Use Partial Views?</span></span>

<span data-ttu-id="0531c-112">如果您想將大型檢視拆解成較小的元件，部分檢視是一種有效的方式。</span><span class="sxs-lookup"><span data-stu-id="0531c-112">Partial views are an effective way of breaking up large views into smaller components.</span></span> <span data-ttu-id="0531c-113">它們可以降低檢視內容重複的情況，並重複使用檢視的項目。</span><span class="sxs-lookup"><span data-stu-id="0531c-113">They can reduce duplication of view content and allow view elements to be reused.</span></span> <span data-ttu-id="0531c-114">您應該在 [_Layout.cshtml](layout.md) 中指定一般版面配置項目。</span><span class="sxs-lookup"><span data-stu-id="0531c-114">Common layout elements should be specified in [_Layout.cshtml](layout.md).</span></span> <span data-ttu-id="0531c-115">非版面配置的可重複使用內容則可以封裝到部分檢視中。</span><span class="sxs-lookup"><span data-stu-id="0531c-115">Non-layout reusable content can be encapsulated into partial views.</span></span>

<span data-ttu-id="0531c-116">如果您的複雜頁面是由多個邏輯項目所組成，就很適合將每個項目作為個別的部分檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-116">If you have a complex page made up of several logical pieces, it can be helpful to work with each piece as its own partial view.</span></span> <span data-ttu-id="0531c-117">每個頁面片段都可以獨立於其餘頁面進行檢視，因此頁面本身的檢視會變得簡單許多，因為它只包含整體頁面結構以及轉譯部分檢視的呼叫。</span><span class="sxs-lookup"><span data-stu-id="0531c-117">Each piece of the page can be viewed in isolation from the rest of the page, and the view for the page itself becomes much simpler since it only contains the overall page structure and calls to render the partial views.</span></span>

<span data-ttu-id="0531c-118">提示：使用檢視時，請遵循 [Don't Repeat Yourself](http://deviq.com/don-t-repeat-yourself/) (不重複) 原則。</span><span class="sxs-lookup"><span data-stu-id="0531c-118">Tip: Follow the [Don't Repeat Yourself Principle](http://deviq.com/don-t-repeat-yourself/) in your views.</span></span>

## <a name="declaring-partial-views"></a><span data-ttu-id="0531c-119">宣告部分檢視</span><span class="sxs-lookup"><span data-stu-id="0531c-119">Declaring Partial Views</span></span>

<span data-ttu-id="0531c-120">部分檢視的建立方式與其他檢視一樣：您可以在 *Views* 資料夾內建立一個 *.cshtml* 檔案。</span><span class="sxs-lookup"><span data-stu-id="0531c-120">Partial views are created like any other view: you create a *.cshtml* file within the *Views* folder.</span></span> <span data-ttu-id="0531c-121">部分檢視和一般檢視之間沒有任何語意差別，只是以不同的方式轉譯。</span><span class="sxs-lookup"><span data-stu-id="0531c-121">There's no semantic difference between a partial view and a regular view - they're just rendered differently.</span></span> <span data-ttu-id="0531c-122">控制器的 `ViewResult` 會直接傳回檢視，您可以將這個檢視作為部分檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-122">You can have a view that's returned directly from a controller's `ViewResult`, and the same view can be used as a partial view.</span></span> <span data-ttu-id="0531c-123">一般檢視與部分檢視的轉譯方式主要差異在於，部分檢視不會執行 *_ViewStart.cshtml* (但一般檢視則會執行，如需詳細資訊，請參閱[版面配置](layout.md)中的 *_ViewStart.cshtml*)。</span><span class="sxs-lookup"><span data-stu-id="0531c-123">The main difference between how a view and a partial view are rendered is that partial views don't run *_ViewStart.cshtml* (while views do - learn more about *_ViewStart.cshtml* in [Layout](layout.md)).</span></span>

## <a name="referencing-a-partial-view"></a><span data-ttu-id="0531c-124">參考部分檢視</span><span class="sxs-lookup"><span data-stu-id="0531c-124">Referencing a Partial View</span></span>

<span data-ttu-id="0531c-125">在檢視頁面中，您可以使用數種方法來轉譯部分檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-125">From within a view page, there are several ways in which you can render a partial view.</span></span> <span data-ttu-id="0531c-126">最佳做法是使用 `Html.PartialAsync`，它會傳回 `IHtmlString`，您可在呼叫前加上 `@` 以參考這個項目：</span><span class="sxs-lookup"><span data-stu-id="0531c-126">The best practice is to use `Html.PartialAsync`, which returns an `IHtmlString` and can be referenced by prefixing the call with `@`:</span></span>

[!code-cshtml[](partial/sample/src/PartialViewsSample/Views/Home/About.cshtml?range=8)]

<span data-ttu-id="0531c-127">您可以使用 `RenderPartialAsync` 來轉譯部分檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-127">You can render a partial view with `RenderPartialAsync`.</span></span> <span data-ttu-id="0531c-128">這個方法不會傳回結果，而會將轉譯的輸出直接串流給回應。</span><span class="sxs-lookup"><span data-stu-id="0531c-128">This method doesn't return a result; it streams the rendered output directly to the response.</span></span> <span data-ttu-id="0531c-129">既然它不會傳回結果，您就必須在 Razor 程式碼區塊內對其進行呼叫：</span><span class="sxs-lookup"><span data-stu-id="0531c-129">Because it doesn't return a result, it must be called within a Razor code block:</span></span>

[!code-cshtml[](partial/sample/src/PartialViewsSample/Views/Home/About.cshtml?range=11-13)]

<span data-ttu-id="0531c-130">由於它會直接串流結果，因此在某些情況下，`RenderPartialAsync` 可能效能會更好。</span><span class="sxs-lookup"><span data-stu-id="0531c-130">Because it streams the result directly, `RenderPartialAsync` may perform better in some scenarios.</span></span> <span data-ttu-id="0531c-131">不過，建議您使用 `PartialAsync`。</span><span class="sxs-lookup"><span data-stu-id="0531c-131">However, it's recommended you use `PartialAsync`.</span></span>

<span data-ttu-id="0531c-132">雖然有 `Html.PartialAsync` (`Html.Partial`) 和 `Html.RenderPartialAsync` (`Html.RenderPartial`) 的同步對等項目，但不建議使用同步對等項目，因為存在其發生死結的情況。</span><span class="sxs-lookup"><span data-stu-id="0531c-132">While there are synchronous equivalents of `Html.PartialAsync` (`Html.Partial`) and `Html.RenderPartialAsync` (`Html.RenderPartial`), use of the synchronous equivalents isn't recommended because there are scenarios where they deadlock.</span></span> <span data-ttu-id="0531c-133">同步方法在未來版本中無法使用。</span><span class="sxs-lookup"><span data-stu-id="0531c-133">The synchronous methods will be unavailable in future versions.</span></span>

> [!NOTE]
> <span data-ttu-id="0531c-134">如果您的檢視需要執行程式碼，則建議的模式是使用[檢視元件](view-components.md)，而不是使用部分檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-134">If your views need to execute code, the recommended pattern is to use a [view component](view-components.md) instead of a partial view.</span></span>

### <a name="partial-view-discovery"></a><span data-ttu-id="0531c-135">部分檢視探索</span><span class="sxs-lookup"><span data-stu-id="0531c-135">Partial View Discovery</span></span>

<span data-ttu-id="0531c-136">參考部分檢視時，您可以透過數種方式來參考它的位置：</span><span class="sxs-lookup"><span data-stu-id="0531c-136">When referencing a partial view, you can refer to its location in several ways:</span></span>

```cshtml
// Uses a view in current folder with this name
// If none is found, searches the Shared folder
@await Html.PartialAsync("ViewName")

// A view with this name must be in the same folder
@await Html.PartialAsync("ViewName.cshtml")

// Locate the view based on the application root
// Paths that start with "/" or "~/" refer to the application root
@await Html.PartialAsync("~/Views/Folder/ViewName.cshtml")
@await Html.PartialAsync("/Views/Folder/ViewName.cshtml")

// Locate the view using relative paths
@await Html.PartialAsync("../Account/LoginPartial.cshtml")
```

<span data-ttu-id="0531c-137">您可以在不同的檢視資料夾中，以相同名稱命名不同的部分檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-137">You can have different partial views with the same name in different view folders.</span></span> <span data-ttu-id="0531c-138">依據名稱 (不含副檔名) 參考檢視時，每個資料夾中的檢視會使用位於相同資料夾中的部分檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-138">When referencing the views by name (without file extension), views in each folder will use the partial view in the same folder with them.</span></span> <span data-ttu-id="0531c-139">您也可以指定使用預設的部分檢視，並將其放在 *Shared* 資料夾中。</span><span class="sxs-lookup"><span data-stu-id="0531c-139">You can also specify a default partial view to use, placing it in the *Shared* folder.</span></span> <span data-ttu-id="0531c-140">如果檢視沒有專屬版本的部分檢視，就會使用共用的部分檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-140">The shared partial view will be used by any views that don't have their own version of the partial view.</span></span> <span data-ttu-id="0531c-141">您可以使用預設的部分檢視 (在 *Shared*)，而與父檢視位於相同資料夾中的同名部分檢視會將其覆寫。</span><span class="sxs-lookup"><span data-stu-id="0531c-141">You can have a default partial view (in *Shared*), which is overridden by a partial view with the same name in the same folder as the parent view.</span></span>

<span data-ttu-id="0531c-142">您可以「鏈結」部分檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-142">Partial views can be *chained*.</span></span> <span data-ttu-id="0531c-143">也就是說，部分檢視可以呼叫另一個部分檢視 (只要您不建立迴圈)。</span><span class="sxs-lookup"><span data-stu-id="0531c-143">That is, a partial view can call another partial view (as long as you don't create a loop).</span></span> <span data-ttu-id="0531c-144">在每一個檢視或部分檢視內，相對路徑一律是相對於該檢視，而非相對於根目錄或父檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-144">Within each view or partial view, relative paths are always relative to that view, not the root or parent view.</span></span>

> [!NOTE]
> <span data-ttu-id="0531c-145">如果您在部分檢視中宣告 [Razor](razor.md) `section`，即會將其限於部分檢視，而不會向其父檢視顯示。</span><span class="sxs-lookup"><span data-stu-id="0531c-145">If you declare a [Razor](razor.md) `section` in a partial view, it will not be visible to its parent(s); it will be limited to the partial view.</span></span>

## <a name="accessing-data-from-partial-views"></a><span data-ttu-id="0531c-146">從部分檢視存取資料</span><span class="sxs-lookup"><span data-stu-id="0531c-146">Accessing Data From Partial Views</span></span>

<span data-ttu-id="0531c-147">將部分檢視具現化時，它會取得一份父檢視的 `ViewData` 字典。</span><span class="sxs-lookup"><span data-stu-id="0531c-147">When a partial view is instantiated, it gets a copy of the parent view's `ViewData` dictionary.</span></span> <span data-ttu-id="0531c-148">父檢視不會保存部分檢視內的資料更新。</span><span class="sxs-lookup"><span data-stu-id="0531c-148">Updates made to the data within the partial view are not persisted to the parent view.</span></span> <span data-ttu-id="0531c-149">傳回部分檢視時，部分檢視內有所變更的 `ViewData` 會遺失。</span><span class="sxs-lookup"><span data-stu-id="0531c-149">`ViewData` changed in a partial view is lost when the partial view returns.</span></span>

<span data-ttu-id="0531c-150">您可以將 `ViewDataDictionary` 的執行個體傳遞給部分檢視：</span><span class="sxs-lookup"><span data-stu-id="0531c-150">You can pass an instance of `ViewDataDictionary` to the partial view:</span></span>

```cshtml
@await Html.PartialAsync("PartialName", customViewData)
```

<span data-ttu-id="0531c-151">您也可以將模型傳入部分檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-151">You can also pass a model into a partial view.</span></span> <span data-ttu-id="0531c-152">這可以是頁面的檢視模型或自訂物件。</span><span class="sxs-lookup"><span data-stu-id="0531c-152">This can be the page's view model or a custom object.</span></span> <span data-ttu-id="0531c-153">您可以將模型傳遞給 `PartialAsync` 或 `RenderPartialAsync`：</span><span class="sxs-lookup"><span data-stu-id="0531c-153">You can pass a model to `PartialAsync` or `RenderPartialAsync`:</span></span>

```cshtml
@await Html.PartialAsync("PartialName", viewModel)
```

<span data-ttu-id="0531c-154">您可以將 `ViewDataDictionary` 的執行個體和檢視模型傳遞給部分檢視：</span><span class="sxs-lookup"><span data-stu-id="0531c-154">You can pass an instance of `ViewDataDictionary` and a view model to a partial view:</span></span>

[!code-cshtml[](partial/sample/src/PartialViewsSample/Views/Articles/Read.cshtml?range=15-16)]

<span data-ttu-id="0531c-155">下列標記表示 *Views/Articles/Read.cshtml* 檢視，其中包含兩個部分檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-155">The markup below shows the *Views/Articles/Read.cshtml* view which contains two partial views.</span></span> <span data-ttu-id="0531c-156">第二個部分檢視將模型和 `ViewData` 傳入部分檢視。</span><span class="sxs-lookup"><span data-stu-id="0531c-156">The second partial view passes in a model and `ViewData` to the partial view.</span></span> <span data-ttu-id="0531c-157">如果您使用 `ViewDataDictionary` 的建構函式多載 (醒目標示如下)，即可傳遞新的 `ViewData` 字典，同時保留現有的 `ViewData`：</span><span class="sxs-lookup"><span data-stu-id="0531c-157">You can pass new `ViewData` dictionary while retaining the existing `ViewData` if you use the constructor overload of the `ViewDataDictionary` highlighted below:</span></span>

[!code-cshtml[](partial/sample/src/PartialViewsSample/Views/Articles/Read.cshtml)]

<span data-ttu-id="0531c-158">*Views/Shared/AuthorPartial*：</span><span class="sxs-lookup"><span data-stu-id="0531c-158">*Views/Shared/AuthorPartial*:</span></span>

[!code-cshtml[](partial/sample/src/PartialViewsSample/Views/Shared/AuthorPartial.cshtml)]

<span data-ttu-id="0531c-159">*ArticleSection* 部分檢視：</span><span class="sxs-lookup"><span data-stu-id="0531c-159">The *ArticleSection* partial:</span></span>

[!code-cshtml[](partial/sample/src/PartialViewsSample/Views/Articles/ArticleSection.cshtml)]

<span data-ttu-id="0531c-160">執行階段期間會將部分檢視轉譯為父檢視，而這個父檢視本身則在共用的 *_Layout.cshtml* 當中轉譯</span><span class="sxs-lookup"><span data-stu-id="0531c-160">At runtime, the partials are rendered into the parent view, which itself is rendered within the shared *_Layout.cshtml*</span></span>

![部分檢視輸出](partial/_static/output.png)
