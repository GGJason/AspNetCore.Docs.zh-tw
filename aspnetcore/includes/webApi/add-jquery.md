## <a name="call-the-web-api-with-jquery"></a><span data-ttu-id="be1ab-101">使用 jQuery 呼叫 Web API</span><span class="sxs-lookup"><span data-stu-id="be1ab-101">Call the Web API with jQuery</span></span>

<span data-ttu-id="be1ab-102">在本節中，將會新增 HTML 網頁，以使用 jQuery 來呼叫 Web API。</span><span class="sxs-lookup"><span data-stu-id="be1ab-102">In this section, an HTML page is added that uses jQuery to call the Web API.</span></span> <span data-ttu-id="be1ab-103">jQuery 會起始要求，並使用來自 API 回應的詳細資料更新頁面。</span><span class="sxs-lookup"><span data-stu-id="be1ab-103">jQuery initiates the request and updates the page with the details from the API's response.</span></span>

<span data-ttu-id="be1ab-104">請設定專案來提供靜態檔案，並啟用預設檔案對應。</span><span class="sxs-lookup"><span data-stu-id="be1ab-104">Configure the project to serve static files and to enable default file mapping.</span></span> <span data-ttu-id="be1ab-105">這是透過在 *Startup.Configure* 中叫用 [UseStaticFiles](/dotnet/api/microsoft.aspnetcore.builder.staticfileextensions.usestaticfiles#Microsoft_AspNetCore_Builder_StaticFileExtensions_UseStaticFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) 和 [UseDefaultFiles](/dotnet/api/microsoft.aspnetcore.builder.defaultfilesextensions.usedefaultfiles#Microsoft_AspNetCore_Builder_DefaultFilesExtensions_UseDefaultFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) 擴充方法來達成。</span><span class="sxs-lookup"><span data-stu-id="be1ab-105">This is accomplished by invoking the [UseStaticFiles](/dotnet/api/microsoft.aspnetcore.builder.staticfileextensions.usestaticfiles#Microsoft_AspNetCore_Builder_StaticFileExtensions_UseStaticFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) and [UseDefaultFiles](/dotnet/api/microsoft.aspnetcore.builder.defaultfilesextensions.usedefaultfiles#Microsoft_AspNetCore_Builder_DefaultFilesExtensions_UseDefaultFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) extension methods in *Startup.Configure*.</span></span> <span data-ttu-id="be1ab-106">如需詳細資訊，請參閱[在 ASP.NET Core 中使用靜態檔案](xref:fundamentals/static-files)。</span><span class="sxs-lookup"><span data-stu-id="be1ab-106">For more information, see [Work with static files in ASP.NET Core](xref:fundamentals/static-files).</span></span>

[!code-csharp[](../../tutorials/first-web-api/samples/2.0/TodoApi/Startup2.cs?name=snippet_Configure&highlight=3-4)]

<span data-ttu-id="be1ab-107">將名為 *index.html* 的 HTML 檔案新增至專案的 *wwwroot* 目錄。</span><span class="sxs-lookup"><span data-stu-id="be1ab-107">Add an HTML file, named *index.html*, to the project's *wwwroot* directory.</span></span> <span data-ttu-id="be1ab-108">將其內容取代為下列標記：</span><span class="sxs-lookup"><span data-stu-id="be1ab-108">Replace its contents with the following markup:</span></span>

[!code-html[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/index.html)]

<span data-ttu-id="be1ab-109">將名為 *site.js* 的 JavaScript 檔案新增至專案的 *wwwroot* 目錄。</span><span class="sxs-lookup"><span data-stu-id="be1ab-109">Add a JavaScript file, named *site.js*, to the project's *wwwroot* directory.</span></span> <span data-ttu-id="be1ab-110">將其內容取代為下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="be1ab-110">Replace its contents with the following code:</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_SiteJs)]

<span data-ttu-id="be1ab-111">若要在本機測試 HTML 網頁，可能需要變更 ASP.NET Core 專案的啟動設定。</span><span class="sxs-lookup"><span data-stu-id="be1ab-111">A change to the ASP.NET Core project's launch settings may be required to test the HTML page locally.</span></span> <span data-ttu-id="be1ab-112">在專案的 *Properties* 目錄中開啟 *launchSettings.json*。</span><span class="sxs-lookup"><span data-stu-id="be1ab-112">Open *launchSettings.json* in the *Properties* directory of the project.</span></span> <span data-ttu-id="be1ab-113">移除 `launchUrl` 屬性，以強制應用程式於 *index.html* 處開啟 &mdash; 專案的預設檔案。</span><span class="sxs-lookup"><span data-stu-id="be1ab-113">Remove the `launchUrl` property to force the app to open at *index.html*&mdash;the project's default file.</span></span>

<span data-ttu-id="be1ab-114">您可以使用幾種方式來取得 jQuery。</span><span class="sxs-lookup"><span data-stu-id="be1ab-114">There are several ways to get jQuery.</span></span> <span data-ttu-id="be1ab-115">在上述的程式碼片段中，從 CDN 載入程式庫。</span><span class="sxs-lookup"><span data-stu-id="be1ab-115">In the preceding snippet, the library is loaded from a CDN.</span></span> <span data-ttu-id="be1ab-116">這個範例是使用 jQuery 呼叫 API 的完整 CRUD 範例。</span><span class="sxs-lookup"><span data-stu-id="be1ab-116">This sample is a complete CRUD example of calling the API with jQuery.</span></span> <span data-ttu-id="be1ab-117">這個範例還有可讓體驗更加豐富的額外功能。</span><span class="sxs-lookup"><span data-stu-id="be1ab-117">There are additional features in this sample to make the experience richer.</span></span> <span data-ttu-id="be1ab-118">以下是關於呼叫 API 的說明。</span><span class="sxs-lookup"><span data-stu-id="be1ab-118">Below are explanations around the calls to the API.</span></span>

### <a name="get-a-list-of-to-do-items"></a><span data-ttu-id="be1ab-119">取得待辦事項的清單</span><span class="sxs-lookup"><span data-stu-id="be1ab-119">Get a list of to-do items</span></span>

<span data-ttu-id="be1ab-120">若要取得待辦事項的清單，請將 HTTP GET 要求傳送至 */api/todo*。</span><span class="sxs-lookup"><span data-stu-id="be1ab-120">To get a list of to-do items, send an HTTP GET request to */api/todo*.</span></span>

<span data-ttu-id="be1ab-121">JQuery [ajax](https://api.jquery.com/jquery.ajax/) 函式會將 AJAX 要求傳送至 API，API 則會傳回代表物件或陣列的 JSON。</span><span class="sxs-lookup"><span data-stu-id="be1ab-121">The jQuery [ajax](https://api.jquery.com/jquery.ajax/) function sends an AJAX request to the API, which returns JSON representing an object or array.</span></span> <span data-ttu-id="be1ab-122">此函式可以處理所有形式的 HTTP 互動，並將 HTTP 要求傳送至指定的 `url`。</span><span class="sxs-lookup"><span data-stu-id="be1ab-122">This function can handle all forms of HTTP interaction, sending an HTTP request to the specified `url`.</span></span> <span data-ttu-id="be1ab-123">`GET` 會當作 `type` 使用。</span><span class="sxs-lookup"><span data-stu-id="be1ab-123">`GET` is used as the `type`.</span></span> <span data-ttu-id="be1ab-124">如果要求成功，則會叫用 `success` 回呼函式。</span><span class="sxs-lookup"><span data-stu-id="be1ab-124">The `success` callback function is invoked if the request succeeds.</span></span> <span data-ttu-id="be1ab-125">在回呼中，DOM 已使用待辦事項資訊進行更新。</span><span class="sxs-lookup"><span data-stu-id="be1ab-125">In the callback, the DOM is updated with the to-do information.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_GetData)]

### <a name="add-a-to-do-item"></a><span data-ttu-id="be1ab-126">新增待辦事項</span><span class="sxs-lookup"><span data-stu-id="be1ab-126">Add a to-do item</span></span>

<span data-ttu-id="be1ab-127">若要新增待辦事項，請將 HTTP POST 要求傳送到 */api/todo/*。</span><span class="sxs-lookup"><span data-stu-id="be1ab-127">To add a to-do item, send an HTTP POST request to */api/todo/*.</span></span> <span data-ttu-id="be1ab-128">要求本文應該包含待辦事項物件。</span><span class="sxs-lookup"><span data-stu-id="be1ab-128">The request body should contain a to-do object.</span></span> <span data-ttu-id="be1ab-129">[ajax](https://api.jquery.com/jquery.ajax/) 函式會使用 `POST` 來呼叫 API。</span><span class="sxs-lookup"><span data-stu-id="be1ab-129">The [ajax](https://api.jquery.com/jquery.ajax/) function is using `POST` to call the API.</span></span> <span data-ttu-id="be1ab-130">對於 `POST` 和 `PUT` 要求，要求本文代表傳送至 API 的資料。</span><span class="sxs-lookup"><span data-stu-id="be1ab-130">For `POST` and `PUT` requests, the request body represents the data sent to the API.</span></span> <span data-ttu-id="be1ab-131">此 API 需要有 JSON 要求本文。</span><span class="sxs-lookup"><span data-stu-id="be1ab-131">The API is expecting a JSON request body.</span></span> <span data-ttu-id="be1ab-132">`accepts` 和 `contentType` 選項都設定為 `application/json`，以分別分類接收和傳送的媒體類型。</span><span class="sxs-lookup"><span data-stu-id="be1ab-132">The `accepts` and `contentType` options are set to `application/json` to classify the media type being received and sent, respectively.</span></span> <span data-ttu-id="be1ab-133">資料會使用 [`JSON.stringify`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) 轉換成 JSON 物件。</span><span class="sxs-lookup"><span data-stu-id="be1ab-133">The data is converted to a JSON object using [`JSON.stringify`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify).</span></span> <span data-ttu-id="be1ab-134">當 API 傳回成功狀態碼時，會叫用 `getData` 函式來更新 HTML 資料表。</span><span class="sxs-lookup"><span data-stu-id="be1ab-134">When the API returns a successful status code, the `getData` function is invoked to update the HTML table.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_AddItem)]

### <a name="update-a-to-do-item"></a><span data-ttu-id="be1ab-135">更新待辦事項</span><span class="sxs-lookup"><span data-stu-id="be1ab-135">Update a to-do item</span></span>

<span data-ttu-id="be1ab-136">更新待辦事項非常類似於新增待辦事項，因為這兩者都依賴要求內文。</span><span class="sxs-lookup"><span data-stu-id="be1ab-136">Updating a to-do item is very similar to adding one, since both rely on a request body.</span></span> <span data-ttu-id="be1ab-137">在此情況下，兩者之間的唯一差異在於 `url` 變更為新增項目的唯一識別碼，而 `type` 是 `PUT`。</span><span class="sxs-lookup"><span data-stu-id="be1ab-137">The only real difference between the two in this case is that the `url` changes to add the unique identifier of the item, and the `type` is `PUT`.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_AjaxPut)]

### <a name="delete-a-to-do-item"></a><span data-ttu-id="be1ab-138">刪除待辦事項</span><span class="sxs-lookup"><span data-stu-id="be1ab-138">Delete a to-do item</span></span>

<span data-ttu-id="be1ab-139">刪除待辦事項的達成方法是將 AJAX 呼叫的 `type` 設定為 `DELETE`，並在 URL 中指定項目的唯一識別碼。</span><span class="sxs-lookup"><span data-stu-id="be1ab-139">Deleting a to-do item is accomplished by setting the `type` on the AJAX call to `DELETE` and specifing the item's unique identifier in the URL.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_AjaxDelete)]
