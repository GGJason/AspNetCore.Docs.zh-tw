---
title: ASP.NET Core 中的路由
author: ardalis
description: 探索 ASP.NET Core 路由功能如何負責將傳入要求對應至路由處理常式。
ms.author: riande
ms.custom: mvc
ms.date: 10/01/2018
uid: fundamentals/routing
ms.openlocfilehash: d9ba96c7b2abd35b1b13c84814bf3f776e8d8731
ms.sourcegitcommit: 13940eb53c68664b11a2d685ee17c78faab1945d
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/01/2018
ms.locfileid: "47861053"
---
# <a name="routing-in-aspnet-core"></a><span data-ttu-id="06f9d-103">ASP.NET Core 中的路由</span><span class="sxs-lookup"><span data-stu-id="06f9d-103">Routing in ASP.NET Core</span></span>

<span data-ttu-id="06f9d-104">作者：[Ryan Nowak](https://github.com/rynowak)、[Steve Smith](https://ardalis.com/) 和 [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="06f9d-104">By [Ryan Nowak](https://github.com/rynowak), [Steve Smith](https://ardalis.com/), and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="06f9d-105">路由功能負責將傳入要求對應至路由處理常式。</span><span class="sxs-lookup"><span data-stu-id="06f9d-105">Routing functionality is responsible for mapping an incoming request to a route handler.</span></span> <span data-ttu-id="06f9d-106">路由定義於應用程式，並在該應用程式啟動時進行設定。</span><span class="sxs-lookup"><span data-stu-id="06f9d-106">Routes are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="06f9d-107">路由可以選擇性地從要求中所包含的 URL 擷取值，然後這些值就可用於處理要求。</span><span class="sxs-lookup"><span data-stu-id="06f9d-107">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="06f9d-108">利用應用程式中的路由資訊，路由功能也能夠產生對應至路由處理常式的 URL。</span><span class="sxs-lookup"><span data-stu-id="06f9d-108">Using route information from the app, the routing functionality is also able to generate URLs that map to route handlers.</span></span> <span data-ttu-id="06f9d-109">因此，路由可以依據 URL 找到路由處理常式，或依據路由處理常式資訊找到對應至指定路由處理常式的 URL。</span><span class="sxs-lookup"><span data-stu-id="06f9d-109">Therefore, routing can find a route handler based on a URL or the URL corresponding to a given route handler based on route handler information.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="06f9d-110">本文件涵蓋低階的 ASP.NET Core 路由。</span><span class="sxs-lookup"><span data-stu-id="06f9d-110">This document covers low-level ASP.NET Core routing.</span></span> <span data-ttu-id="06f9d-111">如需 ASP.NET Core MVC 路由的資訊，請參閱 <xref:mvc/controllers/routing>。</span><span class="sxs-lookup"><span data-stu-id="06f9d-111">For information on ASP.NET Core MVC routing, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="06f9d-112">[檢視或下載範例程式碼](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/samples) \(英文\) ([如何下載](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="06f9d-112">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="06f9d-113">路由的基本概念</span><span class="sxs-lookup"><span data-stu-id="06f9d-113">Routing basics</span></span>

<span data-ttu-id="06f9d-114">路由 (routing) 功能會使用「路由」(*route*) (<xref:Microsoft.AspNetCore.Routing.IRouter> 的實作) 來：</span><span class="sxs-lookup"><span data-stu-id="06f9d-114">Routing uses *routes* (implementations of <xref:Microsoft.AspNetCore.Routing.IRouter>) to:</span></span>

* <span data-ttu-id="06f9d-115">將傳入要求對應至「路由處理常式」。</span><span class="sxs-lookup"><span data-stu-id="06f9d-115">Map incoming requests to *route handlers*.</span></span>
* <span data-ttu-id="06f9d-116">產生用於回應的 URL。</span><span class="sxs-lookup"><span data-stu-id="06f9d-116">Generate URLs used in responses.</span></span>

<span data-ttu-id="06f9d-117">一般而言，應用程式有一個路由集合。</span><span class="sxs-lookup"><span data-stu-id="06f9d-117">Generally, an app has a single collection of routes.</span></span> <span data-ttu-id="06f9d-118">當要求到達時，會依序處理路由集合。</span><span class="sxs-lookup"><span data-stu-id="06f9d-118">When a request arrives, the route collection is processed in order.</span></span> <span data-ttu-id="06f9d-119">傳入要求會在路由集合的每個可用路由上呼叫 <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> 方法，藉以尋找符合所要求 URL 的路由。</span><span class="sxs-lookup"><span data-stu-id="06f9d-119">The incoming request looks for a route that matches the request URL by calling the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each available route in the route collection.</span></span> <span data-ttu-id="06f9d-120">相反地，回應可以根據路由資訊使用路由來產生 URL (例如，針對重新導向或連結)，因此不需要硬式編碼的 URL，這有助於可維護性。</span><span class="sxs-lookup"><span data-stu-id="06f9d-120">By contrast, a response can use routing to generate URLs (for example, for redirection or links) based on route information and thus avoid having to hard-code URLs, which helps maintainability.</span></span>

<span data-ttu-id="06f9d-121">路由會透過 <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> 類別連線到[中介軟體](xref:fundamentals/middleware/index)管線。</span><span class="sxs-lookup"><span data-stu-id="06f9d-121">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> class.</span></span> <span data-ttu-id="06f9d-122">[ASP.NET Core MVC](xref:mvc/overview) 會將路由新增至中介軟體管線，作為其組態的一部分。</span><span class="sxs-lookup"><span data-stu-id="06f9d-122">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration.</span></span> <span data-ttu-id="06f9d-123">若要了解如何使用路由作為獨立元件，請參閱[使用路由中介軟體](#use-routing-middleware)一節。</span><span class="sxs-lookup"><span data-stu-id="06f9d-123">To learn about using routing as a standalone component, see [Use Routing Middleware](#use-routing-middleware) section.</span></span>

### <a name="url-matching"></a><span data-ttu-id="06f9d-124">URL 比對</span><span class="sxs-lookup"><span data-stu-id="06f9d-124">URL matching</span></span>

<span data-ttu-id="06f9d-125">URL 比對是路由用來將傳入要求分派給「處理常式」的處理序。</span><span class="sxs-lookup"><span data-stu-id="06f9d-125">URL matching is the process by which routing dispatches an incoming request to a *handler*.</span></span> <span data-ttu-id="06f9d-126">這個處理序是基於 URL 路徑中的資料，但是可以擴展為考慮要求中的任何資料。</span><span class="sxs-lookup"><span data-stu-id="06f9d-126">This process is based on data in the URL path but can be extended to consider any data in the request.</span></span> <span data-ttu-id="06f9d-127">分派要求給不同處理常式的能力，是調整應用程式大小和複雜度的關鍵。</span><span class="sxs-lookup"><span data-stu-id="06f9d-127">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an app.</span></span>

<span data-ttu-id="06f9d-128">傳入要求將進入 `RouterMiddleware`，而後者會依序在每個路由上呼叫 <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> 方法。</span><span class="sxs-lookup"><span data-stu-id="06f9d-128">Incoming requests enter the `RouterMiddleware`, which calls the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each route in sequence.</span></span> <span data-ttu-id="06f9d-129"><xref:Microsoft.AspNetCore.Routing.IRouter> 執行個體可將 [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) 設定為非 Null 的 <xref:Microsoft.AspNetCore.Http.RequestDelegate>，來選擇是否要「處理」要求。</span><span class="sxs-lookup"><span data-stu-id="06f9d-129">The <xref:Microsoft.AspNetCore.Routing.IRouter> instance chooses whether to *handle* the request by setting the [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) to a non-null <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span> <span data-ttu-id="06f9d-130">如果路由為要求設定了處理常式，則路由處理會停止，且會叫用該處理常式來處理要求。</span><span class="sxs-lookup"><span data-stu-id="06f9d-130">If a route sets a handler for the request, route processing stops, and the handler is invoked to process the request.</span></span> <span data-ttu-id="06f9d-131">如果已嘗試所有路由，但未找到要求的處理常式，中介軟體會呼叫下一個，而要求管線中的下一個中介軟體將被叫用。</span><span class="sxs-lookup"><span data-stu-id="06f9d-131">If all routes are tried and no handler is found for the request, the middleware calls *next*, and the next middleware in the request pipeline is invoked.</span></span>

<span data-ttu-id="06f9d-132">`RouteAsync` 的主要輸入是與目前要求建立關聯的 [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*)。</span><span class="sxs-lookup"><span data-stu-id="06f9d-132">The primary input to `RouteAsync` is the [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*) associated with the current request.</span></span> <span data-ttu-id="06f9d-133">`RouteContext.Handler` 和 [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) 是路由相符之後設定的輸出。</span><span class="sxs-lookup"><span data-stu-id="06f9d-133">The `RouteContext.Handler` and [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) are outputs set after a route matches.</span></span>

<span data-ttu-id="06f9d-134">`RouteAsync` 期間的相符也會依據到目前為止執行的要求處理，將 `RouteContext.RouteData` 的屬性設定為適當值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-134">A match during `RouteAsync` also sets the properties of the `RouteContext.RouteData` to appropriate values based on the request processing performed thus far.</span></span> <span data-ttu-id="06f9d-135">如果路由符合要求，`RouteContext.RouteData` 將包含與「結果」有關的重要狀態資訊。</span><span class="sxs-lookup"><span data-stu-id="06f9d-135">If a route matches a request, the `RouteContext.RouteData` contains important state information about the *result*.</span></span>

<span data-ttu-id="06f9d-136">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) 是「路由值」的字典，而路由值產生自路由。</span><span class="sxs-lookup"><span data-stu-id="06f9d-136">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="06f9d-137">這些值通常是透過將 URL 語彙基元化來決定，可以用來接受使用者輸入，或在應用程式內做出進一步的分派決策。</span><span class="sxs-lookup"><span data-stu-id="06f9d-137">These values are usually determined by tokenizing the URL and can be used to accept user input or to make further dispatching decisions inside the app.</span></span>

<span data-ttu-id="06f9d-138">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) 是其他資料的屬性包，而這些資料與相符路由相關。</span><span class="sxs-lookup"><span data-stu-id="06f9d-138">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="06f9d-139">提供了 `DataTokens` 來支援與每個路由相關聯的狀態資料，因此應用程式可以依據符合哪一個路由來做出決策。</span><span class="sxs-lookup"><span data-stu-id="06f9d-139">`DataTokens` are provided to support associating state data with each route so that the app can make decisions later based on which route matched.</span></span> <span data-ttu-id="06f9d-140">這些是開發人員定義的值，**不會**以任何方式影響路由的行為。</span><span class="sxs-lookup"><span data-stu-id="06f9d-140">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="06f9d-141">此外，隱藏在資料語彙基元中的值可以是任何類型，相較於路由值，它必須能夠輕鬆地來回轉換字串。</span><span class="sxs-lookup"><span data-stu-id="06f9d-141">Additionally, values stashed in data tokens can be of any type, in contrast to route values, which must be easily convertible to and from strings.</span></span>

<span data-ttu-id="06f9d-142">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers*) 是成功符合要求的參與路由清單。</span><span class="sxs-lookup"><span data-stu-id="06f9d-142">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers*) is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="06f9d-143">路由可以用巢狀方式置於彼此內部。</span><span class="sxs-lookup"><span data-stu-id="06f9d-143">Routes can be nested inside of one another.</span></span> <span data-ttu-id="06f9d-144">`Routers` 屬性會透過導致產生相符項目的路由邏輯樹狀結構反映路徑。</span><span class="sxs-lookup"><span data-stu-id="06f9d-144">The `Routers` property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="06f9d-145">一般而言，`Routers` 中的第一個項目是路由集合，應該用於產生 URL。</span><span class="sxs-lookup"><span data-stu-id="06f9d-145">Generally, the first item in `Routers` is the route collection and should be used for URL generation.</span></span> <span data-ttu-id="06f9d-146">`Routers` 中的最後一個項目是相符的路由處理常式。</span><span class="sxs-lookup"><span data-stu-id="06f9d-146">The last item in `Routers` is the route handler that matched.</span></span>

### <a name="url-generation"></a><span data-ttu-id="06f9d-147">URL 產生</span><span class="sxs-lookup"><span data-stu-id="06f9d-147">URL generation</span></span>

<span data-ttu-id="06f9d-148">URL 產生是路由可用來依據一組路由值建立 URL 路徑的處理序。</span><span class="sxs-lookup"><span data-stu-id="06f9d-148">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="06f9d-149">這可讓您在處理常式和存取它們的 URL 之間建立邏輯分隔。</span><span class="sxs-lookup"><span data-stu-id="06f9d-149">This allows for a logical separation between your handlers and the URLs that access them.</span></span>

<span data-ttu-id="06f9d-150">URL 產生遵循類似的反覆執行處理序，但開頭是呼叫路由集合 <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> 方法的使用者或架構程式碼。</span><span class="sxs-lookup"><span data-stu-id="06f9d-150">URL generation follows a similar iterative process, but it starts with user or framework code calling into the <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> method of the route collection.</span></span> <span data-ttu-id="06f9d-151">然後，每個「路由」會依序呼叫其 `GetVirtualPath` 方法，直到傳回非 Null 的 <xref:Microsoft.AspNetCore.Routing.VirtualPathData> 為止。</span><span class="sxs-lookup"><span data-stu-id="06f9d-151">Each *route* then has its `GetVirtualPath` method called in sequence until a non-null <xref:Microsoft.AspNetCore.Routing.VirtualPathData> is returned.</span></span>

<span data-ttu-id="06f9d-152">`GetVirtualPath` 的主要輸入是：</span><span class="sxs-lookup"><span data-stu-id="06f9d-152">The primary inputs to `GetVirtualPath` are:</span></span>

* [<span data-ttu-id="06f9d-153">VirtualPathContext.HttpContext</span><span class="sxs-lookup"><span data-stu-id="06f9d-153">VirtualPathContext.HttpContext</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext*)
* [<span data-ttu-id="06f9d-154">VirtualPathContext.Values</span><span class="sxs-lookup"><span data-stu-id="06f9d-154">VirtualPathContext.Values</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*)
* [<span data-ttu-id="06f9d-155">VirtualPathContext.AmbientValues</span><span class="sxs-lookup"><span data-stu-id="06f9d-155">VirtualPathContext.AmbientValues</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*)

<span data-ttu-id="06f9d-156">路由主要使用 `Values` 和 `AmbientValues` 所提供的路由值，以決定可能產生 URL　的位置以及要包含哪些值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-156">Routes primarily use the route values provided by the `Values` and `AmbientValues` to decide where it's possible to generate a URL and what values to include.</span></span> <span data-ttu-id="06f9d-157">`AmbientValues` 是比對目前要求與路由系統所產生之路由值的集合。</span><span class="sxs-lookup"><span data-stu-id="06f9d-157">The `AmbientValues` are the set of route values that were produced from matching the current request with the routing system.</span></span> <span data-ttu-id="06f9d-158">相反地，`Values` 是指定如何產生目前作業所需之 URL 的路由值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-158">In contrast, `Values` are the route values that specify how to generate the desired URL for the current operation.</span></span> <span data-ttu-id="06f9d-159">提供了 `HttpContext`，以防路由需要取得服務或與目前內容建立關聯的其他資料。</span><span class="sxs-lookup"><span data-stu-id="06f9d-159">The `HttpContext` is provided in case a route needs to obtain services or additional data associated with the current context.</span></span>

> [!TIP]
> <span data-ttu-id="06f9d-160">將 [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) 視為 [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*) 的覆寫項目集合。</span><span class="sxs-lookup"><span data-stu-id="06f9d-160">Think of [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) as being a set of overrides for the [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*).</span></span> <span data-ttu-id="06f9d-161">URL 產生會嘗試重複使用來自目前要求的路由值，讓您輕鬆地使用相同的路由或路由值產生連結的 URL。</span><span class="sxs-lookup"><span data-stu-id="06f9d-161">URL generation attempts to reuse route values from the current request to make it easy to generate URLs for links using the same route or route values.</span></span>

<span data-ttu-id="06f9d-162">`GetVirtualPath` 的輸出是 `VirtualPathData`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-162">The output of `GetVirtualPath` is a `VirtualPathData`.</span></span> <span data-ttu-id="06f9d-163">`VirtualPathData` 是 `RouteData` 的平行處理。</span><span class="sxs-lookup"><span data-stu-id="06f9d-163">`VirtualPathData` is a parallel of `RouteData`.</span></span> <span data-ttu-id="06f9d-164">`VirtualPathData` 包含用於輸出 URL 的 `VirtualPath`，以及一些路由應該設定的其他屬性。</span><span class="sxs-lookup"><span data-stu-id="06f9d-164">`VirtualPathData` contains the `VirtualPath` for the output URL and some additional properties that should be set by the route.</span></span>

<span data-ttu-id="06f9d-165">[VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) 屬性包含路由所產生的「虛擬路徑」。</span><span class="sxs-lookup"><span data-stu-id="06f9d-165">The [VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) property contains the *virtual path* produced by the route.</span></span> <span data-ttu-id="06f9d-166">視您需求的不同，可能需要進一步處理路徑。</span><span class="sxs-lookup"><span data-stu-id="06f9d-166">Depending on your needs, you may need to process the path further.</span></span> <span data-ttu-id="06f9d-167">如果您想要以 HTML 呈現產生的 URL，請在前面加上應用程式的基底路徑。</span><span class="sxs-lookup"><span data-stu-id="06f9d-167">If you want to render the generated URL in HTML, prepend the base path of the app.</span></span>

<span data-ttu-id="06f9d-168">[VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) 是成功產生 URL 的路由參考。</span><span class="sxs-lookup"><span data-stu-id="06f9d-168">The [VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) is a reference to the route that successfully generated the URL.</span></span>

<span data-ttu-id="06f9d-169">[VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) 屬性是其他資料的字典，而這些資料與產生 URL 的路由相關。</span><span class="sxs-lookup"><span data-stu-id="06f9d-169">The [VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) properties is a dictionary of additional data related to the route that generated the URL.</span></span> <span data-ttu-id="06f9d-170">這是 [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) 的平行處理。</span><span class="sxs-lookup"><span data-stu-id="06f9d-170">This is the parallel of [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*).</span></span>

### <a name="creating-routes"></a><span data-ttu-id="06f9d-171">建立路由</span><span class="sxs-lookup"><span data-stu-id="06f9d-171">Creating routes</span></span>

<span data-ttu-id="06f9d-172">路由提供 <xref:Microsoft.AspNetCore.Routing.Route> 類別作為 <xref:Microsoft.AspNetCore.Routing.IRouter> 的標準實作。</span><span class="sxs-lookup"><span data-stu-id="06f9d-172">Routing provides the <xref:Microsoft.AspNetCore.Routing.Route> class as the standard implementation of <xref:Microsoft.AspNetCore.Routing.IRouter>.</span></span> <span data-ttu-id="06f9d-173">在呼叫 <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> 時，`Route` 會使用「路由範本」語法來定義將比對 URL 路徑的模式。</span><span class="sxs-lookup"><span data-stu-id="06f9d-173">`Route` uses the *route template* syntax to define patterns that match against the URL path when <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> is called.</span></span> <span data-ttu-id="06f9d-174">在呼叫 `GetVirtualPath` 時，`Route` 會使用相同的路由範本來產生 URL。</span><span class="sxs-lookup"><span data-stu-id="06f9d-174">`Route` uses the same route template to generate a URL when `GetVirtualPath` is called.</span></span>

<span data-ttu-id="06f9d-175">大部分的應用程式會藉由呼叫 <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> 或其中一個 <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> 上定義的類似擴充方法來定建立路由。</span><span class="sxs-lookup"><span data-stu-id="06f9d-175">Most apps create routes by calling <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> or one of the similar extension methods defined on <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span></span> <span data-ttu-id="06f9d-176">所有這些方法都會建立 <xref:Microsoft.AspNetCore.Routing.Route> 的執行個體，並將它新增至路由集合。</span><span class="sxs-lookup"><span data-stu-id="06f9d-176">All of these methods create an instance of <xref:Microsoft.AspNetCore.Routing.Route> and add it to the route collection.</span></span>

<span data-ttu-id="06f9d-177">`MapRoute` 不會採用路由處理常式參數。</span><span class="sxs-lookup"><span data-stu-id="06f9d-177">`MapRoute` doesn't take a route handler parameter.</span></span> <span data-ttu-id="06f9d-178">`MapRoute` 只會新增 <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*> 所處理的路由。</span><span class="sxs-lookup"><span data-stu-id="06f9d-178">`MapRoute` only adds routes that are handled by the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span> <span data-ttu-id="06f9d-179">由於預設處理常式是 `IRouter`，它可能決定不處理要求。</span><span class="sxs-lookup"><span data-stu-id="06f9d-179">Since the default handler is an `IRouter`, it may decide not to handle the request.</span></span> <span data-ttu-id="06f9d-180">例如，ASP.NET Core MVC 通常會設定為預設處理常式，只處理符合可用控制器和動作的要求。</span><span class="sxs-lookup"><span data-stu-id="06f9d-180">For example, ASP.NET Core MVC is typically configured as a default handler that only handles requests that match an available controller and action.</span></span> <span data-ttu-id="06f9d-181">若要深入了解如何路由至 MVC，請參閱 <xref:mvc/controllers/routing>。</span><span class="sxs-lookup"><span data-stu-id="06f9d-181">To learn more about routing to MVC, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="06f9d-182">下列程式碼範例是典型 ASP.NET Core MVC 路由定義所使用的 `MapRoute` 呼叫範例：</span><span class="sxs-lookup"><span data-stu-id="06f9d-182">The following code example is an example of a `MapRoute` call used by a typical ASP.NET Core MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="06f9d-183">此範本符合 `/Products/Details/17` 等 URL 路徑，並擷取路由值 `{ controller = Products, action = Details, id = 17 }`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-183">This template matches a URL path like `/Products/Details/17` and extracts the route values `{ controller = Products, action = Details, id = 17 }`.</span></span> <span data-ttu-id="06f9d-184">路由值是通過將 URL 路徑分割成區段，並比對每個區段與路由範本中的「路由參數」名稱來判定。</span><span class="sxs-lookup"><span data-stu-id="06f9d-184">The route values are determined by splitting the URL path into segments and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="06f9d-185">路由參數為具名。</span><span class="sxs-lookup"><span data-stu-id="06f9d-185">Route parameters are named.</span></span> <span data-ttu-id="06f9d-186">它們透過以括弧 `{ ... }` 括住參數名稱來定義。</span><span class="sxs-lookup"><span data-stu-id="06f9d-186">They're defined by enclosing the parameter name in braces `{ ... }`.</span></span>

<span data-ttu-id="06f9d-187">上述範本也可以比對 URL 路徑 `/` 並產生值 `{ controller = Home, action = Index }`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-187">The preceding template could also match the URL path `/` and would produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="06f9d-188">發生這種情況是因為 `{controller}` 和 `{action}` 路由參數有預設值，而 `id` 路由參數為選擇性參數。</span><span class="sxs-lookup"><span data-stu-id="06f9d-188">This occurs because the `{controller}` and `{action}` route parameters have default values and the `id` route parameter is optional.</span></span> <span data-ttu-id="06f9d-189">路由參數名稱之後緊接著值的等於 `=` 符號定義參數的預設值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-189">An equals `=` sign followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="06f9d-190">路由參數名稱之後的問號 `?` 則會將參數定義為選擇性。</span><span class="sxs-lookup"><span data-stu-id="06f9d-190">A question mark `?` after the route parameter name defines the parameter as optional.</span></span> <span data-ttu-id="06f9d-191">在路由相符時，具有預設值的路由參數一定會產生路由值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-191">Route parameters with a default value *always* produce a route value when the route matches.</span></span> <span data-ttu-id="06f9d-192">如果沒有任何對應的 URL 路徑區段，選擇性參數不會產生路由值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-192">Optional parameters don't produce a route value if there was no corresponding URL path segment.</span></span>

<span data-ttu-id="06f9d-193">如需路由範本功能和語法的詳細描述，請參閱[路由範本參考](#route-template-reference)。</span><span class="sxs-lookup"><span data-stu-id="06f9d-193">See [route-template-reference](#route-template-reference) for a thorough description of route template features and syntax.</span></span>

<span data-ttu-id="06f9d-194">這個範例包含「路由條件約束」：</span><span class="sxs-lookup"><span data-stu-id="06f9d-194">This example includes a *route constraint*:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="06f9d-195">此範本會符合 `/Products/Details/17` 等 URL 路徑，但不符合 `/Products/Details/Apples`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-195">This template matches a URL path like `/Products/Details/17` but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="06f9d-196">路由參數定義 `{id:int}` 定義 `id` 路由參數的[「路由條件約束」](#route-constraint-reference)。</span><span class="sxs-lookup"><span data-stu-id="06f9d-196">The route parameter definition `{id:int}` defines a [route constraint](#route-constraint-reference) for the `id` route parameter.</span></span> <span data-ttu-id="06f9d-197">路由條件約束會實作 <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>，並檢查路由值以進行驗證。</span><span class="sxs-lookup"><span data-stu-id="06f9d-197">Route constraints implement <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> and inspect route values to verify them.</span></span> <span data-ttu-id="06f9d-198">在此範例中，路由值 `id` 必須可以轉換為整數。</span><span class="sxs-lookup"><span data-stu-id="06f9d-198">In this example, the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="06f9d-199">如需架構所提供之路由條件約束的詳細說明，請參閱[路由條件約束參考](#route-constraint-reference)。</span><span class="sxs-lookup"><span data-stu-id="06f9d-199">See [route-constraint-reference](#route-constraint-reference) for a more detailed explanation of route constraints that are provided by the framework.</span></span>

<span data-ttu-id="06f9d-200">`MapRoute` 的其他多載接受 `constraints`、`dataTokens` 和 `defaults` 的值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-200">Additional overloads of `MapRoute` accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="06f9d-201">這些額外的 `MapRoute` 參數定義為 `object` 類型。</span><span class="sxs-lookup"><span data-stu-id="06f9d-201">These additional parameters of `MapRoute` are defined as type `object`.</span></span> <span data-ttu-id="06f9d-202">這些參數通常是用來傳遞匿名類型的物件，其中匿名類型的屬性名稱符合路由參數名稱。</span><span class="sxs-lookup"><span data-stu-id="06f9d-202">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="06f9d-203">下列兩個範例會建立對等的路由：</span><span class="sxs-lookup"><span data-stu-id="06f9d-203">The following two examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

> [!TIP]
> <span data-ttu-id="06f9d-204">對於簡單的路由而言，定義條件約束和預設的內嵌語法可能很方便。</span><span class="sxs-lookup"><span data-stu-id="06f9d-204">The inline syntax for defining constraints and defaults can be convenient for simple routes.</span></span> <span data-ttu-id="06f9d-205">不過，內嵌語法不支援資料語彙基元等功能。</span><span class="sxs-lookup"><span data-stu-id="06f9d-205">However, there are features, such as data tokens, that aren't supported by inline syntax.</span></span>

<span data-ttu-id="06f9d-206">下列範例將示範一些其他案例：</span><span class="sxs-lookup"><span data-stu-id="06f9d-206">The following example demonstrates a few more scenarios:</span></span>

```csharp
routes.MapRoute(
    name: "blog",
    template: "Blog/{*article}",
    defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="06f9d-207">此範本符合 `/Blog/All-About-Routing/Introduction` 等 URL 路徑，並擷取值 `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-207">This template matches a URL path like `/Blog/All-About-Routing/Introduction` and extracts the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="06f9d-208">即使範本中沒有任何對應的路由參數，路由也會產生 `controller` 和 `action` 的預設路由值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-208">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="06f9d-209">預設值可以在路由範本中指定。</span><span class="sxs-lookup"><span data-stu-id="06f9d-209">Default values can be specified in the route template.</span></span> <span data-ttu-id="06f9d-210">`article` 路由參數透過在路由參數名稱之前加上 `*`，定義為「全部擷取」參數。</span><span class="sxs-lookup"><span data-stu-id="06f9d-210">The `article` route parameter is defined as a *catch-all* by the appearance of an asterisk `*` before the route parameter name.</span></span> <span data-ttu-id="06f9d-211">全部擷取路由參數會擷取 URL 路徑的其餘部分，而且也可以符合空字串。</span><span class="sxs-lookup"><span data-stu-id="06f9d-211">Catch-all route parameters capture the remainder of the URL path and can also match the empty string.</span></span>

<span data-ttu-id="06f9d-212">這個範例會新增路由條件約束和資料語彙基元：</span><span class="sxs-lookup"><span data-stu-id="06f9d-212">This example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="06f9d-213">此範本符合 `/en-US/Products/5` 等 URL 路徑，並擷取值 `{ controller = Products, action = Details, id = 5 }` 和資料語彙基元 `{ locale = en-US }`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-213">This template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![[區域變數] 視窗語彙基元](routing/_static/tokens.png)

### <a name="url-generation"></a><span data-ttu-id="06f9d-215">URL 產生</span><span class="sxs-lookup"><span data-stu-id="06f9d-215">URL generation</span></span>

<span data-ttu-id="06f9d-216">`Route` 類別也可以結合一組路由值與其路由範本來產生 URL。</span><span class="sxs-lookup"><span data-stu-id="06f9d-216">The `Route` class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="06f9d-217">這在邏輯上是比對 URL 路徑的反向處理序。</span><span class="sxs-lookup"><span data-stu-id="06f9d-217">This is logically the reverse process of matching the URL path.</span></span>

> [!TIP]
> <span data-ttu-id="06f9d-218">若要進一步了解 URL 產生，請假設您想要產生的 URL，並考慮路由範本將會如何比對該 URL。</span><span class="sxs-lookup"><span data-stu-id="06f9d-218">To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="06f9d-219">產生的值為何？</span><span class="sxs-lookup"><span data-stu-id="06f9d-219">What values would be produced?</span></span> <span data-ttu-id="06f9d-220">這與 URL 產生在 `Route` 類別中的運作方式大致相同。</span><span class="sxs-lookup"><span data-stu-id="06f9d-220">This is the rough equivalent of how URL generation works in the `Route` class.</span></span>

<span data-ttu-id="06f9d-221">這個範例使用基本的 ASP.NET Core MVC 樣式路由：</span><span class="sxs-lookup"><span data-stu-id="06f9d-221">This example uses a basic ASP.NET Core MVC style route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="06f9d-222">路由值為 `{ controller = Products, action = List }` 時，此路由會產生 URL `/Products/List`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-222">With the route values `{ controller = Products, action = List }`, this route generates the URL `/Products/List`.</span></span> <span data-ttu-id="06f9d-223">路由值會取代對應的路由參數，以形成 URL 路徑。</span><span class="sxs-lookup"><span data-stu-id="06f9d-223">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="06f9d-224">由於 `id` 是選擇性路由參數，因此它沒有值也不會有問題。</span><span class="sxs-lookup"><span data-stu-id="06f9d-224">Since `id` is an optional route parameter, it's no problem that it doesn't have a value.</span></span>

<span data-ttu-id="06f9d-225">路由值為 `{ controller = Home, action = Index }` 時，此路由會產生 URL `/`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-225">With the route values `{ controller = Home, action = Index }`, this route generates the URL `/`.</span></span> <span data-ttu-id="06f9d-226">所提供的路由值符合預設值，因此可以放心地省略這些值對應的區段。</span><span class="sxs-lookup"><span data-stu-id="06f9d-226">The route values that were provided match the default values so that the segments corresponding to those values can be safely omitted.</span></span> <span data-ttu-id="06f9d-227">這兩個產生的 URL 會使用此路由定義反覆存取，並產生用來產生 URL 的相同路由值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-227">Both URLs generated round-trip with this route definition and produce the same route values that were used to generate the URL.</span></span>

> [!TIP]
> <span data-ttu-id="06f9d-228">使用 ASP.NET Core MVC 的應用程式應該使用 <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> 來產生 URL，而不是直接呼叫路由。</span><span class="sxs-lookup"><span data-stu-id="06f9d-228">An app using ASP.NET Core MVC should use <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="06f9d-229">如需 URL 產生的詳細資訊，請參閱 [url-generation-reference](#url-generation-reference)。</span><span class="sxs-lookup"><span data-stu-id="06f9d-229">For more information about URL generation, see [url-generation-reference](#url-generation-reference).</span></span>

## <a name="use-routing-middleware"></a><span data-ttu-id="06f9d-230">使用路由中介軟體</span><span class="sxs-lookup"><span data-stu-id="06f9d-230">Use Routing Middleware</span></span>

::: moniker range=">= aspnetcore-2.1"

<span data-ttu-id="06f9d-231">參考應用程式專案檔中的 [Microsoft.AspNetCore.App 中繼套件](xref:fundamentals/metapackage-app)。</span><span class="sxs-lookup"><span data-stu-id="06f9d-231">Reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the app's project file.</span></span>

::: moniker-end

::: moniker range="= aspnetcore-2.0"

<span data-ttu-id="06f9d-232">參考應用程式專案檔中的 [Microsoft.AspNetCore.All 中繼套件](xref:fundamentals/metapackage)。</span><span class="sxs-lookup"><span data-stu-id="06f9d-232">Reference the [Microsoft.AspNetCore.All metapackage](xref:fundamentals/metapackage) in the app's project file.</span></span>

::: moniker-end

::: moniker range="< aspnetcore-2.0"

<span data-ttu-id="06f9d-233">參考應用程式專案檔中的 [Microsoft.AspNetCore.Routing](https://www.nuget.org/packages/Microsoft.AspNetCore.Routing/)。</span><span class="sxs-lookup"><span data-stu-id="06f9d-233">Reference the [Microsoft.AspNetCore.Routing](https://www.nuget.org/packages/Microsoft.AspNetCore.Routing/) in the app's project file.</span></span>

::: moniker-end

<span data-ttu-id="06f9d-234">在 `Startup.ConfigureServices` 中，將路由新增至服務容器：</span><span class="sxs-lookup"><span data-stu-id="06f9d-234">Add routing to the service container in `Startup.ConfigureServices`:</span></span>

::: moniker range=">= aspnetcore-2.0"

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

::: moniker-end

::: moniker range="< aspnetcore-2.0"

[!code-csharp[](routing/samples/1.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

::: moniker-end

<span data-ttu-id="06f9d-235">路由必須設定在 `Startup.Configure` 方法中。</span><span class="sxs-lookup"><span data-stu-id="06f9d-235">Routes must be configured in the `Startup.Configure` method.</span></span> <span data-ttu-id="06f9d-236">範例應用程式使用這些 API：</span><span class="sxs-lookup"><span data-stu-id="06f9d-236">The sample app uses these APIs:</span></span>

* `RouteBuilder`
* `Build`
* <span data-ttu-id="06f9d-237">`MapGet` &ndash; 僅符合 HTTP GET 要求。</span><span class="sxs-lookup"><span data-stu-id="06f9d-237">`MapGet` &ndash; Matches only HTTP GET requests.</span></span>
* `UseRouter`

::: moniker range=">= aspnetcore-2.0"

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

::: moniker-end

::: moniker range="< aspnetcore-2.0"

[!code-csharp[](routing/samples/1.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

::: moniker-end

<span data-ttu-id="06f9d-238">下表顯示使用指定 URL 的回應。</span><span class="sxs-lookup"><span data-stu-id="06f9d-238">The following table shows the responses with the given URIs.</span></span>

| <span data-ttu-id="06f9d-239">URI</span><span class="sxs-lookup"><span data-stu-id="06f9d-239">URI</span></span>                  | <span data-ttu-id="06f9d-240">回應</span><span class="sxs-lookup"><span data-stu-id="06f9d-240">Response</span></span>                                          |
| -------------------- | ------------------------------------------------- |
| <span data-ttu-id="06f9d-241">/package/create/3</span><span class="sxs-lookup"><span data-stu-id="06f9d-241">/package/create/3</span></span>    | <span data-ttu-id="06f9d-242">Hello!</span><span class="sxs-lookup"><span data-stu-id="06f9d-242">Hello!</span></span> <span data-ttu-id="06f9d-243">Route values: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="06f9d-243">Route values: [operation, create], [id, 3]</span></span> |
| <span data-ttu-id="06f9d-244">/package/track/-3</span><span class="sxs-lookup"><span data-stu-id="06f9d-244">/package/track/-3</span></span>    | <span data-ttu-id="06f9d-245">Hello!</span><span class="sxs-lookup"><span data-stu-id="06f9d-245">Hello!</span></span> <span data-ttu-id="06f9d-246">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="06f9d-246">Route values: [operation, track], [id, -3]</span></span> |
| <span data-ttu-id="06f9d-247">/package/track/-3/</span><span class="sxs-lookup"><span data-stu-id="06f9d-247">/package/track/-3/</span></span>   | <span data-ttu-id="06f9d-248">Hello!</span><span class="sxs-lookup"><span data-stu-id="06f9d-248">Hello!</span></span> <span data-ttu-id="06f9d-249">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="06f9d-249">Route values: [operation, track], [id, -3]</span></span> |
| <span data-ttu-id="06f9d-250">/package/track/</span><span class="sxs-lookup"><span data-stu-id="06f9d-250">/package/track/</span></span>      | <span data-ttu-id="06f9d-251">&lt;正常執行，沒有相符項目&gt;</span><span class="sxs-lookup"><span data-stu-id="06f9d-251">&lt;Fall through, no match&gt;</span></span>                    |
| <span data-ttu-id="06f9d-252">GET /hello/Joe</span><span class="sxs-lookup"><span data-stu-id="06f9d-252">GET /hello/Joe</span></span>       | <span data-ttu-id="06f9d-253">Hi, Joe!</span><span class="sxs-lookup"><span data-stu-id="06f9d-253">Hi, Joe!</span></span>                                          |
| <span data-ttu-id="06f9d-254">POST /hello/Joe</span><span class="sxs-lookup"><span data-stu-id="06f9d-254">POST /hello/Joe</span></span>      | <span data-ttu-id="06f9d-255">&lt;正常執行，僅符合 HTTP GET&gt;</span><span class="sxs-lookup"><span data-stu-id="06f9d-255">&lt;Fall through, matches HTTP GET only&gt;</span></span>       |
| <span data-ttu-id="06f9d-256">GET /hello/Joe/Smith</span><span class="sxs-lookup"><span data-stu-id="06f9d-256">GET /hello/Joe/Smith</span></span> | <span data-ttu-id="06f9d-257">&lt;正常執行，沒有相符項目&gt;</span><span class="sxs-lookup"><span data-stu-id="06f9d-257">&lt;Fall through, no match&gt;</span></span>                    |

<span data-ttu-id="06f9d-258">如果您要設定單一路由，請呼叫傳入 `IRouter` 執行個體的 <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*>。</span><span class="sxs-lookup"><span data-stu-id="06f9d-258">If you're configuring a single route, call <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*> passing in an `IRouter` instance.</span></span> <span data-ttu-id="06f9d-259">您不需要使用 <xref:Microsoft.AspNetCore.Routing.RouteBuilder>。</span><span class="sxs-lookup"><span data-stu-id="06f9d-259">You won't need to use <xref:Microsoft.AspNetCore.Routing.RouteBuilder>.</span></span>

<span data-ttu-id="06f9d-260">架構會提供一組擴充方法來建立路由，例如：</span><span class="sxs-lookup"><span data-stu-id="06f9d-260">The framework provides a set of extension methods for creating routes, such as:</span></span>

* `MapRoute`
* `MapGet`
* `MapPost`
* `MapPut`
* `MapDelete`
* `MapVerb`

<span data-ttu-id="06f9d-261">其中一些方法 (例如 `MapGet`) 需要提供 `RequestDelegate`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-261">Some of these methods, such as `MapGet`, require a `RequestDelegate` to be provided.</span></span> <span data-ttu-id="06f9d-262">路由相符時，`RequestDelegate` 會作為「路由處理常式」使用。</span><span class="sxs-lookup"><span data-stu-id="06f9d-262">The `RequestDelegate` is used as the *route handler* when the route matches.</span></span> <span data-ttu-id="06f9d-263">此系列中的其他方法允許設定中介軟體管線，以作為路由處理常式使用。</span><span class="sxs-lookup"><span data-stu-id="06f9d-263">Other methods in this family allow configuring a middleware pipeline for use as the route handler.</span></span> <span data-ttu-id="06f9d-264">如果 *Map* 方法不接受處理常式 (例如 `MapRoute`)，則它會使用 <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>。</span><span class="sxs-lookup"><span data-stu-id="06f9d-264">If the *Map* method doesn't accept a handler, such as `MapRoute`, then it uses the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span>

<span data-ttu-id="06f9d-265">`Map[Verb]` 方法會使用條件約束，將路由限制為方法名稱中的 HTTP 指令動詞。</span><span class="sxs-lookup"><span data-stu-id="06f9d-265">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="06f9d-266">如需範例，請參閱 <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> 與 <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>。</span><span class="sxs-lookup"><span data-stu-id="06f9d-266">For example, see <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> and <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="06f9d-267">路由範本參考</span><span class="sxs-lookup"><span data-stu-id="06f9d-267">Route template reference</span></span>

<span data-ttu-id="06f9d-268">大括弧 (`{ ... }`) 內的語彙基元定義路由相符時會繫結的「路由參數」。</span><span class="sxs-lookup"><span data-stu-id="06f9d-268">Tokens within curly braces (`{ ... }`) define *route parameters* that are bound if the route is matched.</span></span> <span data-ttu-id="06f9d-269">您可以在路由區段中定義多個路由參數，但其必須以常值分隔。</span><span class="sxs-lookup"><span data-stu-id="06f9d-269">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="06f9d-270">例如，`{controller=Home}{action=Index}` 不是有效的路由，因為 `{controller}` 與 `{action}` 之間沒有任何常值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-270">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="06f9d-271">這些路由參數必須有一個名稱，並且可以指定其他屬性。</span><span class="sxs-lookup"><span data-stu-id="06f9d-271">These route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="06f9d-272">路由參數之外的常值文字 (例如，`{id}`) 和路徑分隔符號 `/` 必須符合 URL 中的文字。</span><span class="sxs-lookup"><span data-stu-id="06f9d-272">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="06f9d-273">文字比對會區分大小寫，並以 URL 路徑的已解碼表示法為基礎。</span><span class="sxs-lookup"><span data-stu-id="06f9d-273">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="06f9d-274">若要與常值路由參數分隔符號 `{` 或 `}` 相符，請重複字元 (`{{` 或 `}}`) 來將它逸出。</span><span class="sxs-lookup"><span data-stu-id="06f9d-274">To match the literal route parameter delimiter `{` or  `}`, escape it by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="06f9d-275">URL 模式嘗試擷取具有選擇性副檔名的檔案名稱時，具有其他考量。</span><span class="sxs-lookup"><span data-stu-id="06f9d-275">URL patterns that attempt to capture a filename with an optional file extension have additional considerations.</span></span> <span data-ttu-id="06f9d-276">以範本 `files/{filename}.{ext?}` 為例。</span><span class="sxs-lookup"><span data-stu-id="06f9d-276">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="06f9d-277">當 `filename` 和 `ext` 都存在時，就會填入這兩個值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-277">When both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="06f9d-278">如果 URL 中只有 `filename` 存在，由於結尾的句點 `.` 是選擇性項目，因此路由相符。</span><span class="sxs-lookup"><span data-stu-id="06f9d-278">If only `filename` exists in the URL, the route matches because the trailing period `.` is  optional.</span></span> <span data-ttu-id="06f9d-279">下列 URL 符合此路由：</span><span class="sxs-lookup"><span data-stu-id="06f9d-279">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="06f9d-280">您可以使用 `*` 字元作為路由參數的前置詞，以繫結至 URI 的其餘部分。</span><span class="sxs-lookup"><span data-stu-id="06f9d-280">You can use the `*` character as a prefix to a route parameter to bind to the rest of the URI.</span></span> <span data-ttu-id="06f9d-281">這稱為「全部擷取」參數。</span><span class="sxs-lookup"><span data-stu-id="06f9d-281">This is called a *catch-all* parameter.</span></span> <span data-ttu-id="06f9d-282">例如，`blog/{*slug}` 符合以 `/blog` 開頭且其後有任何值 (這會指派給 `slug` 路由值) 的所有 URI。</span><span class="sxs-lookup"><span data-stu-id="06f9d-282">For example, `blog/{*slug}` matches any URI that starts with `/blog` and had any value following it (which is assigned to the `slug` route value).</span></span> <span data-ttu-id="06f9d-283">全部擷取參數也可以符合空字串。</span><span class="sxs-lookup"><span data-stu-id="06f9d-283">Catch-all parameters can also match the empty string.</span></span>

::: moniker range=">= aspnetcore-2.2"

<span data-ttu-id="06f9d-284">當使用路由產生 URL (包括路徑分隔符號 (`/`) 字元) 時，catch-all 參數會逸出適當的字元。</span><span class="sxs-lookup"><span data-stu-id="06f9d-284">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator (`/`) characters.</span></span> <span data-ttu-id="06f9d-285">例如，路由值為 `{ path = "my/path" }` 的路由 `foo/{*path}` 會產生 `foo/my%2Fpath`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-285">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="06f9d-286">請注意逸出的斜線。</span><span class="sxs-lookup"><span data-stu-id="06f9d-286">Note the escaped forward slash.</span></span> <span data-ttu-id="06f9d-287">若要反覆存取路徑分隔符號字元，請使用 `**` 路由參數前置詞。</span><span class="sxs-lookup"><span data-stu-id="06f9d-287">To round-trip path separator characters, use the `**` route parameter prefix.</span></span> <span data-ttu-id="06f9d-288">具有 `{ path = "my/path" }` 的路由 `foo/{**path}` 會產生 `foo/my/path`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-288">The route `foo/{**path}` with `{ path = "my/path" }` generates `foo/my/path`.</span></span>

::: moniker-end

<span data-ttu-id="06f9d-289">路由參數可能有「預設值」，指定方法是在參數名稱之後指定預設值，並以等號 (`=`) 分隔。</span><span class="sxs-lookup"><span data-stu-id="06f9d-289">Route parameters may have *default values*, designated by specifying the default after the parameter name, separated by an equals sign (`=`).</span></span> <span data-ttu-id="06f9d-290">例如，`{controller=Home}` 定義 `Home` 作為 `controller` 的預設值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-290">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="06f9d-291">如果 URL 中沒有用於參數的任何值，則會使用預設值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-291">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="06f9d-292">除了預設值之外，路由參數也可以是選擇性參數，指定方法是在參數名稱結尾附加問號 (`?`)，如 `id?` 所示。</span><span class="sxs-lookup"><span data-stu-id="06f9d-292">In addition to default values, route parameters may be optional, specified by appending a question mark (`?`) to the end of the parameter name, as in `id?`.</span></span> <span data-ttu-id="06f9d-293">選擇性值與預設路由參數之間的差異在於，具有預設值的路由參數一定會產生值；選擇性參數只有在要求 URL 提供值時才會有值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-293">The difference between optional values and default route parameters is that a route parameter with a default value always produces a value; an optional parameter has a value only when a value is provided by the request URL.</span></span>

::: moniker range=">= aspnetcore-2.2"

<span data-ttu-id="06f9d-294">路由參數可能具有條件約束，這些條件約束必須符合與 URL 繫結的路由值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-294">Route parameters may have constraints, which must match the route value bound from the URL.</span></span> <span data-ttu-id="06f9d-295">在路由參數名稱之後新增分號 (`:`) 和條件約束名稱，即可指定路由參數的「內嵌條件約束」。</span><span class="sxs-lookup"><span data-stu-id="06f9d-295">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="06f9d-296">如果條件約束需要引數，這些引數會在條件約束名稱後面以括弧 `( )` 括住。</span><span class="sxs-lookup"><span data-stu-id="06f9d-296">If the constraint requires arguments, they're enclosed in parentheses `( )` after the constraint name.</span></span> <span data-ttu-id="06f9d-297">指定多個內嵌條件約束的方法是附加另一個冒號 (`:`) 和條件約束名稱。</span><span class="sxs-lookup"><span data-stu-id="06f9d-297">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span> <span data-ttu-id="06f9d-298">條件約束名稱和引述會傳遞至 <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> 服務來建立 <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> 的執行個體，以用於 URL 處理。</span><span class="sxs-lookup"><span data-stu-id="06f9d-298">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="06f9d-299">如果條件約束建構函式需要服務，則其會從相依性插入的應用程式服務中解析。</span><span class="sxs-lookup"><span data-stu-id="06f9d-299">If the constraint constructor requires services, they're resolved from dependency injection's app services.</span></span> <span data-ttu-id="06f9d-300">例如，路由範本 `blog/{article:minlength(10)}` 指定具有引數 `10` 的 `minlength` 條件約束。</span><span class="sxs-lookup"><span data-stu-id="06f9d-300">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="06f9d-301">如需路由條件約束詳細資訊和架構所提供的條件約束清單，請參閱[路由條件約束參考](#route-constraint-reference)一節。</span><span class="sxs-lookup"><span data-stu-id="06f9d-301">For more information on route constraints and a listing of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

::: moniker-end

::: moniker range="< aspnetcore-2.2"

<span data-ttu-id="06f9d-302">路由參數可能具有條件約束，這些條件約束必須符合與 URL 繫結的路由值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-302">Route parameters may have constraints, which must match the route value bound from the URL.</span></span> <span data-ttu-id="06f9d-303">在路由參數名稱之後新增分號 (`:`) 和條件約束名稱，即可指定路由參數的「內嵌條件約束」。</span><span class="sxs-lookup"><span data-stu-id="06f9d-303">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="06f9d-304">如果條件約束需要引數，這些引數會在條件約束名稱後面以括弧 `( )` 括住。</span><span class="sxs-lookup"><span data-stu-id="06f9d-304">If the constraint requires arguments, they're enclosed in parentheses `( )` after the constraint name.</span></span> <span data-ttu-id="06f9d-305">指定多個內嵌條件約束的方法是附加另一個冒號 (`:`) 和條件約束名稱。</span><span class="sxs-lookup"><span data-stu-id="06f9d-305">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span> <span data-ttu-id="06f9d-306">條件約束名稱和引述會傳遞至 <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> 服務來建立 <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> 的執行個體，以用於 URL 處理。</span><span class="sxs-lookup"><span data-stu-id="06f9d-306">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="06f9d-307">例如，路由範本 `blog/{article:minlength(10)}` 指定具有引數 `10` 的 `minlength` 條件約束。</span><span class="sxs-lookup"><span data-stu-id="06f9d-307">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="06f9d-308">如需路由條件約束詳細資訊和架構所提供的條件約束清單，請參閱[路由條件約束參考](#route-constraint-reference)一節。</span><span class="sxs-lookup"><span data-stu-id="06f9d-308">For more information on route constraints and a listing of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

::: moniker-end

::: moniker range=">= aspnetcore-2.2"

<span data-ttu-id="06f9d-309">路由參數也可以具有參數轉換器，會在產生連結和將動作與頁面比對至 URI 時，轉換參數的值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-309">Route parameters may also have parameter transformers, which transform a parameter's value when generating links and matching actions and pages to URIs.</span></span> <span data-ttu-id="06f9d-310">與條件約束類似，可以透過在路徑參數名稱後面新增冒號 (`:`) 和轉換器名稱，將參數轉換器內嵌新增至路徑參數。</span><span class="sxs-lookup"><span data-stu-id="06f9d-310">Like constraints, parameter transformers can be added inline to a route parameter by adding a colon (`:`) and transformer name after the route parameter name.</span></span> <span data-ttu-id="06f9d-311">例如，路由範本 `blog/{article:slugify}` 會指定 `slugify` 轉換器。</span><span class="sxs-lookup"><span data-stu-id="06f9d-311">For example, the route template `blog/{article:slugify}` specifies a `slugify` transformer.</span></span>

::: moniker-end

<span data-ttu-id="06f9d-312">下表示範一些路由範本及其行為。</span><span class="sxs-lookup"><span data-stu-id="06f9d-312">The following table demonstrates some route templates and their behavior.</span></span>

| <span data-ttu-id="06f9d-313">路由範本</span><span class="sxs-lookup"><span data-stu-id="06f9d-313">Route Template</span></span>                         | <span data-ttu-id="06f9d-314">範例比對 URL</span><span class="sxs-lookup"><span data-stu-id="06f9d-314">Example Matching URL</span></span>  | <span data-ttu-id="06f9d-315">注意</span><span class="sxs-lookup"><span data-stu-id="06f9d-315">Notes</span></span>                                                                  |
| -------------------------------------- | --------------------- | ---------------------------------------------------------------------- |
| <span data-ttu-id="06f9d-316">hello</span><span class="sxs-lookup"><span data-stu-id="06f9d-316">hello</span></span>                                  | <span data-ttu-id="06f9d-317">/hello</span><span class="sxs-lookup"><span data-stu-id="06f9d-317">/hello</span></span>                | <span data-ttu-id="06f9d-318">只比對單一路徑 `/hello`</span><span class="sxs-lookup"><span data-stu-id="06f9d-318">Only matches the single path `/hello`</span></span>                                  |
| <span data-ttu-id="06f9d-319">{Page=Home}</span><span class="sxs-lookup"><span data-stu-id="06f9d-319">{Page=Home}</span></span>                            | /                     | <span data-ttu-id="06f9d-320">比對並將 `Page` 設定為 `Home`</span><span class="sxs-lookup"><span data-stu-id="06f9d-320">Matches and sets `Page` to `Home`</span></span>                                      |
| <span data-ttu-id="06f9d-321">{Page=Home}</span><span class="sxs-lookup"><span data-stu-id="06f9d-321">{Page=Home}</span></span>                            | <span data-ttu-id="06f9d-322">/Contact</span><span class="sxs-lookup"><span data-stu-id="06f9d-322">/Contact</span></span>              | <span data-ttu-id="06f9d-323">比對並將 `Page` 設定為 `Contact`</span><span class="sxs-lookup"><span data-stu-id="06f9d-323">Matches and sets `Page` to `Contact`</span></span>                                   |
| <span data-ttu-id="06f9d-324">{controller}/{action}/{id?}</span><span class="sxs-lookup"><span data-stu-id="06f9d-324">{controller}/{action}/{id?}</span></span>            | <span data-ttu-id="06f9d-325">/Products/List</span><span class="sxs-lookup"><span data-stu-id="06f9d-325">/Products/List</span></span>        | <span data-ttu-id="06f9d-326">對應至 `Products` 控制器和 `List` 動作</span><span class="sxs-lookup"><span data-stu-id="06f9d-326">Maps to `Products` controller and `List`  action</span></span>                       |
| <span data-ttu-id="06f9d-327">{controller}/{action}/{id?}</span><span class="sxs-lookup"><span data-stu-id="06f9d-327">{controller}/{action}/{id?}</span></span>            | <span data-ttu-id="06f9d-328">/Products/Details/123</span><span class="sxs-lookup"><span data-stu-id="06f9d-328">/Products/Details/123</span></span> |  <span data-ttu-id="06f9d-329">對應至 `Products` 控制器和 `Details` 動作。</span><span class="sxs-lookup"><span data-stu-id="06f9d-329">Maps to `Products` controller and  `Details` action.</span></span>  <span data-ttu-id="06f9d-330">將 `id` 設定為 123</span><span class="sxs-lookup"><span data-stu-id="06f9d-330">`id` set to 123</span></span> |
| <span data-ttu-id="06f9d-331">{controller=Home}/{action=Index}/{id?}</span><span class="sxs-lookup"><span data-stu-id="06f9d-331">{controller=Home}/{action=Index}/{id?}</span></span> | /                     |  <span data-ttu-id="06f9d-332">對應至 `Home` 控制器和 `Index` 方法；會忽略 `id`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-332">Maps to `Home` controller and `Index`  method; `id` is ignored.</span></span>       |

<span data-ttu-id="06f9d-333">使用範本通常是最簡單的路由方式。</span><span class="sxs-lookup"><span data-stu-id="06f9d-333">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="06f9d-334">條件約束和預設值也可以在路由範本外部指定。</span><span class="sxs-lookup"><span data-stu-id="06f9d-334">Constraints and defaults can also be specified outside the route template.</span></span>

> [!TIP]
> <span data-ttu-id="06f9d-335">啟用[記錄](xref:fundamentals/logging/index)以查看內建路由實作 (例如 `Route`) 如何符合要求。</span><span class="sxs-lookup"><span data-stu-id="06f9d-335">Enable [Logging](xref:fundamentals/logging/index) to see how the built in routing implementations, such as `Route`, match requests.</span></span>

## <a name="reserved-routing-names"></a><span data-ttu-id="06f9d-336">保留的路由名稱</span><span class="sxs-lookup"><span data-stu-id="06f9d-336">Reserved routing names</span></span>

<span data-ttu-id="06f9d-337">下列關鍵字是保留的名稱，不能用作路由名稱或參數：</span><span class="sxs-lookup"><span data-stu-id="06f9d-337">The following keywords are reserved names and can't be used as route names or parameters:</span></span>

* `action`
* `area`
* `controller`
* `handler`
* `page`

## <a name="route-constraint-reference"></a><span data-ttu-id="06f9d-338">路由條件約束參考</span><span class="sxs-lookup"><span data-stu-id="06f9d-338">Route constraint reference</span></span>

<span data-ttu-id="06f9d-339">路由條件約束的執行時機是 `Route` 已符合傳入 URL 的語法，並將 URL 路徑語彙基元化成路由值時。</span><span class="sxs-lookup"><span data-stu-id="06f9d-339">Route constraints execute when a `Route` has matched the syntax of the incoming URL and tokenized the URL path into route values.</span></span> <span data-ttu-id="06f9d-340">路由條件約束通常會透過路由範本檢查相關聯的路由值，並對是否可接受值做出是/否決策。</span><span class="sxs-lookup"><span data-stu-id="06f9d-340">Route constraints generally inspect the route value associated via the route template and make a yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="06f9d-341">某些路由條件約束會使用路由值以外的資料，以考慮是否可以路由要求。</span><span class="sxs-lookup"><span data-stu-id="06f9d-341">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="06f9d-342">例如，<xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> 可以依據其 HTTP 指令動詞接受或拒絕要求。</span><span class="sxs-lookup"><span data-stu-id="06f9d-342">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span>

> [!WARNING]
> <span data-ttu-id="06f9d-343">請避免針對**輸入驗證**使用條件約束，因為這麼做表示無效的輸入會導致產生「404 - 找不到」回應，而不是「400 - 錯誤要求」與適當的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="06f9d-343">Avoid using constraints for **input validation** because doing so means that invalid input results in a *404 - Not Found* response instead of a *400 - Bad Request* with an appropriate error message.</span></span> <span data-ttu-id="06f9d-344">路由條件約束會用來**釐清**類似的路由，不是用來驗證特定路由的輸入。</span><span class="sxs-lookup"><span data-stu-id="06f9d-344">Route constraints are used to **disambiguate** between similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="06f9d-345">下表示範一些路由條件約束及其預期行為。</span><span class="sxs-lookup"><span data-stu-id="06f9d-345">The following table demonstrates some route constraints and their expected behavior.</span></span>

| <span data-ttu-id="06f9d-346">條件約束</span><span class="sxs-lookup"><span data-stu-id="06f9d-346">constraint</span></span> | <span data-ttu-id="06f9d-347">範例</span><span class="sxs-lookup"><span data-stu-id="06f9d-347">Example</span></span> | <span data-ttu-id="06f9d-348">範例相符項目</span><span class="sxs-lookup"><span data-stu-id="06f9d-348">Example Matches</span></span> | <span data-ttu-id="06f9d-349">注意</span><span class="sxs-lookup"><span data-stu-id="06f9d-349">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="06f9d-350">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="06f9d-350">`123456789`, `-123456789`</span></span>  | <span data-ttu-id="06f9d-351">符合任何整數</span><span class="sxs-lookup"><span data-stu-id="06f9d-351">Matches any integer</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="06f9d-352">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="06f9d-352">`true`, `FALSE`</span></span> | <span data-ttu-id="06f9d-353">符合 `true` 或 `false` (不區分大小寫)</span><span class="sxs-lookup"><span data-stu-id="06f9d-353">Matches `true` or `false` (case-insensitive)</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="06f9d-354">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="06f9d-354">`2016-12-31`, `2016-12-31 7:32pm`</span></span>  | <span data-ttu-id="06f9d-355">符合有效的 `DateTime` 值 (在不因國別而異的文化特性中 - 請參閱警告)</span><span class="sxs-lookup"><span data-stu-id="06f9d-355">Matches a valid `DateTime` value (in the invariant culture - see warning)</span></span> |
| `decimal` | `{price:decimal}` | <span data-ttu-id="06f9d-356">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="06f9d-356">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="06f9d-357">符合有效的 `decimal` 值 (在不因國別而異的文化特性中 - 請參閱警告)</span><span class="sxs-lookup"><span data-stu-id="06f9d-357">Matches a valid `decimal` value (in the invariant culture - see warning)</span></span> |
| `double` | `{weight:double}` | <span data-ttu-id="06f9d-358">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="06f9d-358">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="06f9d-359">符合有效的 `double` 值 (在不因國別而異的文化特性中 - 請參閱警告)</span><span class="sxs-lookup"><span data-stu-id="06f9d-359">Matches a valid `double` value (in the invariant culture - see warning)</span></span> |
| `float` | `{weight:float}` | <span data-ttu-id="06f9d-360">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="06f9d-360">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="06f9d-361">符合有效的 `float` 值 (在不因國別而異的文化特性中 - 請參閱警告)</span><span class="sxs-lookup"><span data-stu-id="06f9d-361">Matches a valid `float` value (in the invariant culture - see warning)</span></span> |
| `guid` | `{id:guid}` | <span data-ttu-id="06f9d-362">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="06f9d-362">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="06f9d-363">符合有效的 `Guid` 值</span><span class="sxs-lookup"><span data-stu-id="06f9d-363">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="06f9d-364">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="06f9d-364">`123456789`, `-123456789`</span></span> | <span data-ttu-id="06f9d-365">符合有效的 `long` 值</span><span class="sxs-lookup"><span data-stu-id="06f9d-365">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="06f9d-366">字串必須至少有 4 個字元</span><span class="sxs-lookup"><span data-stu-id="06f9d-366">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `Richard` | <span data-ttu-id="06f9d-367">字串不能超過 8 個字元</span><span class="sxs-lookup"><span data-stu-id="06f9d-367">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="06f9d-368">字串長度必須剛好是 12 個字元</span><span class="sxs-lookup"><span data-stu-id="06f9d-368">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="06f9d-369">字串長度必須至少有 8 個字元，但不能超過 16 個字元</span><span class="sxs-lookup"><span data-stu-id="06f9d-369">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="06f9d-370">整數值必須至少為 18</span><span class="sxs-lookup"><span data-stu-id="06f9d-370">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="06f9d-371">整數值不能超過 120</span><span class="sxs-lookup"><span data-stu-id="06f9d-371">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="06f9d-372">整數值必須至少為 18，但不能超過 120</span><span class="sxs-lookup"><span data-stu-id="06f9d-372">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="06f9d-373">字串必須包含一或多個字母字元 (`a`-`z`，不區分大小寫)</span><span class="sxs-lookup"><span data-stu-id="06f9d-373">String must consist of one or more alphabetical characters (`a`-`z`, case-insensitive)</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="06f9d-374">字串必須符合規則運算式 (請參閱有關定義規則運算式的提示)</span><span class="sxs-lookup"><span data-stu-id="06f9d-374">String must match the regular expression (see tips about defining a regular expression)</span></span> |
| `required` | `{name:required}` | `Rick` |  <span data-ttu-id="06f9d-375">用來強制執行在 URL 產生期間呈現非參數值</span><span class="sxs-lookup"><span data-stu-id="06f9d-375">Used to enforce that a non-parameter value is present during URL generation</span></span> |

<span data-ttu-id="06f9d-376">以冒號分隔的多個條件約束，可以套用至單一參數。</span><span class="sxs-lookup"><span data-stu-id="06f9d-376">Multiple, colon-delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="06f9d-377">例如，下列條件約束會將參數限制在 1 或更大的整數值：</span><span class="sxs-lookup"><span data-stu-id="06f9d-377">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="06f9d-378">確認 URL 可以轉換成 CLR 類型的路由條件約束 (例如 `int` 或 `DateTime`) 一律使用不因國別而異的文化特性。</span><span class="sxs-lookup"><span data-stu-id="06f9d-378">Route constraints that verify the URL and are converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture.</span></span> <span data-ttu-id="06f9d-379">這些條件約束假設 URL 不可當地語系化。</span><span class="sxs-lookup"><span data-stu-id="06f9d-379">These constraints assume that the URL is non-localizable.</span></span> <span data-ttu-id="06f9d-380">架構提供的路由條件約束不會修改路由值中儲存的值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-380">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="06f9d-381">所有從 URL 剖析而來的路由值會儲存為字串。</span><span class="sxs-lookup"><span data-stu-id="06f9d-381">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="06f9d-382">例如，`float` 條件約束會嘗試將路由值轉換成浮點數，但轉換的值只能用來確認它可以轉換成浮點數。</span><span class="sxs-lookup"><span data-stu-id="06f9d-382">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="06f9d-383">規則運算式</span><span class="sxs-lookup"><span data-stu-id="06f9d-383">Regular expressions</span></span>

<span data-ttu-id="06f9d-384">ASP.NET Core 架構將 `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` 新增至規則運算式建構函式。</span><span class="sxs-lookup"><span data-stu-id="06f9d-384">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="06f9d-385">如需這些成員的說明，請參閱 <xref:System.Text.RegularExpressions.RegexOptions>。</span><span class="sxs-lookup"><span data-stu-id="06f9d-385">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="06f9d-386">規則運算式使用的分隔符號和語彙基元，類似於路由和 C# 語言所使用的分隔符號和語彙基元。</span><span class="sxs-lookup"><span data-stu-id="06f9d-386">Regular expressions use delimiters and tokens similar to those used by Routing and the C# language.</span></span> <span data-ttu-id="06f9d-387">規則運算式的語彙基元必須逸出。</span><span class="sxs-lookup"><span data-stu-id="06f9d-387">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="06f9d-388">若要在路由中使用規則運算式 `^\d{3}-\d{2}-\d{4}$`，運算式必須在 C# 原始程式檔中將 `\` 字元鍵入為 `\\`，以逸出 `\` 字串逸出字元 (除非使用[逐字字串常值](/dotnet/csharp/language-reference/keywords/string))。</span><span class="sxs-lookup"><span data-stu-id="06f9d-388">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in Routing, the expression must have the `\` characters typed in as `\\` in the C# source file to escape the `\` string escape character (unless using [verbatim string literals](/dotnet/csharp/language-reference/keywords/string).</span></span> <span data-ttu-id="06f9d-389">`{`、`}`、`[` 和 `]` 字元必須加以逸出，方法是成對使用以逸出路由參數的分隔符號字元。</span><span class="sxs-lookup"><span data-stu-id="06f9d-389">The `{`, `}`, `[`, and `]` characters must be escaped by doubling them to escape the Routing parameter delimiter characters.</span></span> <span data-ttu-id="06f9d-390">下表顯示規則運算式和逸出的版本。</span><span class="sxs-lookup"><span data-stu-id="06f9d-390">The table below shows a regular expression and the escaped version.</span></span>

| <span data-ttu-id="06f9d-391">運算式</span><span class="sxs-lookup"><span data-stu-id="06f9d-391">Expression</span></span>            | <span data-ttu-id="06f9d-392">已逸出</span><span class="sxs-lookup"><span data-stu-id="06f9d-392">Escaped</span></span>                        |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="06f9d-393">路由中所使用的規則運算式通常以 `^` 字元 (符合字串的起始位置) 開頭，並以 `$` 字元 (符合字串的結束位置) 結尾。</span><span class="sxs-lookup"><span data-stu-id="06f9d-393">Regular expressions used in routing often start with the `^` character (match starting position of the string) and end with the `$` character (match ending position of the string).</span></span> <span data-ttu-id="06f9d-394">`^` 和 `$` 字元可確保規則運算式符合整個路由參數值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-394">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="06f9d-395">若不使用 `^` 與 `$` 字元，規則運算式會比對字串內的所有部分字串，這通常不是您想要的結果。</span><span class="sxs-lookup"><span data-stu-id="06f9d-395">Without the `^` and `$` characters, the regular expression match any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="06f9d-396">下表顯示一些範例，並說明它們符合或無法符合的原因。</span><span class="sxs-lookup"><span data-stu-id="06f9d-396">The table below shows some examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="06f9d-397">運算式</span><span class="sxs-lookup"><span data-stu-id="06f9d-397">Expression</span></span>   | <span data-ttu-id="06f9d-398">String</span><span class="sxs-lookup"><span data-stu-id="06f9d-398">String</span></span>    | <span data-ttu-id="06f9d-399">比對</span><span class="sxs-lookup"><span data-stu-id="06f9d-399">Match</span></span> | <span data-ttu-id="06f9d-400">註解</span><span class="sxs-lookup"><span data-stu-id="06f9d-400">Comment</span></span>               |
| ------------ | --------- |  ---- |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="06f9d-401">hello</span><span class="sxs-lookup"><span data-stu-id="06f9d-401">hello</span></span>     | <span data-ttu-id="06f9d-402">[是]</span><span class="sxs-lookup"><span data-stu-id="06f9d-402">Yes</span></span>   | <span data-ttu-id="06f9d-403">子字串相符項目</span><span class="sxs-lookup"><span data-stu-id="06f9d-403">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="06f9d-404">123abc456</span><span class="sxs-lookup"><span data-stu-id="06f9d-404">123abc456</span></span> | <span data-ttu-id="06f9d-405">[是]</span><span class="sxs-lookup"><span data-stu-id="06f9d-405">Yes</span></span>   | <span data-ttu-id="06f9d-406">子字串相符項目</span><span class="sxs-lookup"><span data-stu-id="06f9d-406">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="06f9d-407">mz</span><span class="sxs-lookup"><span data-stu-id="06f9d-407">mz</span></span>        | <span data-ttu-id="06f9d-408">[是]</span><span class="sxs-lookup"><span data-stu-id="06f9d-408">Yes</span></span>   | <span data-ttu-id="06f9d-409">符合運算式</span><span class="sxs-lookup"><span data-stu-id="06f9d-409">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="06f9d-410">MZ</span><span class="sxs-lookup"><span data-stu-id="06f9d-410">MZ</span></span>        | <span data-ttu-id="06f9d-411">[是]</span><span class="sxs-lookup"><span data-stu-id="06f9d-411">Yes</span></span>   | <span data-ttu-id="06f9d-412">不區分大小寫</span><span class="sxs-lookup"><span data-stu-id="06f9d-412">Not case sensitive</span></span>    |
| `^[a-z]{2}$` |  <span data-ttu-id="06f9d-413">hello</span><span class="sxs-lookup"><span data-stu-id="06f9d-413">hello</span></span>    | <span data-ttu-id="06f9d-414">否</span><span class="sxs-lookup"><span data-stu-id="06f9d-414">No</span></span>    | <span data-ttu-id="06f9d-415">請參閱上述的 `^` 和 `$`</span><span class="sxs-lookup"><span data-stu-id="06f9d-415">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="06f9d-416">123abc456</span><span class="sxs-lookup"><span data-stu-id="06f9d-416">123abc456</span></span> | <span data-ttu-id="06f9d-417">否</span><span class="sxs-lookup"><span data-stu-id="06f9d-417">No</span></span>    | <span data-ttu-id="06f9d-418">請參閱上述的 `^` 和 `$`</span><span class="sxs-lookup"><span data-stu-id="06f9d-418">See `^` and `$` above</span></span> |

<span data-ttu-id="06f9d-419">如需規則運算式語法的詳細資訊，請參閱 [.NET Framework 規則運算式](/dotnet/standard/base-types/regular-expression-language-quick-reference)。</span><span class="sxs-lookup"><span data-stu-id="06f9d-419">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="06f9d-420">若要將參數限制為一組已知的可能值，請使用規則運算式。</span><span class="sxs-lookup"><span data-stu-id="06f9d-420">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="06f9d-421">例如，`{action:regex(^(list|get|create)$)}` 只會將 `action` 路由值與 `list`、`get` 或 `create` 相符。</span><span class="sxs-lookup"><span data-stu-id="06f9d-421">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="06f9d-422">如果已傳入條件約束字典，字串 `^(list|get|create)$` 則是對等項目。</span><span class="sxs-lookup"><span data-stu-id="06f9d-422">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="06f9d-423">已傳入條件約束字典 (未內嵌在範本內) 的條件約束，即使不符合其中一個已知的條件約束，也會被視為規則運算式。</span><span class="sxs-lookup"><span data-stu-id="06f9d-423">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

::: moniker range=">= aspnetcore-2.2"

## <a name="parameter-transformer-reference"></a><span data-ttu-id="06f9d-424">參數轉換器參考</span><span class="sxs-lookup"><span data-stu-id="06f9d-424">Parameter transformer reference</span></span>

<span data-ttu-id="06f9d-425">參數轉換器執行會在為 `Route` 產生連結時執行。</span><span class="sxs-lookup"><span data-stu-id="06f9d-425">Parameter transformers execute when generating a link for a `Route`.</span></span> <span data-ttu-id="06f9d-426">參數轉換器會採用參數的路由值，並將其轉換為新的字串值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-426">Parameter transformers take the parameter's route value and transform it to a new string value.</span></span> <span data-ttu-id="06f9d-427">已轉換的值，會用於產生的連結。</span><span class="sxs-lookup"><span data-stu-id="06f9d-427">The transformed value is used in the generated link.</span></span> <span data-ttu-id="06f9d-428">例如，具有 `Url.Action(new { article = "MyTestArticle" })` 之路由模式 `blog\{article:slugify}` 中的自訂 `slugify` 參數轉換器，會產生 `blog\my-test-article`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-428">For example, a custom `slugify` parameter transformer in route pattern `blog\{article:slugify}` with `Url.Action(new { article = "MyTestArticle" })` generates `blog\my-test-article`.</span></span> <span data-ttu-id="06f9d-429">參數轉換器會實作 `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`，並使用 <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> 來設定。</span><span class="sxs-lookup"><span data-stu-id="06f9d-429">Parameter transformers implement `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer` and are configured using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span></span>

<span data-ttu-id="06f9d-430">架構也會使用參數轉換器來轉換端點解析的 URI。</span><span class="sxs-lookup"><span data-stu-id="06f9d-430">Parameter transformers are also used by frameworks to transform the URI to which an endpoint resolves.</span></span> <span data-ttu-id="06f9d-431">例如，ASP.NET Core MVC 會使用參數轉換器，轉換用於比對 `area`、`controller`、`action` 和 `page` 的路由值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-431">For example, ASP.NET Core MVC uses parameter transformers to transform the route value used to match an `area`, `controller`, `action`, and `page`.</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home:slugify}/{action=Index:slugify}/{id?}");
```

<span data-ttu-id="06f9d-432">使用上述的路由，動作 `SubscriptionManagementController.GetAll()` 會與URI `/subscription-management/get-all` 比對。</span><span class="sxs-lookup"><span data-stu-id="06f9d-432">With the preceding route, the action `SubscriptionManagementController.GetAll()` is matched with the URI `/subscription-management/get-all`.</span></span> <span data-ttu-id="06f9d-433">參數轉換器不會變更用來產生連結的路由值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-433">A parameter transformer doesn't change the route values used to generate a link.</span></span> <span data-ttu-id="06f9d-434">`Url.Action("GetAll", "SubscriptionManagement")` 會輸出 `/subscription-management/get-all`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-434">`Url.Action("GetAll", "SubscriptionManagement")` outputs `/subscription-management/get-all`.</span></span>

<span data-ttu-id="06f9d-435">ASP.NET Core MVC 也隨附 `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention` API 慣例。</span><span class="sxs-lookup"><span data-stu-id="06f9d-435">ASP.NET Core MVC also comes with the `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention` API convention.</span></span> <span data-ttu-id="06f9d-436">慣例會將所指定參數轉換器套用於應用程式中的所有屬性路由權杖。</span><span class="sxs-lookup"><span data-stu-id="06f9d-436">The convention applies a specified parameter transformer to all attribute route tokens in the app.</span></span>

::: moniker-end

## <a name="url-generation-reference"></a><span data-ttu-id="06f9d-437">URL 產生參考</span><span class="sxs-lookup"><span data-stu-id="06f9d-437">URL generation reference</span></span>

<span data-ttu-id="06f9d-438">下列範例示範如何在指定路由值字典和 <xref:Microsoft.AspNetCore.Routing.RouteCollection> 的情況下產生路由的連結。</span><span class="sxs-lookup"><span data-stu-id="06f9d-438">The following example shows how to generate a link to a route given a dictionary of route values and a <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span></span>

::: moniker range=">= aspnetcore-2.0"

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

::: moniker-end

::: moniker range="< aspnetcore-2.0"

[!code-csharp[](routing/samples/1.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

::: moniker-end

<span data-ttu-id="06f9d-439">在上述範例的結尾產生的 `VirtualPath` 是 `/package/create/123`。</span><span class="sxs-lookup"><span data-stu-id="06f9d-439">The `VirtualPath` generated at the end of the preceding sample is `/package/create/123`.</span></span> <span data-ttu-id="06f9d-440">字典提供「追蹤套件路由」範本 `package/{operation}/{id}` 的 `operation` 和 `id` 路由值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-440">The dictionary supplies the `operation` and `id` route values of the "Track Package Route" template, `package/{operation}/{id}`.</span></span> <span data-ttu-id="06f9d-441">如需詳細資訊，請參閱[使用路由中介軟體](#use-routing-middleware)一節或[範例應用程式](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/samples)中的範例程式碼。</span><span class="sxs-lookup"><span data-stu-id="06f9d-441">For details, see the sample code in the [Use Routing Middleware](#use-routing-middleware) section or the [sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span></span>

<span data-ttu-id="06f9d-442">`VirtualPathContext` 建構函式的第二個參數是「環境值」的集合。</span><span class="sxs-lookup"><span data-stu-id="06f9d-442">The second parameter to the `VirtualPathContext` constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="06f9d-443">環境值為方便起見，會限制開發人員必須在特定要求內容中指定的值數目。</span><span class="sxs-lookup"><span data-stu-id="06f9d-443">Ambient values provide convenience by limiting the number of values a developer must specify within a certain request context.</span></span> <span data-ttu-id="06f9d-444">目前要求的目前路由值被視為用於連結產生的環境值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-444">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="06f9d-445">在 ASP.NET Core MVC 應用程式中，如果您處於 `HomeController` 的 `About` 動作，則不需要指定控制器路由值以連結到 `Index` 動作 &mdash; 會使用 `Home` 的環境值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-445">In an ASP.NET Core MVC app if you are in the `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action&mdash;the ambient value of `Home` is used.</span></span>

<span data-ttu-id="06f9d-446">不符合參數的環境值會受到忽略，當明確提供的值在 URL 中從左到右進行覆寫時，也會忽略環境值。</span><span class="sxs-lookup"><span data-stu-id="06f9d-446">Ambient values that don't match a parameter are ignored, and ambient values are also ignored when an explicitly provided value overrides it, going from left to right in the URL.</span></span>

<span data-ttu-id="06f9d-447">明確提供但不符合任何項目的值會新增至查詢字串。</span><span class="sxs-lookup"><span data-stu-id="06f9d-447">Values that are explicitly provided but which don't match anything are added to the query string.</span></span> <span data-ttu-id="06f9d-448">下表顯示使用路由範本 `{controller}/{action}/{id?}` 時的結果。</span><span class="sxs-lookup"><span data-stu-id="06f9d-448">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="06f9d-449">環境值</span><span class="sxs-lookup"><span data-stu-id="06f9d-449">Ambient Values</span></span>                | <span data-ttu-id="06f9d-450">明確值</span><span class="sxs-lookup"><span data-stu-id="06f9d-450">Explicit Values</span></span>                   | <span data-ttu-id="06f9d-451">結果</span><span class="sxs-lookup"><span data-stu-id="06f9d-451">Result</span></span>                  |
| ----------------------------- | --------------------------------- | ----------------------- |
| <span data-ttu-id="06f9d-452">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="06f9d-452">controller="Home"</span></span>             | <span data-ttu-id="06f9d-453">action="About"</span><span class="sxs-lookup"><span data-stu-id="06f9d-453">action="About"</span></span>                    | `/Home/About`           |
| <span data-ttu-id="06f9d-454">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="06f9d-454">controller="Home"</span></span>             | <span data-ttu-id="06f9d-455">controller="Order",action="About"</span><span class="sxs-lookup"><span data-stu-id="06f9d-455">controller="Order",action="About"</span></span> | `/Order/About`          |
| <span data-ttu-id="06f9d-456">controller="Home",color="Red"</span><span class="sxs-lookup"><span data-stu-id="06f9d-456">controller="Home",color="Red"</span></span> | <span data-ttu-id="06f9d-457">action="About"</span><span class="sxs-lookup"><span data-stu-id="06f9d-457">action="About"</span></span>                    | `/Home/About`           |
| <span data-ttu-id="06f9d-458">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="06f9d-458">controller="Home"</span></span>             | <span data-ttu-id="06f9d-459">action="About",color="Red"</span><span class="sxs-lookup"><span data-stu-id="06f9d-459">action="About",color="Red"</span></span>        | `/Home/About?color=Red` |

<span data-ttu-id="06f9d-460">如果路由具有未對應至參數的預設值，且該值會明確提供，它必須符合預設值：</span><span class="sxs-lookup"><span data-stu-id="06f9d-460">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
    defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="06f9d-461">提供了控制器與動作的相符值時，連結產生只會產生此路由的連結。</span><span class="sxs-lookup"><span data-stu-id="06f9d-461">Link generation only generates a link for this route when the matching values for controller and action are provided.</span></span>
