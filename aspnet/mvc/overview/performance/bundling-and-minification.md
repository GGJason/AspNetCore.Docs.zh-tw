---
uid: mvc/overview/performance/bundling-and-minification
title: 統合及縮製 |Microsoft 文件
author: Rick-Anderson
description: 統合及縮製是兩項技術可用於 ASP.NET 4.5 來改善要求載入時間。 統合及縮製 reducin 藉此改善載入時間...
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/23/2012
ms.topic: article
ms.assetid: 5894dc13-5d45-4dad-8096-136499120f1d
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/performance/bundling-and-minification
msc.type: authoredcontent
ms.openlocfilehash: 001ebf89cda66a50cddcd7e4944f27b9396d4450
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/10/2018
ms.locfileid: "30877479"
---
<a name="bundling-and-minification"></a><span data-ttu-id="a1b18-104">統合及縮製</span><span class="sxs-lookup"><span data-stu-id="a1b18-104">Bundling and Minification</span></span>
====================
<span data-ttu-id="a1b18-105">由[Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="a1b18-105">by [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

> <span data-ttu-id="a1b18-106">統合及縮製是兩項技術可用於 ASP.NET 4.5 來改善要求載入時間。</span><span class="sxs-lookup"><span data-stu-id="a1b18-106">Bundling and minification are two techniques you can use in ASP.NET 4.5 to improve request load time.</span></span> <span data-ttu-id="a1b18-107">統合及縮製透過減少伺服器的要求數目以及降低要求資產 （例如 CSS 和 JavaScript。） 的大小，改進載入時間</span><span class="sxs-lookup"><span data-stu-id="a1b18-107">Bundling and minification improves load time by reducing the number of requests to the server and reducing the size of requested assets (such as CSS and JavaScript.)</span></span>


<span data-ttu-id="a1b18-108">目前的主要瀏覽器的大部分限制數目[同時連線](http://www.browserscope.org/?category=network)每為六個每個主機名稱。</span><span class="sxs-lookup"><span data-stu-id="a1b18-108">Most of the current major browsers limit the number of [simultaneous connections](http://www.browserscope.org/?category=network) per each hostname to six.</span></span> <span data-ttu-id="a1b18-109">這表示，而處理六個要求，以便在主機上的資產的其他要求都會排入佇列瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="a1b18-109">That means that while six requests are being processed, additional requests for assets on a host will be queued by the browser.</span></span> <span data-ttu-id="a1b18-110">下面的影像中的 IE F12 開發人員工具-網路索引標籤會顯示 [關於] 檢視的範例應用程式所需的資產的時間。</span><span class="sxs-lookup"><span data-stu-id="a1b18-110">In the image below, the IE F12 developer tools network tabs shows the timing for assets required by the About view of a sample application.</span></span>

![B/M](bundling-and-minification/_static/image1.png)

<span data-ttu-id="a1b18-112">灰色長條顯示六個連接限制在等候瀏覽器的要求會排入佇列的時間。</span><span class="sxs-lookup"><span data-stu-id="a1b18-112">The gray bars show the time the request is queued by the browser waiting on the six connection limit.</span></span> <span data-ttu-id="a1b18-113">黃色列是要求時機，第一個位元組，也就是將要求傳送，並從伺服器接收第一個回應所花費的時間。</span><span class="sxs-lookup"><span data-stu-id="a1b18-113">The yellow bar is the request time to first byte, that is, the time taken to send the request and receive the first response from the server.</span></span> <span data-ttu-id="a1b18-114">藍色巡覽列會顯示從伺服器收到的回應資料所花費的時間。</span><span class="sxs-lookup"><span data-stu-id="a1b18-114">The blue bars show the time taken to receive the response data from the server.</span></span> <span data-ttu-id="a1b18-115">您可以按兩下以取得詳細的計時資訊資產。</span><span class="sxs-lookup"><span data-stu-id="a1b18-115">You can double-click on an asset to get detailed timing information.</span></span> <span data-ttu-id="a1b18-116">例如下, 圖顯示計時詳細資料載入 */Scripts/MyScripts/JavaScript6.js*檔案。</span><span class="sxs-lookup"><span data-stu-id="a1b18-116">For example, the following image shows the timing details for loading the */Scripts/MyScripts/JavaScript6.js* file.</span></span>

![](bundling-and-minification/_static/image2.png)

<span data-ttu-id="a1b18-117">上述的影像顯示**啟動**事件時，哪些提供因為瀏覽器的要求已排入佇列的時間限制的同時連線數目。</span><span class="sxs-lookup"><span data-stu-id="a1b18-117">The preceding image shows the **Start** event, which gives the time the request was queued because of the browser limit the number of simultaneous connections.</span></span> <span data-ttu-id="a1b18-118">在此情況下，要求已排入佇列等候另一個要求完成 46 毫秒。</span><span class="sxs-lookup"><span data-stu-id="a1b18-118">In this case, the request was queued for 46 milliseconds waiting for another request to complete.</span></span>

## <a name="bundling"></a><span data-ttu-id="a1b18-119">結合在一起</span><span class="sxs-lookup"><span data-stu-id="a1b18-119">Bundling</span></span>

<span data-ttu-id="a1b18-120">結合在一起是 ASP.NET 4.5，可讓您輕鬆地結合或多個檔案配套成單一檔案中的新功能。</span><span class="sxs-lookup"><span data-stu-id="a1b18-120">Bundling is a new feature in ASP.NET 4.5 that makes it easy to combine or bundle multiple files into a single file.</span></span> <span data-ttu-id="a1b18-121">您可以建立 CSS、 JavaScript 和其他組合。</span><span class="sxs-lookup"><span data-stu-id="a1b18-121">You can create CSS, JavaScript and other bundles.</span></span> <span data-ttu-id="a1b18-122">較少的檔案表示更少的 HTTP 要求，可改善第一個頁面負載效能。</span><span class="sxs-lookup"><span data-stu-id="a1b18-122">Fewer files means fewer HTTP requests and that can improve first page load performance.</span></span>

<span data-ttu-id="a1b18-123">下圖顯示相同的時間檢視關於檢視顯示之前，但這次與統合及縮製已啟用。</span><span class="sxs-lookup"><span data-stu-id="a1b18-123">The following image shows the same timing view of the About view shown previously, but this time with bundling and minification enabled.</span></span>

![](bundling-and-minification/_static/image3.png)

## <a name="minification"></a><span data-ttu-id="a1b18-124">縮小</span><span class="sxs-lookup"><span data-stu-id="a1b18-124">Minification</span></span>

<span data-ttu-id="a1b18-125">縮製執行各種不同的程式碼最佳化，以指令碼或 css，例如移除不必要的空白字元和註解，以及縮短成一個字元的變數名稱。</span><span class="sxs-lookup"><span data-stu-id="a1b18-125">Minification performs a variety of different code optimizations to scripts or css, such as removing unnecessary white space and comments and shortening variable names to one character.</span></span> <span data-ttu-id="a1b18-126">請考慮下列的 JavaScript 函式。</span><span class="sxs-lookup"><span data-stu-id="a1b18-126">Consider the following JavaScript function.</span></span>

[!code-javascript[Main](bundling-and-minification/samples/sample1.js)]

<span data-ttu-id="a1b18-127">之後縮製，函式會減少所示：</span><span class="sxs-lookup"><span data-stu-id="a1b18-127">After minification, the function is reduced to the following:</span></span>

[!code-javascript[Main](bundling-and-minification/samples/sample2.js)]

<span data-ttu-id="a1b18-128">移除註解和不必要的空白字元，除了下列參數和變數名稱已重新命名 （縮短），如下所示：</span><span class="sxs-lookup"><span data-stu-id="a1b18-128">In addition to removing the comments and unnecessary whitespace, the following parameters and variable names were renamed (shortened) as follows:</span></span>

| <span data-ttu-id="a1b18-129">**原始**</span><span class="sxs-lookup"><span data-stu-id="a1b18-129">**Original**</span></span> | <span data-ttu-id="a1b18-130">**Renamed**</span><span class="sxs-lookup"><span data-stu-id="a1b18-130">**Renamed**</span></span> |
| --- | --- |
| <span data-ttu-id="a1b18-131">imageTagAndImageID</span><span class="sxs-lookup"><span data-stu-id="a1b18-131">imageTagAndImageID</span></span> | <span data-ttu-id="a1b18-132">n</span><span class="sxs-lookup"><span data-stu-id="a1b18-132">n</span></span> |
| <span data-ttu-id="a1b18-133">imageContext</span><span class="sxs-lookup"><span data-stu-id="a1b18-133">imageContext</span></span> | <span data-ttu-id="a1b18-134">t</span><span class="sxs-lookup"><span data-stu-id="a1b18-134">t</span></span> |
| <span data-ttu-id="a1b18-135">imageElement</span><span class="sxs-lookup"><span data-stu-id="a1b18-135">imageElement</span></span> | <span data-ttu-id="a1b18-136">i</span><span class="sxs-lookup"><span data-stu-id="a1b18-136">i</span></span> |

## <a name="impact-of-bundling-and-minification"></a><span data-ttu-id="a1b18-137">影響的組合和縮製</span><span class="sxs-lookup"><span data-stu-id="a1b18-137">Impact of Bundling and Minification</span></span>

<span data-ttu-id="a1b18-138">下表顯示個別列出所有資產及範例程式中使用統合及縮製 (B/M) 之間的數個重要差異。</span><span class="sxs-lookup"><span data-stu-id="a1b18-138">The following table shows several important differences between listing all the assets individually and using bundling and minification (B/M) in the sample program.</span></span>

|  | <span data-ttu-id="a1b18-139">**使用 B/M**</span><span class="sxs-lookup"><span data-stu-id="a1b18-139">**Using B/M**</span></span> | <span data-ttu-id="a1b18-140">**沒有 B/M**</span><span class="sxs-lookup"><span data-stu-id="a1b18-140">**Without B/M**</span></span> | <span data-ttu-id="a1b18-141">**變更**</span><span class="sxs-lookup"><span data-stu-id="a1b18-141">**Change**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a1b18-142">**檔案要求**</span><span class="sxs-lookup"><span data-stu-id="a1b18-142">**File Requests**</span></span> | <span data-ttu-id="a1b18-143">9</span><span class="sxs-lookup"><span data-stu-id="a1b18-143">9</span></span> | <span data-ttu-id="a1b18-144">34</span><span class="sxs-lookup"><span data-stu-id="a1b18-144">34</span></span> | <span data-ttu-id="a1b18-145">256%</span><span class="sxs-lookup"><span data-stu-id="a1b18-145">256%</span></span> |
| <span data-ttu-id="a1b18-146">**KB Sent**</span><span class="sxs-lookup"><span data-stu-id="a1b18-146">**KB Sent**</span></span> | <span data-ttu-id="a1b18-147">3.26</span><span class="sxs-lookup"><span data-stu-id="a1b18-147">3.26</span></span> | <span data-ttu-id="a1b18-148">11.92</span><span class="sxs-lookup"><span data-stu-id="a1b18-148">11.92</span></span> | <span data-ttu-id="a1b18-149">266%</span><span class="sxs-lookup"><span data-stu-id="a1b18-149">266%</span></span> |
| <span data-ttu-id="a1b18-150">**接收的 KB**</span><span class="sxs-lookup"><span data-stu-id="a1b18-150">**KB Received**</span></span> | <span data-ttu-id="a1b18-151">388.51</span><span class="sxs-lookup"><span data-stu-id="a1b18-151">388.51</span></span> | <span data-ttu-id="a1b18-152">530</span><span class="sxs-lookup"><span data-stu-id="a1b18-152">530</span></span> | <span data-ttu-id="a1b18-153">36%</span><span class="sxs-lookup"><span data-stu-id="a1b18-153">36%</span></span> |
| <span data-ttu-id="a1b18-154">**載入時間**</span><span class="sxs-lookup"><span data-stu-id="a1b18-154">**Load Time**</span></span> | <span data-ttu-id="a1b18-155">510 MS</span><span class="sxs-lookup"><span data-stu-id="a1b18-155">510 MS</span></span> | <span data-ttu-id="a1b18-156">780 MS</span><span class="sxs-lookup"><span data-stu-id="a1b18-156">780 MS</span></span> | <span data-ttu-id="a1b18-157">53%</span><span class="sxs-lookup"><span data-stu-id="a1b18-157">53%</span></span> |

<span data-ttu-id="a1b18-158">傳送的位元組有大幅降低與結合在一起的瀏覽器相當詳細資訊，以套用要求的 HTTP 標頭。</span><span class="sxs-lookup"><span data-stu-id="a1b18-158">The bytes sent had a significant reduction with bundling as browsers are fairly verbose with the HTTP headers they apply on requests.</span></span> <span data-ttu-id="a1b18-159">接收的位元組減少不一樣大因為最大檔案 (*Scripts\jquery-ui-1.8.11.min.js*和*Scripts\jquery-1.7.1.min.js*) 已經縮短。</span><span class="sxs-lookup"><span data-stu-id="a1b18-159">The received bytes reduction is not as large because the largest files (*Scripts\jquery-ui-1.8.11.min.js* and *Scripts\jquery-1.7.1.min.js*) are already minified.</span></span> <span data-ttu-id="a1b18-160">注意： 上使用的範例程式時機[Fiddler](http://www.fiddler2.com/fiddler2/)工具來模擬慢速網路。</span><span class="sxs-lookup"><span data-stu-id="a1b18-160">Note: The timings on the sample program used the [Fiddler](http://www.fiddler2.com/fiddler2/) tool to simulate a slow network.</span></span> <span data-ttu-id="a1b18-161">(從 Fiddler**規則**功能表上，選取**效能**然後**模擬數據機速度**。)</span><span class="sxs-lookup"><span data-stu-id="a1b18-161">(From the Fiddler **Rules** menu, select **Performance** then **Simulate Modem Speeds**.)</span></span>

## <a name="debugging-bundled-and-minified-javascript"></a><span data-ttu-id="a1b18-162">偵錯配套並縮短 JavaScript</span><span class="sxs-lookup"><span data-stu-id="a1b18-162">Debugging Bundled and Minified JavaScript</span></span>

<span data-ttu-id="a1b18-163">所以可以輕鬆地偵錯您的 JavaScript，在開發環境中 (其中[compilation 元素](https://msdn.microsoft.com/library/s10awwz0.aspx)中*Web.config*檔案設定為`debug="true"`) 因為不會集結 JavaScript 檔案或縮短。</span><span class="sxs-lookup"><span data-stu-id="a1b18-163">It's easy to debug your JavaScript in a development environment (where the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx) in the *Web.config* file is set to `debug="true"` ) because the JavaScript files are not bundled or minified.</span></span> <span data-ttu-id="a1b18-164">您也可以偵錯的 JavaScript 檔案包裝在一起，而縮短的發行組建。</span><span class="sxs-lookup"><span data-stu-id="a1b18-164">You can also debug a release build where your JavaScript files are bundled and minified.</span></span> <span data-ttu-id="a1b18-165">您使用 IE F12 開發人員工具，偵錯使用下列方式縮短組合中所包含的 JavaScript 函式：</span><span class="sxs-lookup"><span data-stu-id="a1b18-165">Using the IE F12 developer tools, you debug a JavaScript function included in a minified bundle using the following approach:</span></span>

1. <span data-ttu-id="a1b18-166">選取**指令碼**索引標籤，然後選取 [**開始偵錯**] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="a1b18-166">Select the **Script** tab and then select the **Start debugging** button.</span></span>
2. <span data-ttu-id="a1b18-167">選取包含您想要使用 [資產] 按鈕進行偵錯 JavaScript 函式的組合。</span><span class="sxs-lookup"><span data-stu-id="a1b18-167">Select the bundle containing the JavaScript function you want to debug using the assets button.</span></span>  
    ![](bundling-and-minification/_static/image4.png)
3. <span data-ttu-id="a1b18-168">藉由選取格式化縮短的 JavaScript**組態按鈕** ![](bundling-and-minification/_static/image5.png)，然後選取**格式 JavaScript**。</span><span class="sxs-lookup"><span data-stu-id="a1b18-168">Format the minified JavaScript by selecting the **Configuration button** ![](bundling-and-minification/_static/image5.png), and then selecting **Format JavaScript**.</span></span>
4. <span data-ttu-id="a1b18-169">在**搜尋指令碼**t 輸入的方塊中，選取您要偵錯函式的名稱。</span><span class="sxs-lookup"><span data-stu-id="a1b18-169">In the **Search Scrip** t input box, select the name of the function you want to debug.</span></span> <span data-ttu-id="a1b18-170">在下圖**AddAltToImg**輸入**搜尋指令碼**t 輸入的方塊。</span><span class="sxs-lookup"><span data-stu-id="a1b18-170">In the following image, **AddAltToImg** was entered in the **Search Scrip** t input box.</span></span>  
    ![](bundling-and-minification/_static/image6.png)

<span data-ttu-id="a1b18-171">如需有關如何使用 F12 開發人員工具進行偵錯的詳細資訊，請參閱 MSDN 文章：[使用 F12 開發人員工具，偵錯 JavaScript 錯誤](https://msdn.microsoft.com/library/ie/gg699336(v=vs.85).aspx)。</span><span class="sxs-lookup"><span data-stu-id="a1b18-171">For more information on debugging with the F12 developer tools, see the MSDN article [Using the F12 Developer Tools to Debug JavaScript Errors](https://msdn.microsoft.com/library/ie/gg699336(v=vs.85).aspx).</span></span>

## <a name="controlling-bundling-and-minification"></a><span data-ttu-id="a1b18-172">控制統合及縮製</span><span class="sxs-lookup"><span data-stu-id="a1b18-172">Controlling Bundling and Minification</span></span>

<span data-ttu-id="a1b18-173">統合及縮製已啟用或停用偵錯屬性中的值設定[compilation 元素](https://msdn.microsoft.com/library/s10awwz0.aspx)中*Web.config*檔案。</span><span class="sxs-lookup"><span data-stu-id="a1b18-173">Bundling and minification is enabled or disabled by setting the value of the debug attribute in the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx)  in the *Web.config* file.</span></span> <span data-ttu-id="a1b18-174">在下列 XML 中，`debug`設定為 true，組合和縮製已停用。</span><span class="sxs-lookup"><span data-stu-id="a1b18-174">In the following XML, `debug` is set to true so bundling and minification is disabled.</span></span>

[!code-xml[Main](bundling-and-minification/samples/sample3.xml?highlight=2)]

<span data-ttu-id="a1b18-175">若要啟用統合及縮製，`debug`值為"false"。</span><span class="sxs-lookup"><span data-stu-id="a1b18-175">To enable bundling and minification, set the `debug` value to "false".</span></span> <span data-ttu-id="a1b18-176">您可以覆寫*Web.config*設定`EnableOptimizations`屬性`BundleTable`類別。</span><span class="sxs-lookup"><span data-stu-id="a1b18-176">You can override the *Web.config* setting with the `EnableOptimizations` property on the `BundleTable` class.</span></span> <span data-ttu-id="a1b18-177">下列程式碼可讓統合及縮製，並覆寫中的任何設定*Web.config*檔案。</span><span class="sxs-lookup"><span data-stu-id="a1b18-177">The following code enables bundling and minification and overrides any setting in the *Web.config* file.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample4.cs?highlight=7)]

> [!NOTE]
> <span data-ttu-id="a1b18-178">除非`EnableOptimizations`是`true`或中的偵錯屬性[compilation 元素](https://msdn.microsoft.com/library/s10awwz0.aspx)中*Web.config*檔案設定為`false`，檔案將不會搭配或縮短。</span><span class="sxs-lookup"><span data-stu-id="a1b18-178">Unless `EnableOptimizations` is `true` or the debug attribute in the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx)  in the *Web.config* file is set to `false`, files will not be bundled or minified.</span></span> <span data-ttu-id="a1b18-179">此外，將不會使用檔案的.min 版本，將選取完整的偵錯版本。</span><span class="sxs-lookup"><span data-stu-id="a1b18-179">Additionally, the .min version of files will not be used, the full debug versions will be selected.</span></span> <span data-ttu-id="a1b18-180">`EnableOptimizations` 覆寫中的偵錯屬性[compilation 元素](https://msdn.microsoft.com/library/s10awwz0.aspx)中*Web.config*檔案</span><span class="sxs-lookup"><span data-stu-id="a1b18-180">`EnableOptimizations` overrides the debug attribute in the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx)  in the *Web.config* file</span></span>


## <a name="using-bundling-and-minification-with-aspnet-web-forms-and-web-pages"></a><span data-ttu-id="a1b18-181">使用組合和縮製與 ASP.NET Web Form 和 Web 網頁</span><span class="sxs-lookup"><span data-stu-id="a1b18-181">Using Bundling and Minification with ASP.NET Web Forms and Web Pages</span></span>

- <span data-ttu-id="a1b18-182">網頁，請參閱部落格文章： [Web Pages 站台中新增 Web 最佳化](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a1b18-182">For Web Pages, see the blog entry [Adding Web Optimization to a Web Pages Site](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx).</span></span>
- <span data-ttu-id="a1b18-183">Web Form，請參閱部落格文章：[加入統合及縮製到 Web Form](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a1b18-183">For Web Forms, see the blog entry [Adding Bundling and Minification to Web Forms](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx).</span></span>

## <a name="using-bundling-and-minification-with-aspnet-mvc"></a><span data-ttu-id="a1b18-184">使用組合和縮製搭配 ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="a1b18-184">Using Bundling and Minification with ASP.NET MVC</span></span>

<span data-ttu-id="a1b18-185">在本節中，我們將建立 ASP.NET MVC 專案，以檢查組合和縮製。</span><span class="sxs-lookup"><span data-stu-id="a1b18-185">In this section we will create an ASP.NET MVC project to examine bundling and minification.</span></span> <span data-ttu-id="a1b18-186">首先，建立新的 ASP.NET MVC 網際網路專案，名為**MvcBM**而不需要變更任何預設值。</span><span class="sxs-lookup"><span data-stu-id="a1b18-186">First, create a new ASP.NET MVC internet project named **MvcBM** without changing any of the defaults.</span></span>

<span data-ttu-id="a1b18-187">開啟*應用程式\_Start\BundleConfig.cs*檔案，並檢查`RegisterBundles`方法用來建立、 註冊和設定組合。</span><span class="sxs-lookup"><span data-stu-id="a1b18-187">Open the *App\_Start\BundleConfig.cs* file and examine the `RegisterBundles` method which is used to create, register and configure bundles.</span></span> <span data-ttu-id="a1b18-188">下列程式碼顯示的某一部分`RegisterBundles`方法。</span><span class="sxs-lookup"><span data-stu-id="a1b18-188">The following code shows a portion of the `RegisterBundles` method.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample5.cs)]

<span data-ttu-id="a1b18-189">上述程式碼會建立新的 JavaScript 組合，名為 *~/bundles/jquery* ，其中包含所有適當 (是偵錯或縮短但不是。*vsdoc*) 中的檔案*指令碼*符合萬用字元字串"~/Scripts/jquery-{版本}.js"的資料夾。</span><span class="sxs-lookup"><span data-stu-id="a1b18-189">The  preceding code creates a new JavaScript bundle named *~/bundles/jquery* that includes all the appropriate (that is debug or minified but not .*vsdoc*) files in the *Scripts* folder that match the wild card string "~/Scripts/jquery-{version}.js".</span></span> <span data-ttu-id="a1b18-190">ASP.NET MVC 4，這表示偵錯組態，將檔案與*jquery 1.7.1.js*將會新增至組合。</span><span class="sxs-lookup"><span data-stu-id="a1b18-190">For ASP.NET MVC 4, this means with a debug configuration, the file *jquery-1.7.1.js* will be added to the bundle.</span></span> <span data-ttu-id="a1b18-191">在 [發行] 組態*jquery 1.7.1.min.js*將加入。</span><span class="sxs-lookup"><span data-stu-id="a1b18-191">In a release configuration, *jquery-1.7.1.min.js* will be added.</span></span> <span data-ttu-id="a1b18-192">將架構例如遵循幾個常見的慣例：</span><span class="sxs-lookup"><span data-stu-id="a1b18-192">The bundling framework follows several common conventions such as:</span></span>

- <span data-ttu-id="a1b18-193">存在 「 FileX.min.js"和"FileX.js 」 時，請選取一版的 「.min"檔案。</span><span class="sxs-lookup"><span data-stu-id="a1b18-193">Selecting ".min" file for release when "FileX.min.js" and "FileX.js" exist.</span></span>
- <span data-ttu-id="a1b18-194">選取偵錯的非".min 」 版本。</span><span class="sxs-lookup"><span data-stu-id="a1b18-194">Selecting the non ".min" version for debug.</span></span>
- <span data-ttu-id="a1b18-195">正在略過 」-vsdoc 」 檔案 （例如 jquery-1.7.1-vsdoc.js)，這只由 IntelliSense。</span><span class="sxs-lookup"><span data-stu-id="a1b18-195">Ignoring "-vsdoc" files (such as jquery-1.7.1-vsdoc.js), which are used only by IntelliSense.</span></span>

<span data-ttu-id="a1b18-196">`{version}`萬用字元比對上述用來自動建立與 jQuery 中的適當版本的 jQuery 組合您*指令碼*資料夾。</span><span class="sxs-lookup"><span data-stu-id="a1b18-196">The `{version}` wild card matching shown above is used to automatically create a jQuery bundle with the appropriate version of jQuery in your *Scripts* folder.</span></span> <span data-ttu-id="a1b18-197">此範例中，使用萬用字元，提供下列優點：</span><span class="sxs-lookup"><span data-stu-id="a1b18-197">In this example, using a wild card provides the following benefits:</span></span>

- <span data-ttu-id="a1b18-198">可讓您使用 NuGet 而不需要變更上述將程式碼或檢視頁面中的 jQuery 參考更新為較新的 jQuery 版本。</span><span class="sxs-lookup"><span data-stu-id="a1b18-198">Allows you to use NuGet to update to a newer jQuery version without changing the preceding bundling code or jQuery references in your view pages.</span></span>
- <span data-ttu-id="a1b18-199">自動選取偵錯組態的完整版本和版本的 「.min 」 版本組建。</span><span class="sxs-lookup"><span data-stu-id="a1b18-199">Automatically selects the full version for debug configurations and the ".min" version for release builds.</span></span>

## <a name="using-a-cdn"></a><span data-ttu-id="a1b18-200">使用 CDN</span><span class="sxs-lookup"><span data-stu-id="a1b18-200">Using a CDN</span></span>

 <span data-ttu-id="a1b18-201">下列程式碼取代本機 jQuery 組合使用 CDN jQuery 套件組合。</span><span class="sxs-lookup"><span data-stu-id="a1b18-201">The follow code replaces the local jQuery bundle with a CDN jQuery bundle.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample6.cs)]

<span data-ttu-id="a1b18-202">上述程式碼，jQuery 將要求從 CDN 時在發行模式和 jQuery 的偵錯版本將會提取在本機偵錯模式中。</span><span class="sxs-lookup"><span data-stu-id="a1b18-202">In the code above, jQuery will be requested from the CDN while in release mode and the debug version of jQuery will be fetched locally in debug mode.</span></span> <span data-ttu-id="a1b18-203">當使用 CDN 時，您應該在 CDN 要求失敗時，有後援機制。</span><span class="sxs-lookup"><span data-stu-id="a1b18-203">When using a CDN, you should have a fallback mechanism in case the CDN request fails.</span></span> <span data-ttu-id="a1b18-204">下列標記片段從配置檔案顯示指令碼新增至要求 jQuery 應該 CDN 失敗的結尾。</span><span class="sxs-lookup"><span data-stu-id="a1b18-204">The following markup fragment from the end of the layout file shows script added to request jQuery should the CDN fail.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample7.cshtml?highlight=5-13)]

## <a name="creating-a-bundle"></a><span data-ttu-id="a1b18-205">建立套件組合</span><span class="sxs-lookup"><span data-stu-id="a1b18-205">Creating a Bundle</span></span>

<span data-ttu-id="a1b18-206">[配套](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx)類別`Include`方法會採用字串陣列，其中每個字串都是資源的虛擬路徑。</span><span class="sxs-lookup"><span data-stu-id="a1b18-206">The [Bundle](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) class `Include` method takes an array of strings, where each string is a virtual path to resource.</span></span> <span data-ttu-id="a1b18-207">下列程式碼中的 RegisterBundles 方法從*應用程式\_Start\BundleConfig.cs*檔會示範如何在多個檔案會新增至組合：</span><span class="sxs-lookup"><span data-stu-id="a1b18-207">The following code from the RegisterBundles method in the *App\_Start\BundleConfig.cs* file shows how multiple files are added to a bundle:</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample8.cs)]

<span data-ttu-id="a1b18-208">[配套](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx)類別`IncludeDirectory`方法提供來加入所有的檔案的目錄 （以及選擇性地所有子目錄） 中符合搜尋模式。</span><span class="sxs-lookup"><span data-stu-id="a1b18-208">The [Bundle](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) class `IncludeDirectory` method is provided to add all the files in a directory (and optionally all subdirectories) which match a search pattern.</span></span> <span data-ttu-id="a1b18-209">[配套](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx)類別`IncludeDirectory`API 如下所示：</span><span class="sxs-lookup"><span data-stu-id="a1b18-209">The [Bundle](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) class `IncludeDirectory` API is shown below:</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample9.cs)]

<span data-ttu-id="a1b18-210">使用轉譯方法，檢視中所參考的組合 ( `Styles.Render` css 和`Scripts.Render`javascript)。</span><span class="sxs-lookup"><span data-stu-id="a1b18-210">Bundles are referenced in views using the Render method, ( `Styles.Render` for CSS and `Scripts.Render` for JavaScript).</span></span> <span data-ttu-id="a1b18-211">從下列標記 *_layout.cshtml\\_Layout.cshtml*檔案會顯示預設的 ASP.NET 網際網路專案檢視如何參考 CSS 和 JavaScript 的組合。</span><span class="sxs-lookup"><span data-stu-id="a1b18-211">The following markup from the *Views\Shared\\_Layout.cshtml* file shows how the default ASP.NET internet project views reference CSS and JavaScript bundles.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample10.cshtml?highlight=5-6,11)]

<span data-ttu-id="a1b18-212">請注意轉譯方法會採用字串陣列，以便在一行程式碼，您可以加入多種組合。</span><span class="sxs-lookup"><span data-stu-id="a1b18-212">Notice the Render methods takes an array of strings, so you can add multiple bundles in one line of code.</span></span> <span data-ttu-id="a1b18-213">您通常會想要使用轉譯方法會建立必要的 HTML，以便參考資產。</span><span class="sxs-lookup"><span data-stu-id="a1b18-213">You will generally want to use the Render methods which create the necessary HTML to reference the asset.</span></span> <span data-ttu-id="a1b18-214">您可以使用`Url`方法來產生資產的 URL，而不需要參考資產的標記。</span><span class="sxs-lookup"><span data-stu-id="a1b18-214">You can use the `Url` method to generate the URL to the asset without the markup needed to reference the asset.</span></span> <span data-ttu-id="a1b18-215">假設您想要使用新的 HTML5[非同步](http://www.whatwg.org/specs/web-apps/current-work/#attr-script-async)屬性。</span><span class="sxs-lookup"><span data-stu-id="a1b18-215">Suppose you wanted to use the new HTML5 [async](http://www.whatwg.org/specs/web-apps/current-work/#attr-script-async) attribute.</span></span> <span data-ttu-id="a1b18-216">下列程式碼示範如何參考使用 modernizr`Url`方法。</span><span class="sxs-lookup"><span data-stu-id="a1b18-216">The following code shows how to reference modernizr using the `Url` method.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample11.cshtml?highlight=11)]

## <a name="using-the--wildcard-character-to-select-files"></a><span data-ttu-id="a1b18-217">使用 「\*"萬用字元來選取檔案</span><span class="sxs-lookup"><span data-stu-id="a1b18-217">Using the "\*" Wildcard Character to Select Files</span></span>

<span data-ttu-id="a1b18-218">中指定的虛擬路徑`Include`方法，並搜尋模式中`IncludeDirectory`方法可以接受一"\*"做為前置詞或後置詞的最後一個路徑區段中的萬用字元。</span><span class="sxs-lookup"><span data-stu-id="a1b18-218">The virtual path specified in the `Include` method and the search pattern in the `IncludeDirectory` method can accept one "\*" wildcard character as a prefix or suffix to in the last path segment.</span></span> <span data-ttu-id="a1b18-219">搜尋字串是不區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="a1b18-219">The search string is case insensitive.</span></span> <span data-ttu-id="a1b18-220">`IncludeDirectory`方法都有的搜尋子目錄選項。</span><span class="sxs-lookup"><span data-stu-id="a1b18-220">The `IncludeDirectory` method has the option of searching subdirectories.</span></span>

<span data-ttu-id="a1b18-221">專案，請考慮下列 JavaScript 檔案：</span><span class="sxs-lookup"><span data-stu-id="a1b18-221">Consider a project with the following JavaScript files:</span></span>

- <span data-ttu-id="a1b18-222">*Scripts\Common\AddAltToImg.js*</span><span class="sxs-lookup"><span data-stu-id="a1b18-222">*Scripts\Common\AddAltToImg.js*</span></span>
- <span data-ttu-id="a1b18-223">*Scripts\Common\ToggleDiv.js*</span><span class="sxs-lookup"><span data-stu-id="a1b18-223">*Scripts\Common\ToggleDiv.js*</span></span>
- <span data-ttu-id="a1b18-224">*Scripts\Common\ToggleImg.js*</span><span class="sxs-lookup"><span data-stu-id="a1b18-224">*Scripts\Common\ToggleImg.js*</span></span>
- <span data-ttu-id="a1b18-225">*Scripts\Common\Sub1\ToggleLinks.js*</span><span class="sxs-lookup"><span data-stu-id="a1b18-225">*Scripts\Common\Sub1\ToggleLinks.js*</span></span>

![dir imag](bundling-and-minification/_static/image7.png)

<span data-ttu-id="a1b18-227">下表所示，使用萬用字元組合加入的檔案：</span><span class="sxs-lookup"><span data-stu-id="a1b18-227">The following table shows the files added to a bundle using the wildcard as shown:</span></span>

| <span data-ttu-id="a1b18-228">**Call**</span><span class="sxs-lookup"><span data-stu-id="a1b18-228">**Call**</span></span> | <span data-ttu-id="a1b18-229">**加入檔案或引發例外狀況**</span><span class="sxs-lookup"><span data-stu-id="a1b18-229">**Files Added or Exception Raised**</span></span> |
| --- | --- |
| <span data-ttu-id="a1b18-230">Include("~/Scripts/Common/\*.js")</span><span class="sxs-lookup"><span data-stu-id="a1b18-230">Include("~/Scripts/Common/\*.js")</span></span> | <span data-ttu-id="a1b18-231">*AddAltToImg.js，ToggleDiv.js，ToggleImg.js*</span><span class="sxs-lookup"><span data-stu-id="a1b18-231">*AddAltToImg.js, ToggleDiv.js, ToggleImg.js*</span></span> |
| <span data-ttu-id="a1b18-232">Include("~/Scripts/Common/T\*.js")</span><span class="sxs-lookup"><span data-stu-id="a1b18-232">Include("~/Scripts/Common/T\*.js")</span></span> | <span data-ttu-id="a1b18-233">無效的模式例外狀況。</span><span class="sxs-lookup"><span data-stu-id="a1b18-233">Invalid pattern exception.</span></span> <span data-ttu-id="a1b18-234">前置詞或後置詞只允許萬用字元。</span><span class="sxs-lookup"><span data-stu-id="a1b18-234">The wildcard character is only allowed on the prefix or suffix.</span></span> |
| <span data-ttu-id="a1b18-235">Include("~/Scripts/Common/\*og.\*")</span><span class="sxs-lookup"><span data-stu-id="a1b18-235">Include("~/Scripts/Common/\*og.\*")</span></span> | <span data-ttu-id="a1b18-236">無效的模式例外狀況。</span><span class="sxs-lookup"><span data-stu-id="a1b18-236">Invalid pattern exception.</span></span> <span data-ttu-id="a1b18-237">允許只能有一個萬用字元。</span><span class="sxs-lookup"><span data-stu-id="a1b18-237">Only one wildcard character is allowed.</span></span> |
| <span data-ttu-id="a1b18-238">"Include("~/Scripts/Common/T\*")</span><span class="sxs-lookup"><span data-stu-id="a1b18-238">"Include("~/Scripts/Common/T\*")</span></span> | <span data-ttu-id="a1b18-239">*ToggleDiv.js ToggleImg.js*</span><span class="sxs-lookup"><span data-stu-id="a1b18-239">*ToggleDiv.js, ToggleImg.js*</span></span> |
| <span data-ttu-id="a1b18-240">"Include("~/Scripts/Common/\*")</span><span class="sxs-lookup"><span data-stu-id="a1b18-240">"Include("~/Scripts/Common/\*")</span></span> | <span data-ttu-id="a1b18-241">無效的模式例外狀況。</span><span class="sxs-lookup"><span data-stu-id="a1b18-241">Invalid pattern exception.</span></span> <span data-ttu-id="a1b18-242">純的萬用字元片段無效。</span><span class="sxs-lookup"><span data-stu-id="a1b18-242">A pure wildcard segment is not valid.</span></span> |
| <span data-ttu-id="a1b18-243">IncludeDirectory("~/Scripts/Common", "T\*")</span><span class="sxs-lookup"><span data-stu-id="a1b18-243">IncludeDirectory("~/Scripts/Common", "T\*")</span></span> | <span data-ttu-id="a1b18-244">*ToggleDiv.js ToggleImg.js*</span><span class="sxs-lookup"><span data-stu-id="a1b18-244">*ToggleDiv.js, ToggleImg.js*</span></span> |
| <span data-ttu-id="a1b18-245">IncludeDirectory("~/Scripts/Common", "T\*",true)</span><span class="sxs-lookup"><span data-stu-id="a1b18-245">IncludeDirectory("~/Scripts/Common", "T\*",true)</span></span> | <span data-ttu-id="a1b18-246">*ToggleDiv.js，ToggleImg.js，ToggleLinks.js*</span><span class="sxs-lookup"><span data-stu-id="a1b18-246">*ToggleDiv.js, ToggleImg.js, ToggleLinks.js*</span></span> |

<span data-ttu-id="a1b18-247">明確地將每個檔案加入至組合是通常慣用透過萬用字元載入的檔案，原因如下：</span><span class="sxs-lookup"><span data-stu-id="a1b18-247">Explicitly adding each file to a bundle is generally the preferred over wildcard loading of files for the following reasons:</span></span>

- <span data-ttu-id="a1b18-248">加入指令碼萬用字元預設依字母順序，通常不是您想要載入它們。</span><span class="sxs-lookup"><span data-stu-id="a1b18-248">Adding scripts by wildcard defaults to loading them in alphabetical order, which is typically not what you want.</span></span> <span data-ttu-id="a1b18-249">若要新增特定的 （非英文字母） 順序經常需要 CSS 和 JavaScript 檔案。</span><span class="sxs-lookup"><span data-stu-id="a1b18-249">CSS and JavaScript files frequently need to be added in a specific (non-alphabetic) order.</span></span> <span data-ttu-id="a1b18-250">您可以新增自訂來降低此風險[IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx)實作，但是會明確地將每個檔案較不易有錯誤。</span><span class="sxs-lookup"><span data-stu-id="a1b18-250">You can mitigate this risk by adding a custom [IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx) implementation, but explicitly adding each file is less error prone.</span></span> <span data-ttu-id="a1b18-251">比方說，您可以在其中加入新資產的資料夾在未來可能需要修改您[IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx)實作。</span><span class="sxs-lookup"><span data-stu-id="a1b18-251">For example, you might add new assets to a folder in the future which might require you to modify your [IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx) implementation.</span></span>
- <span data-ttu-id="a1b18-252">檢視特定檔案新增至目錄，使用載入的萬用字元可以包含在所有檢視中參考該配套。</span><span class="sxs-lookup"><span data-stu-id="a1b18-252">View specific files added to a directory using wild card loading can be included in all views referencing that bundle.</span></span> <span data-ttu-id="a1b18-253">如果檢視特定指令碼新增至組合，您可能會參考組合之其他檢視上的 JavaScript 錯誤。</span><span class="sxs-lookup"><span data-stu-id="a1b18-253">If the view specific script is added to a bundle, you may get a JavaScript error on other views that reference the bundle.</span></span>
- <span data-ttu-id="a1b18-254">CSS 檔案匯入其他檔案，會導致匯入的檔案載入兩次。</span><span class="sxs-lookup"><span data-stu-id="a1b18-254">CSS files that import other files result in the imported files loaded twice.</span></span> <span data-ttu-id="a1b18-255">例如，下列程式碼建立組合與大部分的載入兩次的 jQuery UI 佈景主題 CSS 檔。</span><span class="sxs-lookup"><span data-stu-id="a1b18-255">For example, the following code creates a bundle with most of the jQuery UI theme CSS files loaded twice.</span></span> 

    [!code-csharp[Main](bundling-and-minification/samples/sample12.cs)]

  <span data-ttu-id="a1b18-256">萬用字元選取器 」\*.css 」 會在資料夾中，每個 CSS 檔案中包括*Content\themes\base\jquery.ui.all.css*檔案。</span><span class="sxs-lookup"><span data-stu-id="a1b18-256">The wild card selector "\*.css" brings in each CSS file in the folder, including the *Content\themes\base\jquery.ui.all.css* file.</span></span> <span data-ttu-id="a1b18-257">*Jquery.ui.all.css*檔匯入其他 CSS 檔案。</span><span class="sxs-lookup"><span data-stu-id="a1b18-257">The *jquery.ui.all.css* file imports other CSS files.</span></span>

## <a name="bundle-caching"></a><span data-ttu-id="a1b18-258">快取中組合</span><span class="sxs-lookup"><span data-stu-id="a1b18-258">Bundle Caching</span></span>

<span data-ttu-id="a1b18-259">組合設定組合建立時從 HTTP 到期標頭一年。</span><span class="sxs-lookup"><span data-stu-id="a1b18-259">Bundles set the HTTP Expires Header one year from when the bundle is created.</span></span> <span data-ttu-id="a1b18-260">如果您瀏覽至先前檢視過的頁面上，Fiddler 顯示 IE 不會進行條件式要求的組合，亦即沒有來自 HTTP GET 要求組合的 IE 和來自伺服器的 HTTP 304 回應。</span><span class="sxs-lookup"><span data-stu-id="a1b18-260">If you navigate to a previously viewed page, Fiddler shows IE does not make a conditional request for the bundle, that is, there are no HTTP GET requests from IE for the bundles and no HTTP 304 responses from the server.</span></span> <span data-ttu-id="a1b18-261">您可以強制 IE （導致每個組合的 HTTP 304 回應） F5 鍵以進行條件式要求每個組合。</span><span class="sxs-lookup"><span data-stu-id="a1b18-261">You can force IE to make a conditional request for each bundle with the F5 key (resulting in a HTTP 304 response for each bundle).</span></span> <span data-ttu-id="a1b18-262">可以使用強制執行完整的重新整理 ^ F5 （導致每個組合的 HTTP 200 回應）。</span><span class="sxs-lookup"><span data-stu-id="a1b18-262">You can force a full refresh by using ^F5 (resulting in a HTTP 200 response for each bundle.)</span></span>

<span data-ttu-id="a1b18-263">下圖顯示**快取**Fiddler 回應窗格 索引標籤：</span><span class="sxs-lookup"><span data-stu-id="a1b18-263">The following image shows the **Caching** tab of the Fiddler response pane:</span></span>

![fiddler 快取映像](bundling-and-minification/_static/image8.png)

<span data-ttu-id="a1b18-265">要求</span><span class="sxs-lookup"><span data-stu-id="a1b18-265">The request</span></span>   
`http://localhost/MvcBM_time/bundles/AllMyScripts?v=r0sLDicvP58AIXN_mc3QdyVvVj5euZNzdsa2N1PKvb81`  
 <span data-ttu-id="a1b18-266">組合是**AllMyScripts**和包含查詢字串組**v = r0sLDicvP58AIXN\_mc3QdyVvVj5euZNzdsa2N1PKvb81**。</span><span class="sxs-lookup"><span data-stu-id="a1b18-266">is for the bundle **AllMyScripts** and contains a query string pair **v=r0sLDicvP58AIXN\_mc3QdyVvVj5euZNzdsa2N1PKvb81**.</span></span> <span data-ttu-id="a1b18-267">查詢字串**v**語彙基元也就是用來快取的唯一識別碼的值。</span><span class="sxs-lookup"><span data-stu-id="a1b18-267">The query string **v** has a value token that is a unique identifier used for caching.</span></span> <span data-ttu-id="a1b18-268">ASP.NET 應用程式，只要組合不會變更，將要求**AllMyScripts**組合使用這個語彙基元。</span><span class="sxs-lookup"><span data-stu-id="a1b18-268">As long as the bundle doesn't change, the ASP.NET application will request the **AllMyScripts** bundle using this token.</span></span> <span data-ttu-id="a1b18-269">如果變更組合中的任何檔案，asp.net WEB 最佳化架構會產生新的權杖，以及確保組合的瀏覽器要求會取得最新的套件組合。</span><span class="sxs-lookup"><span data-stu-id="a1b18-269">If any file in the bundle changes, the ASP.NET optimization framework will generate a new token, guaranteeing that browser requests for the bundle will get the latest bundle.</span></span>

<span data-ttu-id="a1b18-270">如果您執行 IE9 F12 開發人員工具，並瀏覽至先前載入的頁面，即不正確地顯示對每個組合和伺服器傳回 HTTP 304 的條件式 GET 要求。</span><span class="sxs-lookup"><span data-stu-id="a1b18-270">If you run the IE9 F12 developer tools and navigate to a previously loaded page, IE incorrectly shows conditional GET requests made to each bundle and the server returning HTTP 304.</span></span> <span data-ttu-id="a1b18-271">您可以閱讀 IE9 為什麼有問題，判斷條件式要求的部落格文章中[使用 Cdn 和改善網站效能的到期日](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a1b18-271">You can read why IE9 has problems determining if a conditional request was made in the blog entry [Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span>

## <a name="less-coffeescript-scss-sass-bundling"></a><span data-ttu-id="a1b18-272">較少，CoffeeScript、 SCSS，sass 此類結合在一起。</span><span class="sxs-lookup"><span data-stu-id="a1b18-272">LESS, CoffeeScript, SCSS, Sass Bundling.</span></span>

<span data-ttu-id="a1b18-273">統合及縮製架構提供一個機制，例如處理中繼語言[SCSS](http://sass-lang.com/)， [Sass](http://sass-lang.com/)，[較少](http://www.dotlesscss.org/)或[Coffeescript](http://coffeescript.org/)，並將例如縮製的轉換套用至產生的套件組合。</span><span class="sxs-lookup"><span data-stu-id="a1b18-273">The bundling and minification framework provides a mechanism to process intermediate languages such as [SCSS](http://sass-lang.com/), [Sass](http://sass-lang.com/), [LESS](http://www.dotlesscss.org/) or [Coffeescript](http://coffeescript.org/), and apply transforms such as minification to the resulting bundle.</span></span> <span data-ttu-id="a1b18-274">例如，若要新增[.less](http://www.dotlesscss.org/)至 MVC 4 專案的檔案：</span><span class="sxs-lookup"><span data-stu-id="a1b18-274">For example, to add [.less](http://www.dotlesscss.org/) files to your MVC 4 project:</span></span>

1. <span data-ttu-id="a1b18-275">建立適用於您較少的內容資料夾。</span><span class="sxs-lookup"><span data-stu-id="a1b18-275">Create a folder for your LESS content.</span></span> <span data-ttu-id="a1b18-276">下列範例會使用*Content\MyLess*資料夾。</span><span class="sxs-lookup"><span data-stu-id="a1b18-276">The following example uses the *Content\MyLess* folder.</span></span>
2. <span data-ttu-id="a1b18-277">新增[.less](http://www.dotlesscss.org/) NuGet 封裝**無點**至您的專案。</span><span class="sxs-lookup"><span data-stu-id="a1b18-277">Add the [.less](http://www.dotlesscss.org/) NuGet package **dotless** to your project.</span></span>  
    <span data-ttu-id="a1b18-278">![NuGet 無點安裝](bundling-and-minification/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="a1b18-278">![NuGet dotless install](bundling-and-minification/_static/image9.png)</span></span>
3. <span data-ttu-id="a1b18-279">加入的類別，實作[IBundleTransform](https://msdn.microsoft.com/library/system.web.optimization.ibundletransform(VS.110).aspx)介面。</span><span class="sxs-lookup"><span data-stu-id="a1b18-279">Add a class that implements the [IBundleTransform](https://msdn.microsoft.com/library/system.web.optimization.ibundletransform(VS.110).aspx) interface.</span></span> <span data-ttu-id="a1b18-280">.Less 轉換，請將下列程式碼加入您的專案。</span><span class="sxs-lookup"><span data-stu-id="a1b18-280">For the .less transform, add the following code to your project.</span></span>

    [!code-csharp[Main](bundling-and-minification/samples/sample13.cs)]
4. <span data-ttu-id="a1b18-281">建立具有較少檔案的組合`LessTransform`和[CssMinify](https://msdn.microsoft.com/library/system.web.optimization.cssminify(VS.110).aspx)轉換。</span><span class="sxs-lookup"><span data-stu-id="a1b18-281">Create a bundle of LESS files with the `LessTransform` and the [CssMinify](https://msdn.microsoft.com/library/system.web.optimization.cssminify(VS.110).aspx) transform.</span></span> <span data-ttu-id="a1b18-282">將下列程式碼加入`RegisterBundles`方法中的*應用程式\_Start\BundleConfig.cs*檔案。</span><span class="sxs-lookup"><span data-stu-id="a1b18-282">Add the following code to the `RegisterBundles` method in the *App\_Start\BundleConfig.cs* file.</span></span>

    [!code-csharp[Main](bundling-and-minification/samples/sample14.cs)]
5. <span data-ttu-id="a1b18-283">將下列程式碼加入至參考較少的資源存放區的任何檢視。</span><span class="sxs-lookup"><span data-stu-id="a1b18-283">Add the following code to any views which references the LESS bundle.</span></span>

    [!code-cshtml[Main](bundling-and-minification/samples/sample15.cshtml)]

## <a name="bundle-considerations"></a><span data-ttu-id="a1b18-284">配套的考量</span><span class="sxs-lookup"><span data-stu-id="a1b18-284">Bundle Considerations</span></span>

<span data-ttu-id="a1b18-285">建立套件組合時所應遵循的良好慣例是納入 「 組合 」 中的資源存放區名稱的前置詞。</span><span class="sxs-lookup"><span data-stu-id="a1b18-285">A good convention to follow when creating bundles is to include "bundle" as a prefix in the bundle name.</span></span> <span data-ttu-id="a1b18-286">這會避免可能[路由衝突](https://forums.asp.net/post/5012037.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a1b18-286">This will prevent a possible [routing conflict](https://forums.asp.net/post/5012037.aspx).</span></span>

<span data-ttu-id="a1b18-287">一旦您更新配套中的一個檔案時，套件組合的查詢字串參數產生新的權杖和完整的組合必須下載用戶端要求網頁包含組合在下一次。</span><span class="sxs-lookup"><span data-stu-id="a1b18-287">Once you update one file in a bundle, a new token is generated for the bundle query string parameter and the full bundle must be downloaded the next time a client requests a page containing the bundle.</span></span> <span data-ttu-id="a1b18-288">在傳統標記中個別列出每個資產時，會下載已變更的檔案。</span><span class="sxs-lookup"><span data-stu-id="a1b18-288">In traditional markup where each asset is listed individually, only the changed file would be downloaded.</span></span> <span data-ttu-id="a1b18-289">經常變更的資產可能不是理想的對象的結合在一起。</span><span class="sxs-lookup"><span data-stu-id="a1b18-289">Assets that change frequently may not be good candidates for bundling.</span></span>

<span data-ttu-id="a1b18-290">統合及縮製主要改善第一個頁面要求載入時間。</span><span class="sxs-lookup"><span data-stu-id="a1b18-290">Bundling and minification primarily improve the first page request load time.</span></span> <span data-ttu-id="a1b18-291">一旦要求的網頁，瀏覽器快取資產 （JavaScript、 CSS 和圖像） 因此統合及縮製將不提供任何提升效能，當要求相同的頁面上，或在相同的網頁站台要求相同的資產。</span><span class="sxs-lookup"><span data-stu-id="a1b18-291">Once a webpage has been requested, the browser caches the assets (JavaScript, CSS and images) so bundling and minification won't provide any performance boost when requesting the same page, or pages on the same site requesting the same assets.</span></span> <span data-ttu-id="a1b18-292">如果您不需要設定到期標頭，在您的資產上正確和不使用統合及縮製、 瀏覽器有效性啟發學習法會將標示為資產過時幾天之後和瀏覽器將會需要為每個資產的驗證要求。</span><span class="sxs-lookup"><span data-stu-id="a1b18-292">If you don't set the expires header correctly on your assets, and you don't use bundling and minification, the browsers freshness heuristics will mark the assets stale after a few days and the browser will require a validation request for each asset.</span></span> <span data-ttu-id="a1b18-293">在此情況下，統合及縮製的第一個頁面要求之後，提供的效能提升。</span><span class="sxs-lookup"><span data-stu-id="a1b18-293">In this case, bundling and minification provide a performance increase after the first page request.</span></span> <span data-ttu-id="a1b18-294">如需詳細資訊，請參閱部落格[使用 Cdn 和改善網站效能的到期日](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a1b18-294">For details, see the blog [Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span>

<span data-ttu-id="a1b18-295">每個每個主機名稱的六個同時連線的瀏覽器限制可減輕使用[CDN](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a1b18-295">The browser limitation of six simultaneous connections per each hostname can be mitigated by using a [CDN](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span> <span data-ttu-id="a1b18-296">CDN 會有不同的主機名稱與您裝載站台，因為 cdn 資產要求將不會列入裝載環境的六個同時連線限制。</span><span class="sxs-lookup"><span data-stu-id="a1b18-296">Because the CDN will have a different hostname than your hosting site, asset requests from the CDN will not count against the six simultaneous connections limit to your hosting environment.</span></span> <span data-ttu-id="a1b18-297">CDN 時，也可以提供一般封裝快取和邊緣快取的優點。</span><span class="sxs-lookup"><span data-stu-id="a1b18-297">A CDN can also provide common package caching and edge caching advantages.</span></span>

<span data-ttu-id="a1b18-298">組合應該由需要它們的頁面分割。</span><span class="sxs-lookup"><span data-stu-id="a1b18-298">Bundles should be partitioned by pages that need them.</span></span> <span data-ttu-id="a1b18-299">例如的預設網際網路應用程式的 ASP.NET MVC 範本會建立 jQuery 驗證配套分開 jQuery。</span><span class="sxs-lookup"><span data-stu-id="a1b18-299">For example, the default ASP.NET MVC template for an internet application creates a jQuery Validation bundle separate from jQuery.</span></span> <span data-ttu-id="a1b18-300">建立的預設檢視有沒有輸入，並不會回傳值，因為它們不包含驗證套件組合。</span><span class="sxs-lookup"><span data-stu-id="a1b18-300">Because the default views created have no input and do not post values, they don't include the validation bundle.</span></span>

<span data-ttu-id="a1b18-301">`System.Web.Optimization` System.Web.Optimization.DLL 中實作的命名空間。</span><span class="sxs-lookup"><span data-stu-id="a1b18-301">The `System.Web.Optimization` namespace is implemented in System.Web.Optimization.DLL.</span></span> <span data-ttu-id="a1b18-302">它會利用 WebGrease 程式庫 (WebGrease.dll) 縮製功能，接著使用 Antlr3.Runtime.dll。</span><span class="sxs-lookup"><span data-stu-id="a1b18-302">It leverages the WebGrease library (WebGrease.dll) for minification capabilities, which in turn uses Antlr3.Runtime.dll.</span></span>

<span data-ttu-id="a1b18-303">*使用 Twitter 進行快速文章及共用的連結。我 Twitter 控點是*: [@RickAndMSFT](http://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="a1b18-303">*I use Twitter to make quick posts and share links. My Twitter handle is*: [@RickAndMSFT](http://twitter.com/RickAndMSFT)</span></span>

## <a name="additional-resources"></a><span data-ttu-id="a1b18-304">其他資源</span><span class="sxs-lookup"><span data-stu-id="a1b18-304">Additional Resources</span></span>

- <span data-ttu-id="a1b18-305">影片：[統合及最佳化](https://channel9.msdn.com/Events/aspConf/aspConf/Bundling-and-Optimizing)由[Howard Dierking](https://twitter.com/#!/howard_dierking)</span><span class="sxs-lookup"><span data-stu-id="a1b18-305">Video:[Bundling and Optimizing](https://channel9.msdn.com/Events/aspConf/aspConf/Bundling-and-Optimizing) by [Howard Dierking](https://twitter.com/#!/howard_dierking)</span></span>
- <span data-ttu-id="a1b18-306">[加入 Web Pages 站台中的 Web 最佳化](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a1b18-306">[Adding Web Optimization to a Web Pages Site](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx).</span></span>
- <span data-ttu-id="a1b18-307">[新增組合和縮製到 Web Form](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a1b18-307">[Adding Bundling and Minification to Web Forms](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx).</span></span>
- <span data-ttu-id="a1b18-308">[效能影響的組合和縮製的網頁瀏覽](https://blogs.msdn.com/b/henrikn/archive/2012/06/17/performance-implications-of-bundling-and-minification-on-http.aspx)由[Henrik F Nielsen](http://en.wikipedia.org/wiki/Henrik_Frystyk_Nielsen) [@frystyk](https://twitter.com/frystyk)</span><span class="sxs-lookup"><span data-stu-id="a1b18-308">[Performance Implications of Bundling and Minification on Web Browsing](https://blogs.msdn.com/b/henrikn/archive/2012/06/17/performance-implications-of-bundling-and-minification-on-http.aspx) by [Henrik F Nielsen](http://en.wikipedia.org/wiki/Henrik_Frystyk_Nielsen) [@frystyk](https://twitter.com/frystyk)</span></span>
- <span data-ttu-id="a1b18-309">[使用 Cdn，而且已過期來改善網站效能](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)由 Rick anderson 發表 [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="a1b18-309">[Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx) by Rick Anderson [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)</span></span>
- [<span data-ttu-id="a1b18-310">最小化 RTT （來回行程時間）</span><span class="sxs-lookup"><span data-stu-id="a1b18-310">Minimize RTT (round-trip times)</span></span>](https://developers.google.com/speed/docs/best-practices/rtt)

## <a name="contributors"></a><span data-ttu-id="a1b18-311">Contributors</span><span class="sxs-lookup"><span data-stu-id="a1b18-311">Contributors</span></span>

- <span data-ttu-id="a1b18-312">Hao 是一隻</span><span class="sxs-lookup"><span data-stu-id="a1b18-312">Hao Kung</span></span>
- [<span data-ttu-id="a1b18-313">Howard Dierking</span><span class="sxs-lookup"><span data-stu-id="a1b18-313">Howard Dierking</span></span>](https://twitter.com/#!/howard_dierking)
- <span data-ttu-id="a1b18-314">Diana LaRose</span><span class="sxs-lookup"><span data-stu-id="a1b18-314">Diana LaRose</span></span>
