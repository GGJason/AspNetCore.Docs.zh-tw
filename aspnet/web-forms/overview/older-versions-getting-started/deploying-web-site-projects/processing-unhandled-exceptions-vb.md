---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb
title: 處理未處理的例外狀況 (VB) |Microsoft 文件
author: rick-anderson
description: 在生產環境中的 web 應用程式就會發生執行階段錯誤時，務必通知開發人員，並記錄錯誤，因此可能會在中診斷 a la...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/09/2009
ms.topic: article
ms.assetid: 051296f0-9519-4e78-835c-d868da13b0a0
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: cb42cf6c457cf20da7f65352bb7eed1230b59588
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/06/2018
ms.locfileid: "30890173"
---
<a name="processing-unhandled-exceptions-vb"></a><span data-ttu-id="0e1b4-103">處理未處理的例外狀況 (VB)</span><span class="sxs-lookup"><span data-stu-id="0e1b4-103">Processing Unhandled Exceptions (VB)</span></span>
====================
<span data-ttu-id="0e1b4-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="0e1b4-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="0e1b4-105">[檢視或下載範例程式碼](https://github.com/aspnet/Docs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb/samples) \(英文\) ([如何下載](/aspnet/core/tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="0e1b4-105">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb/samples) ([how to download](/aspnet/core/tutorials/index#how-to-download-a-sample))</span></span>

> <span data-ttu-id="0e1b4-106">在生產環境中的 web 應用程式發生執行階段錯誤時務必通知開發人員，並記錄錯誤，因此可能會在稍後中診斷的時間。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-106">When a runtime error occurs on a web application in production it is important to notify a developer and to log the error so that it may be diagnosed at a later point in time.</span></span> <span data-ttu-id="0e1b4-107">本教學課程提供如何 ASP.NET 處理執行階段錯誤，並查看有自訂程式碼執行時處理的例外狀況 （泡泡） 至 ASP.NET 執行階段的其中一種方式的概觀。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-107">This tutorial provides an overview of how ASP.NET processes runtime errors and looks at one way to have custom code execute whenever an unhandled exception bubbles up to the ASP.NET runtime.</span></span>


## <a name="introduction"></a><span data-ttu-id="0e1b4-108">簡介</span><span class="sxs-lookup"><span data-stu-id="0e1b4-108">Introduction</span></span>

<span data-ttu-id="0e1b4-109">ASP.NET 應用程式中處理的例外狀況時，它會顯示最 ASP.NET 執行階段，這會引發多`Error`事件，並顯示適當的錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-109">When an unhandled exception occurs in an ASP.NET application, it bubbles up to the ASP.NET runtime, which raises the `Error` event and displays the appropriate error page.</span></span> <span data-ttu-id="0e1b4-110">有三種不同的錯誤網頁： 執行階段錯誤黃色螢幕的死亡 (YSOD);例外狀況詳細資料 YSOD;和自訂錯誤網頁。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-110">There are three different types of error pages: the Runtime Error Yellow Screen of Death (YSOD); the Exception Details YSOD; and custom error pages.</span></span> <span data-ttu-id="0e1b4-111">在[前述教學課程](displaying-a-custom-error-page-vb.md)我們設定要用於遠端使用者及使用者瀏覽本機例外狀況詳細資料 YSOD 的自訂錯誤網頁應用程式。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-111">In the [preceding tutorial](displaying-a-custom-error-page-vb.md) we configured the application to use a custom error page for remote users and the Exception Details YSOD for users visiting locally.</span></span>

<span data-ttu-id="0e1b4-112">使用符合網站的外觀與風格的人類看得方便自訂錯誤頁面，預設執行階段錯誤 YSOD，但顯示的自訂錯誤頁面是只有一個完整的錯誤處理方案的一部分。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-112">Using a human-friendly custom error page that matches the look and feel of the site is preferred to the default Runtime Error YSOD, but displaying a custom error page is only one part of a comprehensive error handling solution.</span></span> <span data-ttu-id="0e1b4-113">在生產環境中應用程式中發生錯誤時，很重要的開發人員會通知錯誤的使他們可以 unearth 例外狀況的原因和解決。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-113">When an error occurs in an application in production, it is important that the developers are notified of the error so that they can unearth the cause of the exception and address it.</span></span> <span data-ttu-id="0e1b4-114">此外，錯誤詳細資料應記錄，讓錯誤能夠檢查，並診斷在稍後的時間。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-114">Furthermore, the error's details should be logged so that the error can be examined and diagnosed at a later point in time.</span></span>

<span data-ttu-id="0e1b4-115">本教學課程會示範如何存取的未處理的例外狀況詳細資料，以便可以進行記錄和開發人員收到通知。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-115">This tutorial shows how to access the details of an unhandled exception so that they can be logged and a developer notified.</span></span> <span data-ttu-id="0e1b4-116">下列這其中的兩個教學課程中，瀏覽錯誤記錄程式庫之後的位元的設定，, 將自動通知開發人員的執行階段錯誤，並記錄其詳細資料。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-116">The two tutorials following this one explore error logging libraries that, after a bit of configuration, will automatically notify developers of runtime errors and log their details.</span></span>

> [!NOTE]
> <span data-ttu-id="0e1b4-117">檢查此教學課程中的資訊是最有用，如果您需要唯一或自訂的方式處理未處理例外狀況。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-117">The information examined in this tutorial is most useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="0e1b4-118">在您只需要記錄的例外狀況，並通知開發人員的情況下，使用錯誤記錄程式庫是的方式。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-118">In cases where you only need to log the exception and notify a developer, using an error logging library is the way to go.</span></span> <span data-ttu-id="0e1b4-119">下面兩個教學課程提供兩個這類程式庫的概觀。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-119">The next two tutorials provide an overview of two such libraries.</span></span>


## <a name="executing-code-when-theerrorevent-is-raised"></a><span data-ttu-id="0e1b4-120">執行程式碼時`Error`就會引發事件</span><span class="sxs-lookup"><span data-stu-id="0e1b4-120">Executing Code When The`Error`Event Is Raised</span></span>

<span data-ttu-id="0e1b4-121">事件會提供物件的訊號，已發生一些有趣的東西，以及要在回應中執行程式碼的另一個物件的機制。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-121">Events provide an object a mechanism for signaling that something interesting has occurred, and for another object to execute code in response.</span></span> <span data-ttu-id="0e1b4-122">ASP.NET 開發人員會習慣思考事件。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-122">As an ASP.NET developer you are accustomed to thinking in terms of events.</span></span> <span data-ttu-id="0e1b4-123">如果您想要的訪客按一下特定的按鈕時執行一些程式碼，您會建立事件處理常式，按鈕`Click`事件並將程式碼放。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-123">If you want to run some code when the visitor clicks a particular Button, you create an event handler for that Button's `Click` event and put your code there.</span></span> <span data-ttu-id="0e1b4-124">假設 ASP.NET 執行階段引發其[`Error`事件](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx)每次處理的例外狀況發生時，它會依照，記錄錯誤的詳細資料的程式碼將會進入事件處理常式中。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-124">Given that the ASP.NET runtime raises its [`Error` event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) whenever an unhandled exception occurs, it follows that the code for logging the error's details would go in an event handler.</span></span> <span data-ttu-id="0e1b4-125">如何建立事件處理常式，但`Error`事件嗎？</span><span class="sxs-lookup"><span data-stu-id="0e1b4-125">But how do you create an event handler for the `Error` event?</span></span>

<span data-ttu-id="0e1b4-126">`Error`事件是在許多事件的其中一個[`HttpApplication`類別](https://msdn.microsoft.com/library/system.web.httpapplication.aspx)，會在 HTTP 管線中的特定階段上引發要求的存留期間。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-126">The `Error` event is one of many events in the [`HttpApplication` class](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) that are raised at certain stages in the HTTP pipeline during the lifetime of a request.</span></span> <span data-ttu-id="0e1b4-127">例如，`HttpApplication`類別的[`BeginRequest`事件](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx); 的每個要求開頭引發其[`AuthenticateRequest`事件](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx)要求者所識別的安全性模組時引發。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-127">For example, the `HttpApplication` class's [`BeginRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) is raised at the start of every request; its [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) is raised when a security module has identified the requestor.</span></span> <span data-ttu-id="0e1b4-128">這些`HttpApplication`事件讓網頁開發人員在要求的存留期執行的各個點上的自訂邏輯方式。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-128">These `HttpApplication` events give the page developer a means to execute custom logic at the various points in the lifetime of a request.</span></span>

<span data-ttu-id="0e1b4-129">事件處理常式`HttpApplication`事件可以放在名為的特殊檔案`Global.asax`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-129">Event handlers for the `HttpApplication` events can be placed in a special file named `Global.asax`.</span></span> <span data-ttu-id="0e1b4-130">若要建立此檔案在您的網站中，將新的項目加入至使用通用應用程式類別樣板的名稱您網站的根目錄`Global.asax`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-130">To create this file in your website, add a new item to the root of your website using the Global Application Class template with the name `Global.asax`.</span></span>

[![](processing-unhandled-exceptions-vb/_static/image2.png)](processing-unhandled-exceptions-vb/_static/image1.png)

<span data-ttu-id="0e1b4-131">**圖 1**： 新增`Global.asax`您 Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="0e1b4-131">**Figure 1**: Add `Global.asax` To Your Web Application</span></span>  
 <span data-ttu-id="0e1b4-132">([按一下以檢視完整大小的影像](processing-unhandled-exceptions-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="0e1b4-132">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image3.png))</span></span>

<span data-ttu-id="0e1b4-133">內容和結構`Global.asax`稍微根據您是否使用 Web 應用程式專案 (WAP) 或網站專案 (WSP) Visual Studio 所建立的檔案而有所不同。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-133">The contents and structure of the `Global.asax` file created by Visual Studio differ slightly based on whether you are using a Web Application Project (WAP) or Web Site Project (WSP).</span></span> <span data-ttu-id="0e1b4-134">與 WAP，`Global.asax`實作為兩個不同的檔案-`Global.asax`和`Global.asax.vb`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-134">With a WAP, the `Global.asax` is implemented as two separate files - `Global.asax` and `Global.asax.vb`.</span></span> <span data-ttu-id="0e1b4-135">`Global.asax`檔案包含任何項目，但`@Application`指示詞參考`.vb`檔案; 事件中所定義的感興趣的處理常式`Global.asax.vb`檔案。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-135">The `Global.asax` file contains nothing but an `@Application` directive that references the `.vb` file; the event handlers of interest are defined in the `Global.asax.vb` file.</span></span> <span data-ttu-id="0e1b4-136">WSPs，建立單一檔案， `Global.asax`，且事件處理常式已定義在`<script runat="server">`區塊。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-136">For WSPs, only a single file is created, `Global.asax`, and the event handlers are defined in a `<script runat="server">` block.</span></span>

<span data-ttu-id="0e1b4-137">`Global.asax` WAP 中由 Visual Studio 通用應用程式類別範本檔案包含名為的事件處理常式`Application_BeginRequest`， `Application_AuthenticateRequest`，和`Application_Error`，這是事件處理常式，如`HttpApplication`事件`BeginRequest`， `AuthenticateRequest`，和`Error`分別。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-137">The `Global.asax` file created in a WAP by Visual Studio's Global Application Class template includes event handlers named `Application_BeginRequest`, `Application_AuthenticateRequest`, and `Application_Error`, which are event handlers for the `HttpApplication` events `BeginRequest`, `AuthenticateRequest`, and `Error`, respectively.</span></span> <span data-ttu-id="0e1b4-138">另外還有名為事件處理常式`Application_Start`， `Session_Start`， `Application_End`，和`Session_End`，這是 web 應用程式啟動時，當新的工作階段啟動時，應用程式結束時，所引發的事件處理常式，並在工作階段結束時，分別。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-138">There are also event handlers named `Application_Start`, `Session_Start`, `Application_End`, and `Session_End`, which are event handlers that fire when the web application starts, when a new session starts, when the application ends, and when a session ends, respectively.</span></span> <span data-ttu-id="0e1b4-139">`Global.asax`由 Visual Studio 建立 WSP 檔案只包含`Application_Error`， `Application_Start`， `Session_Start`， `Application_End`，和`Session_End`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-139">The `Global.asax` file created in a WSP by Visual Studio contains just the `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, and `Session_End` event handlers.</span></span>

> [!NOTE]
> <span data-ttu-id="0e1b4-140">部署 ASP.NET 應用程式時，您需要將複製`Global.asax`檔案到生產環境。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-140">When deploying the ASP.NET application you need to copy the `Global.asax` file to the production environment.</span></span> <span data-ttu-id="0e1b4-141">`Global.asax.vb` WAP 中建立的檔案不需要複製到生產環境，因為這段程式碼會編譯專案的組件。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-141">The `Global.asax.vb` file, which is created in the WAP, does not need to be copied to production because this code is compiled into the project's assembly.</span></span>


<span data-ttu-id="0e1b4-142">Visual Studio 通用應用程式類別範本所建立的事件處理常式並不詳盡。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-142">The event handlers created by Visual Studio's Global Application Class template are not exhaustive.</span></span> <span data-ttu-id="0e1b4-143">您可以加入事件處理常式的任何`HttpApplication`藉由命名事件處理常式的事件`Application_EventName`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-143">You can add an event handler for any `HttpApplication` event by naming the event handler `Application_EventName`.</span></span> <span data-ttu-id="0e1b4-144">例如，您可以加入下列程式碼加入`Global.asax`檔案以建立事件處理常式[`AuthorizeRequest`事件](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span><span class="sxs-lookup"><span data-stu-id="0e1b4-144">For example, you could add the following code to the `Global.asax` file to create an event handler for the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample1.vb)]

<span data-ttu-id="0e1b4-145">同樣地，您可以移除任何事件處理常式的全域應用程式類別範本所建立不需要用到。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-145">Likewise, you can remove any event handlers created by the Global Application Class template that are not needed.</span></span> <span data-ttu-id="0e1b4-146">此教學課程中，我們只需要的事件處理常式`Error`事件; 逕行移除的其他事件處理常式`Global.asax`檔案。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-146">For this tutorial we only require an event handler for the `Error` event; feel free to remove the other event handlers from the `Global.asax` file.</span></span>

> [!NOTE]
> <span data-ttu-id="0e1b4-147">*HTTP 模組*提供另一種方式來定義事件處理常式`HttpApplication`事件。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-147">*HTTP Modules* offer another way to define event handlers for `HttpApplication` events.</span></span> <span data-ttu-id="0e1b4-148">HTTP 模組會建立成個別的類別程式庫可以直接在 web 應用程式專案內放置或來區隔的類別檔案。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-148">HTTP Modules are created as a class file that can be placed directly within the web application project or separated out into a separate class library.</span></span> <span data-ttu-id="0e1b4-149">它們可以分割成的類別庫，因為 HTTP 模組提供更為彈性和可重複使用模型來建立`HttpApplication`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-149">Because they can be separated out into a class library, HTTP Modules offer a more flexible and reusable model for creating `HttpApplication` event handlers.</span></span> <span data-ttu-id="0e1b4-150">而`Global.asax`檔案是特定 web 應用程式所在的位置，HTTP 模組可以編譯為組件，此時若要將 HTTP 模組加入至網站很簡單，卸除組件中`Bin`資料夾和登錄中的模組`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-150">Whereas the `Global.asax` file is specific to the web application where it resides, HTTP Modules can be compiled into assemblies, at which point adding the HTTP Module to a website is as simple as dropping the assembly in the `Bin` folder and registering the Module in `Web.config`.</span></span> <span data-ttu-id="0e1b4-151">本教學課程不查看建立和使用 HTTP 模組，但在下列兩個教學課程中使用的兩個錯誤記錄程式庫會實作為 HTTP 模組。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-151">This tutorial does not look at creating and using HTTP Modules, but the two error logging libraries used in the following two tutorials are implemented as HTTP Modules.</span></span> <span data-ttu-id="0e1b4-152">如需更多背景之優點的 HTTP 模組，請參閱[使用 HTTP 模組和處理常式，以建立隨插即用的 ASP.NET 元件](https://msdn.microsoft.com/library/aa479332.aspx)。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-152">For more background on the benefits of HTTP Modules refer to [Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components](https://msdn.microsoft.com/library/aa479332.aspx).</span></span>


## <a name="retrieving-information-about-the-unhandled-exception"></a><span data-ttu-id="0e1b4-153">擷取未處理的例外狀況的相關資訊</span><span class="sxs-lookup"><span data-stu-id="0e1b4-153">Retrieving Information About the Unhandled Exception</span></span>

<span data-ttu-id="0e1b4-154">現在我們有的 Global.asax 檔案`Application_Error`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-154">At this point we have a Global.asax file with an `Application_Error` event handler.</span></span> <span data-ttu-id="0e1b4-155">此事件處理常式都會執行我們需要通知錯誤的開發人員，並記錄其詳細資料。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-155">When this event handler executes we need to notify a developer of the error and log its details.</span></span> <span data-ttu-id="0e1b4-156">若要完成這些工作，我們必須先決定所引發的例外狀況的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-156">To accomplish these tasks we first need to determine the details of the exception that was raised.</span></span> <span data-ttu-id="0e1b4-157">使用伺服器物件[`GetLastError`方法](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx)擷取詳細資料的未處理的例外狀況造成`Error`引發事件。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-157">Use the Server object's [`GetLastError` method](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) to retrieve details of the unhandled exception that caused the `Error` event to fire.</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample2.vb)]

<span data-ttu-id="0e1b4-158">`GetLastError`方法會傳回型別的物件`Exception`，這是.NET Framework 中的所有例外狀況的基底類型。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-158">The `GetLastError` method returns an object of type `Exception`, which is the base type for all exceptions in the .NET Framework.</span></span> <span data-ttu-id="0e1b4-159">不過，上述程式碼我轉型所傳回的例外狀況物件`GetLastError`到`HttpException`物件。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-159">However, in the code above I am casting the Exception object returned by `GetLastError` into an `HttpException` object.</span></span> <span data-ttu-id="0e1b4-160">如果`Error`因為例外狀況擲回了 ASP.NET 資源的處理期間所擲回的例外狀況會包裝內則會引發事件`HttpException`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-160">If the `Error` event is being fired because an exception was thrown during the processing of an ASP.NET resource then the exception that was thrown is wrapped within an `HttpException`.</span></span> <span data-ttu-id="0e1b4-161">若要取得實際的例外狀況，導致錯誤事件使用`InnerException`屬性。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-161">To get the actual exception that precipitated the Error event use the `InnerException` property.</span></span> <span data-ttu-id="0e1b4-162">如果`Error`已引發事件，因為 HTTP 為基礎的例外狀況，例如不存在的網頁要求`HttpException`擲回，但它並沒有內部的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-162">If the `Error` event was raised because of an HTTP-based exception, such as a request for a non-existent page, an `HttpException` is thrown, but it does not have an inner exception.</span></span>

<span data-ttu-id="0e1b4-163">下列程式碼會使用`GetLastErrormessage`擷取觸發的例外狀況資訊`Error`事件，儲存`HttpException`在名為`lastErrorWrapper`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-163">The following code uses the `GetLastErrormessage` to retrieve information about the exception that triggered the `Error` event, storing the `HttpException` in a variable named `lastErrorWrapper`.</span></span> <span data-ttu-id="0e1b4-164">它接著會儲存類型、 訊息與原始的例外狀況堆疊追蹤中三個字串變數，檢查是否`lastErrorWrapper`的實際的例外狀況會觸發`Error`事件 （如果是以 HTTP 為基礎的例外狀況），或者它是只是處理要求時擲回的例外狀況的包裝函式。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-164">It then stores the type, message, and stack trace of the originating exception in three string variables, checking to see if the `lastErrorWrapper` is the actual exception that triggered the `Error` event (in the case of HTTP-based exceptions) or if it's merely a wrapper for an exception that was thrown while processing the request.</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample3.vb)]

<span data-ttu-id="0e1b4-165">此時，您會有您需要撰寫程式碼，將記錄到資料庫資料表中的例外狀況詳細資料的所有資訊。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-165">At this point you have all the information you need to write code that will log the exception's details to a database table.</span></span> <span data-ttu-id="0e1b4-166">您可以建立資料庫資料表與資料行，每個感興趣的類型、 訊息、 堆疊追蹤和等等的有用的其他資訊，例如要求網頁的 URL 和目前登入的使用者名稱及錯誤詳細資料。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-166">You could create a database table with columns for each of the error details of interest - the type, the message, the stack trace, and so on - along with other useful pieces of information, such as the URL of the requested page and the name of the currently logged on user.</span></span> <span data-ttu-id="0e1b4-167">在`Application_Error`事件處理常式接著連接到資料庫，並將記錄插入資料表。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-167">In the `Application_Error` event handler you would then connect to the database and insert a record into the table.</span></span> <span data-ttu-id="0e1b4-168">同樣地，您可以新增要警示的錯誤，透過電子郵件的開發人員的程式碼。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-168">Likewise, you could add code to alert a developer of the error via email.</span></span>

<span data-ttu-id="0e1b4-169">下面兩個教學課程中檢查錯誤記錄程式庫會提供根據預設，這類功能，因此不需要建置此錯誤記錄和通知自己。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-169">The error logging libraries examined in the next two tutorials provide such functionality out of the box, so there's no need to build this error logging and notification yourself.</span></span> <span data-ttu-id="0e1b4-170">不過，為了說明，`Error`就會引發事件，`Application_Error`事件處理常式可以用來記錄錯誤詳細資料和通知開發人員，讓我們加入程式碼發生錯誤時通知開發人員。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-170">However, to illustrate that the `Error` event is being raised and that the `Application_Error` event handler can be used to log error details and notify a developer, let's add code that notifies a developer when an error occurs.</span></span>

## <a name="notifying-a-developer-when-an-unhandled-exception-occurs"></a><span data-ttu-id="0e1b4-171">發生未處理的例外狀況時通知開發人員</span><span class="sxs-lookup"><span data-stu-id="0e1b4-171">Notifying a Developer When an Unhandled Exception Occurs</span></span>

<span data-ttu-id="0e1b4-172">在生產環境中發生未處理的例外狀況時務必提醒開發小組，讓它們可以評估錯誤，並判斷必須採取的動作。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-172">When an unhandled exception occurs in the production environment it is important to alert the development team so that they can assess the error and determine what actions need to be taken.</span></span> <span data-ttu-id="0e1b4-173">比方說，如果沒有中連接到資料庫，則您必須為 double 的錯誤檢查您的連接字串，而且可能是，使用虛擬主機公司提出支援票證。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-173">For example, if there is an error in connecting to the database then you'll need to double check your connection string and, perhaps, open a support ticket with your web hosting company.</span></span> <span data-ttu-id="0e1b4-174">如果例外狀況發生的程式設計錯誤，可能需要額外的程式碼或驗證邏輯加入至預防這類錯誤的。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-174">If the exception occurred because of a programming error, additional code or validation logic may need to be added to prevent such errors in the future.</span></span>

<span data-ttu-id="0e1b4-175">.NET Framework 中的類別[`System.Net.Mail`命名空間](https://msdn.microsoft.com/library/system.net.mail.aspx)輕鬆傳送電子郵件。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-175">The .NET Framework classes in the [`System.Net.Mail` namespace](https://msdn.microsoft.com/library/system.net.mail.aspx) make it easy to send an email.</span></span> <span data-ttu-id="0e1b4-176">[ `MailMessage`類別](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx)代表電子郵件訊息，並具有屬性，例如`To`， `From`， `Subject`， `Body`，和`Attachments`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-176">The [`MailMessage` class](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) represents an email message and has properties like `To`, `From`, `Subject`, `Body`, and `Attachments`.</span></span> <span data-ttu-id="0e1b4-177">`SmtpClass`用來傳送`MailMessage`物件使用指定的 SMTP 伺服器，則可以透過程式設計方式或以宣告方式在指定的 SMTP 伺服器設定[`<system.net>`元素](https://msdn.microsoft.com/library/6484zdc1.aspx)中`Web.config file`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-177">The `SmtpClass` is used to send a `MailMessage` object using a specified SMTP server; the SMTP server settings can be specified programmatically or declaratively in the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx) in the `Web.config file`.</span></span> <span data-ttu-id="0e1b4-178">如需有關傳送電子郵件中的 ASP.NET 應用程式的訊息簽出我的文件： [ASP.NET 中的 傳送電子郵件](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)，而[System.Net.Mail 常見問題集](http://systemnetmail.com/)。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-178">For more information on sending email messages in an ASP.NET application check out my article, [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx), and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>

> [!NOTE]
> <span data-ttu-id="0e1b4-179">`<system.net>`元素包含所使用的 SMTP 伺服器設定`SmtpClient`類別時傳送電子郵件。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-179">The `<system.net>` element contains the SMTP server settings used by the `SmtpClient` class when sending an email.</span></span> <span data-ttu-id="0e1b4-180">虛擬主機公司可能會有您可以使用從您的應用程式傳送電子郵件的 SMTP 伺服器。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-180">Your web hosting company likely has an SMTP server that you can use to send email from your application.</span></span> <span data-ttu-id="0e1b4-181">您應該使用 web 應用程式中的 SMTP 伺服器設定的詳細資訊，請參閱 web 主機的支援 > 一節。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-181">Consult your web host's support section for information on the SMTP server settings you should use in your web application.</span></span>


<span data-ttu-id="0e1b4-182">將下列程式碼加入`Application_Error`傳送開發人員的電子郵件，發生錯誤時的事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="0e1b4-182">Add the following code to the `Application_Error` event handler to send a developer an email when an error occurs:</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample4.vb)]

<span data-ttu-id="0e1b4-183">相當冗長，上述程式碼時，大量建立顯示的 HTML 傳送給開發人員的電子郵件中。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-183">While the above code is quite lengthy, the bulk of it creates the HTML that appears in the email sent to the developer.</span></span> <span data-ttu-id="0e1b4-184">程式碼參考開始`HttpException`傳回`GetLastError`方法 (`lastErrorWrapper`)。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-184">The code starts by referencing the `HttpException` returned by the `GetLastError` method (`lastErrorWrapper`).</span></span> <span data-ttu-id="0e1b4-185">實際要求所引發的例外狀況透過擷取`lastErrorWrapper.InnerException`和指派給變數`lastError`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-185">The actual exception that was raised by the request is retrieved via `lastErrorWrapper.InnerException` and is assigned to the variable `lastError`.</span></span> <span data-ttu-id="0e1b4-186">類型、 訊息和堆疊追蹤資訊會從`lastError`並儲存在三個字串變數。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-186">The type, message, and stack trace information is retrieved from `lastError` and stored in three string variables.</span></span>

<span data-ttu-id="0e1b4-187">下一步`MailMessage`名為物件`mm`建立。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-187">Next, a `MailMessage` object named `mm` is created.</span></span> <span data-ttu-id="0e1b4-188">電子郵件內文是 HTML 格式，並顯示要求網頁的 URL，目前登入的使用者，以及例外狀況 （類型、 訊息和堆疊追蹤） 的相關資訊的名稱。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-188">The email body is HTML formatted and displays the URL of the requested page, the name of the currently logged on user, and information about the exception (the type, message, and stack trace).</span></span> <span data-ttu-id="0e1b4-189">其中一個最有趣的事情有關`HttpException`類別是您可以產生用來建立例外狀況詳細資料黃色螢幕的死亡 (YSOD) 藉由呼叫的 HTML [GetHtmlErrorMessage 方法](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx)。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-189">One of the cool things about the `HttpException` class is that you can generate the HTML used to create the Exception Details Yellow Screen of Death (YSOD) by calling the [GetHtmlErrorMessage method](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span></span> <span data-ttu-id="0e1b4-190">這個方法是此處用來擷取例外狀況詳細資料 YSOD 標記，並將它加入做為附件的電子郵件。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-190">This method is used here to retrieve the Exception Details YSOD markup and add it to the email as an attachment.</span></span> <span data-ttu-id="0e1b4-191">一個單字，需要注意的事項： 如果例外狀況，觸發`Error`事件未以 HTTP 為基礎的例外狀況 （例如不存在的網頁要求） 則`GetHtmlErrorMessage`方法會傳回`null`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-191">One word of caution: if the exception that triggered the `Error` event was an HTTP-based exception (such as a request for a non-existent page) then the `GetHtmlErrorMessage` method will return `null`.</span></span>

<span data-ttu-id="0e1b4-192">最後一個步驟是傳送`MailMessage`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-192">The final step is to send the `MailMessage`.</span></span> <span data-ttu-id="0e1b4-193">這樣做，建立新`SmtpClient`方法，並呼叫其`Send`方法。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-193">This is done by creating a new `SmtpClient` method and calling its `Send` method.</span></span>

> [!NOTE]
> <span data-ttu-id="0e1b4-194">在 web 應用程式中使用此程式碼之前您要變更中的值`ToAddress`和`FromAddress`常數support@example.com錯誤通知電子郵件地址應傳送至和來自任何電子郵件。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-194">Before using this code in your web application you'll want to change the values in the `ToAddress` and `FromAddress` constants from support@example.com to whatever email address the error notification email should be sent to and originate from.</span></span> <span data-ttu-id="0e1b4-195">您還需要指定 SMTP 伺服器設定中的`<system.net>`一節中`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-195">You'll also need to specify SMTP server settings in the `<system.net>` section in `Web.config`.</span></span> <span data-ttu-id="0e1b4-196">請參閱您的 web 主機提供者，來判斷要使用的 SMTP 伺服器設定。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-196">Consult your web host provider to determine the SMTP server settings to use.</span></span>


<span data-ttu-id="0e1b4-197">這個程式碼的地方每當錯誤開發人員會傳送電子郵件訊息，摘要說明此錯誤，並包含 YSOD。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-197">With this code in place anytime there's an error the developer is sent an email message that summarizes the error and includes the YSOD.</span></span> <span data-ttu-id="0e1b4-198">在先前的教學課程示範的執行階段錯誤是前往 Genre.aspx，傳入無效的`ID`值透過查詢字串，例如`Genre.aspx?ID=foo`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-198">In the preceding tutorial we demonstrated a runtime error by visiting Genre.aspx and passing in an invalid `ID` value through the querystring, like `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="0e1b4-199">瀏覽的頁面`Global.asax`就地檔案會產生相同的使用者經驗，如在先前的教學課程-在開發環境中您必須繼續時，您就可在生產環境，請參閱例外狀況詳細資料黃色螢幕的死，請參閱自訂錯誤網頁。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-199">Visiting the page with the `Global.asax` file in place produces the same user experience as in the preceding tutorial - in the development environment you'll continue to see the Exception Details Yellow Screen of Death, while in the production environment you'll see the custom error page.</span></span> <span data-ttu-id="0e1b4-200">除了這個現有的行為，開發人員會傳送一封電子郵件。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-200">In addition to this existing behavior, the developer is sent an email.</span></span>

<span data-ttu-id="0e1b4-201">**圖 2**顯示造訪時收到的電子郵件`Genre.aspx?ID=foo`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-201">**Figure 2** shows the email received when visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="0e1b4-202">電子郵件本文摘要說明例外狀況資訊，而`YSOD.htm`附件會顯示例外狀況詳細資料 YSOD 中所顯示的內容 (請參閱**圖 3**)。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-202">The email body summarizes the exception information, while the `YSOD.htm` attachment displays the content that is shown in the Exception Details YSOD (see **Figure 3**).</span></span>

[![](processing-unhandled-exceptions-vb/_static/image5.png)](processing-unhandled-exceptions-vb/_static/image4.png)

<span data-ttu-id="0e1b4-203">**圖 2**： 開發人員處理的例外狀況時傳送電子郵件通知</span><span class="sxs-lookup"><span data-stu-id="0e1b4-203">**Figure 2**: The Developer Is Sent An Email Notification Whenever There's An Unhandled Exception</span></span>  
 <span data-ttu-id="0e1b4-204">([按一下以檢視完整大小的影像](processing-unhandled-exceptions-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="0e1b4-204">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image6.png))</span></span>

[![](processing-unhandled-exceptions-vb/_static/image8.png)](processing-unhandled-exceptions-vb/_static/image7.png)

<span data-ttu-id="0e1b4-205">**圖 3**： 電子郵件通知中包含例外狀況詳細資料做為附件 YSOD</span><span class="sxs-lookup"><span data-stu-id="0e1b4-205">**Figure 3**: The Email Notification Includes the Exception Details YSOD As An Attachment</span></span>  
 <span data-ttu-id="0e1b4-206">([按一下以檢視完整大小的影像](processing-unhandled-exceptions-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="0e1b4-206">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image9.png))</span></span>

## <a name="what-about-using-the-custom-error-page"></a><span data-ttu-id="0e1b4-207">如何使用自訂錯誤網頁嗎？</span><span class="sxs-lookup"><span data-stu-id="0e1b4-207">What About Using the Custom Error Page?</span></span>

<span data-ttu-id="0e1b4-208">本教學課程示範了如何使用`Global.asax`和`Application_Error`事件處理常式來處理的例外狀況發生時執行程式碼。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-208">This tutorial showed how to use `Global.asax` and the `Application_Error` event handler to execute code when an unhandled exception occurs.</span></span> <span data-ttu-id="0e1b4-209">具體來說，我們要通知的錯誤，開發人員使用此事件處理常式我們可以擴充它也在資料庫中記錄錯誤的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-209">Specifically, we used this event handler to notify a developer of an error; we could extend it to also log the error details in a database.</span></span> <span data-ttu-id="0e1b4-210">與否`Application_Error`事件處理常式不會影響使用者的體驗。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-210">The presence of the `Application_Error` event handler does not affect the end user's experience.</span></span> <span data-ttu-id="0e1b4-211">他們仍然看到設定的錯誤頁面上，錯誤詳細資料 YSOD、 執行階段錯誤 YSOD 中，或自訂錯誤網頁。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-211">They still see the configured error page, be it the Error Details YSOD, the Runtime Error YSOD, or the custom error page.</span></span>

<span data-ttu-id="0e1b4-212">很自然想知道是否`Global.asax`檔案和`Application_Error`事件時，需要使用自訂錯誤網頁。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-212">It's natural to wonder whether the `Global.asax` file and `Application_Error` event is necessary when using a custom error page.</span></span> <span data-ttu-id="0e1b4-213">發生錯誤時顯示自訂錯誤網頁的使用者因此為什麼無法我們放通知開發人員和錯誤詳細資料記錄到自訂錯誤網頁的程式碼後置類別的程式碼？</span><span class="sxs-lookup"><span data-stu-id="0e1b4-213">When an error occurs the user is shown the custom error page so why can't we put the code to notify the developer and log the error details into the code-behind class of the custom error page?</span></span> <span data-ttu-id="0e1b4-214">您當然可以自訂錯誤網頁的程式碼後置類別加入程式碼時您沒有存取權所觸發的例外狀況的詳細資料`Error`事件時使用先前的教學課程中我們已探索的技巧。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-214">While you can certainly add code to the custom error page's code-behind class you do not have access to the details of the exception that triggered the `Error` event when using the technique we explored in the preceding tutorial.</span></span> <span data-ttu-id="0e1b4-215">呼叫`GetLastError`從自訂錯誤頁面的方法會傳回`Nothing`。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-215">Calling the `GetLastError` method from the custom error page returns `Nothing`.</span></span>

<span data-ttu-id="0e1b4-216">此行為的原因是因為自訂錯誤網頁達到透過重新導向。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-216">The reason for this behavior is because the custom error page is reached via a redirect.</span></span> <span data-ttu-id="0e1b4-217">當未處理的例外狀況會到達 ASP.NET 執行階段 ASP.NET 引擎引發其`Error`事件 (其中執行`Application_Error`事件處理常式)，然後*重新導向*使用者自訂錯誤頁面，藉由發出`Response.Redirect(customErrorPageUrl)`.</span><span class="sxs-lookup"><span data-stu-id="0e1b4-217">When an unhandled exception reaches the ASP.NET runtime the ASP.NET engine raises its `Error` event (which executes the `Application_Error` event handler) and then *redirects* the user to the custom error page by issuing a `Response.Redirect(customErrorPageUrl)`.</span></span> <span data-ttu-id="0e1b4-218">`Response.Redirect`方法將回應傳送到用戶端使用 HTTP 302 狀態程式碼中，指示來要求新的 URL，也就是自訂錯誤網頁瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-218">The `Response.Redirect` method sends a response to the client with an HTTP 302 status code, instructing the browser to request a new URL, namely the custom error page.</span></span> <span data-ttu-id="0e1b4-219">然後用瀏覽器自動要求新的頁面。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-219">The browser then automatically requests this new page.</span></span> <span data-ttu-id="0e1b4-220">您所見，從頁面個別要求的自訂錯誤網頁，因為瀏覽器的網址列變更為自訂錯誤頁面 URL 而產生錯誤 (請參閱**圖 4**)。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-220">You can tell that the custom error page was requested separately from the page where the error originated because the browser's Address bar changes to the custom error page URL (see **Figure 4**).</span></span>

[![](processing-unhandled-exceptions-vb/_static/image11.png)](processing-unhandled-exceptions-vb/_static/image10.png)

<span data-ttu-id="0e1b4-221">**圖 4**： 發生錯誤時瀏覽器重新導向至自訂錯誤頁面 URL</span><span class="sxs-lookup"><span data-stu-id="0e1b4-221">**Figure 4**: When an Error Occurs the Browser Gets Redirected to the Custom Error Page URL</span></span>  
 <span data-ttu-id="0e1b4-222">([按一下以檢視完整大小的影像](processing-unhandled-exceptions-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="0e1b4-222">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image12.png))</span></span>

<span data-ttu-id="0e1b4-223">結果是未處理的例外狀況的發生位置要求結束時，伺服器會回應 HTTP 302 重新導向。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-223">The net effect is that the request where the unhandled exception occurred ends when the server responds with the HTTP 302 redirect.</span></span> <span data-ttu-id="0e1b4-224">自訂錯誤網頁的後續要求是全新的要求。此時 ASP.NET 引擎會已捨棄錯誤訊息和此外，並沒有上一個要求中未處理的例外狀況關聯的自訂錯誤網頁的新要求的方式。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-224">The subsequent request to the custom error page is a brand new request; by this point the ASP.NET engine has discarded the error information and, moreover, has no way to associate the unhandled exception in the previous request with the new request for the custom error page.</span></span> <span data-ttu-id="0e1b4-225">這就是為什麼`GetLastError`傳回`null`從自訂錯誤網頁呼叫時。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-225">This is why `GetLastError` returns `null` when called from the custom error page.</span></span>

<span data-ttu-id="0e1b4-226">不過，很可能有相同造成錯誤的要求時執行的自訂錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-226">However, it is possible to have the custom error page executed during the same request that caused the error.</span></span> <span data-ttu-id="0e1b4-227">[ `Server.Transfer(url)` ](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx)方法將執行轉移至指定的 URL，而且會處理相同要求中。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-227">The [`Server.Transfer(url)`](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) method transfers execution to the specified URL and processes it within the same request.</span></span> <span data-ttu-id="0e1b4-228">您無法移動程式碼中`Application_Error`事件處理常式，加入自訂錯誤網頁的程式碼後置類別，並取代在`Global.asax`為下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="0e1b4-228">You could move the code in the `Application_Error` event handler to the custom error page's code-behind class, replacing it in `Global.asax` with the following code:</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample5.vb)]

<span data-ttu-id="0e1b4-229">現在當未處理的例外狀況，就會發生`Application_Error`事件處理常式會將控制權傳輸至適當的自訂錯誤網頁的 HTTP 狀態碼為基礎。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-229">Now when an unhandled exception occurs the `Application_Error` event handler transfers control to the appropriate custom error page based on the HTTP status code.</span></span> <span data-ttu-id="0e1b4-230">自訂錯誤頁面已傳輸控制項，因為已透過未處理例外狀況資訊的存取權`Server.GetLastError`及可通知開發人員的錯誤和記錄其詳細資料。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-230">Because control was transferred, the custom error page has access to the unhandled exception information via `Server.GetLastError` and can notify a developer of the error and log its details.</span></span> <span data-ttu-id="0e1b4-231">`Server.Transfer`呼叫停止中將使用者重新導向至自訂錯誤網頁的 ASP.NET 引擎。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-231">The `Server.Transfer` call stops the ASP.NET engine from redirecting the user to the custom error page.</span></span> <span data-ttu-id="0e1b4-232">相反地，就會傳回自訂錯誤網頁的內容，做為頁面產生錯誤的回應。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-232">Instead, the custom error page's content is returned as the response to the page that generated the error.</span></span>

## <a name="summary"></a><span data-ttu-id="0e1b4-233">總結</span><span class="sxs-lookup"><span data-stu-id="0e1b4-233">Summary</span></span>

<span data-ttu-id="0e1b4-234">ASP.NET 執行階段中的 ASP.NET web 應用程式發生未處理的例外狀況時引發`Error`事件會顯示設定的錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-234">When an unhandled exception occurs in an ASP.NET web application the ASP.NET runtime raises the `Error` event and displays the configured error page.</span></span> <span data-ttu-id="0e1b4-235">我們會通知開發人員的錯誤，記錄其詳細資料，或以其他方式，藉由建立錯誤事件的事件處理常式處理它。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-235">We can notify the developer of the error, log its details, or process it in some other fashion, by creating an event handler for the Error event.</span></span> <span data-ttu-id="0e1b4-236">有兩種方式來建立事件處理常式`HttpApplication`事件喜歡`Error`： 在`Global.asax`檔案或 HTTP 模組。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-236">There are two ways to create an event handler for `HttpApplication` events like `Error`: in the `Global.asax` file or from an HTTP Module.</span></span> <span data-ttu-id="0e1b4-237">本教學課程示範了如何建立`Error`中的事件處理常式`Global.asax`通知錯誤的開發人員透過電子郵件訊息的檔案。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-237">This tutorial showed how to create an `Error` event handler in the `Global.asax` file that notifies developers of an error by means of an email message.</span></span>

<span data-ttu-id="0e1b4-238">建立`Error`事件處理常式是您需要唯一或自訂的方式處理未處理例外狀況時相當實用。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-238">Creating an `Error` event handler is useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="0e1b4-239">不過，建立您自己的`Error`事件處理常式記錄的例外狀況，或通知開發人員不是最有效率的使用中的時間因為已經有免費且使用簡單的錯誤記錄程式庫可能是安裝程式會在幾分鐘的時間。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-239">However, creating your own `Error` event handler to log the exception or to notify a developer is not the most efficient use of your time as there already exist free and easy to use error logging libraries that can be setup in a matter of minutes.</span></span> <span data-ttu-id="0e1b4-240">下面兩個教學課程會檢查兩個這類程式庫。</span><span class="sxs-lookup"><span data-stu-id="0e1b4-240">The next two tutorials examine two such libraries.</span></span>

<span data-ttu-id="0e1b4-241">祝您程式設計 ！</span><span class="sxs-lookup"><span data-stu-id="0e1b4-241">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="0e1b4-242">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="0e1b4-242">Further Reading</span></span>

<span data-ttu-id="0e1b4-243">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="0e1b4-243">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="0e1b4-244">ASP.NET HTTP 模組和 HTTP 處理常式概觀</span><span class="sxs-lookup"><span data-stu-id="0e1b4-244">ASP.NET HTTP Modules and HTTP Handlers Overview</span></span>](https://support.microsoft.com/kb/307985)
- [<span data-ttu-id="0e1b4-245">依正常程序回應未處理的例外狀況-處理未處理例外狀況</span><span class="sxs-lookup"><span data-stu-id="0e1b4-245">Gracefully Responding to Unhandled Exceptions - Processing Unhandled Exceptions</span></span>](http://aspnet.4guysfromrolla.com/articles/091306-1.aspx)
- [<span data-ttu-id="0e1b4-246">`HttpApplication` 類別與 ASP.NET 應用程式物件</span><span class="sxs-lookup"><span data-stu-id="0e1b4-246">`HttpApplication` Class and the ASP.NET Application Object</span></span>](http://www.eggheadcafe.com/articles/20030211.asp)
- [<span data-ttu-id="0e1b4-247">HTTP 處理常式和 ASP.NET 中的 HTTP 模組</span><span class="sxs-lookup"><span data-stu-id="0e1b4-247">HTTP Handlers and HTTP Modules in ASP.NET</span></span>](http://www.15seconds.com/Issue/020417.htm)
- [<span data-ttu-id="0e1b4-248">在 ASP.NET 中傳送電子郵件</span><span class="sxs-lookup"><span data-stu-id="0e1b4-248">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="0e1b4-249">了解`Global.asax`檔案</span><span class="sxs-lookup"><span data-stu-id="0e1b4-249">Understanding the `Global.asax` File</span></span>](http://aspalliance.com/1114_Understanding_the_Globalasax_file.all)
- [<span data-ttu-id="0e1b4-250">使用 HTTP 模組和處理常式來建立隨插即用的 ASP.NET 元件</span><span class="sxs-lookup"><span data-stu-id="0e1b4-250">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="0e1b4-251">使用 ASP.NET`Global.asax`檔案</span><span class="sxs-lookup"><span data-stu-id="0e1b4-251">Working with the ASP.NET `Global.asax` File</span></span>](http://articles.techrepublic.com.com/5100-10878_11-5771721.html)
- [<span data-ttu-id="0e1b4-252">使用`HttpApplication`執行個體</span><span class="sxs-lookup"><span data-stu-id="0e1b4-252">Working with `HttpApplication` Instances</span></span>](https://msdn.microsoft.com/library/a0xez8f2.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="0e1b4-253">[上一頁](displaying-a-custom-error-page-vb.md)
> [下一頁](logging-error-details-with-asp-net-health-monitoring-vb.md)</span><span class="sxs-lookup"><span data-stu-id="0e1b4-253">[Previous](displaying-a-custom-error-page-vb.md)
[Next](logging-error-details-with-asp-net-health-monitoring-vb.md)</span></span>
