---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-cs
title: 設定網站使用應用程式服務 (C#) |Microsoft 文件
author: rick-anderson
description: ASP.NET 2.0 版導入了一系列的應用程式服務，而這是.NET Framework 的一部分，並做為建置組塊套件服務 yo...
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/23/2009
ms.topic: article
ms.assetid: 1e33d1c6-3f9f-4c26-81e2-2a8f8907bb05
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-cs
msc.type: authoredcontent
ms.openlocfilehash: da4ef328e3461e96fbb0cdca156ce1b9a076748f
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/06/2018
ms.locfileid: "30890651"
---
<a name="configuring-a-website-that-uses-application-services-c"></a><span data-ttu-id="847f4-103">設定網站使用應用程式服務 (C#)</span><span class="sxs-lookup"><span data-stu-id="847f4-103">Configuring a Website that Uses Application Services (C#)</span></span>
====================
<span data-ttu-id="847f4-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="847f4-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="847f4-105">[下載程式碼](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_CS.zip)或[下載 PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="847f4-105">[Download Code](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_CS.zip) or [Download PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_cs.pdf)</span></span>

> <span data-ttu-id="847f4-106">ASP.NET 2.0 版導入了一系列的應用程式服務，而這是.NET Framework 的一部分而且做為建置組塊服務可讓您將豐富的功能加入至 web 應用程式套件。</span><span class="sxs-lookup"><span data-stu-id="847f4-106">ASP.NET version 2.0 introduced a series of application services, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="847f4-107">本教學課程會探討如何使用應用程式服務在生產環境中設定網站，以及位址管理使用者帳戶和角色在實際執行環境的一般問題。</span><span class="sxs-lookup"><span data-stu-id="847f4-107">This tutorial explores how to configure a website in the production environment to use application services and addresses common issues with managing user accounts and roles on the production environment.</span></span>


## <a name="introduction"></a><span data-ttu-id="847f4-108">簡介</span><span class="sxs-lookup"><span data-stu-id="847f4-108">Introduction</span></span>

<span data-ttu-id="847f4-109">ASP.NET 2.0 版導入了一系列的*應用程式服務*，.NET Framework 的一部分，而且僅做為建置組塊的一組服務，您可以使用將豐富的功能加入至 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="847f4-109">ASP.NET version 2.0 introduced a series of *application services*, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="847f4-110">應用程式服務包括：</span><span class="sxs-lookup"><span data-stu-id="847f4-110">The application services include:</span></span>

- <span data-ttu-id="847f4-111">**成員資格**-的 API，用於建立及管理使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="847f4-111">**Membership** - an API for creating and managing user accounts.</span></span>
- <span data-ttu-id="847f4-112">**角色**-的 API，用於使用者分類成群組。</span><span class="sxs-lookup"><span data-stu-id="847f4-112">**Roles** - an API for categorizing users into groups.</span></span>
- <span data-ttu-id="847f4-113">**設定檔**-的應用程式開發介面來儲存自訂的使用者特定的內容。</span><span class="sxs-lookup"><span data-stu-id="847f4-113">**Profile** - an API for storing custom, user-specific content.</span></span>
- <span data-ttu-id="847f4-114">**站台對應**-的 API，用於定義階層，然後透過導覽控制項，例如功能表和階層連結列會顯示表單中的站台 s 邏輯結構。</span><span class="sxs-lookup"><span data-stu-id="847f4-114">**Site Map** - an API for defining a site s logical structure in the form of a hierarchy, which can then be displayed via navigation controls, such as menus and breadcrumbs.</span></span>
- <span data-ttu-id="847f4-115">**個人化**-的 API，用於維護自訂喜好設定，最常搭配[ *WebParts*](https://msdn.microsoft.com/library/e0s9t4ck.aspx)。</span><span class="sxs-lookup"><span data-stu-id="847f4-115">**Personalization** - an API for maintaining customization preferences, most often used with [*WebParts*](https://msdn.microsoft.com/library/e0s9t4ck.aspx).</span></span>
- <span data-ttu-id="847f4-116">**健全狀況監視**-的 API，用於監視效能、 安全性、 錯誤和執行 web 應用程式的其他系統健康情況計量。</span><span class="sxs-lookup"><span data-stu-id="847f4-116">**Health Monitoring** - an API for monitoring performance, security, errors, and other system health metrics for a running web application.</span></span>
  

<span data-ttu-id="847f4-117">應用程式服務 Api 並不限於特定的實作。</span><span class="sxs-lookup"><span data-stu-id="847f4-117">The application services APIs are not tied to a specific implementation.</span></span> <span data-ttu-id="847f4-118">相反地，您可以指示需要使用特定的應用程式服務*提供者*，和該提供者會實作使用特定技術的服務。</span><span class="sxs-lookup"><span data-stu-id="847f4-118">Instead, you instruct the application services to use a particular *provider*, and that provider implements the service using a particular technology.</span></span> <span data-ttu-id="847f4-119">最常使用的提供者，針對以網際網路為基礎的 web 應用程式裝載在虛擬主機公司是使用 SQL Server 資料庫實作這些提供者。</span><span class="sxs-lookup"><span data-stu-id="847f4-119">The most commonly used providers for Internet-based web applications hosted at a web hosting company are those providers that use a SQL Server database implementation.</span></span> <span data-ttu-id="847f4-120">例如，`SqlMembershipProvider`是將使用者帳戶資訊儲存在 Microsoft SQL Server 資料庫中的成員資格 api 提供者。</span><span class="sxs-lookup"><span data-stu-id="847f4-120">For example, the `SqlMembershipProvider` is a provider for the Membership API that stores user account information in a Microsoft SQL Server database.</span></span>

<span data-ttu-id="847f4-121">部署應用程式時使用的應用程式服務和 SQL Server 提供者新增的一些挑戰。</span><span class="sxs-lookup"><span data-stu-id="847f4-121">Using the application services and SQL Server providers adds some challenges when deploying the application.</span></span> <span data-ttu-id="847f4-122">首先，應用程式服務的資料庫物件必須在開發和生產資料庫上正確建立，並適當地初始化。</span><span class="sxs-lookup"><span data-stu-id="847f4-122">For starters, the application services database objects must be properly created on both the development and production databases and appropriately initialized.</span></span> <span data-ttu-id="847f4-123">另外還有必須做的重大組態設定。</span><span class="sxs-lookup"><span data-stu-id="847f4-123">There are also important configuration settings that need to be made.</span></span>

> [!NOTE]
> <span data-ttu-id="847f4-124">應用程式服務 Api 所設計使用[*提供者模型*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)，允許 API 的實作細節，以在執行階段提供的設計模式。</span><span class="sxs-lookup"><span data-stu-id="847f4-124">The application services APIs were designed using the [*provider model*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), a design pattern that allows for an API s implementation details to be provided at runtime.</span></span> <span data-ttu-id="847f4-125">.NET Framework 隨附許多應用程式服務提供者可用，例如`SqlMembershipProvider`和`SqlRoleProvider`、 哪些是提供者的成員資格和角色 Api 使用 SQL Server 資料庫實作。</span><span class="sxs-lookup"><span data-stu-id="847f4-125">The .NET Framework ships with a number of application service providers that can be used, such as the `SqlMembershipProvider` and `SqlRoleProvider`, which are providers for the Membership and Roles APIs that use a SQL Server database implementation.</span></span> <span data-ttu-id="847f4-126">您也可以建立和外掛程式的自訂提供者。</span><span class="sxs-lookup"><span data-stu-id="847f4-126">You can also create and plug-in a custom provider.</span></span> <span data-ttu-id="847f4-127">事實上，活頁簿檢閱 web 應用程式已經包含站台對應應用程式開發介面的自訂提供者 (`ReviewSiteMapProvider`)，這會建構中的資料從網站地圖`Genres`和`Books`資料庫中的資料表。</span><span class="sxs-lookup"><span data-stu-id="847f4-127">In fact, the Book Reviews web application already contains a custom provider for the Site Map API (`ReviewSiteMapProvider`), which constructs the site map from the data in the `Genres` and `Books` tables in the database.</span></span>


<span data-ttu-id="847f4-128">本教學課程開頭看我擴充書籍檢閱 web 應用程式使用的成員資格和角色應用程式開發介面的方式。</span><span class="sxs-lookup"><span data-stu-id="847f4-128">This tutorial starts with a look at how I extended the Book Reviews web application to use the Membership and Roles APIs.</span></span> <span data-ttu-id="847f4-129">它接著會逐步部署應用程式服務會使用 SQL Server 資料庫實作和結束時，會定址管理使用者帳戶和角色在實際執行環境的一般問題的 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="847f4-129">It then walks through deploying a web application that uses application services with a SQL Server database implementation, and concludes by addressing common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="updates-to-the-book-reviews-application"></a><span data-ttu-id="847f4-130">活頁簿檢閱應用程式的更新</span><span class="sxs-lookup"><span data-stu-id="847f4-130">Updates to the Book Reviews Application</span></span>

<span data-ttu-id="847f4-131">在過去幾書籍檢閱 web 應用程式已更新從靜態網站動態的資料驅動的 web 應用程式的教學課程會使用一組管理頁面來管理內容類型和評論完成。</span><span class="sxs-lookup"><span data-stu-id="847f4-131">Over the past couple tutorials the Book Reviews web application was updated from a static website to a dynamic, data-driven web application complete with a set of administration pages for managing genres and reviews.</span></span> <span data-ttu-id="847f4-132">不過，此系統管理 」 區段目前未受保護-任何使用者都知道 （或猜測） 的管理頁面的 URL 可以 waltz 中和建立、 編輯或刪除在網站上的檢閱。</span><span class="sxs-lookup"><span data-stu-id="847f4-132">However, this administration section is currently not protected - any user who knows (or guesses) the administration page URL can waltz in and create, edit, or delete reviews on our site.</span></span> <span data-ttu-id="847f4-133">保護網站的某些部分的常見方式是實作使用者帳戶，然後使用 URL 授權規則限制存取特定使用者或角色。</span><span class="sxs-lookup"><span data-stu-id="847f4-133">A common way to protect certain portions of a website is to implement user accounts and then use URL authorization rules to restrict access to certain users or roles.</span></span> <span data-ttu-id="847f4-134">活頁簿檢閱 web 應用程式可供下載與本教學課程中支援使用者帳戶和角色。</span><span class="sxs-lookup"><span data-stu-id="847f4-134">The Book Reviews web application available for download with this tutorial supports user accounts and roles.</span></span> <span data-ttu-id="847f4-135">它具有單一角色定義名為系統管理員和只有此角色中的使用者可以存取 [管理] 頁面。</span><span class="sxs-lookup"><span data-stu-id="847f4-135">It has a single role defined named Admin and only users in this role can access the administration pages.</span></span>

> [!NOTE]
> <span data-ttu-id="847f4-136">我 ve 書籍檢閱 web 應用程式中建立三個使用者帳戶： Scott、 Jisun 和 Alice。</span><span class="sxs-lookup"><span data-stu-id="847f4-136">I ve created three user accounts in the Book Reviews web application: Scott, Jisun, and Alice.</span></span> <span data-ttu-id="847f4-137">所有的三個使用者擁有相同的密碼：**密碼 ！**</span><span class="sxs-lookup"><span data-stu-id="847f4-137">All three users have the same password: **password!**</span></span> <span data-ttu-id="847f4-138">Scott 和 Jisun 是系統管理員角色中，Alice 無法。</span><span class="sxs-lookup"><span data-stu-id="847f4-138">Scott and Jisun are in the Admin role, Alice is not.</span></span> <span data-ttu-id="847f4-139">站台 s 非系統管理頁面就仍然可以存取匿名使用者。</span><span class="sxs-lookup"><span data-stu-id="847f4-139">The site s non-administration pages are still accessible to anonymous users.</span></span> <span data-ttu-id="847f4-140">也就是說，您不需要登入網站，除非您想要管理，在此情況下您必須登入系統管理員角色中的使用者身分。</span><span class="sxs-lookup"><span data-stu-id="847f4-140">That is, you do not need to sign in to visit the site, unless you want to administer it, in which case you must sign in as a user in the Admin role.</span></span>


<span data-ttu-id="847f4-141">活頁簿檢閱應用程式 s 主版頁面已更新為包含不同的使用者介面，用於驗證和匿名使用者。</span><span class="sxs-lookup"><span data-stu-id="847f4-141">The Book Reviews application s master page has been updated to include a different user interface for authenticated and anonymous users.</span></span> <span data-ttu-id="847f4-142">如果匿名使用者造訪她看到右上角的登入連結的站台。</span><span class="sxs-lookup"><span data-stu-id="847f4-142">If an anonymous user visits the site she sees a Login link in the upper right corner.</span></span> <span data-ttu-id="847f4-143">已驗證的使用者會看到此訊息中，「 歡迎回來， *username*！ 」</span><span class="sxs-lookup"><span data-stu-id="847f4-143">An authenticated user sees the message, "Welcome back, *username*!"</span></span> <span data-ttu-id="847f4-144">和登出的連結。該處 s 也登入頁面 (`~/Login.aspx`)，其中包含提供使用者介面與邏輯來驗證訪客的登入 Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="847f4-144">and a link to log out. There s also a login page (`~/Login.aspx`), which contains a Login Web control that provides the user interface and logic for authenticating a visitor.</span></span> <span data-ttu-id="847f4-145">只有系統管理員可以建立新的帳戶。</span><span class="sxs-lookup"><span data-stu-id="847f4-145">Only administrators can create new accounts.</span></span> <span data-ttu-id="847f4-146">(有建立及管理中的使用者帳戶的頁面`~/Admin`資料夾。)</span><span class="sxs-lookup"><span data-stu-id="847f4-146">(There are pages for creating and managing user accounts in the `~/Admin` folder.)</span></span>

### <a name="configuring-the-membership-and-roles-apis"></a><span data-ttu-id="847f4-147">設定成員資格和角色 Api</span><span class="sxs-lookup"><span data-stu-id="847f4-147">Configuring the Membership and Roles APIs</span></span>

<span data-ttu-id="847f4-148">若要支援使用者帳戶，並將這些使用者到角色 （也就是 「 管理員 」 角色） 活頁簿檢閱 web 應用程式會使用成員資格和角色應用程式開發介面。</span><span class="sxs-lookup"><span data-stu-id="847f4-148">The Book Reviews web application uses the Membership and Roles APIs to support user accounts and to group those users into roles (namely, the Admin role).</span></span> <span data-ttu-id="847f4-149">`SqlMembershipProvider`和`SqlRoleProvider`可以使用提供者類別，因為我們想要儲存 SQL Server 資料庫中的帳戶和角色的資訊。</span><span class="sxs-lookup"><span data-stu-id="847f4-149">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes are used because we want to store account and role information in a SQL Server database.</span></span>

> [!NOTE]
> <span data-ttu-id="847f4-150">本教學課程的目的不是要在設定 web 應用程式支援的成員資格和角色應用程式開發介面詳細的檢查。</span><span class="sxs-lookup"><span data-stu-id="847f4-150">This tutorial is not intended to be a detailed examination at configuring a web application to support the Membership and Roles APIs.</span></span> <span data-ttu-id="847f4-151">徹底看這些 Api，以及您需要設定網站来使用它們所採取的步驟，請閱讀我[*網站安全性教學課程*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="847f4-151">For a thorough look at these APIs and the steps you need to take to configure a website to use them, please read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>


<span data-ttu-id="847f4-152">若要使用 SQL Server 資料庫，您必須先新增這些提供者使用的資料庫使用者帳戶所在的資料庫物件和儲存的角色資訊的應用程式服務。</span><span class="sxs-lookup"><span data-stu-id="847f4-152">To use the application services with a SQL Server database you must first add the database objects used by these providers to the database where you want the user account and role information stored.</span></span> <span data-ttu-id="847f4-153">這些必要的資料庫物件包括各種不同的資料表、 檢視和預存程序。</span><span class="sxs-lookup"><span data-stu-id="847f4-153">These requisite database objects include a variety of tables, views, and stored procedures.</span></span> <span data-ttu-id="847f4-154">除非另有指定`SqlMembershipProvider`和`SqlRoleProvider`提供者類別會使用名為 SQL Server Express Edition 資料庫`ASPNETDB`位於應用程式的`App_Data`資料夾; 如果這類資料庫不存在，它會自動建立這些提供者在執行階段所需要的資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="847f4-154">Unless specified otherwise, the `SqlMembershipProvider` and `SqlRoleProvider` provider classes use a SQL Server Express Edition database named `ASPNETDB` located in the application s `App_Data` folder; if such a database does not exist, it is automatically created with the necessary database objects by these providers at runtime.</span></span>

<span data-ttu-id="847f4-155">可以，且通常是理想的做法，來建立應用程式服務在網站 s 應用程式特定資料的儲存位置的相同資料庫中資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="847f4-155">It is possible, and usually ideal, to create the application services database objects in the same database where the website s application-specific data is stored.</span></span> <span data-ttu-id="847f4-156">.NET Framework 隨附於名為的工具`aspnet_regsql.exe`指定的資料庫上安裝的資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="847f4-156">The .NET Framework ships with a tool named `aspnet_regsql.exe` that installs the database objects on a specified database.</span></span> <span data-ttu-id="847f4-157">我已事先並使用此工具，這些將物件加入至`Reviews.mdf`資料庫`App_Data`資料夾 （開發資料庫）。</span><span class="sxs-lookup"><span data-stu-id="847f4-157">I have gone ahead and used this tool to add these objects to the `Reviews.mdf` database in the `App_Data` folder (the development database).</span></span> <span data-ttu-id="847f4-158">我們會看到如何使用這項工具稍後在本教學課程中，當我們將這些物件加入至實際執行資料庫。</span><span class="sxs-lookup"><span data-stu-id="847f4-158">We'll see how to use this tool later in this tutorial when we add these objects to the production database.</span></span>

<span data-ttu-id="847f4-159">如果您加入應用程式服務資料庫的資料庫物件以外`ASPNETDB`必須將自訂`SqlMembershipProvider`和`SqlRoleProvider`提供者類別的組態，使其使用適當的資料庫。</span><span class="sxs-lookup"><span data-stu-id="847f4-159">If you add the application services database objects to a database other than `ASPNETDB` you will need to customize the `SqlMembershipProvider` and `SqlRoleProvider` provider classes configurations so that they use the appropriate database.</span></span> <span data-ttu-id="847f4-160">若要自訂成員資格提供者新增[ *&lt;成員資格&gt;元素*](https://msdn.microsoft.com/library/1b9hw62f.aspx)內`<system.web>`一節中`Web.config`; 使用[ *&lt;roleManager&gt;元素*](https://msdn.microsoft.com/library/ms164660.aspx)設定角色提供者。</span><span class="sxs-lookup"><span data-stu-id="847f4-160">To customize the Membership provider add a [*&lt;membership&gt; element*](https://msdn.microsoft.com/library/1b9hw62f.aspx) within the `<system.web>` section in `Web.config`; use the [*&lt;roleManager&gt; element*](https://msdn.microsoft.com/library/ms164660.aspx) to configure the Roles provider.</span></span> <span data-ttu-id="847f4-161">下列程式碼片段取自書籍檢閱應用程式的`Web.config`和顯示的成員資格和角色應用程式開發介面的設定。</span><span class="sxs-lookup"><span data-stu-id="847f4-161">The following snippet is taken from the Book Reviews application s `Web.config` and shows the configure settings for the Membership and Roles APIs.</span></span> <span data-ttu-id="847f4-162">注意兩者註冊新的提供者-`ReviewMembership`和`ReviewRole`-使用`SqlMembershipProvider`和`SqlRoleProvider`提供者，分別。</span><span class="sxs-lookup"><span data-stu-id="847f4-162">Note that both register a new provider - `ReviewMembership` and `ReviewRole` - that use the `SqlMembershipProvider` and `SqlRoleProvider` providers, respectively.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample1.xml)]

<span data-ttu-id="847f4-163">`Web.config`檔案的`<authentication>`元素也已經設定為支援表單架構驗證。</span><span class="sxs-lookup"><span data-stu-id="847f4-163">The `Web.config` file s `<authentication>` element has also been configured to support forms-based authentication.</span></span>
  

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample2.xml)]

### <a name="limiting-access-to-the-administration-pages"></a><span data-ttu-id="847f4-164">限制存取的管理頁面</span><span class="sxs-lookup"><span data-stu-id="847f4-164">Limiting Access to the Administration Pages</span></span>

<span data-ttu-id="847f4-165">ASP.NET 簡化授與或拒絕存取特定檔案或資料夾的使用者或角色，透過其*URL 授權*功能。</span><span class="sxs-lookup"><span data-stu-id="847f4-165">ASP.NET makes it easy to grant or deny access to a particular file or folder by user or by role via its *URL authorization* feature.</span></span> <span data-ttu-id="847f4-166">(我們簡要討論中的 URL 授權*核心差異之間 IIS 和 ASP.NET 程式開發伺服器*教學課程和示範如何在 IIS 和 ASP.NET 程式開發伺服器將套用不同的靜態 URL 授權規則與動態內容。）因為我們想要禁止存取`~/Admin`資料夾中的系統管理員角色的使用者，我們需要加入此資料夾的 URL 授權規則。</span><span class="sxs-lookup"><span data-stu-id="847f4-166">(We briefly discussed URL authorization in the *Core Differences Between IIS and the ASP.NET Development Server* tutorial and showed how IIS and the ASP.NET Development Server apply URL authorization rules differently for static versus dynamic content.) Because we want to prohibit access to the `~/Admin` folder except for those users in the Admin role, we need to add URL authorization rules to this folder.</span></span> <span data-ttu-id="847f4-167">具體而言，URL 授權規則需要讓系統管理員角色中的使用者，並拒絕所有其他使用者。</span><span class="sxs-lookup"><span data-stu-id="847f4-167">Specifically, the URL authorization rules need to allow users in the Admin role and deny all other users.</span></span> <span data-ttu-id="847f4-168">這藉由加入`Web.config`檔案`~/Admin`資料夾具有下列內容：</span><span class="sxs-lookup"><span data-stu-id="847f4-168">This is accomplished by adding a `Web.config` file to the `~/Admin` folder with the following contents:</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample3.xml)]

<span data-ttu-id="847f4-169">ASP.NET 的 URL 授權功能以及如何使用它來拼出授權規則的使用者和角色，如需詳細資訊，應確定有閱讀[*使用者為基礎的授權*](../../older-versions-security/membership/user-based-authorization-cs.md)和[*角色為基礎的授權*](../../older-versions-security/roles/role-based-authorization-cs.md)教學課程，從我[*網站安全性教學課程*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="847f4-169">For more information on ASP.NET s URL authorization feature and how to use it to spell out authorization rules for users and for roles, be sure to read the [*User-Based Authorization*](../../older-versions-security/membership/user-based-authorization-cs.md) and [*Role-Based Authorization*](../../older-versions-security/roles/role-based-authorization-cs.md) tutorials from my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

## <a name="deploying-a-web-application-that-uses-application-services"></a><span data-ttu-id="847f4-170">部署 Web 應用程式使用應用程式服務</span><span class="sxs-lookup"><span data-stu-id="847f4-170">Deploying a Web Application That Uses Application Services</span></span>

<span data-ttu-id="847f4-171">在部署應用程式服務和應用程式服務資訊儲存在資料庫中的提供者所使用的網站時，務必，生產資料庫上建立所需的應用程式服務的資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="847f4-171">When deploying a website that uses application services and a provider that stores the application services information in a database, it is imperative that the database objects needed by the application services be created on the production database.</span></span> <span data-ttu-id="847f4-172">實際執行資料庫一開始並不包含這些物件，因此，當第一次部署應用程式 （或加入應用程式服務後第一次部署時），您必須採取額外步驟，即可取得這些必要的資料庫物件上實際執行資料庫。</span><span class="sxs-lookup"><span data-stu-id="847f4-172">Initially the production database does not contain these objects, so when the application is first deployed (or when it is deployed for the first time after application services have been added), you must take extra steps to get these requisite database objects on the production database.</span></span>

<span data-ttu-id="847f4-173">部署使用應用程式服務，如果您想要複寫到生產環境的開發環境中建立的使用者帳戶的網站時，可能會發生另一項挑戰。</span><span class="sxs-lookup"><span data-stu-id="847f4-173">Another challenge can arise when deploying a website that uses application services if you intend to replicate the user accounts created in the development environment to the production environment.</span></span> <span data-ttu-id="847f4-174">根據成員資格和角色的組態，則可能即使您已成功複製到實際執行資料庫開發環境中所建立的使用者帳戶，這些使用者無法登入 web 應用程式在生產環境中。</span><span class="sxs-lookup"><span data-stu-id="847f4-174">Depending on the Membership and Roles configuration, it is possible that even if you successfully copy the user accounts that were created in the development environment to the production database, these users cannot sign into the web application in production.</span></span> <span data-ttu-id="847f4-175">我們會查看此問題的原因，並討論如何避免這種情況。</span><span class="sxs-lookup"><span data-stu-id="847f4-175">We'll look at the cause of this issue and discuss how to prevent it from happening.</span></span>

<span data-ttu-id="847f4-176">ASP.NET 隨附 nice [*網站管理工具 (WSAT)* ](https://msdn.microsoft.com/library/yy40ytx0.aspx) ，可以從 Visual Studio 啟動，並讓使用者透過以 web 為基礎的管理帳戶、 角色和授權規則介面。</span><span class="sxs-lookup"><span data-stu-id="847f4-176">ASP.NET ships with a nice [*Web Site Administration Tool (WSAT)*](https://msdn.microsoft.com/library/yy40ytx0.aspx) that can be launched from Visual Studio and allows the user account, roles, and authorization rules to be managed through a web-based interface.</span></span> <span data-ttu-id="847f4-177">不幸的是，WSAT 僅適用於本機網站，亦即無法使用遠端管理使用者帳戶、 角色和 web 應用程式在生產環境中的授權規則。</span><span class="sxs-lookup"><span data-stu-id="847f4-177">Unfortunately, the WSAT only works for local websites, meaning that it cannot be used to remotely manage user accounts, roles, and authorization rules for the web application in the production environment.</span></span> <span data-ttu-id="847f4-178">我們會探討不同的方式來實作您的生產網站 WSAT 類似的行為。</span><span class="sxs-lookup"><span data-stu-id="847f4-178">We'll look at different ways to implement WSAT-like behavior from your production website.</span></span>

### <a name="adding-the-database-objects-using-aspnetregsqlexe"></a><span data-ttu-id="847f4-179">加入的資料庫物件使用 aspnet\_regsql.exe</span><span class="sxs-lookup"><span data-stu-id="847f4-179">Adding the Database Objects Using aspnet\_regsql.exe</span></span>

<span data-ttu-id="847f4-180">*部署資料庫*教學課程示範如何將資料表和資料從開發資料庫複製到生產資料庫，而且這些技術當然可用來複製到應用程式服務資料庫物件實際執行資料庫。</span><span class="sxs-lookup"><span data-stu-id="847f4-180">The *Deploying a Database* tutorial showed how to copy the tables and data from the development database to the production database, and these techniques can certainly be used to copy the application services database objects to the production database.</span></span> <span data-ttu-id="847f4-181">另一個選項是`aspnet_regsql.exe`工具，可加入或從資料庫移除應用程式服務的資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="847f4-181">Another option is the `aspnet_regsql.exe` tool, which adds or removes the application services database objects from a database.</span></span>

> [!NOTE]
> <span data-ttu-id="847f4-182">`aspnet_regsql.exe`工具指定的資料庫上建立資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="847f4-182">The `aspnet_regsql.exe` tool creates the database objects on a specified database.</span></span> <span data-ttu-id="847f4-183">它不會移轉的那些資料庫物件中的資料開發資料庫從生產資料庫。</span><span class="sxs-lookup"><span data-stu-id="847f4-183">It does not migrate data in those database objects from the development database to the production database.</span></span> <span data-ttu-id="847f4-184">如果您想要開發資料庫中的使用者帳戶和角色資訊複製到實際執行資料庫使用所涵蓋的技術*部署資料庫*教學課程。</span><span class="sxs-lookup"><span data-stu-id="847f4-184">If you mean to copy the user account and role information in the development database to the production database use the techniques covered in the *Deploying a Database* tutorial.</span></span>


<span data-ttu-id="847f4-185">將 s 看看如何將資料庫物件加入至實際執行資料庫使用`aspnet_regsql.exe`工具。</span><span class="sxs-lookup"><span data-stu-id="847f4-185">Let s look at how to add the database objects to the production database using the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="847f4-186">開啟 Windows 檔案總管並瀏覽至您在電腦上，%WINDIR%\ 的.NET Framework 2.0 版目錄啟動Microsoft.NET\Framework\v2.0.50727。</span><span class="sxs-lookup"><span data-stu-id="847f4-186">Start by opening Windows Explorer and navigating to the .NET Framework version 2.0 directory on your computer, %WINDIR%\ Microsoft.NET\Framework\v2.0.50727.</span></span> <span data-ttu-id="847f4-187">您應該會那里發現`aspnet_regsql.exe`工具。</span><span class="sxs-lookup"><span data-stu-id="847f4-187">There you should find the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="847f4-188">這項工具可從命令列，不過它也包含圖形化使用者介面。按兩下`aspnet_regsql.exe`檔案以啟動其圖形化元件。</span><span class="sxs-lookup"><span data-stu-id="847f4-188">This tool can be used from the command-line, but it also includes a graphical user interface; double-click the `aspnet_regsql.exe` file to launch its graphical component.</span></span>

<span data-ttu-id="847f4-189">此工具一開始會顯示啟動顯示畫面以說明其用途。</span><span class="sxs-lookup"><span data-stu-id="847f4-189">The tool starts by displaying a splash screen explaining its purpose.</span></span> <span data-ttu-id="847f4-190">按一下旁邊前進至 「 選取安裝選項 畫面中，圖 1 所示。</span><span class="sxs-lookup"><span data-stu-id="847f4-190">Click Next to advance to the "Select a Setup Option" screen, which is shown in Figure 1.</span></span> <span data-ttu-id="847f4-191">從這裡您可以選擇加入應用程式服務資料庫物件，或從資料庫中移除。</span><span class="sxs-lookup"><span data-stu-id="847f4-191">From here you can choose to add the application services database objects or remove them from a database.</span></span> <span data-ttu-id="847f4-192">由於我們想要將這些物件加入至實際執行資料庫，選取"設定應用程式服務的 SQL Server"選項，然後按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="847f4-192">Because we want to add these objects to the production database, select the "Configure SQL Server for application services" option and click Next.</span></span>


<span data-ttu-id="847f4-193">[![選擇應用程式服務設定 SQL Server](configuring-a-website-that-uses-application-services-cs/_static/image2.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="847f4-193">[![Choose to Configure SQL Server for Application Services](configuring-a-website-that-uses-application-services-cs/_static/image2.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image1.jpg)</span></span>

<span data-ttu-id="847f4-194">**圖 1**： 設定 SQL Server 應用程式服務的選擇 ([按一下以檢視完整大小的影像](configuring-a-website-that-uses-application-services-cs/_static/image3.jpg))</span><span class="sxs-lookup"><span data-stu-id="847f4-194">**Figure 1**: Choose to Configure SQL Server for Application Services ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image3.jpg))</span></span>


<span data-ttu-id="847f4-195">在 < 選取伺服器和資料庫 > 畫面提示資訊以連接到資料庫。</span><span class="sxs-lookup"><span data-stu-id="847f4-195">In "Select the Server and Database" screen prompts for information to connect to the database.</span></span> <span data-ttu-id="847f4-196">輸入資料庫伺服器、 安全性認證和虛擬主機公司提供給您的資料庫名稱，然後按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="847f4-196">Enter the database server, the security credentials, and the database name supplied to you by your web hosting company and click Next.</span></span>

> [!NOTE]
> <span data-ttu-id="847f4-197">輸入您的資料庫伺服器和認證之後，展開 [資料庫] 下拉式清單時，可能會收到錯誤。</span><span class="sxs-lookup"><span data-stu-id="847f4-197">After entering your database server and credentials you may get an error when expanding the database drop-down list.</span></span> <span data-ttu-id="847f4-198">`aspnet_regsql.exe`工具查詢`sysdatabases`系統資料表，以擷取在伺服器上，但某些虛擬主機公司鎖定其資料庫伺服器，因此這項資訊不會公開可用的資料庫清單。</span><span class="sxs-lookup"><span data-stu-id="847f4-198">The `aspnet_regsql.exe` tool queries the `sysdatabases` system table to retrieve a list of databases on the server, but some web hosting companies lock down their database servers so that this information is not publicly available.</span></span> <span data-ttu-id="847f4-199">如果您收到這個錯誤您可以直接在下拉式清單中輸入資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="847f4-199">If you get this error you can type the database name directly into the drop-down list.</span></span>


<span data-ttu-id="847f4-200">[![提供您的資料庫的連接資訊與工具](configuring-a-website-that-uses-application-services-cs/_static/image5.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="847f4-200">[![Supply the Tool With Your Database s Connection Information](configuring-a-website-that-uses-application-services-cs/_static/image5.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image4.jpg)</span></span>

<span data-ttu-id="847f4-201">**圖 2**： 提供的工具與您的資料庫 s 連接資訊 ([按一下以檢視完整大小的影像](configuring-a-website-that-uses-application-services-cs/_static/image6.jpg))</span><span class="sxs-lookup"><span data-stu-id="847f4-201">**Figure 2**: Supply the Tool With Your Database s Connection Information ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image6.jpg))</span></span>


<span data-ttu-id="847f4-202">後續畫面摘要說明的動作即將進行，也就是應用程式服務的資料庫物件所要加入至指定的資料庫。</span><span class="sxs-lookup"><span data-stu-id="847f4-202">The subsequent screen summarizes the actions that are about to take place, namely that the application services database objects are going to be added to the specified database.</span></span> <span data-ttu-id="847f4-203">按一下旁邊的 完成此動作。</span><span class="sxs-lookup"><span data-stu-id="847f4-203">Click Next to complete this action.</span></span> <span data-ttu-id="847f4-204">在幾分鐘之後, 會顯示最後的畫面，您會看到有 （請參閱圖 3） 已加入的資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="847f4-204">After a few moments, the final screen is displayed, noting that the database objects have been added (see Figure 3).</span></span>


<span data-ttu-id="847f4-205">[![成功 ！應用程式服務的資料庫物件已加入至實際執行資料庫](configuring-a-website-that-uses-application-services-cs/_static/image8.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="847f4-205">[![Success! The Application Services Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-cs/_static/image8.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image7.jpg)</span></span>

<span data-ttu-id="847f4-206">**圖 3**： 成功 ！</span><span class="sxs-lookup"><span data-stu-id="847f4-206">**Figure 3**: Success!</span></span> <span data-ttu-id="847f4-207">應用程式服務的資料庫物件已加入實際執行資料庫 ([按一下以檢視完整大小的影像](configuring-a-website-that-uses-application-services-cs/_static/image9.jpg))</span><span class="sxs-lookup"><span data-stu-id="847f4-207">The Application Services Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image9.jpg))</span></span>


<span data-ttu-id="847f4-208">若要確認應用程式服務的資料庫物件已成功新增到實際執行資料庫，開啟 SQL Server Management Studio 並連接到您的生產資料庫。</span><span class="sxs-lookup"><span data-stu-id="847f4-208">To verify that the application services database objects were successfully added to the production database, open SQL Server Management Studio and connect to your production database.</span></span> <span data-ttu-id="847f4-209">如圖 4 所示，您現在應該會看到應用程式服務資料庫資料表在資料庫中， `aspnet_Applications`， `aspnet_Membership`， `aspnet_Users`，依此類推。</span><span class="sxs-lookup"><span data-stu-id="847f4-209">As Figure 4 shows, you should now see the application services database tables in your database, `aspnet_Applications`, `aspnet_Membership`, `aspnet_Users`, and so forth.</span></span>


<span data-ttu-id="847f4-210">[![確認資料庫物件已新增到實際執行資料庫](configuring-a-website-that-uses-application-services-cs/_static/image11.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image10.jpg)</span><span class="sxs-lookup"><span data-stu-id="847f4-210">[![Confirm That the Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-cs/_static/image11.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image10.jpg)</span></span>

<span data-ttu-id="847f4-211">**圖 4**： 確認的資料庫物件已加入到實際執行資料庫 ([按一下以檢視完整大小的影像](configuring-a-website-that-uses-application-services-cs/_static/image12.jpg))</span><span class="sxs-lookup"><span data-stu-id="847f4-211">**Figure 4**: Confirm That the Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image12.jpg))</span></span>


<span data-ttu-id="847f4-212">您只需要使用`aspnet_regsql.exe`工具時部署 web 應用程式第一次，或已使用應用程式服務啟動後第一次。</span><span class="sxs-lookup"><span data-stu-id="847f4-212">You will only need to use the `aspnet_regsql.exe` tool when deploying your web application for the first time or for the first time after you have started using the application services.</span></span> <span data-ttu-id="847f4-213">一旦這些資料庫物件是在生產資料庫上它們贏得 t 不必重新加入或修改。</span><span class="sxs-lookup"><span data-stu-id="847f4-213">Once these database objects are on the production database they won t need to be re-added or modified.</span></span>

### <a name="copying-user-accounts-from-development-to-production"></a><span data-ttu-id="847f4-214">複製使用者帳戶從開發到生產環境</span><span class="sxs-lookup"><span data-stu-id="847f4-214">Copying User Accounts from Development to Production</span></span>

<span data-ttu-id="847f4-215">當使用`SqlMembershipProvider`和`SqlRoleProvider`提供者類別，將應用程式服務資訊儲存在 SQL Server 資料庫中，使用者帳戶和角色的資訊會儲存在資料庫資料表，包括各種`aspnet_Users`， `aspnet_Membership`，`aspnet_Roles`，和`aspnet_UsersInRoles`，和其他項目。</span><span class="sxs-lookup"><span data-stu-id="847f4-215">When using the `SqlMembershipProvider` and `SqlRoleProvider` provider classes to store the application services information in a SQL Server database, the user account and role information is stored in a variety of database tables, including `aspnet_Users`, `aspnet_Membership`, `aspnet_Roles`, and `aspnet_UsersInRoles`, among others.</span></span> <span data-ttu-id="847f4-216">如果您可以在開發期間建立使用者帳戶來開發環境中您可以藉由複製適用的資料庫資料表中對應記錄複寫在生產環境中的這些使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="847f4-216">If during development you create user accounts in the development environment you can replicate those user accounts in production by copying the corresponding records from the applicable database tables.</span></span> <span data-ttu-id="847f4-217">如果您使用資料庫發行精靈 」 來部署您可能也要複製的記錄，也是在生產環境的開發工作建立的使用者帳戶可能會導致選取的應用程式服務資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="847f4-217">If you used the Database Publishing Wizard to deploy the application services database objects you may have also elected to copy the records, which would result in the user accounts created in development to also be on production.</span></span> <span data-ttu-id="847f4-218">但是，根據您的組態設定，您可能會發現這些開發中建立並複製到生產環境之帳戶的使用者會無法從生產網站登入。</span><span class="sxs-lookup"><span data-stu-id="847f4-218">But, depending on your configuration settings, you may find that those users whose accounts were created in development and copied to production are unable to login from the production website.</span></span> <span data-ttu-id="847f4-219">呢？</span><span class="sxs-lookup"><span data-stu-id="847f4-219">What gives?</span></span>

<span data-ttu-id="847f4-220">`SqlMembershipProvider`和`SqlRoleProvider`提供者類別皆設計單一資料庫可作為使用者存放區的多個應用程式，其中每個應用程式可以在理論上，有重疊的使用者名稱與使用者和角色具有相同的名稱。</span><span class="sxs-lookup"><span data-stu-id="847f4-220">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes were designed such that a single database could serve as a user store for multiple applications, where each application could, in theory, have users with overlapping usernames and roles with the same name.</span></span> <span data-ttu-id="847f4-221">若要允許這種彈性，資料庫會保留一份應用程式中`aspnet_Applications`資料表，以及每個使用者都與上述任一應用程式。</span><span class="sxs-lookup"><span data-stu-id="847f4-221">To allow for this flexibility, the database maintains a list of applications in the `aspnet_Applications` table, and each user is associated with one of these applications.</span></span> <span data-ttu-id="847f4-222">具體來說，`aspnet_Users`資料表有`ApplicationId`繫結合作對每位使用者中之記錄的資料行`aspnet_Applications`資料表。</span><span class="sxs-lookup"><span data-stu-id="847f4-222">Specifically, the `aspnet_Users` table has an `ApplicationId` column that ties each user to a record in the `aspnet_Applications` table.</span></span>

<span data-ttu-id="847f4-223">除了`ApplicationId`資料行，`aspnet_Applications`資料表也包含`ApplicationName`資料行，提供應用程式的人類看得更易記名稱。</span><span class="sxs-lookup"><span data-stu-id="847f4-223">In addition to the `ApplicationId` column, the `aspnet_Applications` table also includes an `ApplicationName` column, which provides a more human-friendly name for the application.</span></span> <span data-ttu-id="847f4-224">網站嘗試使用 [使用者帳戶，例如先驗證使用者 s 來自的認證登入] 頁面上，它必須告知`SqlMembershipProvider`類別要使用之應用程式。</span><span class="sxs-lookup"><span data-stu-id="847f4-224">When a website attempts to work with a user account, such as validating a user s credentials from the login page, it must tell the `SqlMembershipProvider` class what application to work with.</span></span> <span data-ttu-id="847f4-225">它通常會提供應用程式名稱，這和此值的來源中的提供者的組態`Web.config`-特別透過`applicationName`屬性。</span><span class="sxs-lookup"><span data-stu-id="847f4-225">It usually does this by supplying the application name, and the this value comes from the provider s configuration in `Web.config` - specifically via the `applicationName` attribute.</span></span>

<span data-ttu-id="847f4-226">但要是`applicationName`中未指定屬性`Web.config`嗎？</span><span class="sxs-lookup"><span data-stu-id="847f4-226">But what happens if the `applicationName` attribute is not specified in `Web.config`?</span></span> <span data-ttu-id="847f4-227">在此情況下的成員資格系統會使用應用程式根路徑，做為`applicationName`值。</span><span class="sxs-lookup"><span data-stu-id="847f4-227">In such a case the Membership system uses the application root path as the `applicationName` value.</span></span> <span data-ttu-id="847f4-228">如果`applicationName`中未明確設定屬性`Web.config`，接著，則可能會開發環境和生產環境使用不同的應用程式根目錄，因此會有不同的應用程式相關聯在 應用程式服務的名稱。</span><span class="sxs-lookup"><span data-stu-id="847f4-228">If the `applicationName` attribute is not explicitly set in `Web.config`, then, there is the possibility that the development environment and production environment use a different application root and therefore will be associated with different application names in the application services.</span></span> <span data-ttu-id="847f4-229">如果發生這類不符的情形，則在開發環境中建立那些使用者就能`ApplicationId`不相符的值`ApplicationId`實際執行環境的值。</span><span class="sxs-lookup"><span data-stu-id="847f4-229">If such a mismatch occurs then those users created in the development environment will have an `ApplicationId` value that does not match with the `ApplicationId` value for the production environment.</span></span> <span data-ttu-id="847f4-230">最後結果就是贏了 t 那些使用者無法登入。</span><span class="sxs-lookup"><span data-stu-id="847f4-230">The net result is that those users won t be able to login.</span></span>

> [!NOTE]
> <span data-ttu-id="847f4-231">如果您發現自己在此情況下-複製到生產環境與不相符的使用者帳戶與`ApplicationId`值-您可以撰寫查詢以更新這些錯誤`ApplicationId`值`ApplicationId`用於生產環境。</span><span class="sxs-lookup"><span data-stu-id="847f4-231">If you find yourself in this situation - with user accounts copied to production with a mismatched `ApplicationId` value - you could write a query to update these incorrect `ApplicationId` values to the `ApplicationId` used on production.</span></span> <span data-ttu-id="847f4-232">一旦更新，在開發環境中建立之帳戶的使用者現在就可以登入實際執行的 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="847f4-232">Once updated, the users whose accounts were created on the development environment would now be able to sign into the web application on production.</span></span>


<span data-ttu-id="847f4-233">好消息是簡單的步驟可確保兩個環境都使用相同`ApplicationId`-明確設定`applicationName`屬性`Web.config`所有應用程式的服務提供者。</span><span class="sxs-lookup"><span data-stu-id="847f4-233">The good news is that there is a simple step you can take to ensure that the two environments use the same `ApplicationId` - explicitly set the `applicationName` attribute in `Web.config` for all of your application services providers.</span></span> <span data-ttu-id="847f4-234">明確地設定`applicationName`屬性中的"BookReviews"`<membership>`和`<roleManager>`項目從這個程式碼片段為`Web.config`顯示。</span><span class="sxs-lookup"><span data-stu-id="847f4-234">I explicitly set the `applicationName` attribute to "BookReviews" in the `<membership>` and `<roleManager>` elements as this snippet from `Web.config` shows.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample4.xml)]

<span data-ttu-id="847f4-235">如需設定的詳細討論`applicationName`屬性和原理，是指[ *Scott Guthrie* ](https://weblogs.asp.net/scottgu/) s 部落格文章： [*永遠設定應用程式名稱屬性設定 ASP.NET 成員資格和其他提供者時*](https://weblogs.asp.net/scottgu/443634)。</span><span class="sxs-lookup"><span data-stu-id="847f4-235">For more discussion on setting the `applicationName` attribute and the rationale behind it, refer to [*Scott Guthrie*](https://weblogs.asp.net/scottgu/) s blog post, [*Always set the applicationName property when configuring ASP.NET Membership and other Providers*](https://weblogs.asp.net/scottgu/443634).</span></span>

### <a name="managing-user-accounts-in-the-production-environment"></a><span data-ttu-id="847f4-236">在生產環境中管理使用者帳戶</span><span class="sxs-lookup"><span data-stu-id="847f4-236">Managing User Accounts in the Production Environment</span></span>

<span data-ttu-id="847f4-237">ASP.NET 網站管理工具 (WSAT) 可讓您輕鬆地建立及管理使用者帳戶、 定義及套用角色和拼出使用者和角色為基礎的授權規則。</span><span class="sxs-lookup"><span data-stu-id="847f4-237">The ASP.NET Web Site Administration Tool (WSAT) makes it easy to create and manage user accounts, define and apply roles, and spell out user- and role-based authorization rules.</span></span> <span data-ttu-id="847f4-238">您可以啟動 Visual Studio 從 WSAT 移至 [方案總管] 並按一下 [ASP.NET 組態] 圖示，或移至 [網站] 或 [專案] 功能表，然後選取 [ASP.NET 組態] 功能表項目。</span><span class="sxs-lookup"><span data-stu-id="847f4-238">You can launch the WSAT from Visual Studio by going to the Solution Explorer and clicking the ASP.NET Configuration icon or by going to the Website or Project menus and selecting the ASP.NET Configuration menu item.</span></span> <span data-ttu-id="847f4-239">不幸的是，WSAT 只能搭配本機網站。</span><span class="sxs-lookup"><span data-stu-id="847f4-239">Unfortunately, the WSAT can only work with local websites.</span></span> <span data-ttu-id="847f4-240">因此，您無法從工作站使用 WSAT 來管理生產環境中的網站。</span><span class="sxs-lookup"><span data-stu-id="847f4-240">Therefore, you cannot use the WSAT from your workstation to manage the website in the production environment.</span></span>

<span data-ttu-id="847f4-241">好消息是功能的 WSAT 所提供所有公開都是功能的以程式設計方式透過成員資格和角色應用程式開發介面。此外，許多 WSAT 螢幕使用標準 ASP.NET 登入相關的控制項。</span><span class="sxs-lookup"><span data-stu-id="847f4-241">The good news is that all of the functionality exposed provided by the WSAT is available programmatically through the Membership and Roles APIs; furthermore, many of the WSAT screens use the standard ASP.NET Login-related controls.</span></span> <span data-ttu-id="847f4-242">簡單地說，您可以將 ASP.NET 網頁加入您的網站，提供必要的管理功能。</span><span class="sxs-lookup"><span data-stu-id="847f4-242">In short, you can add ASP.NET pages to your website that offer the necessary management capabilities.</span></span>

<span data-ttu-id="847f4-243">前文提過早的教學課程，更新活頁簿檢閱 web 應用程式，以包含`~/Admin`資料夾，然後此資料夾已設定，只允許系統管理員角色中的使用者。</span><span class="sxs-lookup"><span data-stu-id="847f4-243">Recall that an earlier tutorial updated the Book Reviews web application to include an `~/Admin` folder, and this folder has been configured to only allow users in the Admin role.</span></span> <span data-ttu-id="847f4-244">我將頁面加入到該資料夾中名為`CreateAccount.aspx`從系統管理員可以建立新的使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="847f4-244">I added a page to that folder named `CreateAccount.aspx` from which an administrator can create a new user account.</span></span> <span data-ttu-id="847f4-245">此頁面會使用適用於 CreateUserWizard 控制項來顯示使用者介面和後端邏輯來建立新的使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="847f4-245">This page uses the CreateUserWizard control to display the user interface and backend logic for creating a new user account.</span></span> <span data-ttu-id="847f4-246">更多、 哪些 s 我自訂以包含提示是否有新的使用者也應該加入至管理員角色的核取方塊控制項 （請參閱圖 5）。</span><span class="sxs-lookup"><span data-stu-id="847f4-246">What s more, I customized the control to include a CheckBox that prompts whether the new user should also be added to the Admin role (see Figure 5).</span></span> <span data-ttu-id="847f4-247">使用一些工作，您可以建立一組自訂的網頁可實作使用者和角色管理相關的工作，否則會 WSAT 所提供。</span><span class="sxs-lookup"><span data-stu-id="847f4-247">With a little bit of work you can build a custom set of pages that implements the user and role management-related tasks that would otherwise be provided by the WSAT.</span></span>

> [!NOTE]
> <span data-ttu-id="847f4-248">登入相關的 ASP.NET Web 控制項，以及使用的成員資格和角色應用程式開發介面的詳細資訊，應確定有閱讀我[*網站安全性教學課程*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="847f4-248">For more information on using the Membership and Roles APIs along with the Login-related ASP.NET Web controls, be sure to read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span> <span data-ttu-id="847f4-249">如需自訂適用於 CreateUserWizard 控制項的詳細資訊，請參閱[*建立使用者帳戶*](../../older-versions-security/membership/creating-user-accounts-cs.md)和[*儲存額外的使用者資訊*](../../older-versions-security/membership/storing-additional-user-information-cs.md)教學課程中或簽出[*何 Peterson* ](http://www.erichpeterson.com/) s 文章[*自訂適用於 CreateUserWizard 控制項*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="847f4-249">For more on customizing the CreateUserWizard control refer to the [*Creating User Accounts*](../../older-versions-security/membership/creating-user-accounts-cs.md) and [*Storing Additional User Information*](../../older-versions-security/membership/storing-additional-user-information-cs.md) tutorials, or check out [*Erich Peterson*](http://www.erichpeterson.com/) s article, [*Customizing the CreateUserWizard Control*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span></span>


<span data-ttu-id="847f4-250">[![系統管理員可以建立新的使用者帳戶](configuring-a-website-that-uses-application-services-cs/_static/image14.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image13.jpg)</span><span class="sxs-lookup"><span data-stu-id="847f4-250">[![Administrators Can Create New User Accounts](configuring-a-website-that-uses-application-services-cs/_static/image14.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image13.jpg)</span></span>

<span data-ttu-id="847f4-251">**圖 5**： 系統管理員可以建立新的使用者帳戶 ([按一下以檢視完整大小的影像](configuring-a-website-that-uses-application-services-cs/_static/image15.jpg))</span><span class="sxs-lookup"><span data-stu-id="847f4-251">**Figure 5**: Administrators Can Create New User Accounts ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image15.jpg))</span></span>


<span data-ttu-id="847f4-252">如果您需要的 WSAT 簽出的完整功能[*輪流您自己的網站管理工具*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)中的作者 Dan Clem 逐步解說建立自訂的 WSAT 類似工具的程序。</span><span class="sxs-lookup"><span data-stu-id="847f4-252">If you need the full functionality of the WSAT check out [*Rolling Your Own Web Site Administration Tool*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx), in which author Dan Clem walks through the process of building a custom WSAT-like tool.</span></span> <span data-ttu-id="847f4-253">Dan 共用他的應用程式的來源的程式碼 （C# 中），並提供逐步指示，將它加入至您裝載的網站。</span><span class="sxs-lookup"><span data-stu-id="847f4-253">Dan shares his application s source code (in C#) and provides step-by-step instructions for adding it to your hosted website.</span></span>

## <a name="summary"></a><span data-ttu-id="847f4-254">總結</span><span class="sxs-lookup"><span data-stu-id="847f4-254">Summary</span></span>

<span data-ttu-id="847f4-255">部署 web 應用程式使用應用程式服務資料庫實作時必須先確定生產資料庫的必要資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="847f4-255">When deploying a web application that uses the application services database implementation you must first ensure that the production database has the requisite database objects.</span></span> <span data-ttu-id="847f4-256">這些物件可以使用中討論的技術加入*部署資料庫*教學課程; 或者，您可以使用`aspnet_regsql.exe`工具，我們在本教學課程，了解。</span><span class="sxs-lookup"><span data-stu-id="847f4-256">These objects can be added using the techniques discussed in the *Deploying a Database* tutorial; alternatively, you can use the `aspnet_regsql.exe` tool, as we saw in this tutorial.</span></span> <span data-ttu-id="847f4-257">其他的挑戰我們觸及中心周圍同步處理中 （這是很重要，如果您想要在生產環境中有效的使用者和開發環境中建立的角色） 的開發和生產環境和技術使用的應用程式名稱管理使用者和實際執行環境中的角色。</span><span class="sxs-lookup"><span data-stu-id="847f4-257">Other challenges we touched on center around synchronizing the application name used in the development and production environments (which is important if you want users and roles created in the development environment to be valid on production) and techniques for managing the users and roles in the production environment.</span></span>

<span data-ttu-id="847f4-258">祝您程式設計 ！</span><span class="sxs-lookup"><span data-stu-id="847f4-258">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="847f4-259">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="847f4-259">Further Reading</span></span>

<span data-ttu-id="847f4-260">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="847f4-260">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="847f4-261">*ASP.NET SQL Server 註冊工具 (aspnet_regsql.exe)*</span><span class="sxs-lookup"><span data-stu-id="847f4-261">*ASP.NET SQL Server Registration Tool (aspnet_regsql.exe)*</span></span>](https://msdn.microsoft.com/library/ms229862.aspx)
- [<span data-ttu-id="847f4-262">*建立適用於 SQL Server 的應用程式服務資料庫*</span><span class="sxs-lookup"><span data-stu-id="847f4-262">*Creating the Application Services Database for SQL Server*</span></span>](https://msdn.microsoft.com/library/x28wfk74.aspx)
- [<span data-ttu-id="847f4-263">*在 SQL Server 中建立成員資格結構描述*</span><span class="sxs-lookup"><span data-stu-id="847f4-263">*Creating the Membership Schema in SQL Server*</span></span>](../../older-versions-security/membership/creating-the-membership-schema-in-sql-server-cs.md)
- [<span data-ttu-id="847f4-264">*檢查 ASP.NET s 成員資格、 角色和設定檔*</span><span class="sxs-lookup"><span data-stu-id="847f4-264">*Examining ASP.NET s Membership, Roles, and Profile*</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="847f4-265">*復原您的網站管理工具*</span><span class="sxs-lookup"><span data-stu-id="847f4-265">*Rolling Your Own Web Site Administration Tool*</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="847f4-266">*網站安全性教學課程*</span><span class="sxs-lookup"><span data-stu-id="847f4-266">*Website Security Tutorials*</span></span>](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)
- [<span data-ttu-id="847f4-267">*網站管理工具概觀*</span><span class="sxs-lookup"><span data-stu-id="847f4-267">*Web Site Administration Tool Overview*</span></span>](https://msdn.microsoft.com/library/yy40ytx0.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="847f4-268">[上一頁](configuring-the-production-web-application-to-use-the-production-database-cs.md)
> [下一頁](strategies-for-database-development-and-deployment-cs.md)</span><span class="sxs-lookup"><span data-stu-id="847f4-268">[Previous](configuring-the-production-web-application-to-use-the-production-database-cs.md)
[Next](strategies-for-database-development-and-deployment-cs.md)</span></span>
