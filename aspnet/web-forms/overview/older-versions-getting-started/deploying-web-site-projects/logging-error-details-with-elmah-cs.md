---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-elmah-cs
title: 記錄錯誤的詳細資料與 ELMAH (C#) |Microsoft 文件
author: rick-anderson
description: 錯誤記錄模組和處理常式 (ELMAH) 提供了另一個執行階段錯誤記錄在生產環境中的方法。 ELMAH 是免費的開放原始錯誤...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/09/2009
ms.topic: article
ms.assetid: 11f6fe44-64ef-4a38-a3b4-35c7bb992352
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-elmah-cs
msc.type: authoredcontent
ms.openlocfilehash: cd91c745624f09d01a326a445bea2bb756576688
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/10/2018
ms.locfileid: "30890615"
---
<a name="logging-error-details-with-elmah-c"></a><span data-ttu-id="30d0c-104">記錄錯誤的詳細資料與 ELMAH (C#)</span><span class="sxs-lookup"><span data-stu-id="30d0c-104">Logging Error Details with ELMAH (C#)</span></span>
====================
<span data-ttu-id="30d0c-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="30d0c-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="30d0c-106">[下載程式碼](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_14_CS.zip)或[下載 PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial14_ELMAH_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="30d0c-106">[Download Code](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_14_CS.zip) or [Download PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial14_ELMAH_cs.pdf)</span></span>

> <span data-ttu-id="30d0c-107">錯誤記錄模組和處理常式 (ELMAH) 提供了另一個執行階段錯誤記錄在生產環境中的方法。</span><span class="sxs-lookup"><span data-stu-id="30d0c-107">Error Logging Modules And Handlers (ELMAH) offers another approach to logging runtime errors in a production environment.</span></span> <span data-ttu-id="30d0c-108">ELMAH 是免費的開放原始錯誤記錄程式庫所包含的功能類似錯誤篩選和 RSS 摘要，以檢視錯誤記錄檔從網頁上，或下載為逗號分隔檔案的能力。</span><span class="sxs-lookup"><span data-stu-id="30d0c-108">ELMAH is a free, open source error logging library that includes features like error filtering and the ability to view the error log from a web page, as an RSS feed, or to download it as a comma-delimited file.</span></span> <span data-ttu-id="30d0c-109">這個教學課程引導下載和設定 ELMAH。</span><span class="sxs-lookup"><span data-stu-id="30d0c-109">This tutorial walks through downloading and configuring ELMAH.</span></span>


## <a name="introduction"></a><span data-ttu-id="30d0c-110">簡介</span><span class="sxs-lookup"><span data-stu-id="30d0c-110">Introduction</span></span>

<span data-ttu-id="30d0c-111">[前述教學課程](logging-error-details-with-asp-net-health-monitoring-cs.md)檢查 ASP。網路的健全狀況監視系統，可提供現成的方塊程式庫錄製的 Web 事件。</span><span class="sxs-lookup"><span data-stu-id="30d0c-111">The [preceding tutorial](logging-error-details-with-asp-net-health-monitoring-cs.md) examined ASP.NET's health monitoring system, which offers an out of the box library for recording a wide array of Web events.</span></span> <span data-ttu-id="30d0c-112">許多開發人員使用健全狀況監視記錄和電子郵件的未處理例外狀況詳細資料。</span><span class="sxs-lookup"><span data-stu-id="30d0c-112">Many developers use health monitoring to log and email the details of unhandled exceptions.</span></span> <span data-ttu-id="30d0c-113">不過，有幾個痛苦點與此系統。</span><span class="sxs-lookup"><span data-stu-id="30d0c-113">However, there are a few pain points with this system.</span></span> <span data-ttu-id="30d0c-114">第一次和最重要 」 表示無任何使用者介面，以檢視所記錄的事件的相關任何的資訊排序。</span><span class="sxs-lookup"><span data-stu-id="30d0c-114">First and foremost is the lack any sort of user interface for viewing information about the logged events.</span></span> <span data-ttu-id="30d0c-115">如果您想要查看摘要，以 10 的最後一個錯誤，或檢視上週發生了錯誤的詳細資料，您必須是透過資料庫查詢、 掃描您的電子郵件收件匣、 長度或建立顯示資訊的 web 網頁`aspnet_WebEvent_Events`資料表。</span><span class="sxs-lookup"><span data-stu-id="30d0c-115">If you want to see a summary of the 10 last errors, or view the details of an error that happened last week, you must either poke through the database, scan through your email Inbox, or build a web page that displays information from the `aspnet_WebEvent_Events` table.</span></span>

<span data-ttu-id="30d0c-116">另一個痛苦點中心健全狀況監視的複雜性。</span><span class="sxs-lookup"><span data-stu-id="30d0c-116">Another pain point centers around health monitoring's complexity.</span></span> <span data-ttu-id="30d0c-117">可以用來記錄上的不同事件的健全狀況監視，因為有許多不同的選項來指示如何及何時會記錄事件，正確設定監視系統健全狀況是很繁重的工作。</span><span class="sxs-lookup"><span data-stu-id="30d0c-117">Because health monitoring can be used to record a plethora of different events, and because there are a variety of options for instructing how and when events are logged, correctly configuring the health monitoring system can be an onerous task.</span></span> <span data-ttu-id="30d0c-118">最後，有相容性問題。</span><span class="sxs-lookup"><span data-stu-id="30d0c-118">Finally, there are compatibility issues.</span></span> <span data-ttu-id="30d0c-119">健全狀況監視已初次加入至.NET Framework 2.0 版中，因為它不適用於較舊的 web 應用程式使用 ASP.NET 版本建置的 1.x。</span><span class="sxs-lookup"><span data-stu-id="30d0c-119">Because health monitoring was first added to the .NET Framework in version 2.0, it is not available for older web applications built using ASP.NET version 1.x.</span></span> <span data-ttu-id="30d0c-120">此外，`SqlWebEventProvider`類別，可使用資料庫的記錄檔錯誤詳細資料前述教學課程中，只適用於 Microsoft SQL Server 資料庫。</span><span class="sxs-lookup"><span data-stu-id="30d0c-120">Moreover, the `SqlWebEventProvider` class, which we used in the preceding tutorial to logs error details to a database, only works with Microsoft SQL Server databases.</span></span> <span data-ttu-id="30d0c-121">您必須建立自訂記錄提供者類別，您應該要替代的資料存放區，例如 XML 檔案或 Oracle 資料庫中記錄錯誤。</span><span class="sxs-lookup"><span data-stu-id="30d0c-121">You will need to create a custom log provider class should you need to log errors to an alternate data store, such as an XML file or Oracle database.</span></span>

<span data-ttu-id="30d0c-122">監視系統健全狀況的替代方式是錯誤記錄模組和處理常式 (ELMAH)，建立免費的開放原始碼的錯誤記錄系統[Atif Aziz](http://www.raboof.com/)。</span><span class="sxs-lookup"><span data-stu-id="30d0c-122">An alternative to the health monitoring system is Error Logging Modules And Handlers (ELMAH), a free, open-source error logging system created by [Atif Aziz](http://www.raboof.com/).</span></span> <span data-ttu-id="30d0c-123">兩個系統之間最顯著的差異是 ELAMH 的能夠顯示的錯誤，以及從網頁和特定錯誤的詳細資料 RSS 摘要清單。</span><span class="sxs-lookup"><span data-stu-id="30d0c-123">The most notable difference between the two systems is ELAMH's ability to display a list of errors and the details of a specific error from a web page and as an RSS feed.</span></span> <span data-ttu-id="30d0c-124">ELMAH 很容易設定比健全狀況監視，因為它只會記錄錯誤。</span><span class="sxs-lookup"><span data-stu-id="30d0c-124">ELMAH is easier to configure than health monitoring because it only logs errors.</span></span> <span data-ttu-id="30d0c-125">此外，ELMAH 包含支援 ASP.NET 1.x、 ASP.NET 2.0 中，與 ASP.NET 3.5 應用程式，以及隨附於各種不同的記錄檔提供者。</span><span class="sxs-lookup"><span data-stu-id="30d0c-125">Furthermore, ELMAH includes support for ASP.NET 1.x, ASP.NET 2.0, and ASP.NET 3.5 applications, and ships with a variety of log source providers.</span></span>

<span data-ttu-id="30d0c-126">本教學課程逐步解說中將 ELMAH 加入至 ASP.NET 應用程式所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="30d0c-126">This tutorial walks through the steps involved in adding ELMAH to an ASP.NET application.</span></span> <span data-ttu-id="30d0c-127">讓我們開始吧 ！</span><span class="sxs-lookup"><span data-stu-id="30d0c-127">Let's get started!</span></span>

> [!NOTE]
> <span data-ttu-id="30d0c-128">健全狀況監視系統和 ELMAH 兩者都有它們自己集合的優缺點。</span><span class="sxs-lookup"><span data-stu-id="30d0c-128">The health monitoring system and ELMAH both have their own sets of pros and cons.</span></span> <span data-ttu-id="30d0c-129">建議您將再試一次這兩個系統，並決定哪一個最符合您的需求。</span><span class="sxs-lookup"><span data-stu-id="30d0c-129">I encourage you to try both systems and decide what one best suits your needs.</span></span>


## <a name="adding-elmah-to-an-aspnet-web-application"></a><span data-ttu-id="30d0c-130">加入 ASP.NET Web 應用程式中的 ELMAH</span><span class="sxs-lookup"><span data-stu-id="30d0c-130">Adding ELMAH to an ASP.NET Web Application</span></span>

<span data-ttu-id="30d0c-131">整合新的或現有的 ASP.NET 應用程式中的 ELMAH 是簡單且直接的程序，需要在五分鐘的時間。</span><span class="sxs-lookup"><span data-stu-id="30d0c-131">Integrating ELMAH into a new or existing ASP.NET application is an easy and straightforward process that takes under five minutes.</span></span> <span data-ttu-id="30d0c-132">簡單地說，它牽涉到四個簡單步驟：</span><span class="sxs-lookup"><span data-stu-id="30d0c-132">In a nutshell, it involves four simple steps:</span></span>

1. <span data-ttu-id="30d0c-133">下載 ELMAH 並加入`Elmah.dll`web 應用程式的組件</span><span class="sxs-lookup"><span data-stu-id="30d0c-133">Download ELMAH and add the `Elmah.dll` assembly to your web application,</span></span>
2. <span data-ttu-id="30d0c-134">註冊 ELMAH 的 HTTP 模組和處理常式中的`Web.config`，</span><span class="sxs-lookup"><span data-stu-id="30d0c-134">Register ELMAH's HTTP Modules and Handler in `Web.config`,</span></span>
3. <span data-ttu-id="30d0c-135">指定 ELMAH 的組態選項，並</span><span class="sxs-lookup"><span data-stu-id="30d0c-135">Specify ELMAH's configuration options, and</span></span>
4. <span data-ttu-id="30d0c-136">若有需要請建立錯誤記錄檔來源基礎結構。</span><span class="sxs-lookup"><span data-stu-id="30d0c-136">Create the error log source infrastructure, if needed.</span></span>

<span data-ttu-id="30d0c-137">讓我們逐步解說每一次下列四個步驟。</span><span class="sxs-lookup"><span data-stu-id="30d0c-137">Let's walk through each of these four steps, one at a time.</span></span>

### <a name="step-1-downloading-the-elmah-project-files-and-addingelmahdllto-your-web-application"></a><span data-ttu-id="30d0c-138">步驟 1： 下載 ELMAH 專案檔案，並加入`Elmah.dll`您 Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="30d0c-138">Step 1: Downloading the ELMAH Project Files and Adding`Elmah.dll`To Your Web Application</span></span>

<span data-ttu-id="30d0c-139">下載適用於本教學課程中隨附 ELMAH 1.0 BETA 3 (建置 10617)，在撰寫時，時間的最新版本。</span><span class="sxs-lookup"><span data-stu-id="30d0c-139">ELMAH 1.0 BETA 3 (Build 10617), the most recent version at the time of writing, is included in the download available with this tutorial.</span></span> <span data-ttu-id="30d0c-140">或者，您可能瀏覽[ELMAH 網站](https://code.google.com/p/elmah/)取得最新版本，或下載的原始程式碼。</span><span class="sxs-lookup"><span data-stu-id="30d0c-140">Alternatively, you may visit the [ELMAH website](https://code.google.com/p/elmah/) to get the most recent version or to download the source code.</span></span> <span data-ttu-id="30d0c-141">擷取 ELMAH 下載到您的桌面上的資料夾，並找出 ELMAH 組件檔案 (`Elmah.dll`)。</span><span class="sxs-lookup"><span data-stu-id="30d0c-141">Extract the ELMAH download to a folder on your desktop and locate the ELMAH assembly file (`Elmah.dll`).</span></span>

> [!NOTE]
> <span data-ttu-id="30d0c-142">`Elmah.dll`檔案位於下載`Bin`有不同的.NET Framework 版本和發行和偵錯組建的子資料夾的資料夾。</span><span class="sxs-lookup"><span data-stu-id="30d0c-142">The `Elmah.dll` file is located in the download's `Bin` folder, which has subfolders for different .NET Framework versions and for Release and Debug builds.</span></span> <span data-ttu-id="30d0c-143">使用 「 版本 」 組建之適當的 framework 版本。</span><span class="sxs-lookup"><span data-stu-id="30d0c-143">Use the Release build for the appropriate framework version.</span></span> <span data-ttu-id="30d0c-144">比方說，如果您要建置的 ASP.NET 3.5 web 應用程式，將複製`Elmah.dll`檔案從`Bin\net-3.5\Release`資料夾。</span><span class="sxs-lookup"><span data-stu-id="30d0c-144">For instance, if you are building an ASP.NET 3.5 web application, copy the `Elmah.dll` file from the `Bin\net-3.5\Release` folder.</span></span>


<span data-ttu-id="30d0c-145">接下來，開啟 Visual Studio，並將組件加入至專案，以滑鼠右鍵按一下方案總管 中選擇加入的參考，從內容功能表的網站名稱。</span><span class="sxs-lookup"><span data-stu-id="30d0c-145">Next, open Visual Studio and add the assembly to your project by right-clicking on the website name in the Solution Explorer and choosing Add Reference from the context menu.</span></span> <span data-ttu-id="30d0c-146">這會開啟 [加入參考] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="30d0c-146">This brings up the Add Reference dialog box.</span></span> <span data-ttu-id="30d0c-147">瀏覽至 瀏覽 索引標籤，然後選擇 `Elmah.dll`檔案。</span><span class="sxs-lookup"><span data-stu-id="30d0c-147">Navigate to the Browse tab and choose the `Elmah.dll` file.</span></span> <span data-ttu-id="30d0c-148">這個動作會將`Elmah.dll`web 應用程式檔案`Bin`資料夾。</span><span class="sxs-lookup"><span data-stu-id="30d0c-148">This action adds the `Elmah.dll` file to the web application's `Bin` folder.</span></span>

> [!NOTE]
> <span data-ttu-id="30d0c-149">Web 應用程式專案 (WAP) 型別不會顯示`Bin`在 [方案總管] 中的資料夾。</span><span class="sxs-lookup"><span data-stu-id="30d0c-149">The Web Application Project (WAP) type does not show the `Bin` folder in the Solution Explorer.</span></span> <span data-ttu-id="30d0c-150">相反地，它會列出這些項目參考 資料夾下。</span><span class="sxs-lookup"><span data-stu-id="30d0c-150">Instead, it lists these items under the References folder.</span></span>


<span data-ttu-id="30d0c-151">`Elmah.dll`該組件包含 ELMAH 系統所使用的類別。</span><span class="sxs-lookup"><span data-stu-id="30d0c-151">The `Elmah.dll` assembly includes the classes used by the ELMAH system.</span></span> <span data-ttu-id="30d0c-152">這些類別可分為三種類別：</span><span class="sxs-lookup"><span data-stu-id="30d0c-152">These classes fall into one of three categories:</span></span>

- <span data-ttu-id="30d0c-153">**HTTP 模組**-HTTP 模組是一個類別來定義事件處理常式`HttpApplication`事件，例如`Error`事件。</span><span class="sxs-lookup"><span data-stu-id="30d0c-153">**HTTP Modules** - an HTTP Module is a class that defines event handlers for `HttpApplication` events, such as the `Error` event.</span></span> <span data-ttu-id="30d0c-154">ELMAH 包含多個 HTTP 模組，三個最密切關聯的項目正在：</span><span class="sxs-lookup"><span data-stu-id="30d0c-154">ELMAH includes multiple HTTP Modules, the three most germane ones being:</span></span> 

    - <span data-ttu-id="30d0c-155">`ErrorLogModule` -記錄到記錄檔來源的未處理例外狀況。</span><span class="sxs-lookup"><span data-stu-id="30d0c-155">`ErrorLogModule` - logs unhandled exceptions to a log source.</span></span>
    - <span data-ttu-id="30d0c-156">`ErrorMailModule` -傳送電子郵件訊息中的未處理的例外狀況詳細資料。</span><span class="sxs-lookup"><span data-stu-id="30d0c-156">`ErrorMailModule` - sends the details of an unhandled exception in an email message.</span></span>
    - <span data-ttu-id="30d0c-157">`ErrorFilterModule` -適用於開發人員指定的篩選來判斷哪些例外狀況的記錄，以及是會被忽略。</span><span class="sxs-lookup"><span data-stu-id="30d0c-157">`ErrorFilterModule` - applies developer-specified filters to determine what exceptions are logged and what ones are ignored.</span></span>
- <span data-ttu-id="30d0c-158">**HTTP 處理常式**-HTTP 處理常式是負責產生要求的特定類型的標記的類別。</span><span class="sxs-lookup"><span data-stu-id="30d0c-158">**HTTP Handlers** - an HTTP Handler is a class that is responsible for generating the markup for a particular type of request.</span></span> <span data-ttu-id="30d0c-159">ELMAH 包括網頁上、 RSS 摘要，或以逗號分隔的檔案 (CSV) 轉譯錯誤的詳細資料的 HTTP 處理常式。</span><span class="sxs-lookup"><span data-stu-id="30d0c-159">ELMAH includes HTTP Handlers that render error details as a web page, as an RSS feed, or as a comma-delimited file (CSV).</span></span>
- <span data-ttu-id="30d0c-160">**錯誤記錄檔來源**-ELMAH 可以將 Microsoft SQL Server 資料庫，到 Microsoft Access 資料庫，Oracle 資料庫，要的記憶體，錯誤記錄到現成 SQLite 資料庫中，或 Vista DB 資料庫的 XML 檔案。</span><span class="sxs-lookup"><span data-stu-id="30d0c-160">**Error Log Sources** - out of the box ELMAH can log errors to memory, to a Microsoft SQL Server database, to a Microsoft Access database, to an Oracle database, to an XML file, to a SQLite database, or to a Vista DB database.</span></span> <span data-ttu-id="30d0c-161">監視系統健全狀況，例如 ELMAH 的架構是使用提供者模型，這表示您可以用來建立，並密切整合您自己自訂的記錄檔來源提供者中，視所建立的。</span><span class="sxs-lookup"><span data-stu-id="30d0c-161">Like the health monitoring system, ELMAH's architecture was built using the provider model, meaning that you can create and seamlessly integrate your own custom log source providers, if needed.</span></span>

### <a name="step-2-registering-elmahs-http-module-and-handler"></a><span data-ttu-id="30d0c-162">步驟 2： 註冊 ELMAH 的 HTTP 模組和處理常式</span><span class="sxs-lookup"><span data-stu-id="30d0c-162">Step 2: Registering ELMAH's HTTP Module and Handler</span></span>

<span data-ttu-id="30d0c-163">雖然`Elmah.dll`檔包含 HTTP 模組和處理常式需要自動記錄未處理的例外狀況，並顯示從網頁上的錯誤詳細資料，這些必須先明確註冊 web 應用程式的組態中。</span><span class="sxs-lookup"><span data-stu-id="30d0c-163">While the `Elmah.dll` file contains the HTTP Modules and Handler needed to automatically log unhandled exceptions and to display error details from a web page, these must be explicitly registered in the web application's configuration.</span></span> <span data-ttu-id="30d0c-164">`ErrorLogModule` HTTP 模組，一旦註冊之後，訂閱`HttpApplication`的`Error`事件。</span><span class="sxs-lookup"><span data-stu-id="30d0c-164">The `ErrorLogModule` HTTP Module, once registered, subscribes to the `HttpApplication`'s `Error` event.</span></span> <span data-ttu-id="30d0c-165">每當會引發這個事件`ErrorLogModule`例外狀況的詳細資訊記錄到指定的記錄檔來源。</span><span class="sxs-lookup"><span data-stu-id="30d0c-165">Whenever this event is raised the `ErrorLogModule` logs the details of the exception to a specified log source.</span></span> <span data-ttu-id="30d0c-166">我們會看到如何在下一節中定義的記錄檔來源提供者 」"設定 ELMAH。</span><span class="sxs-lookup"><span data-stu-id="30d0c-166">We'll see how to define the log source provider in the next section, "Configuring ELMAH."</span></span> <span data-ttu-id="30d0c-167">`ErrorLogPageFactory` HTTP 處理常式 factory 會負責檢視錯誤記錄檔從網頁時，產生標記。</span><span class="sxs-lookup"><span data-stu-id="30d0c-167">The `ErrorLogPageFactory` HTTP Handler factory is responsible for generating the markup when viewing the error log from a web page.</span></span>

<span data-ttu-id="30d0c-168">HTTP 模組和處理常式註冊的特定語法取決於正在強化功能的站台的網頁伺服器。</span><span class="sxs-lookup"><span data-stu-id="30d0c-168">The specific syntax for registering HTTP Modules and Handlers depends upon the web server that is powering the site.</span></span> <span data-ttu-id="30d0c-169">ASP.NET 程式開發伺服器和 Microsoft 的 iis 6.0 或更早版本，HTTP 模組和處理常式會在註冊`<httpModules>`和`<httpHandlers>`區段出現在`<system.web>`項目。</span><span class="sxs-lookup"><span data-stu-id="30d0c-169">For the ASP.NET Development Server and Microsoft's IIS version 6.0 and earlier, HTTP Modules and Handlers are registered in the `<httpModules>` and `<httpHandlers>` sections, which appear within the `<system.web>` element.</span></span> <span data-ttu-id="30d0c-170">如果您使用的 IIS 7.0，則他們需要登記在`<system.webServer>`項目的`<modules>`和`<handlers>`區段。</span><span class="sxs-lookup"><span data-stu-id="30d0c-170">If you are using IIS 7.0 then they need to be registered in the `<system.webServer>` element's `<modules>` and `<handlers>` sections.</span></span> <span data-ttu-id="30d0c-171">幸運的是，您可以在其中定義的 HTTP 模組和處理常式中的*兩者*放置不論所使用的 web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="30d0c-171">Fortunately, you can define the HTTP Modules and Handlers in *both* places regardless of the web server being used.</span></span> <span data-ttu-id="30d0c-172">這個選項就是大部分可攜式因為它可讓相同的設定，以用於開發和生產環境，不論所使用的 web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="30d0c-172">This option is the most portable one as it allows the same configuration to be used in the development and production environments regardless of the web server being used.</span></span>

<span data-ttu-id="30d0c-173">註冊啟動`ErrorLogModule`HTTP 模組和`ErrorLogPageFactory`HTTP 處理常式中`<httpModules>`和`<httpHandlers>`一節中`<system.web>`。</span><span class="sxs-lookup"><span data-stu-id="30d0c-173">Start by registering the `ErrorLogModule` HTTP Module and the `ErrorLogPageFactory` HTTP Handler in the `<httpModules>` and `<httpHandlers>` section in `<system.web>`.</span></span> <span data-ttu-id="30d0c-174">如果您的組態已定義這兩個元素然後只包含`<add>`ELMAH 的 HTTP 模組和處理常式項目。</span><span class="sxs-lookup"><span data-stu-id="30d0c-174">If your configuration already defines these two elements then simply include the `<add>` element for ELMAH's HTTP Module and Handler.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample1.xml)]

<span data-ttu-id="30d0c-175">接下來，註冊 ELMAH 的 HTTP 模組和處理常式中的`<system.webServer>`項目。</span><span class="sxs-lookup"><span data-stu-id="30d0c-175">Next, register ELMAH's HTTP Module and Handler in the `<system.webServer>` element.</span></span> <span data-ttu-id="30d0c-176">如往常一般，如有此項目已不存在於您的組態加入它。</span><span class="sxs-lookup"><span data-stu-id="30d0c-176">As before, if this element is not already present in your configuration then add it.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample2.xml)]

<span data-ttu-id="30d0c-177">根據預設，IIS 7 抱怨 HTTP 模組和處理常式會在註冊`<system.web>`> 一節。</span><span class="sxs-lookup"><span data-stu-id="30d0c-177">By default, IIS 7 complains if HTTP Modules and Handlers are registered in the `<system.web>` section.</span></span> <span data-ttu-id="30d0c-178">`validateIntegratedModeConfiguration`屬性`<validation>`項目指示 IIS 7，以隱藏這類的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="30d0c-178">The `validateIntegratedModeConfiguration` attribute in the `<validation>` element instructs IIS 7 to suppress such error messages.</span></span>

<span data-ttu-id="30d0c-179">請注意，註冊語法`ErrorLogPageFactory`HTTP 處理常式包括`path`屬性設定為`elmah.axd`。</span><span class="sxs-lookup"><span data-stu-id="30d0c-179">Note that the syntax for registering the `ErrorLogPageFactory` HTTP Handler includes a `path` attribute, which is set to `elmah.axd`.</span></span> <span data-ttu-id="30d0c-180">這個屬性會通知 web 應用程式，如果要求到達名為的頁面`elmah.axd`則要求應該由`ErrorLogPageFactory`HTTP 處理常式。</span><span class="sxs-lookup"><span data-stu-id="30d0c-180">This attribute informs the web application that if a request arrives for a page named `elmah.axd` then the request should be processed by the `ErrorLogPageFactory` HTTP Handler.</span></span> <span data-ttu-id="30d0c-181">我們會看到`ErrorLogPageFactory`動作稍後在本教學課程中的 HTTP 處理常式。</span><span class="sxs-lookup"><span data-stu-id="30d0c-181">We'll see the `ErrorLogPageFactory` HTTP Handler in action later in this tutorial.</span></span>

### <a name="step-3-configuring-elmah"></a><span data-ttu-id="30d0c-182">步驟 3： 設定 ELMAH</span><span class="sxs-lookup"><span data-stu-id="30d0c-182">Step 3: Configuring ELMAH</span></span>

<span data-ttu-id="30d0c-183">會尋找其網站中的組態選項的 ELMAH`Web.config`名為的自訂組態區段中的檔案`<elmah>`。</span><span class="sxs-lookup"><span data-stu-id="30d0c-183">ELMAH looks for its configuration options in the website's `Web.config` file in a custom configuration section named `<elmah>`.</span></span> <span data-ttu-id="30d0c-184">若要使用的自訂區段`Web.config`必須先將定義在`<configSections>`項目。</span><span class="sxs-lookup"><span data-stu-id="30d0c-184">In order to use a custom section in `Web.config` it must first be defined in the `<configSections>` element.</span></span> <span data-ttu-id="30d0c-185">開啟`Web.config`檔案，然後加入下列標記以`<configSections>`:</span><span class="sxs-lookup"><span data-stu-id="30d0c-185">Open the `Web.config` file and add the following markup to the `<configSections>`:</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample3.xml)]

> [!NOTE]
> <span data-ttu-id="30d0c-186">如果您要設定 ELMAH ASP.NET 1.x 應用程式，則移除`requirePermission="false"`屬性從`<section>`上述項目。</span><span class="sxs-lookup"><span data-stu-id="30d0c-186">If you are configuring ELMAH for an ASP.NET 1.x application then remove the `requirePermission="false"` attribute from the `<section>` elements above.</span></span>


<span data-ttu-id="30d0c-187">上述語法註冊自訂`<elmah>`區段，其各小節： `<security>`， `<errorLog>`， `<errorMail>`，和`<errorFilter>`。</span><span class="sxs-lookup"><span data-stu-id="30d0c-187">The above syntax registers the custom `<elmah>` section and its subsections: `<security>`, `<errorLog>`, `<errorMail>`, and `<errorFilter>`.</span></span>

<span data-ttu-id="30d0c-188">接下來，加入`<elmah>`區段`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="30d0c-188">Next, add the `<elmah>` section to `Web.config`.</span></span> <span data-ttu-id="30d0c-189">本章節應該出現在相同的層級`<system.web>`項目。</span><span class="sxs-lookup"><span data-stu-id="30d0c-189">This section should appear at the same level as the `<system.web>` element.</span></span> <span data-ttu-id="30d0c-190">內部`<elmah>`> 一節新增`<security>`和`<errorLog>`區段如下所示：</span><span class="sxs-lookup"><span data-stu-id="30d0c-190">Inside the `<elmah>` section add the `<security>` and `<errorLog>` sections like so:</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample4.xml)]

<span data-ttu-id="30d0c-191">`<security>`區段的`allowRemoteAccess`屬性會指出是否允許遠端存取。</span><span class="sxs-lookup"><span data-stu-id="30d0c-191">The `<security>` section's `allowRemoteAccess` attribute indicates whether remote access is allowed.</span></span> <span data-ttu-id="30d0c-192">如果此值設定為 0，然後錯誤記錄檔網頁只能檢視在本機。</span><span class="sxs-lookup"><span data-stu-id="30d0c-192">If this value is set to 0, then the error log web page can only be viewed locally.</span></span> <span data-ttu-id="30d0c-193">如果這個屬性設定為 1 錯誤記錄檔的 web 網頁會啟用遠端和本機訪客。</span><span class="sxs-lookup"><span data-stu-id="30d0c-193">If this attribute is set to 1 then the error log web page is enabled for both remote and local visitors.</span></span> <span data-ttu-id="30d0c-194">現在，讓我們來停用錯誤記錄檔網頁遠端訪客。</span><span class="sxs-lookup"><span data-stu-id="30d0c-194">For now, let's disable the error log web page for remote visitors.</span></span> <span data-ttu-id="30d0c-195">稍後我們有機會討論這樣做的安全性考量之後，我們會允許遠端存取。</span><span class="sxs-lookup"><span data-stu-id="30d0c-195">We'll allow remote access later after we have an opportunity to discuss the security concerns of doing so.</span></span>

<span data-ttu-id="30d0c-196">`<errorLog>`區段會定義錯誤記錄檔來源，其中會記錄錯誤的詳細資料，類似於哪一個指定`<providers>`監視系統健全狀況 > 一節。</span><span class="sxs-lookup"><span data-stu-id="30d0c-196">The `<errorLog>` section defines the error log source, which dictates where the error details are recorded; it is similar to the `<providers>` section in the health monitoring system.</span></span> <span data-ttu-id="30d0c-197">上述語法指定`SqlErrorLog`類別做為將錯誤記錄到 Microsoft SQL Server 資料庫所指定錯誤記錄檔來源`connectionStringName`屬性值。</span><span class="sxs-lookup"><span data-stu-id="30d0c-197">The above syntax specifies the `SqlErrorLog` class as the error log source, which logs the errors to a Microsoft SQL Server database specified by the `connectionStringName` attribute value.</span></span>

> [!NOTE]
> <span data-ttu-id="30d0c-198">ELMAH 隨附其他錯誤記錄檔提供者可將錯誤記錄到 XML 檔案、 Microsoft Access 資料庫、 Oracle 資料庫和其他資料存放區。</span><span class="sxs-lookup"><span data-stu-id="30d0c-198">ELMAH ships with additional error log providers that can be used to log errors to an XML file, a Microsoft Access database, an Oracle database, and other data stores.</span></span> <span data-ttu-id="30d0c-199">請參閱範例`Web.config`會包含有關如何使用這些替代錯誤記錄檔提供者的 ELMAH 下載的檔案。</span><span class="sxs-lookup"><span data-stu-id="30d0c-199">Refer to the sample `Web.config` file that is included with the ELMAH download for information on how to use these alternate error log providers.</span></span>


### <a name="step-4-creating-the-error-log-source-infrastructure"></a><span data-ttu-id="30d0c-200">步驟 4： 建立錯誤記錄檔來源基礎結構</span><span class="sxs-lookup"><span data-stu-id="30d0c-200">Step 4: Creating the Error Log Source Infrastructure</span></span>

<span data-ttu-id="30d0c-201">ELMAH 的`SqlErrorLog`提供者記錄到指定的 Microsoft SQL Server 資料庫的錯誤詳細資料。</span><span class="sxs-lookup"><span data-stu-id="30d0c-201">ELMAH's `SqlErrorLog` provider logs error details to a specified Microsoft SQL Server database.</span></span> <span data-ttu-id="30d0c-202">`SqlErrorLog`提供者必須要有這個資料庫有一個名為資料表`ELMAH_Error`和三個預存程序： `ELMAH_GetErrorsXml`， `ELMAH_GetErrorXml`，和`ELMAH_LogError`。</span><span class="sxs-lookup"><span data-stu-id="30d0c-202">The `SqlErrorLog` provider expects this database to have a table named `ELMAH_Error` and three stored procedures: `ELMAH_GetErrorsXml`, `ELMAH_GetErrorXml`, and `ELMAH_LogError`.</span></span> <span data-ttu-id="30d0c-203">ELMAH 下載包含名為`SQLServer.sql`中`db`資料夾，其中包含用於建立這個資料表，而且這些 T-SQL 預存程序。</span><span class="sxs-lookup"><span data-stu-id="30d0c-203">The ELMAH download includes a file named `SQLServer.sql` in the `db` folder that contains the T-SQL for creating this table and these stored procedures.</span></span> <span data-ttu-id="30d0c-204">您必須在您要使用的資料庫上執行這些陳述式`SqlErrorLog`提供者。</span><span class="sxs-lookup"><span data-stu-id="30d0c-204">You'll need to run these statements on your database to use the `SqlErrorLog` provider.</span></span>

<span data-ttu-id="30d0c-205">**數字 1**和**2** Visual Studio 中的 [資料庫總管] 中顯示所需的資料庫物件之後`SqlErrorLog`已加入提供者。</span><span class="sxs-lookup"><span data-stu-id="30d0c-205">**Figures 1** and **2** show the Database Explorer in Visual Studio after the database objects needed by the `SqlErrorLog` provider have been added.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image2.png)](logging-error-details-with-elmah-cs/_static/image1.png)

<span data-ttu-id="30d0c-206">**圖 1**:`SqlErrorLog`提供者會記錄錯誤`ELMAH_Error`資料表</span><span class="sxs-lookup"><span data-stu-id="30d0c-206">**Figure 1**: The `SqlErrorLog` Provider Logs Errors to the `ELMAH_Error` Table</span></span>

[![](logging-error-details-with-elmah-cs/_static/image4.png)](logging-error-details-with-elmah-cs/_static/image3.png)

<span data-ttu-id="30d0c-207">**圖 2**:`SqlErrorLog`提供者會使用三個預存程序</span><span class="sxs-lookup"><span data-stu-id="30d0c-207">**Figure 2**: The `SqlErrorLog` Provider Uses Three Stored Procedures</span></span>

## <a name="elmah-in-action"></a><span data-ttu-id="30d0c-208">在動作中的 ELMAH</span><span class="sxs-lookup"><span data-stu-id="30d0c-208">ELMAH In Action</span></span>

<span data-ttu-id="30d0c-209">此時我們新增了 ELMAH web 應用程式、 註冊`ErrorLogModule`HTTP 模組和`ErrorLogPageFactory`HTTP 處理常式中，指定中的 ELMAH 的設定選項`Web.config`，並加入所需的資料庫物件`SqlErrorLog`錯誤記錄檔提供者。</span><span class="sxs-lookup"><span data-stu-id="30d0c-209">At this point we have added ELMAH to the web application, registered the `ErrorLogModule` HTTP Module and the `ErrorLogPageFactory` HTTP Handler, specified ELMAH's configuration options in `Web.config`, and added the needed database objects for the `SqlErrorLog` error log provider.</span></span> <span data-ttu-id="30d0c-210">我們現在已準備好在動作中看到 ELMAH ！</span><span class="sxs-lookup"><span data-stu-id="30d0c-210">We are now ready to see ELMAH in action!</span></span> <span data-ttu-id="30d0c-211">瀏覽書籍檢閱網站，瀏覽的頁面，會產生執行階段錯誤，例如`Genre.aspx?ID=foo`，或不存在的頁面，例如`NoSuchPage.aspx`。</span><span class="sxs-lookup"><span data-stu-id="30d0c-211">Visit the Book Reviews website and visit a page that generates a runtime error, such as `Genre.aspx?ID=foo`, or a non-existent page, such as `NoSuchPage.aspx`.</span></span> <span data-ttu-id="30d0c-212">瀏覽這些網頁時看到的內容取決於`<customErrors>`組態和您所造訪在本機或遠端。</span><span class="sxs-lookup"><span data-stu-id="30d0c-212">What you see when visiting these pages depends on the `<customErrors>` configuration and whether you're visiting locally or remotely.</span></span> <span data-ttu-id="30d0c-213">(會回頭[*顯示自訂錯誤網頁*教學課程](displaying-a-custom-error-page-cs.md)如本主題的重新整理程式。)</span><span class="sxs-lookup"><span data-stu-id="30d0c-213">(Refer back to the [*Displaying a Custom Error Page* tutorial](displaying-a-custom-error-page-cs.md) for a refresher on this topic.)</span></span>

<span data-ttu-id="30d0c-214">ELMAH 並不會影響哪些內容顯示給使用者時就會發生未處理的例外狀況。它只會記錄其詳細資料。</span><span class="sxs-lookup"><span data-stu-id="30d0c-214">ELMAH doesn't affect what content is shown to the user when an unhandled exception occurs; it just logs its details.</span></span> <span data-ttu-id="30d0c-215">此錯誤記錄檔是可從網站上`elmah.axd`根目錄中的網站，例如`http://localhost/BookReviews/elmah.axd`。</span><span class="sxs-lookup"><span data-stu-id="30d0c-215">This error log is accessible from the web page `elmah.axd` from the root of your website, such as `http://localhost/BookReviews/elmah.axd`.</span></span> <span data-ttu-id="30d0c-216">(這個檔案不實際存在您的專案，但當要求進入的`elmah.axd`執行階段會將它分派至`ErrorLogPageFactory`HTTP 處理常式，會產生傳回給瀏覽器的標記。)</span><span class="sxs-lookup"><span data-stu-id="30d0c-216">(This file does not physically exist in your project, but when a request comes in for `elmah.axd` the runtime dispatches it to the `ErrorLogPageFactory` HTTP Handler, which generates the markup sent back to the browser.)</span></span>

> [!NOTE]
> <span data-ttu-id="30d0c-217">您也可以使用`elmah.axd`頁面，即可指示 ELMAH 產生測試錯誤。</span><span class="sxs-lookup"><span data-stu-id="30d0c-217">You can also use the `elmah.axd` page to instruct ELMAH to generate a test error.</span></span> <span data-ttu-id="30d0c-218">瀏覽`elmah.axd/test`(像是`http://localhost/BookReviews/elmah.axd/test`) 會導致擲回例外狀況類型的 ELMAH `Elmah.TestException`，後者有錯誤訊息: 「 這個 」 可以放心略過的測試例外狀況。</span><span class="sxs-lookup"><span data-stu-id="30d0c-218">Visiting `elmah.axd/test` (as in, `http://localhost/BookReviews/elmah.axd/test`) causes ELMAH to throw an exception of type `Elmah.TestException`, which has the error message: " This is a test exception that can be safely ignored."</span></span>


<span data-ttu-id="30d0c-219">**圖 3**瀏覽時顯示錯誤記錄檔`elmah.axd`從開發環境。</span><span class="sxs-lookup"><span data-stu-id="30d0c-219">**Figure 3** shows the error log when visiting `elmah.axd` from the development environment.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image6.png)](logging-error-details-with-elmah-cs/_static/image5.png)

<span data-ttu-id="30d0c-220">**圖 3**:`Elmah.axd`從網頁上顯示的錯誤</span><span class="sxs-lookup"><span data-stu-id="30d0c-220">**Figure 3**: `Elmah.axd` Displays the Error Log from a Web Page</span></span>  
<span data-ttu-id="30d0c-221">([按一下以檢視完整大小的影像](logging-error-details-with-elmah-cs/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="30d0c-221">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image7.png))</span></span>

<span data-ttu-id="30d0c-222">錯誤記錄檔**圖 3**包含六個錯誤項目。</span><span class="sxs-lookup"><span data-stu-id="30d0c-222">The error log in **Figure 3** contains six error entries.</span></span> <span data-ttu-id="30d0c-223">每個項目包括 HTTP 狀態碼 （404 或 500，這些錯誤）、 類型、 描述、 發生錯誤時，登入的使用者名稱和的日期和時間。</span><span class="sxs-lookup"><span data-stu-id="30d0c-223">Each entry includes the HTTP status code (404 or 500, for these errors), the type, the description, the name of the logged on user when the error occurred, and the date and time.</span></span> <span data-ttu-id="30d0c-224">按一下 [詳細資料] 連結會顯示一個網頁，內含錯誤詳細資料黃色螢幕的死所示相同的錯誤訊息 (請參閱**圖 4**) 以及在發生錯誤時的伺服器變數的值 (請參閱**圖 5**)。</span><span class="sxs-lookup"><span data-stu-id="30d0c-224">Clicking the Details link displays a page that includes the same error message shown in the Error Details Yellow Screen of Death (see **Figure 4**) along with the values of the server variables at the time of the error (see **Figure 5**).</span></span> <span data-ttu-id="30d0c-225">您也可以檢視在其中儲存錯誤詳細資料，其中包含 HTTP POST 標頭中的其他資訊，例如值的原始 XML。</span><span class="sxs-lookup"><span data-stu-id="30d0c-225">You can also view the raw XML in which the error details are saved, which includes additional information such as the values in the HTTP POST header.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image9.png)](logging-error-details-with-elmah-cs/_static/image8.png)

<span data-ttu-id="30d0c-226">**圖 4**： 檢視錯誤詳細資料 YSOD</span><span class="sxs-lookup"><span data-stu-id="30d0c-226">**Figure 4**: View the Error Details YSOD</span></span>  
<span data-ttu-id="30d0c-227">([按一下以檢視完整大小的影像](logging-error-details-with-elmah-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="30d0c-227">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image10.png))</span></span>

[![](logging-error-details-with-elmah-cs/_static/image12.png)](logging-error-details-with-elmah-cs/_static/image11.png)

<span data-ttu-id="30d0c-228">**圖 5**： 瀏覽伺服器變數集合，在發生錯誤時的值</span><span class="sxs-lookup"><span data-stu-id="30d0c-228">**Figure 5**: Explore the Values of the Server Variables Collection at the Time of the Error</span></span>  
<span data-ttu-id="30d0c-229">([按一下以檢視完整大小的影像](logging-error-details-with-elmah-cs/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="30d0c-229">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image13.png))</span></span>

<span data-ttu-id="30d0c-230">部署至生產環境網站的 ELMAH 牽涉到：</span><span class="sxs-lookup"><span data-stu-id="30d0c-230">Deploying ELMAH to the production website entails:</span></span>

- <span data-ttu-id="30d0c-231">複製`Elmah.dll`檔案`Bin`上生產環境中，資料夾</span><span class="sxs-lookup"><span data-stu-id="30d0c-231">Copying the `Elmah.dll` file to the `Bin` folder on production,</span></span>
- <span data-ttu-id="30d0c-232">複製 ELMAH 特定組態設定來`Web.config`用在生產環境中，檔案和</span><span class="sxs-lookup"><span data-stu-id="30d0c-232">Copying the ELMAH-specific configuration settings to the `Web.config` file used on production, and</span></span>
- <span data-ttu-id="30d0c-233">將錯誤記錄檔來源基礎結構加入至實際執行資料庫。</span><span class="sxs-lookup"><span data-stu-id="30d0c-233">Adding the error log source infrastructure to the production database.</span></span>

<span data-ttu-id="30d0c-234">我們已瀏覽檔案複製到生產環境中先前的教學課程開發的技術。</span><span class="sxs-lookup"><span data-stu-id="30d0c-234">We've explored techniques for copying files from development to production in previous tutorials.</span></span> <span data-ttu-id="30d0c-235">可能是在生產資料庫上取得錯誤記錄檔來源基礎結構最簡單方式是使用 SQL Server Management Studio 連接到實際執行資料庫，然後執行`SqlServer.sql`指令碼檔案，它會建立所需的資料表，並儲存程序。</span><span class="sxs-lookup"><span data-stu-id="30d0c-235">Perhaps the easiest way to get the error log source infrastructure on the production database is to use SQL Server Management Studio to connect to the production database and then execute the `SqlServer.sql` script file, which will create the needed table and stored procedures.</span></span>

### <a name="viewing-the-error-details-page-on-production"></a><span data-ttu-id="30d0c-236">在生產環境中檢視錯誤詳細資料頁面</span><span class="sxs-lookup"><span data-stu-id="30d0c-236">Viewing the Error Details Page on Production</span></span>

<span data-ttu-id="30d0c-237">之後將您的網站部署至生產環境，請前往生產網站並產生未處理的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="30d0c-237">After deploying your site to production, visit the production website and generate an unhandled exception.</span></span> <span data-ttu-id="30d0c-238">開發環境中，如同 ELMAH 會有任何作用時，發生未處理的例外狀況，顯示錯誤頁面相反地，則只會記錄錯誤。</span><span class="sxs-lookup"><span data-stu-id="30d0c-238">As in the development environment, ELMAH has no affect on the error page displayed when an unhandled exception occurs; instead, it merely logs the error.</span></span> <span data-ttu-id="30d0c-239">如果您嘗試瀏覽錯誤記錄頁面 (`elmah.axd`) 從生產環境中，您將氣急敗壞 [禁止] 頁面中顯示與**圖 6**。</span><span class="sxs-lookup"><span data-stu-id="30d0c-239">If you attempt to visit the error log page (`elmah.axd`) from the production environment, you will be greeted with the Forbidden page shown in **Figure 6**.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image15.png)](logging-error-details-with-elmah-cs/_static/image14.png)

<span data-ttu-id="30d0c-240">**圖 6**： 根據預設，遠端的訪客無法檢視錯誤記錄檔的 Web 網頁</span><span class="sxs-lookup"><span data-stu-id="30d0c-240">**Figure 6**: By Default, Remote Visitors Cannot View the Error Log Web Page</span></span>  
<span data-ttu-id="30d0c-241">([按一下以檢視完整大小的影像](logging-error-details-with-elmah-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="30d0c-241">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image16.png))</span></span>

<span data-ttu-id="30d0c-242">請記得，ELMAH 組態中`<security>`> 一節中，我們設定`allowRemoteAccess`屬性設定為 0，檢視錯誤記錄檔時，防止遠端使用者。</span><span class="sxs-lookup"><span data-stu-id="30d0c-242">Recall that in the ELMAH configuration's `<security>` section we set the `allowRemoteAccess` attribute to 0, which prohibits remote users from viewing the error log.</span></span> <span data-ttu-id="30d0c-243">請務必禁止匿名訪客檢視錯誤記錄檔，因為安全性弱點或其他機密資訊，可能會顯示錯誤詳細資料。</span><span class="sxs-lookup"><span data-stu-id="30d0c-243">It's important to prohibit anonymous visitors from viewing the error log, as the error details might reveal security vulnerabilities or other sensitive information.</span></span> <span data-ttu-id="30d0c-244">如果您決定要將這個屬性設定為 1，並啟用遠端存取錯誤記錄檔，則務必要鎖定`elmah.axd`路徑，因此只有授權的訪客具有存取權限。</span><span class="sxs-lookup"><span data-stu-id="30d0c-244">If you decide to set this attribute to 1 and enable remote access to the error log then it is important to lock down the `elmah.axd` path so that only authorized visitors can access it.</span></span> <span data-ttu-id="30d0c-245">這可藉由新增`<location>`元素`Web.config`檔案。</span><span class="sxs-lookup"><span data-stu-id="30d0c-245">This can be achieved by adding a `<location>` element to the `Web.config` file.</span></span>

<span data-ttu-id="30d0c-246">下列組態會允許系統管理員角色，來存取錯誤記錄檔網頁中只有使用者：</span><span class="sxs-lookup"><span data-stu-id="30d0c-246">The following configuration permits only users in the Admin role to access the error log web page:</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample5.xml)]

> [!NOTE]
> <span data-ttu-id="30d0c-247">中已加入系統管理員角色和三個使用者在系統中，Scott、 Jisun 和 Alice- [*設定網站，會使用應用程式服務*教學課程](configuring-a-website-that-uses-application-services-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="30d0c-247">The Admin role and the three users in the system - Scott, Jisun, and Alice - were added in the [*Configuring a Website That Uses Application Services* tutorial](configuring-a-website-that-uses-application-services-cs.md).</span></span> <span data-ttu-id="30d0c-248">使用者 Scott 和 Jisun 是 「 管理員 」 角色的成員。</span><span class="sxs-lookup"><span data-stu-id="30d0c-248">Users Scott and Jisun are members of the Admin role.</span></span> <span data-ttu-id="30d0c-249">如需有關驗證和授權的詳細資訊，請參閱我[網站安全性教學課程](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="30d0c-249">For more information on authentication and authorization, refer to my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>


<span data-ttu-id="30d0c-250">遠端使用者; 現在可以檢視錯誤記錄檔，在實際執行環境回頭參考**數字 3**， **4**，和**5**的錯誤記錄檔網頁的螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="30d0c-250">The error log on the production environment can now be viewed by remote users; refer back to **Figures 3**, **4**, and **5** for screen shots of the error log web page.</span></span> <span data-ttu-id="30d0c-251">不過，如果匿名或非系統管理員的使用者嘗試檢視 [錯誤記錄] 頁面會會自動重新導向至登入頁面 (`Login.aspx`)，做為**圖 7**顯示。</span><span class="sxs-lookup"><span data-stu-id="30d0c-251">However, if an anonymous or non-Admin user attempts to view the error log page they are automatically redirected to the login page (`Login.aspx`), as **Figure 7** shows.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image18.png)](logging-error-details-with-elmah-cs/_static/image17.png)

<span data-ttu-id="30d0c-252">**圖 7**： 未經授權的使用者會自動重新導向至登入頁面</span><span class="sxs-lookup"><span data-stu-id="30d0c-252">**Figure 7**: Unauthorized Users are Automatically Redirected to the Login Page</span></span>  
<span data-ttu-id="30d0c-253">([按一下以檢視完整大小的影像](logging-error-details-with-elmah-cs/_static/image19.png))</span><span class="sxs-lookup"><span data-stu-id="30d0c-253">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image19.png))</span></span>

### <a name="programmatically-logging-errors"></a><span data-ttu-id="30d0c-254">以程式設計方式記錄錯誤</span><span class="sxs-lookup"><span data-stu-id="30d0c-254">Programmatically Logging Errors</span></span>

<span data-ttu-id="30d0c-255">ELMAH 的`ErrorLogModule`HTTP 模組自動記錄未處理例外狀況指定的記錄檔來源。</span><span class="sxs-lookup"><span data-stu-id="30d0c-255">ELMAH's `ErrorLogModule` HTTP Module automatically logs unhandled exceptions to the specified log source.</span></span> <span data-ttu-id="30d0c-256">或者，您可以記錄錯誤，而不必使用引發未處理例外狀況`ErrorSignal`類別和其`Raise`方法。</span><span class="sxs-lookup"><span data-stu-id="30d0c-256">Alternatively, you can log an error without having to raise an unhandled exception by using the `ErrorSignal` class and its `Raise` method.</span></span> <span data-ttu-id="30d0c-257">`Raise`方法傳遞`Exception`物件，並已擲回該例外狀況，並已達 ASP.NET 執行階段，而不處理加以記錄。</span><span class="sxs-lookup"><span data-stu-id="30d0c-257">The `Raise` method is passed an `Exception` object and logs it as if that exception had been thrown and had reached the ASP.NET runtime without being handled.</span></span> <span data-ttu-id="30d0c-258">差異，不過，會要求會繼續執行正常之後`Raise`已呼叫方法，而擲回、 未處理的例外狀況中斷要求的正常執行，並讓 ASP.NET 執行階段顯示設定錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="30d0c-258">The difference, however, is that the request continues executing normally after the `Raise` method has been called, whereas a thrown, unhandled exception interrupts the request's normal execution and causes the ASP.NET runtime to display the configured error page.</span></span>

<span data-ttu-id="30d0c-259">`ErrorSignal`類別會在沒有可能會失敗，某些動作，但其失敗不是重大的整體的作業正在執行的情況下很有用。</span><span class="sxs-lookup"><span data-stu-id="30d0c-259">The `ErrorSignal` class is useful in situations where there is some action that may fail, but its failure is not catastrophic to the overall operation being performed.</span></span> <span data-ttu-id="30d0c-260">例如，網站可能包含一個表單，會接受使用者輸入，將它儲存在資料庫中，然後將使用者傳送一封電子郵件通知他們確定它們已處理的資訊。</span><span class="sxs-lookup"><span data-stu-id="30d0c-260">For instance, a website may contain a form that takes the user's input, stores it in a database, and then sends the user an email informing them that they information was processed.</span></span> <span data-ttu-id="30d0c-261">如果成功，資訊儲存到資料庫，但出現錯誤時傳送電子郵件訊息時要採取的動作？</span><span class="sxs-lookup"><span data-stu-id="30d0c-261">What should happen if the information is saved to the database successfully, but there is an error when sending the email message?</span></span> <span data-ttu-id="30d0c-262">其中一個選項，可擲回例外狀況，並傳送給使用者，對錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="30d0c-262">One option would be to throw an exception and send the user to the error page.</span></span> <span data-ttu-id="30d0c-263">不過，這可能會混淆使用者到他們所輸入的資訊未儲存的想法。</span><span class="sxs-lookup"><span data-stu-id="30d0c-263">However, this might confuse the user into thinking that the information they entered was not saved.</span></span> <span data-ttu-id="30d0c-264">另一種方法就是記錄電子郵件相關的錯誤，但不是能更改任何方式中的使用者經驗。</span><span class="sxs-lookup"><span data-stu-id="30d0c-264">Another approach would be to log the email-related error, but not alter the user's experience in any way.</span></span> <span data-ttu-id="30d0c-265">這是 where`ErrorSignal`類別就很有用。</span><span class="sxs-lookup"><span data-stu-id="30d0c-265">This is where the `ErrorSignal` class is useful.</span></span>

[!code-csharp[Main](logging-error-details-with-elmah-cs/samples/sample6.cs)]

## <a name="error-notification-via-email"></a><span data-ttu-id="30d0c-266">透過電子郵件錯誤通知</span><span class="sxs-lookup"><span data-stu-id="30d0c-266">Error Notification Via Email</span></span>

<span data-ttu-id="30d0c-267">將錯誤記錄至資料庫，以及 ELMAH 也可以設定以電子郵件給指定的收件者的錯誤詳細資料。</span><span class="sxs-lookup"><span data-stu-id="30d0c-267">Along with logging errors to a database, ELMAH can also be configured to email error details to a specified recipient.</span></span> <span data-ttu-id="30d0c-268">這項功能由`ErrorMailModule`HTTP 模組; 因此，您必須註冊此 HTTP 模組`Web.config`才能傳送錯誤詳細資料，透過電子郵件。</span><span class="sxs-lookup"><span data-stu-id="30d0c-268">This functionality is provided by the `ErrorMailModule` HTTP Module; therefore, you must register this HTTP Module in `Web.config` in order to send error details via email.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample7.xml)]

<span data-ttu-id="30d0c-269">接下來，指定在錯誤的電子郵件相關的資訊`<elmah>`項目的`<errorMail>`區段中，表示電子郵件的寄件者和收件者、 主旨、 電子郵件是否以非同步方式傳送。</span><span class="sxs-lookup"><span data-stu-id="30d0c-269">Next, specify information about the error email in the `<elmah>` element's `<errorMail>` section, indicating the email's sender and recipient, the subject, and whether the email is sent asynchronously.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample8.xml)]

<span data-ttu-id="30d0c-270">使用就地上述的設定，每當發生執行階段錯誤 ELMAH 傳送電子郵件support@example.com與錯誤詳細資料。</span><span class="sxs-lookup"><span data-stu-id="30d0c-270">With the above settings in place, whenever a runtime error occurs ELMAH sends an email to support@example.com with the error details.</span></span> <span data-ttu-id="30d0c-271">ELMAH 的錯誤電子郵件包含錯誤詳細資料網頁上，也就是錯誤訊息、 堆疊追蹤和伺服器變數中顯示的相同資訊 (回頭參考**圖 4**和**5**)。</span><span class="sxs-lookup"><span data-stu-id="30d0c-271">ELMAH's error email includes the same information shown in the error details web page, namely the error message, the stack trace, and the server variables (refer back to **Figures 4** and **5**).</span></span> <span data-ttu-id="30d0c-272">錯誤的電子郵件也包含例外狀況詳細資料黃色螢幕的死亡內容做為附件 (`YSOD.html`)。</span><span class="sxs-lookup"><span data-stu-id="30d0c-272">The error email also includes the Exception Details Yellow Screen of Death content as an attachment (`YSOD.html`).</span></span>

<span data-ttu-id="30d0c-273">**圖 8**顯示造訪所產生的 ELMAH 的錯誤電子郵件`Genre.aspx?ID=foo`。</span><span class="sxs-lookup"><span data-stu-id="30d0c-273">**Figure 8** shows ELMAH's error email generated by visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="30d0c-274">雖然**圖 8**顯示只有錯誤訊息和堆疊追蹤，伺服器變數會包含進一步向下電子郵件的本文中。</span><span class="sxs-lookup"><span data-stu-id="30d0c-274">While **Figure 8** shows only the error message and stack trace, the server variables are included further down in the email's body.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image21.png)](logging-error-details-with-elmah-cs/_static/image20.png)

<span data-ttu-id="30d0c-275">**圖 8**： 您可以設定要傳送錯誤詳細資料，透過電子郵件的 ELMAH</span><span class="sxs-lookup"><span data-stu-id="30d0c-275">**Figure 8**: You Can Configure ELMAH To Send Error Details Via Email</span></span>  
<span data-ttu-id="30d0c-276">([按一下以檢視完整大小的影像](logging-error-details-with-elmah-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="30d0c-276">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image22.png))</span></span>

## <a name="only-logging-errors-of-interest"></a><span data-ttu-id="30d0c-277">只記錄您感興趣的錯誤</span><span class="sxs-lookup"><span data-stu-id="30d0c-277">Only Logging Errors Of Interest</span></span>

<span data-ttu-id="30d0c-278">根據預設，ELMAH 會記錄每個未處理的例外狀況，包括 404 和其他 HTTP 錯誤的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="30d0c-278">By default, ELMAH logs the details of every unhandled exception, including 404 and other HTTP errors.</span></span> <span data-ttu-id="30d0c-279">您可以指示要略過這些或其他類型的錯誤使用錯誤篩選 ELMAH。</span><span class="sxs-lookup"><span data-stu-id="30d0c-279">You can instruct ELMAH to ignore these or other types of errors using error filtering.</span></span> <span data-ttu-id="30d0c-280">篩選的邏輯由 ELMAH 的`ErrorFilterModule`HTTP 模組，您必須註冊在`Web.config`才能使用篩選的邏輯。</span><span class="sxs-lookup"><span data-stu-id="30d0c-280">The filtering logic is performed by ELMAH's `ErrorFilterModule` HTTP Module, which you'll need to register in `Web.config` in order to use the filtering logic.</span></span> <span data-ttu-id="30d0c-281">中指定的規則篩選`<errorFilter>`> 一節。</span><span class="sxs-lookup"><span data-stu-id="30d0c-281">The rules for filtering are specified in the `<errorFilter>` section.</span></span>

<span data-ttu-id="30d0c-282">下列標記會指示 ELMAH 不記錄 404 錯誤。</span><span class="sxs-lookup"><span data-stu-id="30d0c-282">The following markup instructs ELMAH to not log 404 errors.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample9.xml)]

> [!NOTE]
> <span data-ttu-id="30d0c-283">不要忘記，才能使用錯誤的篩選必須註冊`ErrorFilterModule`HTTP 模組。</span><span class="sxs-lookup"><span data-stu-id="30d0c-283">Don't forget, in order to use error filtering you must register the `ErrorFilterModule` HTTP Module.</span></span>


<span data-ttu-id="30d0c-284">`<equal>`元素內`<test>`區段指判斷提示。</span><span class="sxs-lookup"><span data-stu-id="30d0c-284">The `<equal>` element inside the `<test>` section is referred to as an assertion.</span></span> <span data-ttu-id="30d0c-285">如果評估為 true 的判斷提示錯誤被篩選從 ELMAH 的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="30d0c-285">If the assertion evaluates to true then the error is filtered from ELMAH's log.</span></span> <span data-ttu-id="30d0c-286">有可用的其他判斷提示，包括： `<greater>`， `<greater-or-equal>`， `<not-equal>`， `<lesser>`， `<lesser-or-equal>`，依此類推。</span><span class="sxs-lookup"><span data-stu-id="30d0c-286">There are other assertions available, including: `<greater>`, `<greater-or-equal>`, `<not-equal>`, `<lesser>`, `<lesser-or-equal>`, and so on.</span></span> <span data-ttu-id="30d0c-287">您也可以結合使用判斷提示`<and>`和`<or>`布林運算子。</span><span class="sxs-lookup"><span data-stu-id="30d0c-287">You can also combine assertions using the `<and>` and `<or>` Boolean operators.</span></span> <span data-ttu-id="30d0c-288">您甚至可以包含簡單的 JavaScript 運算式，做為判斷提示，或在 C# 或 Visual Basic 中撰寫您自己的判斷提示。</span><span class="sxs-lookup"><span data-stu-id="30d0c-288">What's more, you can even include a simple JavaScript expression as an assertion, or write your own assertions in C# or Visual Basic.</span></span>

<span data-ttu-id="30d0c-289">如需有關篩選功能的 ELMAH 的錯誤的詳細資訊，請參閱[錯誤篩選區段](https://code.google.com/p/elmah/wiki/ErrorFiltering)中[ELMAH wiki](https://code.google.com/p/elmah/w/list)。</span><span class="sxs-lookup"><span data-stu-id="30d0c-289">For more information on ELMAH's error filtering capabilities, refer to the [Error Filtering section](https://code.google.com/p/elmah/wiki/ErrorFiltering) in the [ELMAH wiki](https://code.google.com/p/elmah/w/list).</span></span>

## <a name="summary"></a><span data-ttu-id="30d0c-290">總結</span><span class="sxs-lookup"><span data-stu-id="30d0c-290">Summary</span></span>

<span data-ttu-id="30d0c-291">ELMAH 提供簡單，但功能強大的機制，ASP.NET web 應用程式中記錄錯誤。</span><span class="sxs-lookup"><span data-stu-id="30d0c-291">ELMAH provides a simple, yet powerful mechanism for logging errors in an ASP.NET web application.</span></span> <span data-ttu-id="30d0c-292">Microsoft 的健全狀況監視系統，例如 ELMAH 錯誤記錄至資料庫，以開發人員透過電子郵件傳送錯誤詳細資料。</span><span class="sxs-lookup"><span data-stu-id="30d0c-292">Like Microsoft's health monitoring system, ELMAH can log errors to a database and can send the error details to a developer via email.</span></span> <span data-ttu-id="30d0c-293">ELMAH 包含超出支援更大範圍的錯誤記錄檔資料存放區，包括與監視系統健全狀況，不同的是： Microsoft SQL Server、 Microsoft Access、 Oracle、 XML 檔案，以及其他幾個。</span><span class="sxs-lookup"><span data-stu-id="30d0c-293">Unlike the health monitoring system, ELMAH includes out of the box support for a wider range of error log data stores, including: Microsoft SQL Server, Microsoft Access, Oracle, XML files, and several others.</span></span> <span data-ttu-id="30d0c-294">此外，ELMAH 提供內建的機制，可檢視錯誤記錄檔及網頁，從特定錯誤的詳細資訊`elmah.axd`。</span><span class="sxs-lookup"><span data-stu-id="30d0c-294">Moreover, ELMAH offers a built-in mechanism for viewing the error log and details about a specific error from a web page, `elmah.axd`.</span></span> <span data-ttu-id="30d0c-295">`elmah.axd`頁面也可以轉譯為 RSS 摘要或以逗號分隔值檔案 (CSV)，您可以閱讀使用 Microsoft Excel 的錯誤資訊。</span><span class="sxs-lookup"><span data-stu-id="30d0c-295">The `elmah.axd` page can also render error information as an RSS feed or as a comma-separated value file (CSV), which you can read using Microsoft Excel.</span></span> <span data-ttu-id="30d0c-296">您也可以篩選錯誤指示 ELMAH，從記錄檔使用宣告式或以程式設計方式判斷提示。</span><span class="sxs-lookup"><span data-stu-id="30d0c-296">You can also instruct ELMAH to filter errors from the log using declarative or programmatic assertions.</span></span> <span data-ttu-id="30d0c-297">且 ELMAH 可以搭配 ASP.NET 版本 1.x 應用程式。</span><span class="sxs-lookup"><span data-stu-id="30d0c-297">And ELMAH can be used with ASP.NET version 1.x applications.</span></span>

<span data-ttu-id="30d0c-298">每個已部署的應用程式應該擁有一些機制，自動記錄未處理例外狀況，並傳送通知給開發團隊。</span><span class="sxs-lookup"><span data-stu-id="30d0c-298">Every deployed application should have some mechanism for automatically logging unhandled exceptions and sending notification to the development team.</span></span> <span data-ttu-id="30d0c-299">是否這是使用的健全狀況監視或 ELMAH 是次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="30d0c-299">Whether this is accomplished using health monitoring or ELMAH is secondary.</span></span> <span data-ttu-id="30d0c-300">換句話說，它不會真的很重要更無論您使用健全狀況監視或 ELMAH;評估這兩個系統，然後選擇其中一個最符合您的需求。</span><span class="sxs-lookup"><span data-stu-id="30d0c-300">In other words, it doesn't really matter much whether you use health monitoring or ELMAH; evaluate both systems and then choose the one that best fits your needs.</span></span> <span data-ttu-id="30d0c-301">基本上是重要的是一些機制，放在實際執行環境中記錄未處理的例外狀況的地方。</span><span class="sxs-lookup"><span data-stu-id="30d0c-301">What is fundamentally important is that some mechanism be put in place to log unhandled exceptions in the production environment.</span></span>

<span data-ttu-id="30d0c-302">祝您程式設計 ！</span><span class="sxs-lookup"><span data-stu-id="30d0c-302">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="30d0c-303">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="30d0c-303">Further Reading</span></span>

<span data-ttu-id="30d0c-304">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="30d0c-304">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="30d0c-305">ELMAH-錯誤記錄模組和處理常式</span><span class="sxs-lookup"><span data-stu-id="30d0c-305">ELMAH - Error Logging Modules and Handlers</span></span>](http://dotnetslackers.com/articles/aspnet/ErrorLoggingModulesAndHandlers.aspx)
- <span data-ttu-id="30d0c-306">[ELMAH 專案頁面](https://code.google.com/p/elmah/)（來源的程式碼、 範例、 wiki）</span><span class="sxs-lookup"><span data-stu-id="30d0c-306">[ELMAH Project Page](https://code.google.com/p/elmah/) (source code, samples, wiki)</span></span>
- <span data-ttu-id="30d0c-307">[插入 ELMAH 成 Web 應用程式以攔截未處理例外狀況](http://screencastaday.com/ScreenCasts/43_Plugging_Elmah_into_Web_Application_to_Catch_Unhandled_Exceptions.aspx)（影片）</span><span class="sxs-lookup"><span data-stu-id="30d0c-307">[Plugging ELMAH Into a Web Application to Catch Unhandled Exceptions](http://screencastaday.com/ScreenCasts/43_Plugging_Elmah_into_Web_Application_to_Catch_Unhandled_Exceptions.aspx) (video)</span></span>
- [<span data-ttu-id="30d0c-308">安全性錯誤記錄 頁面</span><span class="sxs-lookup"><span data-stu-id="30d0c-308">Security Error Log Pages</span></span>](https://code.google.com/p/elmah/wiki/SecuringErrorLogPages)
- [<span data-ttu-id="30d0c-309">使用 HTTP 模組和處理常式來建立隨插即用的 ASP.NET 元件</span><span class="sxs-lookup"><span data-stu-id="30d0c-309">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="30d0c-310">網站安全性教學課程</span><span class="sxs-lookup"><span data-stu-id="30d0c-310">Website Security Tutorials</span></span>](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)

> [!div class="step-by-step"]
> <span data-ttu-id="30d0c-311">[上一頁](logging-error-details-with-asp-net-health-monitoring-cs.md)
> [下一頁](precompiling-your-website-cs.md)</span><span class="sxs-lookup"><span data-stu-id="30d0c-311">[Previous](logging-error-details-with-asp-net-health-monitoring-cs.md)
[Next](precompiling-your-website-cs.md)</span></span>
