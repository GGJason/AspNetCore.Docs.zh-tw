---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
title: 自訂資料庫部署多個環境 |Microsoft 文件
author: jrjlee
description: 本主題描述如何修改資料庫至特定目標環境的屬性做為部署程序的一部分。 注意： 本主題假設 th...
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/04/2012
ms.topic: article
ms.assetid: a172979a-1318-4318-a9c6-4f9560d26267
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
msc.type: authoredcontent
ms.openlocfilehash: 06f22bc9a3068ee5621df62ee5ed1bea06d7e9e6
ms.sourcegitcommit: 6784510cfb589308c3875ccb5113eb31031766b4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/08/2018
ms.locfileid: "30881353"
---
<a name="customizing-database-deployments-for-multiple-environments"></a><span data-ttu-id="d222d-104">自訂資料庫部署多個環境</span><span class="sxs-lookup"><span data-stu-id="d222d-104">Customizing Database Deployments for Multiple Environments</span></span>
====================
<span data-ttu-id="d222d-105">由[Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="d222d-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="d222d-106">下載 PDF</span><span class="sxs-lookup"><span data-stu-id="d222d-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="d222d-107">本主題描述如何修改資料庫至特定目標環境的屬性做為部署程序的一部分。</span><span class="sxs-lookup"><span data-stu-id="d222d-107">This topic describes how to tailor the properties of a database to specific target environments as part of the deployment process.</span></span>
> 
> > [!NOTE]
> > <span data-ttu-id="d222d-108">本主題假設您要部署使用 MSBuild.exe 和 VSDBCMD.exe Visual Studio 2010 資料庫專案。</span><span class="sxs-lookup"><span data-stu-id="d222d-108">The topic assumes that you're deploying a Visual Studio 2010 database project using MSBuild.exe and VSDBCMD.exe.</span></span> <span data-ttu-id="d222d-109">如需有關為什麼您可能會選擇這種方法的詳細資訊，請參閱[企業中的 Web 部署](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md)和[部署資料庫專案](../web-deployment-in-the-enterprise/deploying-database-projects.md)。</span><span class="sxs-lookup"><span data-stu-id="d222d-109">For more information on why you might choose this approach, see [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) and [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span>
> 
> 
> <span data-ttu-id="d222d-110">當您將資料庫專案部署到多個目的地時，您通常需要自訂每個目標環境的資料庫部署屬性。</span><span class="sxs-lookup"><span data-stu-id="d222d-110">When you deploy a database project to multiple destinations, you'll often want to customize the database deployment properties for each target environment.</span></span> <span data-ttu-id="d222d-111">例如，在測試環境中您會通常重新建立資料庫上每個部署，而在預備或生產環境中您可能遠超過進行累加式更新，才能保留您的資料。</span><span class="sxs-lookup"><span data-stu-id="d222d-111">For example, in test environments you'd typically recreate the database on every deployment, whereas in staging or production environments you'd be a lot more likely to make incremental updates to preserve your data.</span></span>
> 
> <span data-ttu-id="d222d-112">在 Visual Studio 2010 資料庫專案中，部署設定都包含在部署組態 (.sqldeployment) 檔案。</span><span class="sxs-lookup"><span data-stu-id="d222d-112">In a Visual Studio 2010 database project, deployment settings are contained within a deployment configuration (.sqldeployment) file.</span></span> <span data-ttu-id="d222d-113">本主題將說明如何建立環境特定部署組態檔案，並指定您的想来用來當作 VSDBCMD 參數。</span><span class="sxs-lookup"><span data-stu-id="d222d-113">This topic will show you how to create environment-specific deployment configuration files and specify the one you want to use as a VSDBCMD parameter.</span></span>


<span data-ttu-id="d222d-114">本主題根據名為 Fabrikam，Inc.的虛構公司的企業部署需求的教學課程系列的一部分此教學課程使用範例方案&#x2014;[連絡人管理員解決方案](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;來表示實際層級的複雜性，包括 ASP.NET MVC 3 應用程式時，Windows 通訊的 web 應用程式Foundation (WCF) 服務與資料庫專案。</span><span class="sxs-lookup"><span data-stu-id="d222d-114">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="d222d-115">這些教學課程的核心的部署方法為基礎所說明的分割專案檔案方法[了解專案檔](../web-deployment-in-the-enterprise/understanding-the-project-file.md)，在建置流程控制的兩個專案檔&#x2014;一個包含建置適用於每個目的地環境中和包含特定環境的建置和部署設定的指示。</span><span class="sxs-lookup"><span data-stu-id="d222d-115">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="d222d-116">在建置時，環境特定專案檔就會合併環境無從驗證專案檔來形成一組完整組建指示。</span><span class="sxs-lookup"><span data-stu-id="d222d-116">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="d222d-117">工作概觀</span><span class="sxs-lookup"><span data-stu-id="d222d-117">Task Overview</span></span>

<span data-ttu-id="d222d-118">本主題假設：</span><span class="sxs-lookup"><span data-stu-id="d222d-118">This topic assumes that:</span></span>

- <span data-ttu-id="d222d-119">中所述，使用方案部署的分割專案檔案方法[了解專案檔](../web-deployment-in-the-enterprise/understanding-the-project-file.md)。</span><span class="sxs-lookup"><span data-stu-id="d222d-119">You use the split project file approach to solution deployment, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span>
- <span data-ttu-id="d222d-120">中所述，從專案檔來部署資料庫專案中，呼叫 VSDBCMD[瞭解建置程序](../web-deployment-in-the-enterprise/understanding-the-build-process.md)。</span><span class="sxs-lookup"><span data-stu-id="d222d-120">You call VSDBCMD from the project file to deploy your database project, as described in [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="d222d-121">若要建立支援不同的資料庫部署屬性之間的目標環境的部署系統，您將需要：</span><span class="sxs-lookup"><span data-stu-id="d222d-121">To create a deployment system that supports varying the database deployment properties between target environments, you'll need to:</span></span>

- <span data-ttu-id="d222d-122">建立每個目標環境的部署組態 (.sqldeployment) 檔。</span><span class="sxs-lookup"><span data-stu-id="d222d-122">Create a deployment configuration (.sqldeployment) file for each target environment.</span></span>
- <span data-ttu-id="d222d-123">建立指定的部署組態檔做為命令列參數 VSDBCMD 命令。</span><span class="sxs-lookup"><span data-stu-id="d222d-123">Create a VSDBCMD command that specifies the deployment configuration file as a command-line switch.</span></span>
- <span data-ttu-id="d222d-124">使 VSDBCMD 選項適用於目標環境，參數化在 Microsoft Build Engine (MSBuild) 專案檔中，VSDBCMD 命令。</span><span class="sxs-lookup"><span data-stu-id="d222d-124">Parameterize the VSDBCMD command in a Microsoft Build Engine (MSBuild) project file, so that the VSDBCMD options are appropriate to the target environment.</span></span>

<span data-ttu-id="d222d-125">本主題將說明如何執行這種程序。</span><span class="sxs-lookup"><span data-stu-id="d222d-125">This topic will show you how to perform each of these procedures.</span></span>

## <a name="creating-environment-specific-deployment-configuration-files"></a><span data-ttu-id="d222d-126">建立環境特定部署組態檔</span><span class="sxs-lookup"><span data-stu-id="d222d-126">Creating Environment-Specific Deployment Configuration Files</span></span>

<span data-ttu-id="d222d-127">根據預設，資料庫專案包含名為單一部署組態檔*Database.sqldeployment*。</span><span class="sxs-lookup"><span data-stu-id="d222d-127">By default, a database project contains a single deployment configuration file named *Database.sqldeployment*.</span></span> <span data-ttu-id="d222d-128">如果您在 Visual Studio 2010 中開啟這個檔案，您可以看到您可以使用不同的部署選項：</span><span class="sxs-lookup"><span data-stu-id="d222d-128">If you open this file in Visual Studio 2010, you can see the different deployment options that are available to you:</span></span>

- <span data-ttu-id="d222d-129">**部署比較定序**。</span><span class="sxs-lookup"><span data-stu-id="d222d-129">**Deployment comparison collation**.</span></span> <span data-ttu-id="d222d-130">這可讓您選擇是否要使用您的專案的資料庫定序 (*來源*定序) 或目的地伺服器的資料庫定序 (*目標*定序)。</span><span class="sxs-lookup"><span data-stu-id="d222d-130">This lets you choose whether to use the database collation of your project (the *source* collation) or the database collation of your destination server (the *target* collation).</span></span> <span data-ttu-id="d222d-131">在大部分情況下，您會想要使用來源定序，當您部署至開發或測試環境。</span><span class="sxs-lookup"><span data-stu-id="d222d-131">In most cases, you'll want to use the source collation when you deploy to a development or test environment.</span></span> <span data-ttu-id="d222d-132">當您部署至預備或生產環境時，您通常需要將保持不變，以避免任何互通性問題的目標定序。</span><span class="sxs-lookup"><span data-stu-id="d222d-132">When you deploy to a staging or production environment, you'll usually want to leave the target collation unchanged to avoid any interoperability issues.</span></span>
- <span data-ttu-id="d222d-133">**部署資料庫屬性**。</span><span class="sxs-lookup"><span data-stu-id="d222d-133">**Deploy database properties**.</span></span> <span data-ttu-id="d222d-134">這可讓您選擇是否要套用的資料庫屬性，如中所定義*Database.sqlsettings*檔案。</span><span class="sxs-lookup"><span data-stu-id="d222d-134">This lets you choose whether to apply the database properties, as defined in the *Database.sqlsettings* file.</span></span> <span data-ttu-id="d222d-135">當您第一次部署資料庫時，您應該部署資料庫屬性。</span><span class="sxs-lookup"><span data-stu-id="d222d-135">When you deploy a database for the first time, you should deploy the database properties.</span></span> <span data-ttu-id="d222d-136">如果您更新現有的資料庫，屬性應該已經就地，而且您應該不需要再次將其部署。</span><span class="sxs-lookup"><span data-stu-id="d222d-136">If you're updating an existing database, the properties should already be in place, and you shouldn't need to deploy them again.</span></span>
- <span data-ttu-id="d222d-137">**永遠重新建立資料庫**。</span><span class="sxs-lookup"><span data-stu-id="d222d-137">**Always re-create database**.</span></span> <span data-ttu-id="d222d-138">這可讓您選擇是否要重新建立目標資料庫，每次部署或與您的結構描述，請將目標資料庫的累加變更最新狀態。</span><span class="sxs-lookup"><span data-stu-id="d222d-138">This lets you choose whether to re-create the target database every time you deploy or make incremental changes to bring the target database up to date with your schema.</span></span> <span data-ttu-id="d222d-139">如果您重新建立資料庫，您將會遺失現有的資料庫中的任何資料。</span><span class="sxs-lookup"><span data-stu-id="d222d-139">If you re-create the database, you'll lose any data in the existing database.</span></span> <span data-ttu-id="d222d-140">因此，您應該通常設定為**false**部署至預備環境或生產環境。</span><span class="sxs-lookup"><span data-stu-id="d222d-140">As such, you should usually set this to **false** for deployments to staging or production environments.</span></span>
- <span data-ttu-id="d222d-141">**如果可能遺失資料請封鎖累加部署**。</span><span class="sxs-lookup"><span data-stu-id="d222d-141">**Block incremental deployment if data loss might occur**.</span></span> <span data-ttu-id="d222d-142">這可讓您選擇是否應該停止部署，是否資料庫結構描述變更會導致資料遺失。</span><span class="sxs-lookup"><span data-stu-id="d222d-142">This lets you choose whether deployment should stop if a change to the database schema will cause the loss of data.</span></span> <span data-ttu-id="d222d-143">您通常設定為**true**以部署至生產環境中，提供您一個機會介入及保護重要資料。</span><span class="sxs-lookup"><span data-stu-id="d222d-143">You typically set this to **true** for a deployment to a production environment, to give you the opportunity to intervene and protect any important data.</span></span> <span data-ttu-id="d222d-144">如果您已將**永遠重新建立資料庫**至**false**，這項設定沒有任何作用。</span><span class="sxs-lookup"><span data-stu-id="d222d-144">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="d222d-145">**在單一使用者模式中執行部署**。</span><span class="sxs-lookup"><span data-stu-id="d222d-145">**Execute deployment in single-user mode**.</span></span> <span data-ttu-id="d222d-146">這不通常是在開發或測試環境中的問題。</span><span class="sxs-lookup"><span data-stu-id="d222d-146">This is not usually an issue in development or test environments.</span></span> <span data-ttu-id="d222d-147">不過，您應該通常設定為**true**部署至預備環境或生產環境。</span><span class="sxs-lookup"><span data-stu-id="d222d-147">However, you should typically set this to **true** for deployments to staging or production environments.</span></span> <span data-ttu-id="d222d-148">這可以防止使用者對資料庫進行變更，而部署正在進行中。</span><span class="sxs-lookup"><span data-stu-id="d222d-148">This prevents users from making changes to the database while the deployment is underway.</span></span>
- <span data-ttu-id="d222d-149">**備份資料庫後再部署**。</span><span class="sxs-lookup"><span data-stu-id="d222d-149">**Back up database before deployment**.</span></span> <span data-ttu-id="d222d-150">您通常設定為**true**當您部署至生產環境中，以防範資料遺失。</span><span class="sxs-lookup"><span data-stu-id="d222d-150">You typically set this to **true** when you deploy to a production environment, as a precaution against data loss.</span></span> <span data-ttu-id="d222d-151">您也可以將它設定為**true**當您部署至預備環境中，如果暫存資料庫包含大量資料。</span><span class="sxs-lookup"><span data-stu-id="d222d-151">You may also want to set it to **true** when you deploy to a staging environment, if your staging database contains a lot of data.</span></span>
- <span data-ttu-id="d222d-152">**產生目標資料庫中，但不在資料庫專案中的物件的 DROP 陳述式**。</span><span class="sxs-lookup"><span data-stu-id="d222d-152">**Generate DROP statements for objects that are in the target database but that are not in the database project**.</span></span> <span data-ttu-id="d222d-153">在大部分情況下，這是不可或缺的一部分對資料庫進行累加變更。</span><span class="sxs-lookup"><span data-stu-id="d222d-153">In most cases, this is an integral and essential part of making incremental changes to a database.</span></span> <span data-ttu-id="d222d-154">如果您已將**永遠重新建立資料庫**至**false**，這項設定沒有任何作用。</span><span class="sxs-lookup"><span data-stu-id="d222d-154">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="d222d-155">**請勿使用 ALTER ASSEMBLY 陳述式來更新 CLR 型別**。</span><span class="sxs-lookup"><span data-stu-id="d222d-155">**Do not use ALTER ASSEMBLY statements to update CLR types**.</span></span> <span data-ttu-id="d222d-156">此設定會決定 SQL Server 至較新的組件版本更新 common language runtime (CLR) 類型的方式。</span><span class="sxs-lookup"><span data-stu-id="d222d-156">This setting determines how SQL Server should update common language runtime (CLR) types to newer assembly versions.</span></span> <span data-ttu-id="d222d-157">這應該設定為**false**在大部分情況下。</span><span class="sxs-lookup"><span data-stu-id="d222d-157">This should be set to **false** in most scenarios.</span></span>

<span data-ttu-id="d222d-158">下表顯示不同的目的地環境的一般的部署設定。</span><span class="sxs-lookup"><span data-stu-id="d222d-158">This table shows typical deployment settings for different destination environments.</span></span> <span data-ttu-id="d222d-159">不過，您的設定可能是您實際需求而有所不同。</span><span class="sxs-lookup"><span data-stu-id="d222d-159">However, your settings may be different depending on your exact requirements.</span></span>

|  | <span data-ttu-id="d222d-160">開發/測試</span><span class="sxs-lookup"><span data-stu-id="d222d-160">Developer/Test</span></span> | <span data-ttu-id="d222d-161">臨時/整合</span><span class="sxs-lookup"><span data-stu-id="d222d-161">Staging/Integration</span></span> | <span data-ttu-id="d222d-162">生產環境</span><span class="sxs-lookup"><span data-stu-id="d222d-162">Production</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="d222d-163">**部署比較定序**</span><span class="sxs-lookup"><span data-stu-id="d222d-163">**Deployment comparison collation**</span></span> | <span data-ttu-id="d222d-164">原始程式檔</span><span class="sxs-lookup"><span data-stu-id="d222d-164">Source</span></span> | <span data-ttu-id="d222d-165">目標</span><span class="sxs-lookup"><span data-stu-id="d222d-165">Target</span></span> | <span data-ttu-id="d222d-166">目標</span><span class="sxs-lookup"><span data-stu-id="d222d-166">Target</span></span> |
| <span data-ttu-id="d222d-167">**部署資料庫屬性**</span><span class="sxs-lookup"><span data-stu-id="d222d-167">**Deploy database properties**</span></span> | <span data-ttu-id="d222d-168">True</span><span class="sxs-lookup"><span data-stu-id="d222d-168">True</span></span> | <span data-ttu-id="d222d-169">只有第一次</span><span class="sxs-lookup"><span data-stu-id="d222d-169">First time only</span></span> | <span data-ttu-id="d222d-170">只有第一次</span><span class="sxs-lookup"><span data-stu-id="d222d-170">First time only</span></span> |
| <span data-ttu-id="d222d-171">**永遠重新建立資料庫**</span><span class="sxs-lookup"><span data-stu-id="d222d-171">**Always re-create database**</span></span> | <span data-ttu-id="d222d-172">True</span><span class="sxs-lookup"><span data-stu-id="d222d-172">True</span></span> | <span data-ttu-id="d222d-173">False</span><span class="sxs-lookup"><span data-stu-id="d222d-173">False</span></span> | <span data-ttu-id="d222d-174">False</span><span class="sxs-lookup"><span data-stu-id="d222d-174">False</span></span> |
| <span data-ttu-id="d222d-175">**如果可能遺失資料請封鎖累加部署**</span><span class="sxs-lookup"><span data-stu-id="d222d-175">**Block incremental deployment if data loss might occur**</span></span> | <span data-ttu-id="d222d-176">False</span><span class="sxs-lookup"><span data-stu-id="d222d-176">False</span></span> | <span data-ttu-id="d222d-177">可能是</span><span class="sxs-lookup"><span data-stu-id="d222d-177">Maybe</span></span> | <span data-ttu-id="d222d-178">True</span><span class="sxs-lookup"><span data-stu-id="d222d-178">True</span></span> |
| <span data-ttu-id="d222d-179">**在單一使用者模式中執行部署指令碼**</span><span class="sxs-lookup"><span data-stu-id="d222d-179">**Execute deployment script in single-user mode**</span></span> | <span data-ttu-id="d222d-180">False</span><span class="sxs-lookup"><span data-stu-id="d222d-180">False</span></span> | <span data-ttu-id="d222d-181">True</span><span class="sxs-lookup"><span data-stu-id="d222d-181">True</span></span> | <span data-ttu-id="d222d-182">True</span><span class="sxs-lookup"><span data-stu-id="d222d-182">True</span></span> |
| <span data-ttu-id="d222d-183">**部署前備份資料庫**</span><span class="sxs-lookup"><span data-stu-id="d222d-183">**Back up database before deployment**</span></span> | <span data-ttu-id="d222d-184">False</span><span class="sxs-lookup"><span data-stu-id="d222d-184">False</span></span> | <span data-ttu-id="d222d-185">可能是</span><span class="sxs-lookup"><span data-stu-id="d222d-185">Maybe</span></span> | <span data-ttu-id="d222d-186">True</span><span class="sxs-lookup"><span data-stu-id="d222d-186">True</span></span> |
| <span data-ttu-id="d222d-187">**產生之物件的目標資料庫中的 DROP 陳述式，但不在資料庫專案**</span><span class="sxs-lookup"><span data-stu-id="d222d-187">**Generate DROP statements for objects that are in the target database but that are not in the database project**</span></span> | <span data-ttu-id="d222d-188">False</span><span class="sxs-lookup"><span data-stu-id="d222d-188">False</span></span> | <span data-ttu-id="d222d-189">True</span><span class="sxs-lookup"><span data-stu-id="d222d-189">True</span></span> | <span data-ttu-id="d222d-190">True</span><span class="sxs-lookup"><span data-stu-id="d222d-190">True</span></span> |
| <span data-ttu-id="d222d-191">**請勿使用 ALTER ASSEMBLY 陳述式來更新 CLR 型別**</span><span class="sxs-lookup"><span data-stu-id="d222d-191">**Do not use ALTER ASSEMBLY statements to update CLR types**</span></span> | <span data-ttu-id="d222d-192">False</span><span class="sxs-lookup"><span data-stu-id="d222d-192">False</span></span> | <span data-ttu-id="d222d-193">False</span><span class="sxs-lookup"><span data-stu-id="d222d-193">False</span></span> | <span data-ttu-id="d222d-194">False</span><span class="sxs-lookup"><span data-stu-id="d222d-194">False</span></span> |
  

> [!NOTE]
> <span data-ttu-id="d222d-195">如需有關資料庫部署屬性和環境的考量因素的詳細資訊，請參閱[概觀的資料庫專案設定](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)， [How to： 設定部署詳細資料屬性](https://msdn.microsoft.com/library/dd172125.aspx)， [建置和部署資料庫至隔離的開發環境](https://msdn.microsoft.com/library/dd193409.aspx)，和[建置，並將資料庫部署到預備環境或生產環境](https://msdn.microsoft.com/library/dd193413.aspx)。</span><span class="sxs-lookup"><span data-stu-id="d222d-195">For more information on database deployment properties and environment considerations, see [An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx), [How to: Configure Properties for Deployment Details](https://msdn.microsoft.com/library/dd172125.aspx), [Build and Deploy Database to an Isolated Development Environment](https://msdn.microsoft.com/library/dd193409.aspx), and [Build and Deploy Databases to a Staging or Production Environment](https://msdn.microsoft.com/library/dd193413.aspx).</span></span>


<span data-ttu-id="d222d-196">若要支援多個目的地的資料庫專案的部署，您應該建立每個目標環境的部署組態檔。</span><span class="sxs-lookup"><span data-stu-id="d222d-196">To support the deployment of a database project to multiple destinations, you should create a deployment configuration file for each target environment.</span></span>

<span data-ttu-id="d222d-197">**若要建立環境專屬的組態檔**</span><span class="sxs-lookup"><span data-stu-id="d222d-197">**To create an environment-specific configuration file**</span></span>

1. <span data-ttu-id="d222d-198">在 Visual Studio 2010 中，在**方案總管 中**視窗中，以滑鼠右鍵按一下資料庫專案，然後**屬性**。</span><span class="sxs-lookup"><span data-stu-id="d222d-198">In Visual Studio 2010, in the **Solution Explorer** window, right-click your database project, and then click **Properties**.</span></span>
2. <span data-ttu-id="d222d-199">在資料庫專案屬性頁面上，在**部署**索引標籤的**部署組態檔**資料列中，按一下 **新增**。</span><span class="sxs-lookup"><span data-stu-id="d222d-199">On the database project properties page, on the **Deploy** tab, in the **Deployment configuration file** row, click **New**.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image1.png)
3. <span data-ttu-id="d222d-200">在**新的部署組態檔**對話方塊方塊中，讓檔案有意義的名稱 (例如， **TestEnvironment.sqldeployment**)，然後按一下 **儲存**。</span><span class="sxs-lookup"><span data-stu-id="d222d-200">In the **New Deployment Configuration File** dialog box, give the file a meaningful name (for example, **TestEnvironment.sqldeployment**), and then click **Save**.</span></span>
4. <span data-ttu-id="d222d-201">在 *[Filename] * * *.sqldeployment** 頁面上，設定部署屬性，以符合環境需求的目的地，並儲存檔案。</span><span class="sxs-lookup"><span data-stu-id="d222d-201">On the *[Filename]***.sqldeployment** page, set the deployment properties to match the requirements of your destination environment, and then save the file.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image2.png)
5. <span data-ttu-id="d222d-202">請注意新的檔案加入資料庫專案中的 [屬性] 資料夾。</span><span class="sxs-lookup"><span data-stu-id="d222d-202">Notice that the new file is added to the Properties folder in your database project.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image3.png)

## <a name="specifying-the-deployment-configuration-file-in-vsdbcmd"></a><span data-ttu-id="d222d-203">指定部署組態檔中 VSDBCMD</span><span class="sxs-lookup"><span data-stu-id="d222d-203">Specifying the Deployment Configuration File in VSDBCMD</span></span>

<span data-ttu-id="d222d-204">當您使用 Visual Studio 2010 內 （例如偵錯和發行） 的方案組態時，您可以將部署設定檔與每個組態。</span><span class="sxs-lookup"><span data-stu-id="d222d-204">When you use solution configurations (like Debug and Release) within Visual Studio 2010, you can associate a deployment configuration file with each configuration.</span></span> <span data-ttu-id="d222d-205">當您建置的特定組態時，建置程序會產生特定組態的部署組態檔案會指向特定組態的部署資訊清單檔。</span><span class="sxs-lookup"><span data-stu-id="d222d-205">When you build a particular configuration, the build process generates a configuration-specific deployment manifest file that points to the configuration-specific deployment configuration file.</span></span> <span data-ttu-id="d222d-206">不過，其中的這些教學課程中所述的部署方法的主要目標是讓人能夠控制部署程序，而不需使用 Visual Studio 2010 和方案組態。</span><span class="sxs-lookup"><span data-stu-id="d222d-206">However, one of the main aims of the approach to deployment described in these tutorials is to give people the ability to control the deployment process without using Visual Studio 2010 and solution configurations.</span></span> <span data-ttu-id="d222d-207">這種方法，將方案組態設定是相同的目標部署環境。</span><span class="sxs-lookup"><span data-stu-id="d222d-207">In this approach, the solution configuration is the same regardless of the target deployment environment.</span></span> <span data-ttu-id="d222d-208">若要修改您的資料庫部署到特定目的地環境，您可以使用 VSDBCMD 命令列選項來指定您的部署組態檔。</span><span class="sxs-lookup"><span data-stu-id="d222d-208">To tailor your database deployment to a specific destination environment, you can use the VSDBCMD command-line options to specify your deployment configuration file.</span></span>

<span data-ttu-id="d222d-209">若要指定您 VSDBCMD 部署組態檔，使用**p/DeploymentConfigurationFile**參數並提供您的檔案的完整路徑。</span><span class="sxs-lookup"><span data-stu-id="d222d-209">To specify a deployment configuration file in your VSDBCMD, use the **p:/DeploymentConfigurationFile** switch and provide the full path to your file.</span></span> <span data-ttu-id="d222d-210">這會覆寫部署資訊清單識別部署組態檔。</span><span class="sxs-lookup"><span data-stu-id="d222d-210">This will override the deployment configuration file that the deployment manifest identifies.</span></span> <span data-ttu-id="d222d-211">例如，您可以使用此 VSDBCMD 命令來部署**ContactManager**資料庫，以在測試環境：</span><span class="sxs-lookup"><span data-stu-id="d222d-211">For example, you could use this VSDBCMD command to deploy the **ContactManager** database to a test environment:</span></span>


[!code-console[Main](customizing-database-deployments-for-multiple-environments/samples/sample1.cmd)]


> [!NOTE]
> <span data-ttu-id="d222d-212">請注意，在建置程序可能會將檔案重新命名.sqldeployment 時它會將檔案複製到輸出目錄。</span><span class="sxs-lookup"><span data-stu-id="d222d-212">Note that the build process may rename your .sqldeployment file when it copies the file to the output directory.</span></span>


<span data-ttu-id="d222d-213">如果您使用的 SQL 命令變數預先部署或部署後 SQL 指令碼中，您可以使用類似的方法與您的部署環境特定.sqlcmdvars 檔案。</span><span class="sxs-lookup"><span data-stu-id="d222d-213">If you use SQL command variables in your pre-deployment or post-deployment SQL scripts, you can use a similar approach to associate an environment-specific .sqlcmdvars file with your deployment.</span></span> <span data-ttu-id="d222d-214">在此情況下，您使用**p/SqlCommandVariablesFile**參數來識別.sqlcmdvars 檔案。</span><span class="sxs-lookup"><span data-stu-id="d222d-214">In this case, you use the **p:/SqlCommandVariablesFile** switch to identify your .sqlcmdvars file.</span></span>

## <a name="running-the-vsdbcmd-command-from-an-msbuild-project-file"></a><span data-ttu-id="d222d-215">從 MSBuild 專案檔案執行 VSDBCMD 命令</span><span class="sxs-lookup"><span data-stu-id="d222d-215">Running the VSDBCMD Command from an MSBuild Project File</span></span>

<span data-ttu-id="d222d-216">您可以使用叫用 MSBuild 專案檔從 VSDBCMD 命令**Exec** MSBuild 目標內的工作。</span><span class="sxs-lookup"><span data-stu-id="d222d-216">You can invoke a VSDBCMD command from an MSBuild project file by using an **Exec** task within an MSBuild target.</span></span> <span data-ttu-id="d222d-217">最簡單的形式，它看起來會像這樣：</span><span class="sxs-lookup"><span data-stu-id="d222d-217">In its simplest form, it would look like this:</span></span>


[!code-xml[Main](customizing-database-deployments-for-multiple-environments/samples/sample2.xml)]


- <span data-ttu-id="d222d-218">在實務上，以便於您的專案檔案讀取和重複使用，您要建立屬性，以儲存各種不同的命令列參數。</span><span class="sxs-lookup"><span data-stu-id="d222d-218">In practice, to make your project files easy to read and reuse, you'll want to create properties to store the various command-line parameters.</span></span> <span data-ttu-id="d222d-219">這可簡化使用者提供環境特定專案檔中的屬性值，或覆寫從 MSBuild 命令列的預設值。</span><span class="sxs-lookup"><span data-stu-id="d222d-219">This makes it easier for users to provide property values in an environment-specific project file or to override default values from the MSBuild command line.</span></span> <span data-ttu-id="d222d-220">如果您使用的分割專案檔案方法中所述[了解專案檔](../web-deployment-in-the-enterprise/understanding-the-project-file.md)，您應該據以分割您的組建指令和兩個檔案之間的屬性：</span><span class="sxs-lookup"><span data-stu-id="d222d-220">If you use the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), you should divide your build instructions and properties between the two files accordingly:</span></span>
- <span data-ttu-id="d222d-221">環境特定設定，例如部署組態檔案名稱、 資料庫連接字串和目標資料庫名稱，應該放在特定環境的專案檔。</span><span class="sxs-lookup"><span data-stu-id="d222d-221">Environment-specific settings, like the deployment configuration filename, the database connection string, and the target database name, should go in the environment-specific project file.</span></span>
- <span data-ttu-id="d222d-222">通用專案檔中應執行 VSDBCMD 指令，以及任何通用的屬性，例如 VSDBCMD 可執行檔的位置的 MSBuild 目標。</span><span class="sxs-lookup"><span data-stu-id="d222d-222">The MSBuild target that runs the VSDBCMD command, together with any universal properties like the location of the VSDBCMD executable, should go in the universal project file.</span></span>

<span data-ttu-id="d222d-223">您也應該確定您建置資料庫專案，才能叫用 VSDBCMD 使.deploymanifest 檔案建立且可供使用。</span><span class="sxs-lookup"><span data-stu-id="d222d-223">You should also ensure that you build the database project before you invoke VSDBCMD so that the .deploymanifest file is created and ready to use.</span></span> <span data-ttu-id="d222d-224">此主題中的處理方式的完整範例請參閱 <<c0> [ 瞭解建置程序](../web-deployment-in-the-enterprise/understanding-the-build-process.md)的逐步解說中的專案檔[連絡人管理員範例方案](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)。</span><span class="sxs-lookup"><span data-stu-id="d222d-224">You can see a full example of this approach in the topic [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md), which walks you through the project files in the [Contact Manager sample solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md).</span></span>

## <a name="conclusion"></a><span data-ttu-id="d222d-225">結論</span><span class="sxs-lookup"><span data-stu-id="d222d-225">Conclusion</span></span>

<span data-ttu-id="d222d-226">本主題描述如何調整到不同的目的地環境的資料庫屬性，當您部署資料庫專案使用 MSBuild 和 VSDBCMD 時。</span><span class="sxs-lookup"><span data-stu-id="d222d-226">This topic described how you can tailor database properties to different destination environments when you deploy database projects using MSBuild and VSDBCMD.</span></span> <span data-ttu-id="d222d-227">當您需要更大，企業級解決方案的一部分部署資料庫專案時，這個方法很有用。</span><span class="sxs-lookup"><span data-stu-id="d222d-227">This approach is useful when you need to deploy database projects as part of larger, enterprise-scale solutions.</span></span> <span data-ttu-id="d222d-228">這些解決方案通常會部署至多個目的地，像是沙箱化開發或測試環境、 預備環境或整合平台和生產環境或即時環境。</span><span class="sxs-lookup"><span data-stu-id="d222d-228">These solutions are often deployed to multiple destinations, like sandboxed development or test environments, staging or integration platforms, and production or live environments.</span></span> <span data-ttu-id="d222d-229">每個目標環境通常需要一組唯一的資料庫部署屬性。</span><span class="sxs-lookup"><span data-stu-id="d222d-229">Each of these target environments typically requires a unique set of database deployment properties.</span></span>

## <a name="further-reading"></a><span data-ttu-id="d222d-230">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="d222d-230">Further Reading</span></span>

<span data-ttu-id="d222d-231">如需有關部署使用 VSDBCMD.exe 資料庫專案的詳細資訊，請參閱[部署資料庫專案](../web-deployment-in-the-enterprise/deploying-database-projects.md)。</span><span class="sxs-lookup"><span data-stu-id="d222d-231">For more information on deploying database projects using VSDBCMD.exe, see [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span> <span data-ttu-id="d222d-232">如需使用自訂的 MSBuild 專案檔來控制部署程序的詳細資訊，請參閱[了解專案檔](../web-deployment-in-the-enterprise/understanding-the-project-file.md)和[瞭解建置程序](../web-deployment-in-the-enterprise/understanding-the-build-process.md)。</span><span class="sxs-lookup"><span data-stu-id="d222d-232">For more information on using custom MSBuild project files to control the deployment process, see [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md) and [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="d222d-233">MSDN 上的這些文章提供資料庫部署更一般的指導方針：</span><span class="sxs-lookup"><span data-stu-id="d222d-233">These articles on MSDN provide more general guidance on database deployment:</span></span>

- <span data-ttu-id="d222d-234">[資料庫專案設定概觀](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="d222d-234">[An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span></span>
- [<span data-ttu-id="d222d-235">如何： 設定的部署詳細資料屬性</span><span class="sxs-lookup"><span data-stu-id="d222d-235">How to: Configure Properties for Deployment Details</span></span>](https://msdn.microsoft.com/library/dd172125.aspx)
- [<span data-ttu-id="d222d-236">建置和部署資料庫至隔離的開發環境</span><span class="sxs-lookup"><span data-stu-id="d222d-236">Build and Deploy Databases to an Isolated Development Environment</span></span>](https://msdn.microsoft.com/library/dd193409.aspx)
- [<span data-ttu-id="d222d-237">建置並將資料庫部署到預備環境或生產環境</span><span class="sxs-lookup"><span data-stu-id="d222d-237">Build and Deploy Databases to a Staging or Production Environment</span></span>](https://msdn.microsoft.com/library/dd193413.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="d222d-238">[上一頁](performing-a-what-if-deployment.md)
> [下一頁](deploying-database-role-memberships-to-test-environments.md)</span><span class="sxs-lookup"><span data-stu-id="d222d-238">[Previous](performing-a-what-if-deployment.md)
[Next](deploying-database-role-memberships-to-test-environments.md)</span></span>
