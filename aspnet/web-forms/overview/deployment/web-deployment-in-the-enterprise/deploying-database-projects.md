---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
title: 部署資料庫專案 |Microsoft 文件
author: jrjlee
description: 注意： 在許多企業部署案例，您需要將累加更新發行到已部署資料庫的能力。 替代方法是重新建立...
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/04/2012
ms.topic: article
ms.assetid: 832f226a-1aa3-4093-8c29-ce4196793259
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
msc.type: authoredcontent
ms.openlocfilehash: a0b3871ea098b549271bce2b9d5f0c24f9ca8a9c
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/06/2018
ms.locfileid: "30882497"
---
<a name="deploying-database-projects"></a><span data-ttu-id="818db-104">部署資料庫專案</span><span class="sxs-lookup"><span data-stu-id="818db-104">Deploying Database Projects</span></span>
====================
<span data-ttu-id="818db-105">由[Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="818db-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="818db-106">下載 PDF</span><span class="sxs-lookup"><span data-stu-id="818db-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> [!NOTE]
> <span data-ttu-id="818db-107">在許多企業部署案例，您必須要能夠將累加更新發行到已部署的資料庫。</span><span class="sxs-lookup"><span data-stu-id="818db-107">In lots of enterprise deployment scenarios, you need the ability to publish incremental updates to a deployed database.</span></span> <span data-ttu-id="818db-108">替代方法是重新建立每個部署，這表示您會遺失任何資料，在現有的資料庫上的資料庫。</span><span class="sxs-lookup"><span data-stu-id="818db-108">The alternative is to recreate the database on every deployment, which means you lose any data in the existing database.</span></span> <span data-ttu-id="818db-109">當您使用 Visual Studio 2010，請使用 VSDBCMD 是增量資料庫發行的建議的方法。</span><span class="sxs-lookup"><span data-stu-id="818db-109">When you work with Visual Studio 2010, using VSDBCMD is the recommended approach to incremental database publishing.</span></span> <span data-ttu-id="818db-110">不過下, 一版的 Visual Studio 和 Web 發行管線 (WPP) 會包含支援累加發行直接的工具。</span><span class="sxs-lookup"><span data-stu-id="818db-110">However, the next version of Visual Studio and the Web Publishing Pipeline (WPP) will include tooling that supports incremental publishing directly.</span></span>


<span data-ttu-id="818db-111">如果您在 Visual Studio 2010 中開啟連絡人管理員範例方案，您會看到資料庫專案包含四個檔案內容資料夾。</span><span class="sxs-lookup"><span data-stu-id="818db-111">If you open the Contact Manager sample solution in Visual Studio 2010, you'll see that the database project includes a Properties folder that contains four files.</span></span>

![](deploying-database-projects/_static/image1.png)

<span data-ttu-id="818db-112">與專案檔 (*ContactManager.Database.dbproj*在此情況下)，這些檔案可控制建置和部署處理程序的各個層面：</span><span class="sxs-lookup"><span data-stu-id="818db-112">Together with the project file (*ContactManager.Database.dbproj* in this case), these files control various aspects of the build and deployment process:</span></span>

- <span data-ttu-id="818db-113">*Database.sqlcmdvars*檔案提供可用來部署專案時，您使用任何 SQLCMD 變數的值。</span><span class="sxs-lookup"><span data-stu-id="818db-113">The *Database.sqlcmdvars* file provides values for any SQLCMD variables you use when you deploy the project.</span></span> <span data-ttu-id="818db-114">每個方案組態 （例如，偵錯和發行） 可以指定不同的.sqlcmdvars 檔案。</span><span class="sxs-lookup"><span data-stu-id="818db-114">Each solution configuration (for example, debug and release) can specify a different .sqlcmdvars file.</span></span>
- <span data-ttu-id="818db-115">*Database.sqldeployment*檔案提供部署特定設定，例如是否要使用您的專案或目的地伺服器的定序中定義的定序是否要重新建立目的地資料庫，每個時間，或直接修改現有的資料庫，使其維持最新狀態，以此類推。</span><span class="sxs-lookup"><span data-stu-id="818db-115">The *Database.sqldeployment* file provides deployment-specific settings, like whether to use the collation defined in your project or the collation of the destination server, whether to recreate the destination database every time or simply amend the existing database to bring it up to date, and so on.</span></span> <span data-ttu-id="818db-116">每個方案組態時，可以指定不同的.sqldeployment 檔案。</span><span class="sxs-lookup"><span data-stu-id="818db-116">Each solution configuration can specify a different .sqldeployment file.</span></span>
- <span data-ttu-id="818db-117">*Database.sqlpermissions*檔案是 XML 文件可讓您定義您想要新增到目標資料庫的任何權限。</span><span class="sxs-lookup"><span data-stu-id="818db-117">The *Database.sqlpermissions* file is an XML document that you can use to define any permissions you want to add to the target database.</span></span> <span data-ttu-id="818db-118">所有的方案組態共用相同.sqlpermissions 檔。</span><span class="sxs-lookup"><span data-stu-id="818db-118">All solution configurations share the same .sqlpermissions file.</span></span>
- <span data-ttu-id="818db-119">*Database.sqlsettings*檔案會指定建立資料庫，例如要使用的比較運算子的行為和等等的定序時要使用的資料庫層級屬性。</span><span class="sxs-lookup"><span data-stu-id="818db-119">The *Database.sqlsettings* file specifies the database-level properties to use when creating the database, like the collation to use, the behavior of comparison operators, and so on.</span></span> <span data-ttu-id="818db-120">所有的方案組態共用相同.sqlsettings 檔案。</span><span class="sxs-lookup"><span data-stu-id="818db-120">All solution configurations share the same .sqlsettings file.</span></span>

<span data-ttu-id="818db-121">它是值得花一點時間來進行 Visual Studio 中開啟這些檔案，並熟悉內容。</span><span class="sxs-lookup"><span data-stu-id="818db-121">It's worth taking a moment to open these files in Visual Studio and familiarize yourself with the contents.</span></span>

<span data-ttu-id="818db-122">當您建置資料庫專案時，建置程序會建立兩個檔案：</span><span class="sxs-lookup"><span data-stu-id="818db-122">When you build a database project, the build process creates two files:</span></span>

- <span data-ttu-id="818db-123">A*資料庫結構描述*（.dbschema 檔案）。</span><span class="sxs-lookup"><span data-stu-id="818db-123">A *database schema* (.dbschema file).</span></span> <span data-ttu-id="818db-124">這會描述您想要建立 XML 格式的資料庫結構描述。</span><span class="sxs-lookup"><span data-stu-id="818db-124">This describes the schema of the database you want to create in XML format.</span></span>
- <span data-ttu-id="818db-125">A*部署資訊清單*（.deploymanifest 檔案）。</span><span class="sxs-lookup"><span data-stu-id="818db-125">A *deployment manifest* (.deploymanifest file).</span></span> <span data-ttu-id="818db-126">這包含建立及部署資料庫所需的所有資訊。</span><span class="sxs-lookup"><span data-stu-id="818db-126">This contains all the information required to create and deploy your database.</span></span> <span data-ttu-id="818db-127">它會參考.dbschema 檔案以及其他資源，例如部署指示 （.sqldeployment 檔案） 和任何的預先部署或部署後 SQL 指令碼。</span><span class="sxs-lookup"><span data-stu-id="818db-127">It references the .dbschema file along with other resources, like the deployment instructions (the .sqldeployment file) and any pre-deployment or post-deployment SQL scripts.</span></span>

<span data-ttu-id="818db-128">這會顯示這些資源之間的關聯性：</span><span class="sxs-lookup"><span data-stu-id="818db-128">This shows the relationship between these resources:</span></span>

![](deploying-database-projects/_static/image2.png)

<span data-ttu-id="818db-129">如您所見，.sqlsettings 和.sqlpermissions 檔案會在建置程序的輸入。</span><span class="sxs-lookup"><span data-stu-id="818db-129">As you can see, the .sqlsettings file and the .sqlpermissions file are inputs to the build process.</span></span> <span data-ttu-id="818db-130">資料庫專案檔，以及這些檔案可用來建立資料庫結構描述檔案。</span><span class="sxs-lookup"><span data-stu-id="818db-130">Along with the database project file, these files are used to create the database schema file.</span></span> <span data-ttu-id="818db-131">.Sqldeployment 和.sqlcmdvars 檔案通過建置處理序保持不變。</span><span class="sxs-lookup"><span data-stu-id="818db-131">The .sqldeployment file and the .sqlcmdvars file pass through the build process unchanged.</span></span> <span data-ttu-id="818db-132">部署資訊清單指出資料庫結構描述、.sqldeployment 檔案、.sqlcmdvars 檔案，與任何預先部署或部署後 SQL 指令碼的位置。</span><span class="sxs-lookup"><span data-stu-id="818db-132">The deployment manifest indicates the location of the database schema, the .sqldeployment file, the .sqlcmdvars file, and any pre-deployment or post-deployment SQL scripts.</span></span>

## <a name="why-use-vsdbcmd-to-deploy-a-database-project"></a><span data-ttu-id="818db-133">為何要使用 VSDBCMD 部署資料庫專案嗎？</span><span class="sxs-lookup"><span data-stu-id="818db-133">Why Use VSDBCMD to Deploy a Database Project?</span></span>

<span data-ttu-id="818db-134">有各種不同的方法來部署資料庫專案。</span><span class="sxs-lookup"><span data-stu-id="818db-134">There are various different approaches to deploying database projects.</span></span> <span data-ttu-id="818db-135">不過，並非所有都適用於將資料庫專案部署至企業環境中的遠端伺服器。</span><span class="sxs-lookup"><span data-stu-id="818db-135">However, not all of them are suitable for deploying a database project to remote servers in an enterprise environment.</span></span> <span data-ttu-id="818db-136">請考慮要從資料庫專案部署。</span><span class="sxs-lookup"><span data-stu-id="818db-136">Consider what you want from a database project deployment.</span></span> <span data-ttu-id="818db-137">在企業部署案例中，您可能想要：</span><span class="sxs-lookup"><span data-stu-id="818db-137">In enterprise deployment scenarios, you're likely to want:</span></span>

- <span data-ttu-id="818db-138">部署資料庫專案，從遠端位置的能力。</span><span class="sxs-lookup"><span data-stu-id="818db-138">The ability to deploy the database project from a remote location.</span></span>
- <span data-ttu-id="818db-139">提供對現有的資料庫進行累加式更新的能力。</span><span class="sxs-lookup"><span data-stu-id="818db-139">The ability to make incremental updates to an existing database.</span></span>
- <span data-ttu-id="818db-140">提供包含預先部署指令碼或部署後指令碼的能力。</span><span class="sxs-lookup"><span data-stu-id="818db-140">The ability to include pre-deployment scripts or post-deployment scripts.</span></span>
- <span data-ttu-id="818db-141">可以修改部署至多個目的地環境的能力。</span><span class="sxs-lookup"><span data-stu-id="818db-141">The ability to tailor the deployment to multiple destination environments.</span></span>
- <span data-ttu-id="818db-142">部署資料庫專案的較大一部分的能力通常編寫指令碼，逐步執行方案部署。</span><span class="sxs-lookup"><span data-stu-id="818db-142">The ability to deploy the database project as part of a larger, typically scripted, single-step solution deployment.</span></span>

<span data-ttu-id="818db-143">有三個主要的方式，您可以使用來部署資料庫專案：</span><span class="sxs-lookup"><span data-stu-id="818db-143">There are three main approaches you can use to deploy a database project:</span></span>

- <span data-ttu-id="818db-144">您可以使用部署功能與在 Visual Studio 2010 資料庫專案類型。</span><span class="sxs-lookup"><span data-stu-id="818db-144">You can use the deployment functionality with the database project type in Visual Studio 2010.</span></span> <span data-ttu-id="818db-145">當您建置並部署在 Visual Studio 2010 資料庫專案時，部署程序會使用部署資訊清單產生特定的組建組態的 SQL 為基礎的部署檔案。</span><span class="sxs-lookup"><span data-stu-id="818db-145">When you build and deploy a database project in Visual Studio 2010, the deployment process uses the deployment manifest to generate a SQL-based deployment file specific to the build configuration.</span></span> <span data-ttu-id="818db-146">如果它已不存在或對資料庫進行任何必要的變更，如果已經存在的話，這會建立資料庫。</span><span class="sxs-lookup"><span data-stu-id="818db-146">This will create the database if it doesn't already exist or make any necessary changes to the database if it does already exist.</span></span> <span data-ttu-id="818db-147">您可以使用 SQLCMD.exe 來執行在目的地伺服器上，這個檔案，或您可以設定 Visual Studio 來建立和執行檔案。</span><span class="sxs-lookup"><span data-stu-id="818db-147">You can use SQLCMD.exe to run this file on your destination server, or you can set Visual Studio to create and run the file.</span></span> <span data-ttu-id="818db-148">這個方法的缺點是，僅有有限控制部署設定。</span><span class="sxs-lookup"><span data-stu-id="818db-148">The disadvantage of this approach is that you have only limited control over the deployment settings.</span></span> <span data-ttu-id="818db-149">您通常也可能需要修改 SQL 部署檔案，以提供環境特定變數的值。</span><span class="sxs-lookup"><span data-stu-id="818db-149">You may often also need to modify the SQL deployment file to provide environment-specific variable values.</span></span> <span data-ttu-id="818db-150">您只能使用與 Visual Studio 2010 安裝，這種方法，從電腦和開發人員會想要知道，並提供所有目的地環境中的連接字串和認證。</span><span class="sxs-lookup"><span data-stu-id="818db-150">You can only use this approach from a computer with Visual Studio 2010 installed, and the developer would need to know and provide connection strings and credentials for all destination environments.</span></span>
- <span data-ttu-id="818db-151">您可以使用網際網路資訊服務 (IIS) Web Deployment Tool (Web Deploy) 至[將資料庫部署為 web 應用程式專案的一部分](https://msdn.microsoft.com/library/dd465343.aspx)。</span><span class="sxs-lookup"><span data-stu-id="818db-151">You can use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to [deploy a database as part of a web application project](https://msdn.microsoft.com/library/dd465343.aspx).</span></span> <span data-ttu-id="818db-152">不過，這個方法是如果您想要部署資料庫專案，而不是只複寫到目的地伺服器上現有的本機資料庫更加複雜。</span><span class="sxs-lookup"><span data-stu-id="818db-152">However, this approach is a lot more complex if you want to deploy a database project rather than simply replicate an existing local database on a destination server.</span></span> <span data-ttu-id="818db-153">您可以設定 Web Deploy 才能執行 SQL 部署指令碼的資料庫專案所產生，但若要這樣做，您必須建立您的 web 應用程式專案的自訂 WPP 目標檔案。</span><span class="sxs-lookup"><span data-stu-id="818db-153">You can configure Web Deploy to run the SQL deployment script that the database project generates, but in order to do this, you need to create a custom WPP targets file for your web application project.</span></span> <span data-ttu-id="818db-154">這會將大量的複雜度加入部署程序。</span><span class="sxs-lookup"><span data-stu-id="818db-154">This adds a substantial amount of complexity to the deployment process.</span></span> <span data-ttu-id="818db-155">此外，Web Deploy 不直接支援累加式更新至現有的資料庫。</span><span class="sxs-lookup"><span data-stu-id="818db-155">In addition, Web Deploy does not directly support incremental updates to existing databases.</span></span> <span data-ttu-id="818db-156">如需這種方法的詳細資訊，請參閱[擴充封裝資料庫專案將 Web 發行管線部署 SQL 檔案](https://go.microsoft.com/?linkid=9805121)。</span><span class="sxs-lookup"><span data-stu-id="818db-156">For more information on this approach, see [Extending the Web Publishing Pipeline to package database project deployed SQL file](https://go.microsoft.com/?linkid=9805121).</span></span>
- <span data-ttu-id="818db-157">您可以使用 VSDBCMD 公用程式來部署資料庫，使用的資料庫結構描述或部署資訊清單。</span><span class="sxs-lookup"><span data-stu-id="818db-157">You can use the VSDBCMD utility to deploy the database, using either the database schema or the deployment manifest.</span></span> <span data-ttu-id="818db-158">您可以呼叫 VSDBCMD.exe 從 MSBuild 目標，這可讓您將資料庫發行更大、 已編寫指令碼的部署程序的一部分。</span><span class="sxs-lookup"><span data-stu-id="818db-158">You can call VSDBCMD.exe from an MSBuild target, which lets you publish databases as part of a larger, scripted deployment process.</span></span> <span data-ttu-id="818db-159">您可以覆寫您.sqlcmdvars 檔案與許多其他的資料庫內容從 VSDBCMD 命令，可讓您自訂您的部署不同環境，而不需要建立多個組建組態中的變數。</span><span class="sxs-lookup"><span data-stu-id="818db-159">You can override the variables in your .sqlcmdvars file and lots of other database properties from a VSDBCMD command, which allows you to customize your deployment for different environments without creating multiple build configurations.</span></span> <span data-ttu-id="818db-160">VSDBCMD 提供差異化功能，這表示它會變更只需要對齊資料庫結構描述的目的地資料庫。</span><span class="sxs-lookup"><span data-stu-id="818db-160">VSDBCMD provides differentiation functionality, which means it will make only the necessary changes to align a destination database with your database schema.</span></span> <span data-ttu-id="818db-161">VSDBCMD 也提供各種不同的命令列選項，可讓您在部署程序更細微的控制。</span><span class="sxs-lookup"><span data-stu-id="818db-161">VSDBCMD also offers a wide range of command-line options, which give you fine-grained control over the deployment process.</span></span>

<span data-ttu-id="818db-162">從本概觀中，您可以發現，使用 MSBuild VSDBCMD 最適合典型的企業部署案例的方法：</span><span class="sxs-lookup"><span data-stu-id="818db-162">From this overview, you can see that using VSDBCMD with MSBuild is the approach best suited to a typical enterprise deployment scenario:</span></span>

|  | <span data-ttu-id="818db-163">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="818db-163">Visual Studio 2010</span></span> | <span data-ttu-id="818db-164">Web Deploy 2.0</span><span class="sxs-lookup"><span data-stu-id="818db-164">Web Deploy 2.0</span></span> | <span data-ttu-id="818db-165">VSDBCMD.exe</span><span class="sxs-lookup"><span data-stu-id="818db-165">VSDBCMD.exe</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="818db-166">支援遠端部署嗎？</span><span class="sxs-lookup"><span data-stu-id="818db-166">Supports remote deployment?</span></span> | <span data-ttu-id="818db-167">[是]</span><span class="sxs-lookup"><span data-stu-id="818db-167">Yes</span></span> | <span data-ttu-id="818db-168">是</span><span class="sxs-lookup"><span data-stu-id="818db-168">Yes</span></span> | <span data-ttu-id="818db-169">[是]</span><span class="sxs-lookup"><span data-stu-id="818db-169">Yes</span></span> |
| <span data-ttu-id="818db-170">支援累加式更新嗎？</span><span class="sxs-lookup"><span data-stu-id="818db-170">Supports incremental updates?</span></span> | <span data-ttu-id="818db-171">[是]</span><span class="sxs-lookup"><span data-stu-id="818db-171">Yes</span></span> | <span data-ttu-id="818db-172">否</span><span class="sxs-lookup"><span data-stu-id="818db-172">No</span></span> | <span data-ttu-id="818db-173">[是]</span><span class="sxs-lookup"><span data-stu-id="818db-173">Yes</span></span> |
| <span data-ttu-id="818db-174">支援預先/部署後指令碼嗎？</span><span class="sxs-lookup"><span data-stu-id="818db-174">Supports pre/post-deployment scripts?</span></span> | <span data-ttu-id="818db-175">[是]</span><span class="sxs-lookup"><span data-stu-id="818db-175">Yes</span></span> | <span data-ttu-id="818db-176">是</span><span class="sxs-lookup"><span data-stu-id="818db-176">Yes</span></span> | <span data-ttu-id="818db-177">[是]</span><span class="sxs-lookup"><span data-stu-id="818db-177">Yes</span></span> |
| <span data-ttu-id="818db-178">支援多重環境部署嗎？</span><span class="sxs-lookup"><span data-stu-id="818db-178">Supports multi-environment deployment?</span></span> | <span data-ttu-id="818db-179">有限</span><span class="sxs-lookup"><span data-stu-id="818db-179">Limited</span></span> | <span data-ttu-id="818db-180">有限</span><span class="sxs-lookup"><span data-stu-id="818db-180">Limited</span></span> | <span data-ttu-id="818db-181">[是]</span><span class="sxs-lookup"><span data-stu-id="818db-181">Yes</span></span> |
| <span data-ttu-id="818db-182">支援已編寫指令碼的部署嗎？</span><span class="sxs-lookup"><span data-stu-id="818db-182">Supports scripted deployment?</span></span> | <span data-ttu-id="818db-183">有限</span><span class="sxs-lookup"><span data-stu-id="818db-183">Limited</span></span> | <span data-ttu-id="818db-184">[是]</span><span class="sxs-lookup"><span data-stu-id="818db-184">Yes</span></span> | <span data-ttu-id="818db-185">[是]</span><span class="sxs-lookup"><span data-stu-id="818db-185">Yes</span></span> |

<span data-ttu-id="818db-186">本主題的其餘部分說明如何使用部署資料庫專案的 MSBuild VSDBCMD 使用。</span><span class="sxs-lookup"><span data-stu-id="818db-186">The remainder of this topic describes the use of VSDBCMD with MSBuild to deploy database projects.</span></span>

## <a name="understanding-the-deployment-process"></a><span data-ttu-id="818db-187">了解部署程序</span><span class="sxs-lookup"><span data-stu-id="818db-187">Understanding the Deployment Process</span></span>

<span data-ttu-id="818db-188">VSDBCMD 公用程式可讓您使用部署資料庫的資料庫結構描述 （.dbschema 檔案） 或部署資訊清單 （.deploymanifest 檔案）。</span><span class="sxs-lookup"><span data-stu-id="818db-188">The VSDBCMD utility lets you deploy a database using either the database schema (the .dbschema file) or the deployment manifest (the .deploymanifest file).</span></span> <span data-ttu-id="818db-189">在實務上，您幾乎都將使用部署資訊清單中，當部署資訊清單可讓您針對不同的部署屬性提供預設值，並識別任何的預先部署或部署後 SQL 指令碼想要執行。</span><span class="sxs-lookup"><span data-stu-id="818db-189">In practice, you'll almost always use the deployment manifest, as the deployment manifest lets you provide default values for various deployment properties and identify any pre-deployment or post-deployment SQL scripts you want to run.</span></span> <span data-ttu-id="818db-190">例如，此 VSDBCMD 命令可用來部署**ContactManager**測試環境中的資料庫伺服器的資料庫：</span><span class="sxs-lookup"><span data-stu-id="818db-190">For example, this VSDBCMD command is used to deploy the **ContactManager** database to a database server in a test environment:</span></span>


[!code-console[Main](deploying-database-projects/samples/sample1.cmd)]


<span data-ttu-id="818db-191">在此情況下：</span><span class="sxs-lookup"><span data-stu-id="818db-191">In this case:</span></span>

- <span data-ttu-id="818db-192">**/A** (或 **/Action**) 參數指定您想要 VSDBCMD。</span><span class="sxs-lookup"><span data-stu-id="818db-192">The **/a** (or **/Action**) switch specifies what you want VSDBCMD to do.</span></span> <span data-ttu-id="818db-193">您可以設定為**匯入**或**部署**。</span><span class="sxs-lookup"><span data-stu-id="818db-193">You can set this to **Import** or **Deploy**.</span></span> <span data-ttu-id="818db-194">**匯入**選項用來產生.dbschema 檔案從現有的資料庫，而**部署**選項用來將.dbschema 檔案部署到目標資料庫。</span><span class="sxs-lookup"><span data-stu-id="818db-194">The **Import** option is used to generate a .dbschema file from an existing database, and the **Deploy** option is used to deploy a .dbschema file to a target database.</span></span>
- <span data-ttu-id="818db-195">**/資訊清單**(或 **/ManifestFile**) 參數識別您想要部署的.deploymanifest 檔案。</span><span class="sxs-lookup"><span data-stu-id="818db-195">The **/manifest** (or **/ManifestFile**) switch identifies the .deploymanifest file you want to deploy.</span></span> <span data-ttu-id="818db-196">如果您想要改用.dbschema 檔案，您會使用 **/模型**(或 **/ModelFile**) 切換。</span><span class="sxs-lookup"><span data-stu-id="818db-196">If you wanted to use the .dbschema file instead, you'd use the **/model** (or **/ModelFile**) switch.</span></span>
- <span data-ttu-id="818db-197">**/Cs** (或 **/ConnectionString**) 交換器提供目標資料庫伺服器的連接字串。</span><span class="sxs-lookup"><span data-stu-id="818db-197">The **/cs** (or **/ConnectionString**) switch provides the connection string for the target database server.</span></span> <span data-ttu-id="818db-198">請注意，這不包含資料庫的名稱&#x2014;VSDBCMD 需要連接到伺服器，以建立資料庫。它不需要連接到個別的資料庫。</span><span class="sxs-lookup"><span data-stu-id="818db-198">Note that this doesn't include the name of the database&#x2014;VSDBCMD needs to connect to the server to create the database; it doesn't need to connect to an individual database.</span></span> <span data-ttu-id="818db-199">如果.deploymanifest 檔案包含連接字串，您可以省略這個參數。</span><span class="sxs-lookup"><span data-stu-id="818db-199">If your .deploymanifest file includes a connection string, you can omit this switch.</span></span> <span data-ttu-id="818db-200">如果您要使用參數，參數值會覆寫.deploymanifest 值。</span><span class="sxs-lookup"><span data-stu-id="818db-200">If you use the switch anyway, the switch value will override the .deploymanifest value.</span></span>
- <span data-ttu-id="818db-201"><strong>/P:TargetDatabase</strong>屬性提供您想要指派到目標資料庫上建立的名稱。</span><span class="sxs-lookup"><span data-stu-id="818db-201">The <strong>/p:TargetDatabase</strong> property provides the name you want to assign to the target database on creation.</span></span> <span data-ttu-id="818db-202">這會覆寫的值<strong>TargetDatabase</strong> .deploymanifest 檔案中的屬性。</span><span class="sxs-lookup"><span data-stu-id="818db-202">This overrides the value of the <strong>TargetDatabase</strong> property in the .deploymanifest file.</span></span> <span data-ttu-id="818db-203">您可以使用<strong>/p:</strong> <em>[屬性名稱]</em>.sqlcmdvars 檔案中宣告的語法來設定各種不同的部署屬性，並覆寫任何 SQLCMD 變數。</span><span class="sxs-lookup"><span data-stu-id="818db-203">You can use the <strong>/p:</strong> <em>[property name]</em>syntax to set a wide variety of deployment properties and to override any SQLCMD variables declared in your .sqlcmdvars file.</span></span>
- <span data-ttu-id="818db-204">**/Dd+** (或 **/DeployToDatabase+**) 參數表示您想要建立部署，並將它部署至目標環境。</span><span class="sxs-lookup"><span data-stu-id="818db-204">The **/dd+** (or **/DeployToDatabase+**) switch indicates that you want to create a deployment and deploy it to the target environment.</span></span> <span data-ttu-id="818db-205">如果您指定 **/dd-**，或省略這個參數，VSDBCMD 將會產生部署指令碼，但不是將它部署至目標環境。</span><span class="sxs-lookup"><span data-stu-id="818db-205">If you specify **/dd-**, or omit the switch, VSDBCMD will generate a deployment script but will not deploy it to the target environment.</span></span> <span data-ttu-id="818db-206">此參數通常是混淆的來源，並且會在下一節中詳細說明。</span><span class="sxs-lookup"><span data-stu-id="818db-206">This switch is often the source of confusion and is explained in more detail in the next section.</span></span>
- <span data-ttu-id="818db-207">**/指令碼**(或 **/DeploymentScriptFile**) 參數指定您想要用來產生部署指令碼。</span><span class="sxs-lookup"><span data-stu-id="818db-207">The **/script** (or **/DeploymentScriptFile**) switch specifies where you want to generate the deployment script.</span></span> <span data-ttu-id="818db-208">此值不會影響部署程序。</span><span class="sxs-lookup"><span data-stu-id="818db-208">This value does not affect the deployment process.</span></span>

<span data-ttu-id="818db-209">如需有關 VSDBCMD 的詳細資訊，請參閱[VSDBCMD 的命令列參考。EXE （部署和結構描述匯入）](https://msdn.microsoft.com/library/dd193283.aspx)和[如何： 準備資料庫以進行部署的命令提示字元使用 VSDBCMD。EXE](https://msdn.microsoft.com/library/dd193258.aspx)。</span><span class="sxs-lookup"><span data-stu-id="818db-209">For more information on VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE](https://msdn.microsoft.com/library/dd193258.aspx).</span></span>

<span data-ttu-id="818db-210">如需如何使用 VSDBCMD 從 MSBuild 專案檔的範例，請參閱[瞭解建置程序](understanding-the-build-process.md)。</span><span class="sxs-lookup"><span data-stu-id="818db-210">For an example of how you can use VSDBCMD from an MSBuild project file, see [Understanding the Build Process](understanding-the-build-process.md).</span></span> <span data-ttu-id="818db-211">如需如何設定資料庫部署設定多個環境的範例，請參閱[自訂資料庫部署多個環境](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="818db-211">For examples of how to configure database deployment settings for multiple environments, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="understanding-the-deploytodatabase-switch"></a><span data-ttu-id="818db-212">了解 DeployToDatabase 交換器</span><span class="sxs-lookup"><span data-stu-id="818db-212">Understanding the DeployToDatabase Switch</span></span>

<span data-ttu-id="818db-213">行為 **/dd**或 **/DeployToDatabase**交換器取決於您是否使用 VSDBCMD 搭配.dbschema 檔案或.deploymanifest 檔案。</span><span class="sxs-lookup"><span data-stu-id="818db-213">The behavior of the **/dd** or **/DeployToDatabase** switch depends on whether you're using VSDBCMD with a .dbschema file or a .deploymanifest file.</span></span> <span data-ttu-id="818db-214">如果您使用.dbschema 檔案，則行為是相當簡單：</span><span class="sxs-lookup"><span data-stu-id="818db-214">If you're using a .dbschema file, the behavior is fairly straightforward:</span></span>

- <span data-ttu-id="818db-215">如果您指定 **/dd+** 或 **/dd**，VSDBCMD 會產生部署指令碼及部署資料庫。</span><span class="sxs-lookup"><span data-stu-id="818db-215">If you specify **/dd+** or **/dd**, VSDBCMD will generate a deployment script and deploy the database.</span></span>
- <span data-ttu-id="818db-216">如果您指定 **/dd-** 或省略參數，VSDBCMD 皆會產生部署指令碼只。</span><span class="sxs-lookup"><span data-stu-id="818db-216">If you specify **/dd-** or omit the switch, VSDBCMD will generate a deployment script only.</span></span>

<span data-ttu-id="818db-217">如果您使用.deploymanifest 檔案，則行為是很複雜。</span><span class="sxs-lookup"><span data-stu-id="818db-217">If you're using a .deploymanifest file, the behavior is a lot more complicated.</span></span> <span data-ttu-id="818db-218">這是因為.deploymanifest 檔案包含屬性名稱**DeployToDatabase** ，也會決定是否要部署資料庫。</span><span class="sxs-lookup"><span data-stu-id="818db-218">This is because the .deploymanifest file contains a property name **DeployToDatabase** that also determines whether the database is deployed.</span></span>


[!code-xml[Main](deploying-database-projects/samples/sample2.xml)]


<span data-ttu-id="818db-219">根據資料庫專案的屬性來設定這個屬性的值。</span><span class="sxs-lookup"><span data-stu-id="818db-219">The value of this property is set according to the properties of the database project.</span></span> <span data-ttu-id="818db-220">如果您設定**部署動作**至**建立部署指令碼 (.sql)**，此值會是**False**。</span><span class="sxs-lookup"><span data-stu-id="818db-220">If you set the **Deploy action** to **Create a deployment script (.sql)**, the value will be **False**.</span></span> <span data-ttu-id="818db-221">如果您設定**部署動作**至**建立部署指令碼 (.sql) 並部署到資料庫**，值將是**True**。</span><span class="sxs-lookup"><span data-stu-id="818db-221">If you set the **Deploy action** to **Create a deployment script (.sql) and deploy to the database**, the value will be **True**.</span></span>

> [!NOTE]
> <span data-ttu-id="818db-222">這些設定會與特定組建組態與平台關聯。</span><span class="sxs-lookup"><span data-stu-id="818db-222">These settings are associated with a specific build configuration and platform.</span></span> <span data-ttu-id="818db-223">比方說，如果您設定**偵錯**組態，然後將發行使用**發行**組態中，將不會使用您的設定。</span><span class="sxs-lookup"><span data-stu-id="818db-223">For example, if you configure settings for the **Debug** configuration and then publish using the **Release** configuration, your settings will not be used.</span></span>


![](deploying-database-projects/_static/image3.png)

> [!NOTE]
> <span data-ttu-id="818db-224">在此案例中，**部署動作**應該一律設定為**建立部署指令碼 (.sql)**，因為您不想將資料庫部署 Visual Studio 2010。</span><span class="sxs-lookup"><span data-stu-id="818db-224">In this scenario, the **Deploy action** should always be set to **Create a deployment script (.sql)**, because you don't want Visual Studio 2010 to deploy your database.</span></span> <span data-ttu-id="818db-225">換句話說， **DeployToDatabase**屬性應永遠為**False**。</span><span class="sxs-lookup"><span data-stu-id="818db-225">In other words, the **DeployToDatabase** property should always be **False**.</span></span>


<span data-ttu-id="818db-226">當**DeployToDatabase**指定屬性， **/dd**交換器將只覆寫屬性的屬性值是否**false**:</span><span class="sxs-lookup"><span data-stu-id="818db-226">When a **DeployToDatabase** property is specified, the **/dd** switch will only override the property if the property value is **false**:</span></span>

- <span data-ttu-id="818db-227">如果**DeployToDatabase**屬性是**False**，而且您指定 **/dd+** 或 **/dd**，將會覆寫 VSDBCMD **DeployToDatabase**屬性及部署資料庫。</span><span class="sxs-lookup"><span data-stu-id="818db-227">If the **DeployToDatabase** property is **False**, and you specify **/dd+** or **/dd**, VSDBCMD will override the **DeployToDatabase** property and deploy the database.</span></span>
- <span data-ttu-id="818db-228">如果**DeployToDatabase**屬性是**False**，而且您指定 **/dd-** 或省略參數，VSDBCMD 不會將資料庫部署。</span><span class="sxs-lookup"><span data-stu-id="818db-228">If the **DeployToDatabase** property is **False**, and you specify **/dd-** or omit the switch, VSDBCMD will not deploy the database.</span></span>
- <span data-ttu-id="818db-229">如果**DeployToDatabase**屬性是**True**，VSDBCMD 將會忽略此參數，部署資料庫。</span><span class="sxs-lookup"><span data-stu-id="818db-229">If the **DeployToDatabase** property is **True**, VSDBCMD will ignore the switch and deploy the database.</span></span>
- <span data-ttu-id="818db-230">在各案例中，不論是否您要部署的資料庫也會產生部署指令碼。</span><span class="sxs-lookup"><span data-stu-id="818db-230">A deployment script is generated in each case, regardless of whether you're deploying the database as well.</span></span>

## <a name="conclusion"></a><span data-ttu-id="818db-231">結論</span><span class="sxs-lookup"><span data-stu-id="818db-231">Conclusion</span></span>

<span data-ttu-id="818db-232">本主題提供在 Visual Studio 2010 資料庫專案的組建和部署程序的概觀。</span><span class="sxs-lookup"><span data-stu-id="818db-232">This topic provided an overview of the build and deployment process for database projects in Visual Studio 2010.</span></span> <span data-ttu-id="818db-233">它也說明如何使用 VSDBCMD.exe 的 MSBuild 支援企業級資料庫部署。</span><span class="sxs-lookup"><span data-stu-id="818db-233">It also described how you can use VSDBCMD.exe with MSBuild to support enterprise-scale database deployment.</span></span>

<span data-ttu-id="818db-234">如需有關這實際上的運作方式的詳細資訊，請參閱[自訂資料庫部署多個環境](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="818db-234">For more information on how this works in practice, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="further-reading"></a><span data-ttu-id="818db-235">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="818db-235">Further Reading</span></span>

<span data-ttu-id="818db-236">如需如何建立不同的部署組態檔，每個環境中自訂資料庫部署資訊，請參閱[自訂資料庫部署多個環境](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="818db-236">For information on how to customize database deployments by creating a separate deployment configuration file for each environment, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span> <span data-ttu-id="818db-237">如需有關如何執行部署後指令碼來設定資料庫角色成員資格的指引，請參閱[部署資料庫角色成員資格測試環境](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="818db-237">For guidance on how to configure database role memberships by running a post-deployment script, see [Deploying Database Role Memberships to Test Environments](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).</span></span> <span data-ttu-id="818db-238">如需指引管理某些項挑戰，那該成員資格資料庫強制執行，請參閱[部署至企業環境的成員資格資料庫](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="818db-238">For guidance on managing some of the unique challenges that membership databases impose, see [Deploying Membership Databases to Enterprise Environments](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).</span></span>

<span data-ttu-id="818db-239">MSDN 上的這些主題會提供更廣泛的指導方針和 Visual Studio 資料庫專案的背景資訊和資料庫部署程序：</span><span class="sxs-lookup"><span data-stu-id="818db-239">These topics on MSDN provide broader guidance and background information on Visual Studio database projects and the database deployment process:</span></span>

- [<span data-ttu-id="818db-240">Visual Studio 2010 SQL Server 資料庫專案</span><span class="sxs-lookup"><span data-stu-id="818db-240">Visual Studio 2010 SQL Server Database Projects</span></span>](https://msdn.microsoft.com/library/ff678491.aspx)
- [<span data-ttu-id="818db-241">管理資料庫變更</span><span class="sxs-lookup"><span data-stu-id="818db-241">Managing Database Change</span></span>](https://msdn.microsoft.com/library/aa833404.aspx)
- [<span data-ttu-id="818db-242">如何： 準備資料庫以進行部署的命令提示字元使用 VSDBCMD。EXE</span><span class="sxs-lookup"><span data-stu-id="818db-242">How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE</span></span>](https://msdn.microsoft.com/library/dd193258.aspx)
- [<span data-ttu-id="818db-243">資料庫建置和部署的概觀</span><span class="sxs-lookup"><span data-stu-id="818db-243">An Overview of Database Build and Deployment</span></span>](https://msdn.microsoft.com/library/aa833165.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="818db-244">[上一頁](deploying-web-packages.md)
> [下一頁](creating-and-running-a-deployment-command-file.md)</span><span class="sxs-lookup"><span data-stu-id="818db-244">[Previous](deploying-web-packages.md)
[Next](creating-and-running-a-deployment-command-file.md)</span></span>
