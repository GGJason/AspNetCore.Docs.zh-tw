---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs
title: 使用現有的預存程序的具類型資料集的 Tableadapter (C#) |Microsoft 文件
author: rick-anderson
description: 在上一個教學課程中我們學到如何使用 TableAdapter 精靈來產生新的預存程序。 在此教學課程中我們了解如何在相同 TableAdapter...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/18/2007
ms.topic: article
ms.assetid: 440bef2a-1641-4238-99e3-8e2d44e7d94c
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs
msc.type: authoredcontent
ms.openlocfilehash: df8a714325ce99db615eddc3d457da5c926919ba
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/06/2018
ms.locfileid: "30877069"
---
<a name="using-existing-stored-procedures-for-the-typed-datasets-tableadapters-c"></a><span data-ttu-id="6a65a-104">使用現有的預存程序的具類型資料集的 Tableadapter (C#)</span><span class="sxs-lookup"><span data-stu-id="6a65a-104">Using Existing Stored Procedures for the Typed DataSet's TableAdapters (C#)</span></span>
====================
<span data-ttu-id="6a65a-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6a65a-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6a65a-106">[下載程式碼](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_CS.zip)或[下載 PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/datatutorial68cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="6a65a-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_CS.zip) or [Download PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/datatutorial68cs1.pdf)</span></span>

> <span data-ttu-id="6a65a-107">在上一個教學課程中我們學到如何使用 TableAdapter 精靈來產生新的預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-107">In the previous tutorial we learned how to use the TableAdapter Wizard to generate new stored procedures.</span></span> <span data-ttu-id="6a65a-108">本教學課程中我們了解如何相同 TableAdapter 精靈可搭配現有的預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-108">In this tutorial we learn how the same TableAdapter Wizard can work with existing stored procedures.</span></span> <span data-ttu-id="6a65a-109">我們也會了解如何以手動方式將新的預存程序加入至我們的資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a65a-109">We also learn how to manually add new stored procedures to our database.</span></span>


## <a name="introduction"></a><span data-ttu-id="6a65a-110">簡介</span><span class="sxs-lookup"><span data-stu-id="6a65a-110">Introduction</span></span>

<span data-ttu-id="6a65a-111">在[前述教學課程](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)我們可了解如何 s Tableadapter 的型別資料集無法設定為使用預存程序存取資料，而不是特定 SQL 陳述式。</span><span class="sxs-lookup"><span data-stu-id="6a65a-111">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) we saw how the Typed DataSet s TableAdapters could be configured to use stored procedures to access data rather than ad-hoc SQL statements.</span></span> <span data-ttu-id="6a65a-112">特別是，我們檢驗如何以自動建立這些預存程序 [Tabaleadapter 精靈]。</span><span class="sxs-lookup"><span data-stu-id="6a65a-112">In particular, we examined how to have the TableAdapter wizard automatically create these stored procedures.</span></span> <span data-ttu-id="6a65a-113">當舊版應用程式移植到 ASP.NET 2.0 或建置現有的資料模型周圍 ASP.NET 2.0 網站，有可能是資料庫已包含我們需要的預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-113">When porting a legacy application to ASP.NET 2.0 or when building an ASP.NET 2.0 website around an existing data model, chances are that the database already contains the stored procedures we need.</span></span> <span data-ttu-id="6a65a-114">或者，您可能想要建立預存程序，以手動方式或透過您的預存程序會自動產生 [Tabaleadapter 精靈] 以外的某些工具。</span><span class="sxs-lookup"><span data-stu-id="6a65a-114">Alternatively, you may prefer to create your stored procedures by hand or through some tool other than the TableAdapter wizard that auto-generates your stored procedures.</span></span>

<span data-ttu-id="6a65a-115">在此教學課程中我們將探討如何設定要使用現有的預存程序的 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="6a65a-115">In this tutorial we will look at how to configure the TableAdapter to use existing stored procedures.</span></span> <span data-ttu-id="6a65a-116">因為 Northwind 資料庫只會有較少的內建的預存程序，我們也會探討手動將新的預存程序新增至 Visual Studio 環境透過資料庫所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="6a65a-116">Since the Northwind database only has a small set of built-in stored procedures, we will also look at the steps needed to manually add new stored procedures to the database through the Visual Studio environment.</span></span> <span data-ttu-id="6a65a-117">Let s 開始 ！</span><span class="sxs-lookup"><span data-stu-id="6a65a-117">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="6a65a-118">在[包裝在交易內的資料庫修改](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md)教學課程中我們將方法加入 TableAdapter 為支援交易 (`BeginTransaction`，`CommitTransaction`等等)。</span><span class="sxs-lookup"><span data-stu-id="6a65a-118">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) tutorial we added methods to the TableAdapter to support transactions (`BeginTransaction`, `CommitTransaction`, and so on).</span></span> <span data-ttu-id="6a65a-119">或者，可以完全在預存程序，不需要修改的資料存取層程式碼來管理交易。</span><span class="sxs-lookup"><span data-stu-id="6a65a-119">Alternatively, transactions can be managed entirely within a stored procedure, which requires no modifications to the Data Access Layer code.</span></span> <span data-ttu-id="6a65a-120">在本教學課程中，我們將探討用來執行預存程序 s 陳述式的範圍內的交易的 T-SQL 命令。</span><span class="sxs-lookup"><span data-stu-id="6a65a-120">In this tutorial we'll explore the T-SQL commands used to execute a stored procedure s statements within the scope of a transaction.</span></span>


## <a name="step-1-adding-stored-procedures-to-the-northwind-database"></a><span data-ttu-id="6a65a-121">步驟 1： 將預存程序加入至 Northwind 資料庫</span><span class="sxs-lookup"><span data-stu-id="6a65a-121">Step 1: Adding Stored Procedures to the Northwind Database</span></span>

<span data-ttu-id="6a65a-122">Visual Studio 輕鬆地將新的預存程序加入至資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a65a-122">Visual Studio makes it easy to add new stored procedures to a database.</span></span> <span data-ttu-id="6a65a-123">O d e s 傳回所有資料行，從 Northwind 資料庫中加入新的預存程序`Products`適用於具有特定資料表`CategoryID`值。</span><span class="sxs-lookup"><span data-stu-id="6a65a-123">Let s add a new stored procedure to the Northwind database that returns all columns from the `Products` table for those that have a particular `CategoryID` value.</span></span> <span data-ttu-id="6a65a-124">從 [伺服器總管] 視窗中展開 Northwind 資料庫，讓其資料夾-資料庫圖表、 資料表、 檢視和等位會顯示。</span><span class="sxs-lookup"><span data-stu-id="6a65a-124">From the Server Explorer window, expand the Northwind database so that its folders - Database Diagrams, Tables, Views, and so forth - are displayed.</span></span> <span data-ttu-id="6a65a-125">如我們所見前述教學課程中，這個預存程序資料夾包含的資料庫 s 現有預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-125">As we saw in the preceding tutorial, the Stored Procedures folder contains the database s existing stored procedures.</span></span> <span data-ttu-id="6a65a-126">若要加入新的預存程序，只要以滑鼠右鍵按一下 預存程序 資料夾，並從內容功能表中選擇 加入新的預存程序選項。</span><span class="sxs-lookup"><span data-stu-id="6a65a-126">To add a new stored procedure, simply right-click the Stored Procedures folder and choose the Add New Stored Procedure option from the context menu.</span></span>


<span data-ttu-id="6a65a-127">[![以滑鼠右鍵按一下 [預存程序] 資料夾，並加入新的預存程序](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-127">[![Right-Click the Stored Procedures Folder and Add a New Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image1.png)</span></span>

<span data-ttu-id="6a65a-128">**圖 1**： 以滑鼠右鍵按一下預存程序 」 資料夾，並加入新的預存程序 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-128">**Figure 1**: Right-Click the Stored Procedures Folder and Add a New Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image3.png))</span></span>


<span data-ttu-id="6a65a-129">如圖 1 所示，選取 [加入新的預存程序] 選項會開啟的指令碼視窗 Visual Studio 中與建立預存程序所需的 SQL 指令碼的大綱。</span><span class="sxs-lookup"><span data-stu-id="6a65a-129">As Figure 1 shows, selecting the Add New Stored Procedure option opens a script window in Visual Studio with the outline of the SQL script needed to create the stored procedure.</span></span> <span data-ttu-id="6a65a-130">就是我們來充實此指令碼和執行它，此時預存程序將會加入至資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a65a-130">It is our job to flesh out this script and execute it, at which point the stored procedure will be added to the database.</span></span>

<span data-ttu-id="6a65a-131">輸入下列指令碼：</span><span class="sxs-lookup"><span data-stu-id="6a65a-131">Enter the following script:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample1.sql)]

<span data-ttu-id="6a65a-132">此指令碼，在執行時，會將新的預存程序加入至名為 Northwind 資料庫`Products_SelectByCategoryID`。</span><span class="sxs-lookup"><span data-stu-id="6a65a-132">This script, when executed, will add a new stored procedure to the Northwind database named `Products_SelectByCategoryID`.</span></span> <span data-ttu-id="6a65a-133">這個預存程序會接受單一輸入的參數 (`@CategoryID`，型別`int`)，它會傳回所有符合這些產品欄位`CategoryID`值。</span><span class="sxs-lookup"><span data-stu-id="6a65a-133">This stored procedure accepts a single input parameter (`@CategoryID`, of type `int`) and it returns all of the fields for those products with a matching `CategoryID` value.</span></span>

<span data-ttu-id="6a65a-134">若要執行此`CREATE PROCEDURE`指令碼和預存程序加入至資料庫、 按一下工具列中的 [儲存] 圖示或按 Ctrl + S。</span><span class="sxs-lookup"><span data-stu-id="6a65a-134">To execute this `CREATE PROCEDURE` script and add the stored procedure to the database, click the Save icon in the toolbar or hit Ctrl+S.</span></span> <span data-ttu-id="6a65a-135">這樣做之後，預存程序資料夾重新整理，顯示新建立預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-135">After doing so, the Stored Procedures folder refreshes, showing the newly created stored procedure.</span></span> <span data-ttu-id="6a65a-136">此外，在視窗中的指令碼將變更從微妙的地方`CREATE PROCEDURE dbo.Products_SelectProductByCategoryID`至`ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`。</span><span class="sxs-lookup"><span data-stu-id="6a65a-136">Also, the script in the window will change subtlety from `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` to `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span></span> <span data-ttu-id="6a65a-137">`CREATE PROCEDURE` 在資料庫中，加入新的預存程序時`ALTER PROCEDURE`更新現有。</span><span class="sxs-lookup"><span data-stu-id="6a65a-137">`CREATE PROCEDURE` adds a new stored procedure to the database, while `ALTER PROCEDURE` updates an existing one.</span></span> <span data-ttu-id="6a65a-138">因為指令碼開頭已變更為`ALTER PROCEDURE`，變更預存程序輸入參數或 SQL 陳述式，並按一下 [儲存] 圖示將會使用這些變更更新預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-138">Since the start of the script has changed to `ALTER PROCEDURE`, changing the stored procedures input parameters or SQL statements and clicking the Save icon will update the stored procedure with these changes.</span></span>

<span data-ttu-id="6a65a-139">圖 2 顯示 Visual Studio 之後`Products_SelectByCategoryID`尚未儲存預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-139">Figure 2 shows Visual Studio after the `Products_SelectByCategoryID` stored procedure has been saved.</span></span>


<span data-ttu-id="6a65a-140">[![預存程序 Products_SelectByCategoryID 加入資料庫](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-140">[![The Stored Procedure Products_SelectByCategoryID Has Been Added to the Database](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image4.png)</span></span>

<span data-ttu-id="6a65a-141">**圖 2**: 預存程序`Products_SelectByCategoryID`已加入至資料庫 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-141">**Figure 2**: The Stored Procedure `Products_SelectByCategoryID` Has Been Added to the Database ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image6.png))</span></span>


## <a name="step-2-configuring-the-tableadapter-to-use-an-existing-stored-procedure"></a><span data-ttu-id="6a65a-142">步驟 2： 設定要使用現有的預存程序的 TableAdapter</span><span class="sxs-lookup"><span data-stu-id="6a65a-142">Step 2: Configuring the TableAdapter to Use an Existing Stored Procedure</span></span>

<span data-ttu-id="6a65a-143">既然`Products_SelectByCategoryID`預存程序已加入至資料庫，我們可以 concigure 我們的資料存取層，其中一個方法叫用時，請使用此預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-143">Now that the `Products_SelectByCategoryID` stored procedure has been added to the database, we can concigure our Data Access Layer to use this stored procedure when one of its methods is invoked.</span></span> <span data-ttu-id="6a65a-144">特別是，我們將會加入`GetProducstByCategoryID(categoryID)`方法`ProductsTableAdapter`中`NorthwindWithSprocs`呼叫的型別資料集`Products_SelectByCategoryID`預存程序剛才所建立。</span><span class="sxs-lookup"><span data-stu-id="6a65a-144">In particular, we will add a `GetProducstByCategoryID(categoryID)` method to the `ProductsTableAdapter` in the `NorthwindWithSprocs` Typed DataSet that calls the `Products_SelectByCategoryID` stored procedure we just created.</span></span>

<span data-ttu-id="6a65a-145">先開啟`NorthwindWithSprocs`資料集。</span><span class="sxs-lookup"><span data-stu-id="6a65a-145">Start by opening the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="6a65a-146">以滑鼠右鍵按一下`ProductsTableAdapter`，然後選擇 加入查詢，啟動 TableAdapter 查詢組態精靈。</span><span class="sxs-lookup"><span data-stu-id="6a65a-146">Right-click on the `ProductsTableAdapter` and choose Add Query to launch the TableAdapter Query Configuration wizard.</span></span> <span data-ttu-id="6a65a-147">在[前述教學課程](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)我們選擇已建立新的預存程序為我們的 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="6a65a-147">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) we opted to have the TableAdapter create a new stored procedure for us.</span></span> <span data-ttu-id="6a65a-148">此教學課程中，不過，我們想要連接至現有的新的 TableAdapter 方法`Products_SelectByCategoryID`預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-148">For this tutorial, however, we want to wire the new TableAdapter method to the existing `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="6a65a-149">因此，精靈 s 第一個步驟中選擇使用現有的預存程序選項，然後按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="6a65a-149">Therefore, choose the Use existing stored procedure option from the wizard s first step and then click Next.</span></span>


<span data-ttu-id="6a65a-150">[![選擇 使用現有的預存程序選項](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-150">[![Choose the Use existing stored procedure Option](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image7.png)</span></span>

<span data-ttu-id="6a65a-151">**圖 3**： 選擇使用現有的預存程序選項 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-151">**Figure 3**: Choose the Use existing stored procedure Option ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image9.png))</span></span>


<span data-ttu-id="6a65a-152">下列畫面會提供下拉式清單填入資料庫 s 預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-152">The following screen provides a drop-down list populated with the database s stored procedures.</span></span> <span data-ttu-id="6a65a-153">選取預存程序會列出其左邊和右邊傳回 （如果有的話） 的資料欄位的輸入的參數。</span><span class="sxs-lookup"><span data-stu-id="6a65a-153">Selecting a stored procedure lists its input parameters on the left and the data fields returned (if any) on the right.</span></span> <span data-ttu-id="6a65a-154">選擇`Products_SelectByCategoryID`預存程序，從清單中，按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="6a65a-154">Choose the `Products_SelectByCategoryID` stored procedure from the list and click Next.</span></span>


<span data-ttu-id="6a65a-155">[![挑選 Products_SelectByCategoryID 預存程序](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-155">[![Pick the Products_SelectByCategoryID Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image10.png)</span></span>

<span data-ttu-id="6a65a-156">**圖 4**： 挑選`Products_SelectByCategoryID`預存程序 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-156">**Figure 4**: Pick the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image12.png))</span></span>


<span data-ttu-id="6a65a-157">下一個畫面會詢問您的資料類型由預存程序，我們在這裡的回答決定了 TableAdapter 的方法所傳回的類型。</span><span class="sxs-lookup"><span data-stu-id="6a65a-157">The next screen asks us what kind of data is returned by the stored procedure and our answer here determines the type returned by the TableAdapter s method.</span></span> <span data-ttu-id="6a65a-158">例如，如果我們表示會傳回表格式資料，則方法會傳回`ProductsDataTable`填入傳回記錄的預存程序的執行個體。</span><span class="sxs-lookup"><span data-stu-id="6a65a-158">For example, if we indicate that tabular data is returned, the method will return a `ProductsDataTable` instance populated with the records returned by the stored procedure.</span></span> <span data-ttu-id="6a65a-159">相反地，如果我們指出此預存程序傳回單一值會傳回 TableAdapter`object`指派預存程序所傳回的第一個記錄的第一個資料行中的值。</span><span class="sxs-lookup"><span data-stu-id="6a65a-159">In contrast, if we indicate that this stored procedure returns a single value the TableAdapter will return an `object` that is assigned the value in the first column of the first record returned by the stored procedure.</span></span>

<span data-ttu-id="6a65a-160">因為`Products_SelectByCategoryID`預存程序會傳回屬於特定類別，選擇第一個回應的表格式資料-然後按下一步的所有產品。</span><span class="sxs-lookup"><span data-stu-id="6a65a-160">Since the `Products_SelectByCategoryID` stored procedure returns all products that belong to a particular category, choose the first answer - Tabular data - and click Next.</span></span>


<span data-ttu-id="6a65a-161">[![指出預存程序傳回表格式資料](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-161">[![Indicate that the Stored Procedure Returns Tabular Data](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image13.png)</span></span>

<span data-ttu-id="6a65a-162">**圖 5**： 指出預存程序傳回表格式資料 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-162">**Figure 5**: Indicate that the Stored Procedure Returns Tabular Data ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image15.png))</span></span>


<span data-ttu-id="6a65a-163">剩下的就是以指出方法模式來使用這些方法的名稱後面。</span><span class="sxs-lookup"><span data-stu-id="6a65a-163">All that remains is to indicate what method patterns to use followed by the names for these methods.</span></span> <span data-ttu-id="6a65a-164">保留的填滿 DataTable 和 傳回 DataTable 選項選取此選項，但重新命名的方法`FillByCategoryID`和`GetProductsByCategoryID`。</span><span class="sxs-lookup"><span data-stu-id="6a65a-164">Leave both the Fill a DataTable and Return a DataTable options checked, but rename the methods to `FillByCategoryID` and `GetProductsByCategoryID`.</span></span> <span data-ttu-id="6a65a-165">然後按一下 [下一步] 檢閱精靈即將執行的工作的摘要。</span><span class="sxs-lookup"><span data-stu-id="6a65a-165">Then click Next to review a summary of the tasks the wizard will perform.</span></span> <span data-ttu-id="6a65a-166">如果一切正確，按一下 [完成]。</span><span class="sxs-lookup"><span data-stu-id="6a65a-166">If everything looks correct, click Finish.</span></span>


<span data-ttu-id="6a65a-167">[![名稱方法 FillByCategoryID 和 GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-167">[![Name the Methods FillByCategoryID and GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image16.png)</span></span>

<span data-ttu-id="6a65a-168">**圖 6**: Name 方法`FillByCategoryID`和`GetProductsByCategoryID`([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-168">**Figure 6**: Name the Methods `FillByCategoryID` and `GetProductsByCategoryID` ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image18.png))</span></span>


> [!NOTE]
> <span data-ttu-id="6a65a-169">我們剛建立的 TableAdapter 方法`FillByCategoryID`和`GetProductsByCategoryID`，預期類型的輸入的參數`int`。</span><span class="sxs-lookup"><span data-stu-id="6a65a-169">The TableAdapter methods we just created, `FillByCategoryID` and `GetProductsByCategoryID`, expect an input parameter of type `int`.</span></span> <span data-ttu-id="6a65a-170">此輸入的參數值傳遞至預存程序，透過其`@CategoryID`參數。</span><span class="sxs-lookup"><span data-stu-id="6a65a-170">This input parameter value is passed into the stored procedure via its `@CategoryID` parameter.</span></span> <span data-ttu-id="6a65a-171">如果您修改`Products_SelectByCategory`預存程序的參數，您必須也更新這些 TableAdapter 方法的參數。</span><span class="sxs-lookup"><span data-stu-id="6a65a-171">If you modify the `Products_SelectByCategory` stored procedure s parameters, you'll need to also update the parameters for these TableAdapter methods.</span></span> <span data-ttu-id="6a65a-172">中所述[上一個教學課程](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)，作法是在兩種方式之一： 透過手動新增或移除參數從參數集合，或返回 [Tabaleadapter 精靈]。</span><span class="sxs-lookup"><span data-stu-id="6a65a-172">As discussed in the [previous tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md), this can be done in one of two ways: by manually adding or removing parameters from the parameters collection or by rerunning the TableAdapter wizard.</span></span>


## <a name="step-3-adding-agetproductsbycategoryidcategoryidmethod-to-the-bll"></a><span data-ttu-id="6a65a-173">步驟 3： 加入`GetProductsByCategoryID(categoryID)`BLL 方法</span><span class="sxs-lookup"><span data-stu-id="6a65a-173">Step 3: Adding a`GetProductsByCategoryID(categoryID)`Method to the BLL</span></span>

<span data-ttu-id="6a65a-174">與`GetProductsByCategoryID`DAL 方法完成下, 一個步驟是讓商務邏輯層中，這個方法的存取。</span><span class="sxs-lookup"><span data-stu-id="6a65a-174">With the `GetProductsByCategoryID` DAL method complete, the next step is to provide access to this method in the Business Logic Layer.</span></span> <span data-ttu-id="6a65a-175">開啟`ProductsBLLWithSprocs`類別檔案，然後將下列方法：</span><span class="sxs-lookup"><span data-stu-id="6a65a-175">Open the `ProductsBLLWithSprocs` class file and add the following method:</span></span>


[!code-csharp[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample2.cs)]

<span data-ttu-id="6a65a-176">這個 BLL 方法只會傳回`ProductsDataTable`從傳回`ProductsTableAdapter`s`GetProductsByCategoryID`方法。</span><span class="sxs-lookup"><span data-stu-id="6a65a-176">This BLL method simply returns the `ProductsDataTable` returned from the `ProductsTableAdapter` s `GetProductsByCategoryID` method.</span></span> <span data-ttu-id="6a65a-177">`DataObjectMethodAttribute`屬性提供 ObjectDataSource s 設定資料來源精靈 所使用的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="6a65a-177">The `DataObjectMethodAttribute` attribute provides metadata used by the ObjectDataSource s Configure Data Source wizard.</span></span> <span data-ttu-id="6a65a-178">特別是，這個方法會出現在選取的索引標籤的下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="6a65a-178">In particular, this method will appear in the SELECT tab s drop-down list.</span></span>

## <a name="step-4-displaying-products-by-category"></a><span data-ttu-id="6a65a-179">步驟 4： 顯示產品類別目錄</span><span class="sxs-lookup"><span data-stu-id="6a65a-179">Step 4: Displaying Products by Category</span></span>

<span data-ttu-id="6a65a-180">若要測試新加入`Products_SelectByCategoryID`預存程序和對應的 DAL 和 BLL 方法，讓建立 ASP.NET 網頁，其中包含 DropDownList 和 GridView。</span><span class="sxs-lookup"><span data-stu-id="6a65a-180">To test the newly added `Products_SelectByCategoryID` stored procedure and the corresponding DAL and BLL methods, let s create an ASP.NET page that contains a DropDownList and a GridView.</span></span> <span data-ttu-id="6a65a-181">DropDownList 會列出所有資料庫中的類別時 GridView 會顯示屬於所選類別目錄的產品。</span><span class="sxs-lookup"><span data-stu-id="6a65a-181">The DropDownList will list all of the categories in the database while the GridView will display the products belonging to the selected category.</span></span>

> [!NOTE]
> <span data-ttu-id="6a65a-182">我們已建立主從式介面在先前的教學課程中使用 DropDownLists。</span><span class="sxs-lookup"><span data-stu-id="6a65a-182">We ve created master/detail interfaces using DropDownLists in previous tutorials.</span></span> <span data-ttu-id="6a65a-183">更深入探討實作主要/詳細資料報表，請參閱[主要/詳細資料篩選與 DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="6a65a-183">For a more in-depth look at implementing such a master/detail report, refer to the [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) tutorial.</span></span>


<span data-ttu-id="6a65a-184">開啟`ExistingSprocs.aspx`頁面`AdvancedDAL`資料夾，然後從 [工具箱] 拖曳至設計工具拖曳 DropDownList。</span><span class="sxs-lookup"><span data-stu-id="6a65a-184">Open the `ExistingSprocs.aspx` page in the `AdvancedDAL` folder and drag a DropDownList from the Toolbox onto the Designer.</span></span> <span data-ttu-id="6a65a-185">設定 DropDownList s`ID`屬性`Categories`及其`AutoPostBack`屬性`true`。</span><span class="sxs-lookup"><span data-stu-id="6a65a-185">Set the DropDownList s `ID` property to `Categories` and its `AutoPostBack` property to `true`.</span></span> <span data-ttu-id="6a65a-186">接下來，從其智慧標籤，將繫結 DropDownList 至名為新 ObjectDataSource `CategoriesDataSource`。</span><span class="sxs-lookup"><span data-stu-id="6a65a-186">Next, from its smart tag, bind the DropDownList to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="6a65a-187">因此，它會擷取資料的來源設定 ObjectDataSource`CategoriesBLL`類別的`GetCategories`方法。</span><span class="sxs-lookup"><span data-stu-id="6a65a-187">Configure the ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="6a65a-188">設定下拉式清單中更新、 插入和刪除索引標籤為 （無）。</span><span class="sxs-lookup"><span data-stu-id="6a65a-188">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="6a65a-189">[![從 CategoriesBLL 類別的 GetCategories 方法擷取資料](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-189">[![Retrieve Data from the CategoriesBLL Class s GetCategories Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image19.png)</span></span>

<span data-ttu-id="6a65a-190">**圖 7**： 擷取資料，從`CategoriesBLL`類別 s`GetCategories`方法 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-190">**Figure 7**: Retrieve Data from the `CategoriesBLL` Class s `GetCategories` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image21.png))</span></span>


<span data-ttu-id="6a65a-191">[![設定下拉式清單中更新、 插入和刪除 （無） 索引標籤](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-191">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image22.png)</span></span>

<span data-ttu-id="6a65a-192">**圖 8**： 下拉式清單中設定更新、 插入和刪除的索引標籤 （無） ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-192">**Figure 8**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image24.png))</span></span>


<span data-ttu-id="6a65a-193">完成 ObjectDataSource 精靈之後，設定要顯示 DropDownList`CategoryName`資料欄位並使用`CategoryID`欄位做為`Value`每個`ListItem`。</span><span class="sxs-lookup"><span data-stu-id="6a65a-193">After completing the ObjectDataSource wizard, configure the DropDownList to display the `CategoryName` data field and to use the `CategoryID` field as the `Value` for each `ListItem`.</span></span>

<span data-ttu-id="6a65a-194">此時，DropDownList 和 ObjectDataSource s 宣告式標記應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="6a65a-194">At this point, the DropDownList and ObjectDataSource s declarative markup should similar to the following:</span></span>


[!code-aspx[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample3.aspx)]

<span data-ttu-id="6a65a-195">下一步，拖曳至設計工具中，將此硬碟置於 DropDownList 下方的 GridView。</span><span class="sxs-lookup"><span data-stu-id="6a65a-195">Next, drag a GridView onto the Designer, placing it beneath the DropDownList.</span></span> <span data-ttu-id="6a65a-196">設定 GridView s`ID`至`ProductsByCategory`和其智慧標籤上，從繫結到名為新 ObjectDataSource `ProductsByCategoryDataSource`。</span><span class="sxs-lookup"><span data-stu-id="6a65a-196">Set the GridView s `ID` to `ProductsByCategory` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="6a65a-197">設定`ProductsByCategoryDataSource`使用 ObjectDataSource`ProductsBLLWithSprocs`類別，它會擷取其資料使用`GetProductsByCategoryID(categoryID)`方法。</span><span class="sxs-lookup"><span data-stu-id="6a65a-197">Configure the `ProductsByCategoryDataSource` ObjectDataSource to use the `ProductsBLLWithSprocs` class, having it retrieve its data using the `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="6a65a-198">此 GridView 將只可用來顯示資料，因為下拉式清單中更新、 插入和刪除索引標籤為 （無） 並按下一步。</span><span class="sxs-lookup"><span data-stu-id="6a65a-198">Since this GridView will only be used to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and click Next.</span></span>


<span data-ttu-id="6a65a-199">[![設定使用 ProductsBLLWithSprocs 類別 ObjectDataSource](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-199">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image25.png)</span></span>

<span data-ttu-id="6a65a-200">**圖 9**： 設定要使用 ObjectDataSource`ProductsBLLWithSprocs`類別 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-200">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image27.png))</span></span>


<span data-ttu-id="6a65a-201">[![從 GetProductsByCategoryID(categoryID) 方法擷取資料](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-201">[![Retrieve Data from the GetProductsByCategoryID(categoryID) Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image28.png)</span></span>

<span data-ttu-id="6a65a-202">**圖 10**： 擷取資料，從`GetProductsByCategoryID(categoryID)`方法 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-202">**Figure 10**: Retrieve Data from the `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image30.png))</span></span>


<span data-ttu-id="6a65a-203">在 [選取] 索引標籤中選擇的方法預期參數，因此精靈的最後一個步驟會將我們提示參數 s 的來源。</span><span class="sxs-lookup"><span data-stu-id="6a65a-203">The method chosen in the SELECT tab expects a parameter, so the final step of the wizard prompts us for the parameter s source.</span></span> <span data-ttu-id="6a65a-204">設定參數來源下拉式清單控制項，然後選擇 `Categories`控制項從 ControlID 下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="6a65a-204">Set the Parameter source drop-down list to Control and choose the `Categories` control from the ControlID drop-down list.</span></span> <span data-ttu-id="6a65a-205">按一下 [完成] 5d; 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="6a65a-205">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="6a65a-206">[![使用類別 DropDownList 做 categoryID 參數的來源](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-206">[![Use the Categories DropDownList as the Source of the categoryID Parameter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image31.png)</span></span>

<span data-ttu-id="6a65a-207">**圖 11**： 使用`Categories`做為來源的 DropDownList`categoryID`參數 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-207">**Figure 11**: Use the `Categories` DropDownList as the Source of the `categoryID` Parameter ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image33.png))</span></span>


<span data-ttu-id="6a65a-208">完成 [ObjectDataSource] 精靈，Visual Studio 會加入 BoundFields 以及 CheckBoxField 每個產品資料欄位。</span><span class="sxs-lookup"><span data-stu-id="6a65a-208">Upon completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="6a65a-209">請隨意自訂這些欄位，根據您的需要。</span><span class="sxs-lookup"><span data-stu-id="6a65a-209">Feel free to customize these fields as you see fit.</span></span>

<span data-ttu-id="6a65a-210">瀏覽透過瀏覽器的頁面。</span><span class="sxs-lookup"><span data-stu-id="6a65a-210">Visit the page through a browser.</span></span> <span data-ttu-id="6a65a-211">當瀏覽 [已選取的飲料類別目錄] 頁面和對應方格中列出的產品。</span><span class="sxs-lookup"><span data-stu-id="6a65a-211">When visiting the page the Beverages category is selected and the corresponding products listed in the grid.</span></span> <span data-ttu-id="6a65a-212">將下拉式清單變更為替代的類別，圖 12 顯示、 導致回傳並重新載入格線，內含新選取的類別目錄的產品。</span><span class="sxs-lookup"><span data-stu-id="6a65a-212">Changing the drop-down list to an alternative category, as Figure 12 shows, causes a postback and reloads the grid with the products of the newly selected category.</span></span>


<span data-ttu-id="6a65a-213">[![會顯示產生的類別目錄中的產品](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-213">[![The Products in the Produce Category are Displayed](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image34.png)</span></span>

<span data-ttu-id="6a65a-214">**圖 12**： 會顯示產生的類別目錄中的產品 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-214">**Figure 12**: The Products in the Produce Category are Displayed ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image36.png))</span></span>


## <a name="step-5-wrapping-a-stored-procedure-s-statements-within-the-scope-of-a-transaction"></a><span data-ttu-id="6a65a-215">步驟 5： 包裝預存程序 s 陳述式的交易範圍內</span><span class="sxs-lookup"><span data-stu-id="6a65a-215">Step 5: Wrapping a Stored Procedure s Statements Within the Scope of a Transaction</span></span>

<span data-ttu-id="6a65a-216">在[包裝在交易內的資料庫修改](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md)教學課程中我們將討論資料庫修改陳述式的範圍內的交易的一系列的技術。</span><span class="sxs-lookup"><span data-stu-id="6a65a-216">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) tutorial we discussed techniques for performing a series of database modification statements within the scope of a transaction.</span></span> <span data-ttu-id="6a65a-217">提醒您，或是執行起交易的修改所有成功 」 或 「 所有的失敗，保證不可部份完成性。</span><span class="sxs-lookup"><span data-stu-id="6a65a-217">Recall that the modifications performed under the umbrella of a transaction either all succeed or all fail, guaranteeing atomicity.</span></span> <span data-ttu-id="6a65a-218">使用的交易的相關技巧包括：</span><span class="sxs-lookup"><span data-stu-id="6a65a-218">Techniques for using transactions include:</span></span>

- <span data-ttu-id="6a65a-219">使用中的類別`System.Transactions`命名空間，</span><span class="sxs-lookup"><span data-stu-id="6a65a-219">Using the classes in the `System.Transactions` namespace,</span></span>
- <span data-ttu-id="6a65a-220">讓資料存取層使用 ADO.NET 類別，例如`SqlTransaction`，和</span><span class="sxs-lookup"><span data-stu-id="6a65a-220">Having the Data Access Layer use ADO.NET classes like `SqlTransaction`, and</span></span>
- <span data-ttu-id="6a65a-221">加入直接在預存程序內的 T-SQL 和交易命令</span><span class="sxs-lookup"><span data-stu-id="6a65a-221">Adding the T-SQL transaction commands directly within the stored procedure</span></span>

<span data-ttu-id="6a65a-222">*包裝在交易內的資料庫修改*教學課程中 DAL 使用 ADO.NET 類別。</span><span class="sxs-lookup"><span data-stu-id="6a65a-222">The *Wrapping Database Modifications within a Transaction* tutorial used the ADO.NET classes in the DAL.</span></span> <span data-ttu-id="6a65a-223">本教學課程的其餘部分會檢查如何管理使用 T-SQL 命令從預存程序內的交易。</span><span class="sxs-lookup"><span data-stu-id="6a65a-223">The remainder of this tutorial examines how to manage a transaction using T-SQL commands from within a stored procedure.</span></span>

<span data-ttu-id="6a65a-224">手動啟動、 認可，以及回復交易的三個主要 SQL 命令是`BEGIN TRANSACTION`， `COMMIT TRANSACTION`，和`ROLLBACK TRANSACTION`分別。</span><span class="sxs-lookup"><span data-stu-id="6a65a-224">The three key SQL commands for manually starting, committing, and rolling back a transaction are `BEGIN TRANSACTION`, `COMMIT TRANSACTION`, and `ROLLBACK TRANSACTION`, respectively.</span></span> <span data-ttu-id="6a65a-225">使用預存程序，我們需要套用下列模式中的交易時的 ADO.NET 方法，例如：</span><span class="sxs-lookup"><span data-stu-id="6a65a-225">Like with the ADO.NET approach, when using transactions from within a stored procedure we need to apply the following pattern:</span></span>

1. <span data-ttu-id="6a65a-226">表示開始的交易。</span><span class="sxs-lookup"><span data-stu-id="6a65a-226">Indicate the start of a transaction.</span></span>
2. <span data-ttu-id="6a65a-227">執行 SQL 陳述式組成的交易。</span><span class="sxs-lookup"><span data-stu-id="6a65a-227">Execute the SQL statements that comprise the transaction.</span></span>
3. <span data-ttu-id="6a65a-228">如果任何一種從步驟 2 中，復原交易的陳述式錯誤</span><span class="sxs-lookup"><span data-stu-id="6a65a-228">If there is an error in any one of the statements from Step 2, rollback the transaction</span></span>
4. <span data-ttu-id="6a65a-229">如果所有的步驟 2 中的陳述式完成不會發生錯誤時，會認可交易。</span><span class="sxs-lookup"><span data-stu-id="6a65a-229">If all of the statements from Step 2 complete without error, commit the transaction.</span></span>

<span data-ttu-id="6a65a-230">可以實作此模式中使用下列範本的 T-SQL 語法：</span><span class="sxs-lookup"><span data-stu-id="6a65a-230">This pattern can be implemented in T-SQL syntax using the following template:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample4.sql)]

<span data-ttu-id="6a65a-231">範本會定義啟動`TRY...CATCH`區塊中，新增到 SQL Server 2005 的建構。</span><span class="sxs-lookup"><span data-stu-id="6a65a-231">The template starts by defining a `TRY...CATCH` block, a construct new to SQL Server 2005.</span></span> <span data-ttu-id="6a65a-232">例如`try...catch`封鎖在 C# 中，SQL`TRY...CATCH`區塊會執行中的陳述式`TRY`區塊。</span><span class="sxs-lookup"><span data-stu-id="6a65a-232">Like with `try...catch` blocks in C#, the SQL `TRY...CATCH` block executes the statements in the `TRY` block.</span></span> <span data-ttu-id="6a65a-233">如果任何陳述式引發錯誤，控制權會立即轉移到`CATCH`區塊。</span><span class="sxs-lookup"><span data-stu-id="6a65a-233">If any statement raises an error, control is immediately transferred to the `CATCH` block.</span></span>

<span data-ttu-id="6a65a-234">如果沒有執行 SQL 陳述式的交易，該結構的錯誤`COMMIT TRANSACTION`陳述式認可的變更並完成交易。</span><span class="sxs-lookup"><span data-stu-id="6a65a-234">If there are no errors executing the SQL statements that makeup the transaction, the `COMMIT TRANSACTION` statement commits the changes and completes the transaction.</span></span> <span data-ttu-id="6a65a-235">如果其中一個陳述式導致錯誤，不過，`ROLLBACK TRANSACTION`中`CATCH`區塊將使資料庫回到其交易啟動之前的狀態。</span><span class="sxs-lookup"><span data-stu-id="6a65a-235">If, however, one of the statements results in an error, the `ROLLBACK TRANSACTION` in the `CATCH` block returns the database to its state prior to the start of the transaction.</span></span> <span data-ttu-id="6a65a-236">預存程序也會引發錯誤使用[RAISERROR 命令](https://msdn.microsoft.com/library/ms178592.aspx)，這會導致`SqlException`在應用程式中引發。</span><span class="sxs-lookup"><span data-stu-id="6a65a-236">The stored procedure also raises an error using the [RAISERROR command](https://msdn.microsoft.com/library/ms178592.aspx), which causes a `SqlException` to be raised in the application.</span></span>

> [!NOTE]
> <span data-ttu-id="6a65a-237">因為`TRY...CATCH`區塊的新 SQL Server 2005、 如果您使用舊版的 Microsoft SQL Server，將無法使用上述的範本。</span><span class="sxs-lookup"><span data-stu-id="6a65a-237">Since the `TRY...CATCH` block is new to SQL Server 2005, the above template will not work if you are using older versions of Microsoft SQL Server.</span></span> <span data-ttu-id="6a65a-238">如果您不使用 SQL Server 2005，請參閱[管理 SQL Server 預存程序中的交易](http://www.4guysfromrolla.com/webtech/080305-1.shtml)的範本，將會使用其他版本的 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="6a65a-238">If you are not using SQL Server 2005, consult [Managing Transactions in SQL Server Stored Procedures](http://www.4guysfromrolla.com/webtech/080305-1.shtml) for a template that will work with other versions of SQL Server.</span></span>


<span data-ttu-id="6a65a-239">可讓 s 查看具體的範例。</span><span class="sxs-lookup"><span data-stu-id="6a65a-239">Let s look at a concrete example.</span></span> <span data-ttu-id="6a65a-240">之間存在的外部索引鍵條件約束`Categories`和`Products`資料表，這表示，每個`CategoryID`欄位`Products`資料表必須對應到`CategoryID`值`Categories`資料表。</span><span class="sxs-lookup"><span data-stu-id="6a65a-240">A foreign key constraint exists between the `Categories` and `Products` tables, meaning that each `CategoryID` field in the `Products` table must map to a `CategoryID` value in the `Categories` table.</span></span> <span data-ttu-id="6a65a-241">任何違反這個條件約束，例如嘗試刪除具有相關聯的產品類別目錄的動作會導致外部索引鍵條件約束違規。</span><span class="sxs-lookup"><span data-stu-id="6a65a-241">Any action that would violate this constraint, such as attempting to delete a category that has associated products, results in a foreign key constraint violation.</span></span> <span data-ttu-id="6a65a-242">若要確認這種情況，再次瀏覽正在更新及刪除現有的二進位資料的範例中使用二進位資料區段 (`~/BinaryData/UpdatingAndDeleting.aspx`)。</span><span class="sxs-lookup"><span data-stu-id="6a65a-242">To verify this, revisit the Updating and Deleting Existing Binary Data example in the Working with Binary Data section (`~/BinaryData/UpdatingAndDeleting.aspx`).</span></span> <span data-ttu-id="6a65a-243">此頁面會列出每個類別目錄中編輯和刪除按鈕 （請參閱圖 13），以及系統，但刪除如果您嘗試刪除具有相關聯的產品，例如飲料-類別卻因外部索引鍵條件約束違規而失敗 （請參閱圖 14）。</span><span class="sxs-lookup"><span data-stu-id="6a65a-243">This page lists each category in the system along with Edit and Delete buttons (see Figure 13), but if you attempt to delete a category that has associated products - such as Beverages - the delete fails due to a foreign key constraint violation (see Figure 14).</span></span>


<span data-ttu-id="6a65a-244">[![每個類別都會顯示於編輯和刪除按鈕的 GridView](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-244">[![Each Category is Displayed in a GridView with Edit and Delete Buttons](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image37.png)</span></span>

<span data-ttu-id="6a65a-245">**圖 13**： 每個類別都會顯示於編輯和刪除按鈕的 GridView ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-245">**Figure 13**: Each Category is Displayed in a GridView with Edit and Delete Buttons ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image39.png))</span></span>


<span data-ttu-id="6a65a-246">[![您無法刪除具有現有的產品類別目錄](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="6a65a-246">[![You Cannot Delete a Category that has Existing Products](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image40.png)</span></span>

<span data-ttu-id="6a65a-247">**圖 14**： 您無法刪除具有現有的產品類別目錄 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="6a65a-247">**Figure 14**: You Cannot Delete a Category that has Existing Products ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image42.png))</span></span>


<span data-ttu-id="6a65a-248">不過，假設我們想要允許刪除不論它們是否有關聯的產品類別目錄。</span><span class="sxs-lookup"><span data-stu-id="6a65a-248">Imagine, though, that we want to allow categories to be deleted regardless of whether they have associated products.</span></span> <span data-ttu-id="6a65a-249">會刪除與產品類別目錄，假設我們想要同時刪除其現有的產品 (雖然另一個選項，可直接將其產品`CategoryID`值`NULL`)。</span><span class="sxs-lookup"><span data-stu-id="6a65a-249">Should a category with products be deleted, imagine that we want to also delete its existing products (although another option would be to simply set its products `CategoryID` values to `NULL`).</span></span> <span data-ttu-id="6a65a-250">這項功能可能會透過外部索引鍵條件約束的 cascade 規則實作。</span><span class="sxs-lookup"><span data-stu-id="6a65a-250">This functionality could be implemented through the cascade rules of the foreign key constraint.</span></span> <span data-ttu-id="6a65a-251">或者，我們可以建立可接受的預存程序`@CategoryID`輸入的參數並叫用時，明確地刪除所有相關聯的產品，然後指定的分類。</span><span class="sxs-lookup"><span data-stu-id="6a65a-251">Alternatively, we could create a stored procedure that accepts a `@CategoryID` input parameter and, when invoked, explicitly deletes all of the associated products and then the specified category.</span></span>

<span data-ttu-id="6a65a-252">我們第一次嘗試在這樣的預存程序可能如下所示：</span><span class="sxs-lookup"><span data-stu-id="6a65a-252">Our first attempt at such a stored procedure might look like the following:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample5.sql)]

<span data-ttu-id="6a65a-253">這肯定會刪除相關聯的產品和分類，而它不會這樣起的交易。</span><span class="sxs-lookup"><span data-stu-id="6a65a-253">While this will definitely delete the associated products and category, it does not do so under the umbrella of a transaction.</span></span> <span data-ttu-id="6a65a-254">假設上是一些其他外部索引鍵條件約束`Categories`，會禁止刪除特定`@CategoryID`值。</span><span class="sxs-lookup"><span data-stu-id="6a65a-254">Imagine that there is some other foreign key constraint on `Categories` that would prohibit the deletion of a particular `@CategoryID` value.</span></span> <span data-ttu-id="6a65a-255">問題是，在這種情況下的所有產品會刪除之前，我們嘗試刪除類別目錄。</span><span class="sxs-lookup"><span data-stu-id="6a65a-255">The problem is that in such a case all of the products will be deleted before we attempt to delete the category.</span></span> <span data-ttu-id="6a65a-256">最後結果就是，這類的類別目錄，此預存程序會移除所有的產品類別目錄變得讚賞，因為它仍有相關的其他資料表中的記錄時。</span><span class="sxs-lookup"><span data-stu-id="6a65a-256">The net result is that for such a category, this stored procedure would remove all of its products while the category remained since it still has related records in some other table.</span></span>

<span data-ttu-id="6a65a-257">如果預存程序包裝範圍內的交易，不過，若要刪除`Products`資料表會面臨無法刪除上回復`Categories`。</span><span class="sxs-lookup"><span data-stu-id="6a65a-257">If the stored procedure were wrapped within the scope of a transaction, however, the deletes to the `Products` table would be rolled back in the face of a failed delete on `Categories`.</span></span> <span data-ttu-id="6a65a-258">下列預存程序指令碼會使用交易，以確保兩者之間的不可部份完成性`DELETE`陳述式：</span><span class="sxs-lookup"><span data-stu-id="6a65a-258">The following stored procedure script uses a transaction to assure atomicity between the two `DELETE` statements:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample6.sql)]

<span data-ttu-id="6a65a-259">請花一點時間加入`Categories_Delete`預存程序至 Northwind 資料庫。</span><span class="sxs-lookup"><span data-stu-id="6a65a-259">Take a moment to add the `Categories_Delete` stored procedure to the Northwind database.</span></span> <span data-ttu-id="6a65a-260">步驟 1 回頭參考，如需將預存程序加入資料庫中的指示。</span><span class="sxs-lookup"><span data-stu-id="6a65a-260">Refer back to Step 1 for instructions on adding stored procedures to a database.</span></span>

## <a name="step-6-updating-thecategoriestableadapter"></a><span data-ttu-id="6a65a-261">步驟 6： 更新`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="6a65a-261">Step 6: Updating the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="6a65a-262">我們已加入`Categories_Delete`預存程序至資料庫，DAL 目前設定為使用特定 SQL 陳述式來執行刪除。</span><span class="sxs-lookup"><span data-stu-id="6a65a-262">While we ve added the `Categories_Delete` stored procedure to the database, the DAL is currently configured to use ad-hoc SQL statements to perform the delete.</span></span> <span data-ttu-id="6a65a-263">我們需要更新`CategoriesTableAdapter`並指示它使用`Categories_Delete`改為預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-263">We need to update the `CategoriesTableAdapter` and instruct it to use the `Categories_Delete` stored procedure instead.</span></span>

> [!NOTE]
> <span data-ttu-id="6a65a-264">稍早在本教學課程中我們使用`NorthwindWithSprocs`資料集。</span><span class="sxs-lookup"><span data-stu-id="6a65a-264">Earlier in this tutorial we were working with the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="6a65a-265">但該資料集只有單一實體， `ProductsDataTable`，因此需要使用 類別目錄。</span><span class="sxs-lookup"><span data-stu-id="6a65a-265">But that DataSet only has a single entity, `ProductsDataTable`, and we need to work with categories.</span></span> <span data-ttu-id="6a65a-266">因此，對於當我談論的資料存取層 I m 參考本教學課程的其餘部分`Northwind`資料集，我們在第一次建立一個[建立資料存取層](../introduction/creating-a-data-access-layer-cs.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="6a65a-266">Therefore, for the remainder of this tutorial when I talk about the Data Access Layer I m referring to the `Northwind` DataSet, the one that we first created in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial.</span></span>


<span data-ttu-id="6a65a-267">開啟 Northwind 資料集選取`CategoriesTableAdapter`，並移至 [屬性] 視窗。</span><span class="sxs-lookup"><span data-stu-id="6a65a-267">Open the Northwind DataSet, select the `CategoriesTableAdapter`, and go to the Properties window.</span></span> <span data-ttu-id="6a65a-268">屬性視窗清單`InsertCommand`， `UpdateCommand`， `DeleteCommand`，和`SelectCommand`使用 TableAdapter，因為其名稱和連接資訊。</span><span class="sxs-lookup"><span data-stu-id="6a65a-268">The Properties window lists the `InsertCommand`, `UpdateCommand`, `DeleteCommand`, and `SelectCommand` used by the TableAdapter, as well as its name and connection information.</span></span> <span data-ttu-id="6a65a-269">展開`DeleteCommand`屬性，以查看其詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6a65a-269">Expand the `DeleteCommand` property to see its details.</span></span> <span data-ttu-id="6a65a-270">如圖 15 所示， `DeleteCommand` s`ComamndType`屬性設定為指示它傳送文字的文字`CommandText`屬性做為特定 SQL 查詢。</span><span class="sxs-lookup"><span data-stu-id="6a65a-270">As Figure 15 shows, the `DeleteCommand` s `ComamndType` property is set to Text, which instructs it to send the text in the `CommandText` property as an ad-hoc SQL query.</span></span>


![CategoriesTableAdapter 設計工具中選取 [屬性] 視窗中檢視其屬性](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image43.png)

<span data-ttu-id="6a65a-272">**圖 15**： 選取`CategoriesTableAdapter`在設計工具中 [屬性] 視窗中檢視其屬性</span><span class="sxs-lookup"><span data-stu-id="6a65a-272">**Figure 15**: Select the `CategoriesTableAdapter` in the Designer to View Its Properties in the Properties Window</span></span>


<span data-ttu-id="6a65a-273">若要變更這些設定，請在 屬性 視窗中選取 (DeleteCommand) 文字並從下拉式清單中選擇 （新增）。</span><span class="sxs-lookup"><span data-stu-id="6a65a-273">To change these settings, select the (DeleteCommand) text in the Properties window and choose (New) from the drop-down list.</span></span> <span data-ttu-id="6a65a-274">這會清除的設定`CommandText`， `CommandType`，和`Parameters`屬性。</span><span class="sxs-lookup"><span data-stu-id="6a65a-274">This will clear out the settings for the `CommandText`, `CommandType`, and `Parameters` properties.</span></span> <span data-ttu-id="6a65a-275">接下來，設定`CommandType`屬性`StoredProcedure`，請輸入名稱的預存程序和`CommandText`(`dbo.Categories_Delete`)。</span><span class="sxs-lookup"><span data-stu-id="6a65a-275">Next, set the `CommandType` property to `StoredProcedure` and then type in the name of the stored procedure for the `CommandText` (`dbo.Categories_Delete`).</span></span> <span data-ttu-id="6a65a-276">如果您務必依此順序中的輸入屬性，第一次`CommandType`然後`CommandText`-Visual Studio 會自動填入參數集合。</span><span class="sxs-lookup"><span data-stu-id="6a65a-276">If you make sure to enter the properties in this order - first the `CommandType` and then the `CommandText` - Visual Studio will automatically populate the Parameters collection.</span></span> <span data-ttu-id="6a65a-277">如果您沒有在此順序中輸入這些屬性，您必須手動加入參數的參數集合編輯器。</span><span class="sxs-lookup"><span data-stu-id="6a65a-277">If you do not enter these properties in this order, you will have to manually add the parameters through the Parameters Collection Editor.</span></span> <span data-ttu-id="6a65a-278">在任一情況下，它 s 審慎的作法是按一下省略符號，即可確認，正確的參數設定已變更 （請參閱圖 16） 的參數集合編輯器的 [參數] 屬性。</span><span class="sxs-lookup"><span data-stu-id="6a65a-278">In either case, it s prudent to click on the ellipses in the Parameters property to bring up the Parameters Collection Editor to verify that the correct parameter settings changes have been made (see Figure 16).</span></span> <span data-ttu-id="6a65a-279">如果看不到任何參數，在對話方塊中，加入`@CategoryID`參數以手動方式 (您不需要加入`@RETURN_VALUE`參數)。</span><span class="sxs-lookup"><span data-stu-id="6a65a-279">If you do not see any parameters in the dialog box, add the `@CategoryID` parameter manually (you do not need to add the `@RETURN_VALUE` parameter).</span></span>


![確認參數設定正確](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image44.png)

<span data-ttu-id="6a65a-281">**圖 16**： 確認參數設定是否正確</span><span class="sxs-lookup"><span data-stu-id="6a65a-281">**Figure 16**: Ensure That the Parameters Settings are Correct</span></span>


<span data-ttu-id="6a65a-282">一旦更新 DAL 刪除類別目錄會自動刪除所有相關聯的產品並散布概括性的交易。</span><span class="sxs-lookup"><span data-stu-id="6a65a-282">Once the DAL has been updated, deleting a category will automatically delete all of its associated products and do so under the umbrella of a transaction.</span></span> <span data-ttu-id="6a65a-283">若要確認這種情況，返回 更新和刪除現有的二進位資料頁面上，按一下的其中一個類別目錄的 刪除 按鈕。</span><span class="sxs-lookup"><span data-stu-id="6a65a-283">To verify this, return to the Updating and Deleting Existing Binary Data page and click the Delete button for one of the categories.</span></span> <span data-ttu-id="6a65a-284">與一個單一按一下滑鼠，就會刪除類別目錄和所有相關聯的產品。</span><span class="sxs-lookup"><span data-stu-id="6a65a-284">With one single click of the mouse, the category and all of its associated products will be deleted.</span></span>

> [!NOTE]
> <span data-ttu-id="6a65a-285">在測試之前先`Categories_Delete`預存程序，將會刪除與所選類別目錄的產品數目，可能必須在製作資料庫的備份複本。</span><span class="sxs-lookup"><span data-stu-id="6a65a-285">Before testing the `Categories_Delete` stored procedure, which will delete a number of products along with the selected category, it might be prudent to make a backup copy of your database.</span></span> <span data-ttu-id="6a65a-286">如果您使用`NORTHWND.MDF`資料庫`App_Data`，只需關閉 Visual Studio，並將複製的 MDF 和 LDF 檔案中`App_Data`為其他資料夾。</span><span class="sxs-lookup"><span data-stu-id="6a65a-286">If you are using the `NORTHWND.MDF` database in `App_Data`, simply close Visual Studio and copy the MDF and LDF files in `App_Data` to some other folder.</span></span> <span data-ttu-id="6a65a-287">之後測試的功能，您可以關閉 Visual Studio 來還原資料庫，並取代目前的 MDF 和 LDF 檔案`App_Data`以備份複本。</span><span class="sxs-lookup"><span data-stu-id="6a65a-287">After testing the functionality, you can restore the database by closing Visual Studio and replacing the current MDF and LDF files in `App_Data` with the backup copies.</span></span>


## <a name="summary"></a><span data-ttu-id="6a65a-288">總結</span><span class="sxs-lookup"><span data-stu-id="6a65a-288">Summary</span></span>

<span data-ttu-id="6a65a-289">雖然我們，TableAdapter 的精靈會自動產生預存程序，但有些的時候，當我們可能已經有這類預存程序，建立或想要它們以手動方式或使用其他工具改為建立。</span><span class="sxs-lookup"><span data-stu-id="6a65a-289">While the TableAdapter s wizard will automatically generate stored procedures for us, there are times when we might already have such stored procedures created or want to create them manually or with other tools instead.</span></span> <span data-ttu-id="6a65a-290">為了配合這種情況下，TableAdapter 也可以設定為指向現有的預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-290">To accommodate such scenarios, the TableAdapter can also be configured to point to an existing stored procedure.</span></span> <span data-ttu-id="6a65a-291">本教學課程中我們會討論如何手動新增到資料庫中透過 Visual Studio 環境的 預存程序，以及如何連接 TableAdapter 的方法，這些預存程序。</span><span class="sxs-lookup"><span data-stu-id="6a65a-291">In this tutorial we looked at how to manually add stored procedures to a database through the Visual Studio environment and how to wire the TableAdapter s methods to these stored procedures.</span></span> <span data-ttu-id="6a65a-292">此外，我們也會檢查 T-SQL 命令和指令碼模式，用於啟動、 認可，以及回復預存程序內的交易。</span><span class="sxs-lookup"><span data-stu-id="6a65a-292">We also examined the T-SQL commands and script pattern used for starting, committing, and rolling back transactions from within a stored procedure.</span></span>

<span data-ttu-id="6a65a-293">祝您程式設計 ！</span><span class="sxs-lookup"><span data-stu-id="6a65a-293">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="6a65a-294">關於作者</span><span class="sxs-lookup"><span data-stu-id="6a65a-294">About the Author</span></span>

<span data-ttu-id="6a65a-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP/ASP.NET 書籍和的創辦[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已從 1998 年使用 Microsoft Web 技術。</span><span class="sxs-lookup"><span data-stu-id="6a65a-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="6a65a-296">Scott 可做為獨立顧問、 訓練和寫入器。</span><span class="sxs-lookup"><span data-stu-id="6a65a-296">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="6a65a-297">他最新的活頁簿[ *Sam 教導您自己 ASP.NET 2.0 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="6a65a-297">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="6a65a-298">他可以在達到[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或透過他的部落格，這可以在找到[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="6a65a-298">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="6a65a-299">特別感謝</span><span class="sxs-lookup"><span data-stu-id="6a65a-299">Special Thanks To</span></span>

<span data-ttu-id="6a65a-300">許多有用的檢閱者已檢閱本教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="6a65a-300">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="6a65a-301">此教學課程中的前導檢閱者已 Hilton Geisenow、 S ren 因此 Lauritsen 和本文菲。</span><span class="sxs-lookup"><span data-stu-id="6a65a-301">Lead reviewers for this tutorial were Hilton Geisenow, S ren Jacob Lauritsen, and Teresa Murphy.</span></span> <span data-ttu-id="6a65a-302">檢閱我即將推出的 MSDN 文件有興趣嗎？</span><span class="sxs-lookup"><span data-stu-id="6a65a-302">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="6a65a-303">如果是這樣，卸除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="6a65a-303">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6a65a-304">[上一頁](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)
> [下一頁](updating-the-tableadapter-to-use-joins-cs.md)</span><span class="sxs-lookup"><span data-stu-id="6a65a-304">[Previous](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)
[Next](updating-the-tableadapter-to-use-joins-cs.md)</span></span>
