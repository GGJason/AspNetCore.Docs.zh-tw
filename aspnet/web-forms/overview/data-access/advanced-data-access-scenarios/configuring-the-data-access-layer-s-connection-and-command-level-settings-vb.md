---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/configuring-the-data-access-layer-s-connection-and-command-level-settings-vb
title: 設定資料存取層連接和命令層級設定 (VB) |Microsoft 文件
author: rick-anderson
description: 在輸入資料集內 Tableadapter 自動處理連接到資料庫中，發出命令，並填入具有結果的 DataTable...
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/03/2007
ms.topic: article
ms.assetid: d57dfa2b-d627-45cb-b5b1-abbf3159d770
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/configuring-the-data-access-layer-s-connection-and-command-level-settings-vb
msc.type: authoredcontent
ms.openlocfilehash: b73c6113e84e290025e5835781fa2f85587289b1
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/06/2018
ms.locfileid: "30877173"
---
<a name="configuring-the-data-access-layers-connection--and-command-level-settings-vb"></a><span data-ttu-id="7e5ef-103">設定資料存取層連接和命令層級設定 (VB)</span><span class="sxs-lookup"><span data-stu-id="7e5ef-103">Configuring the Data Access Layer's Connection- and Command-Level Settings (VB)</span></span>
====================
<span data-ttu-id="7e5ef-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7e5ef-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7e5ef-105">[下載程式碼](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_72_VB.zip)或[下載 PDF](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/datatutorial72vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="7e5ef-105">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_72_VB.zip) or [Download PDF](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/datatutorial72vb1.pdf)</span></span>

> <span data-ttu-id="7e5ef-106">在輸入資料集內 Tableadapter 自動處理連接到資料庫中，發出命令，並填入具有結果的 DataTable。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-106">The TableAdapters within a Typed DataSet automatically take care of connecting to the database, issuing commands, and populating a DataTable with the results.</span></span> <span data-ttu-id="7e5ef-107">不過，當我們想要小心，這些詳細資料，以及在本教學課程中我們會了解如何存取資料庫連接和命令層級設定，在 TableAdapter 中沒有的情況。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-107">There are occasions however when we want to take care of these details ourselves, and in this tutorial we learn how to access the database connection- and command-level settings in the TableAdapter.</span></span>


## <a name="introduction"></a><span data-ttu-id="7e5ef-108">簡介</span><span class="sxs-lookup"><span data-stu-id="7e5ef-108">Introduction</span></span>

<span data-ttu-id="7e5ef-109">在整個教學課程系列我們已實作的資料存取層和我們多層式架構商務物件使用型別資料集。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-109">Throughout the tutorial series we have used Typed DataSets to implement the Data Access Layer and business objects of our layered architecture.</span></span> <span data-ttu-id="7e5ef-110">中所述[第一個教學課程](../introduction/creating-a-data-access-layer-vb.md)，s Datatable 會做為儲存機制的資料，而 Tableadapter 做為包裝函式與要擷取和修改基礎資料的資料庫進行通訊的型別資料集。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-110">As discussed in the [first tutorial](../introduction/creating-a-data-access-layer-vb.md), the Typed DataSet s DataTables serve as repositories of data whereas the TableAdapters act as wrappers to communicate with the database to retrieve and modify the underlying data.</span></span> <span data-ttu-id="7e5ef-111">Tableadapter 封裝使用資料庫的複雜度，並將我們儲存不必撰寫程式碼以連接到資料庫、 發出命令，或填入 DataTable 的結果。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-111">The TableAdapters encapsulate the complexity involved in working with the database and saves us from having to write code to connect to the database, issue a command, or populate the results into a DataTable.</span></span>

<span data-ttu-id="7e5ef-112">有的時間，不過，當我們需要 burrow TableAdapter 複製撰寫的程式碼直接使用的 ADO.NET 物件。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-112">There are times, however, when we need to burrow into the depths of the TableAdapter and write code that works directly with the ADO.NET objects.</span></span> <span data-ttu-id="7e5ef-113">在[包裝在交易內的資料庫修改](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md)教學課程中，例如，我們加入方法開始、 認可，以及回復 ADO.NET 交易 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-113">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial, for example, we added methods to the TableAdapter for beginning, committing, and rolling back ADO.NET transactions.</span></span> <span data-ttu-id="7e5ef-114">這些方法使用的內部，手動建立`SqlTransaction`物件指派給 tableadapter`SqlCommand`物件。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-114">These methods used an internal, manually-created `SqlTransaction` object that was assigned to the TableAdapter s `SqlCommand` objects.</span></span>

<span data-ttu-id="7e5ef-115">在本教學課程中，我們將檢查如何存取在 TableAdapter 中的資料庫連接和命令層級設定。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-115">In this tutorial we will examine how to access the database connection- and command-level settings in the TableAdapter.</span></span> <span data-ttu-id="7e5ef-116">特別是，我們會將功能加入至`ProductsTableAdapter`啟用存取基礎的連接字串，以及命令逾時設定。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-116">In particular, we will add functionality to the `ProductsTableAdapter` that enables access to the underlying connection string and command timeout settings.</span></span>

## <a name="working-with-data-using-adonet"></a><span data-ttu-id="7e5ef-117">使用 ADO.NET 資料搭配使用</span><span class="sxs-lookup"><span data-stu-id="7e5ef-117">Working with Data Using ADO.NET</span></span>

<span data-ttu-id="7e5ef-118">Microsoft.NET Framework 包含特別設計來處理資料的類別上的。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-118">The Microsoft .NET Framework contains a plethora of classes designed specifically to work with data.</span></span> <span data-ttu-id="7e5ef-119">這些內找到的類別[`System.Data`命名空間](https://msdn.microsoft.com/library/system.data.aspx)，稱為*ADO.NET*類別。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-119">These classes, found within the [`System.Data` namespace](https://msdn.microsoft.com/library/system.data.aspx), are referred to as the *ADO.NET* classes.</span></span> <span data-ttu-id="7e5ef-120">某些 ADO.NET 概括性下類別會繫結至特定*資料提供者*。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-120">Some of the classes under the ADO.NET umbrella are tied to a particular *data provider*.</span></span> <span data-ttu-id="7e5ef-121">您可以視為資料提供者可讓資訊 ADO.NET 類別與基礎資料存放區之間的通訊通道。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-121">You can think of a data provider as a communication channel that allows information to flow between the ADO.NET classes and the underlying data store.</span></span> <span data-ttu-id="7e5ef-122">有一般化的提供者，例如 OleDb 和 ODBC，以及專為特定資料庫系統的提供者。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-122">There are generalized providers, like OleDb and ODBC, as well as providers that are specially designed for a particular database system.</span></span> <span data-ttu-id="7e5ef-123">例如，雖然可以連接到 Microsoft SQL Server 資料庫使用 OleDb 提供者，SqlClient 提供者會更有效率設計並最佳化特別適用於 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-123">For example, while it is possible to connect to a Microsoft SQL Server database using the OleDb provider, the SqlClient provider is much more efficient as it was designed and optimized specifically for SQL Server.</span></span>

<span data-ttu-id="7e5ef-124">當以程式設計方式存取資料時，下列的模式通常會：</span><span class="sxs-lookup"><span data-stu-id="7e5ef-124">When programmatically accessing data, the following pattern is commonly used:</span></span>

1. <span data-ttu-id="7e5ef-125">連接到資料庫。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-125">Establish a connection to the database.</span></span>
2. <span data-ttu-id="7e5ef-126">發出命令。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-126">Issue a command.</span></span>
3. <span data-ttu-id="7e5ef-127">如`SELECT`查詢，使用產生的記錄。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-127">For `SELECT` queries, work with the resulting records.</span></span>

<span data-ttu-id="7e5ef-128">有不同的 ADO.NET 類別來執行每個步驟。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-128">There are separate ADO.NET classes for performing each of these steps.</span></span> <span data-ttu-id="7e5ef-129">若要連接至資料庫，使用 SqlClient 提供者，例如，使用[`SqlConnection`類別](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-129">To connect to a database using the SqlClient provider, for example, use the [`SqlConnection` class](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection(VS.80).aspx).</span></span> <span data-ttu-id="7e5ef-130">要發出`INSERT`， `UPDATE`， `DELETE`，或`SELECT`命令到資料庫，使用[`SqlCommand`類別](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-130">To issue an `INSERT`, `UPDATE`, `DELETE`, or `SELECT` command to the database, use the [`SqlCommand` class](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.aspx).</span></span>

<span data-ttu-id="7e5ef-131">除了[包裝在交易內的資料庫修改](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md)教學課程中，我們已不需要撰寫任何低階 ADO.NET 程式碼自行因為 Tableadapter 自動產生程式碼包含所需的功能連接到資料庫、 發出命令、 擷取資料，並填入 Datatable 中的該資料。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-131">Except for the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial, we have not had to write any low-level ADO.NET code ourselves because the TableAdapters auto-generated code includes the functionality needed to connect to the database, issue commands, retrieve data, and populate that data into DataTables.</span></span> <span data-ttu-id="7e5ef-132">不過，可能是我們需要來自訂這些低層級的設定。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-132">However, there may be times when we need to customize these low-level settings.</span></span> <span data-ttu-id="7e5ef-133">在接下來的幾個步驟中，我們將檢查如何挖掘內部使用的 Tableadapter 的 ADO.NET 物件。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-133">Over the next few steps we will examine how to tap into the ADO.NET objects used internally by the TableAdapters.</span></span>

## <a name="step-1-examining-with-the-connection-property"></a><span data-ttu-id="7e5ef-134">步驟 1： 檢查連接屬性</span><span class="sxs-lookup"><span data-stu-id="7e5ef-134">Step 1: Examining with the Connection Property</span></span>

<span data-ttu-id="7e5ef-135">每個 TableAdapter 類別具有`Connection`屬性，指定資料庫連接資訊。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-135">Each TableAdapter class has a `Connection` property that specifies database connection information.</span></span> <span data-ttu-id="7e5ef-136">這個屬性的資料型別和`ConnectionString`值取決於在 TableAdapter 組態精靈所做的選擇。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-136">This property s data type and `ConnectionString` value are determined by the selections made in the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="7e5ef-137">前文提過，我們先將 TableAdapter 加入型別資料集時此精靈會詢問我們資料庫來源 （請參閱圖 1）。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-137">Recall that when we first add a TableAdapter to a Typed DataSet this wizard asks us for the database source (see Figure 1).</span></span> <span data-ttu-id="7e5ef-138">在此步驟中第一個下拉式清單包含這些組態檔，以及在伺服器總管的資料連接中的任何其他資料庫中指定的資料庫。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-138">The drop-down list in this first step includes those databases specified in the configuration file as well as any other databases in the Server Explorer s Data Connections.</span></span> <span data-ttu-id="7e5ef-139">如果下拉式清單中，我們想要使用的資料庫不存在，可以透過按一下 [新增連接] 按鈕，並提供所需的連接資訊指定新的資料庫連接。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-139">If the database we want to use does not exist in the drop-down list, a new database connection can be specified by clicking the New Connection button and providing the needed connection information.</span></span>


<span data-ttu-id="7e5ef-140">[![[TableAdapter 組態精靈] 的第一個步驟](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image2.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7e5ef-140">[![The First Step of the TableAdapter Configuration Wizard](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image2.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image1.png)</span></span>

<span data-ttu-id="7e5ef-141">**圖 1**: TableAdapter 組態精靈 的第一個步驟 ([按一下以檢視完整大小的影像](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="7e5ef-141">**Figure 1**: The First Step of the TableAdapter Configuration Wizard ([Click to view full-size image](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image3.png))</span></span>


<span data-ttu-id="7e5ef-142">可讓 s 花點時間 tableadapter 的程式碼檢查`Connection`屬性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-142">Let s take a moment to inspect the code for the TableAdapter s `Connection` property.</span></span> <span data-ttu-id="7e5ef-143">如中所述[建立資料存取層](../introduction/creating-a-data-access-layer-vb.md)教學課程中，我們可以檢視自動產生的 TableAdapter 程式碼移至 [類別檢視] 視窗中，向下適當的類別，鑽研，然後按兩下成員名稱。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-143">As noted in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, we can view the auto-generated TableAdapter code by going to the Class View window, drilling down to the appropriate class, and then double-clicking the member name.</span></span>

<span data-ttu-id="7e5ef-144">移至 檢視 功能表，然後選擇 類別檢視 （或輸入 Ctrl + Shift + C），請瀏覽 類別檢視 視窗。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-144">Navigate to the Class View window by going to the View menu and choosing Class View (or by typing Ctrl+Shift+C).</span></span> <span data-ttu-id="7e5ef-145">從 [類別檢視] 視窗的上半部，向下鑽研至`NorthwindTableAdapters`命名空間並選取`ProductsTableAdapter`類別。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-145">From the top half of the Class View window, drill down to the `NorthwindTableAdapters` namespace and select the `ProductsTableAdapter` class.</span></span> <span data-ttu-id="7e5ef-146">這會顯示`ProductsTableAdapter`的成員，在 類別檢視中，如圖 2 所示的下半部。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-146">This will display the `ProductsTableAdapter` s members in the bottom half of the Class View, as shown in Figure 2.</span></span> <span data-ttu-id="7e5ef-147">按兩下`Connection`屬性來查看其程式碼。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-147">Double-click the `Connection` property to see its code.</span></span>


![按兩下要檢視其自動產生程式碼的類別檢視中的連接屬性](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image4.png)

<span data-ttu-id="7e5ef-149">**圖 2**： 按兩下要檢視其自動產生程式碼的類別檢視中的連接屬性</span><span class="sxs-lookup"><span data-stu-id="7e5ef-149">**Figure 2**: Double-Click the Connection Property in the Class View to View Its Auto-Generated Code</span></span>


<span data-ttu-id="7e5ef-150">Tableadapter`Connection`屬性和其他連接相關的程式碼如下所示：</span><span class="sxs-lookup"><span data-stu-id="7e5ef-150">The TableAdapter s `Connection` property and other connection-related code follows:</span></span>


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample1.vb)]

<span data-ttu-id="7e5ef-151">TableAdapter 類別具現化時，成員變數`_connection`等於`Nothing`。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-151">When the TableAdapter class is instantiated, the member variable `_connection` is equal to `Nothing`.</span></span> <span data-ttu-id="7e5ef-152">當`Connection`存取屬性時，它會先檢查，看看是否`_connection`已具現化成員變數。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-152">When the `Connection` property is accessed, it first checks to see if the `_connection` member variable has been instantiated.</span></span> <span data-ttu-id="7e5ef-153">如果沒有，`InitConnection`叫用方法時，它會具現化`_connection`並設定其`ConnectionString`TableAdapter 組態精靈 s 第一個步驟中指定的連接字串值的屬性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-153">If it has not, the `InitConnection` method is invoked, which instantiates `_connection` and sets its `ConnectionString` property to the connection string value specified from the TableAdapter Configuration wizard s first step.</span></span>

<span data-ttu-id="7e5ef-154">`Connection`屬性也可以指派給`SqlConnection`物件。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-154">The `Connection` property can also be assigned to a `SqlConnection` object.</span></span> <span data-ttu-id="7e5ef-155">如此一來將新`SqlConnection`物件與每個 tableadapter`SqlCommand`物件。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-155">Doing so associates the new `SqlConnection` object with each of the TableAdapter s `SqlCommand` objects.</span></span>

## <a name="step-2-exposing-connection-level-settings"></a><span data-ttu-id="7e5ef-156">步驟 2： 公開連接層級設定</span><span class="sxs-lookup"><span data-stu-id="7e5ef-156">Step 2: Exposing Connection-Level Settings</span></span>

<span data-ttu-id="7e5ef-157">連接資訊應該維持封裝內的 TableAdapter，並無法存取應用程式架構的其他圖層。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-157">The connection information should remain encapsulated within the TableAdapter and not be accessible to other layers in the application architecture.</span></span> <span data-ttu-id="7e5ef-158">不過，可能有案例時必須是可存取或可自訂的查詢、 使用者或 ASP.NET 網頁的 TableAdapter 的連接層級資訊。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-158">However, there may be scenarios when the TableAdapter s connection-level information needs to be accessible or customizable for a query, user, or ASP.NET page.</span></span>

<span data-ttu-id="7e5ef-159">可讓擴充的 s`ProductsTableAdapter`中`Northwind`要包含的資料集`ConnectionString`可以由商務邏輯層用來讀取或變更使用 TableAdapter 的連接字串屬性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-159">Let s extend the `ProductsTableAdapter` in the `Northwind` DataSet to include a `ConnectionString` property that can be used by the Business Logic Layer to read or change the connection string used by the TableAdapter.</span></span>

> [!NOTE]
> <span data-ttu-id="7e5ef-160">A*連接字串*是字串，指定資料庫連接資訊，例如若要使用，資料庫、 驗證認證，以及其他資料庫相關設定的位置提供者。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-160">A *connection string* is a string that specifies database connection information, such as the provider to use, the location of the database, authentication credentials, and other database-related settings.</span></span> <span data-ttu-id="7e5ef-161">如需使用的各種不同的資料存放區和提供者的連接字串模式的清單，請參閱[ConnectionStrings.com](http://www.connectionstrings.com/)。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-161">For a list of connection string patterns used by a variety of data stores and providers, see [ConnectionStrings.com](http://www.connectionstrings.com/).</span></span>


<span data-ttu-id="7e5ef-162">中所述[建立資料存取層](../introduction/creating-a-data-access-layer-vb.md)教學課程中，可以透過使用部分類別擴充的型別資料集的自動產生類別。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-162">As discussed in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, the Typed DataSet s auto-generated classes can be extended through the use of partial classes.</span></span> <span data-ttu-id="7e5ef-163">首先，建立新的子資料夾中名為的專案`ConnectionAndCommandSettings`下方`~/App_Code/DAL`資料夾。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-163">First, create a new subfolder in the project named `ConnectionAndCommandSettings` underneath the `~/App_Code/DAL` folder.</span></span>


![加入名為 ConnectionAndCommandSettings 子資料夾](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image5.png)

<span data-ttu-id="7e5ef-165">**圖 3**： 加入子資料夾名為 `ConnectionAndCommandSettings`</span><span class="sxs-lookup"><span data-stu-id="7e5ef-165">**Figure 3**: Add a Subfolder Named `ConnectionAndCommandSettings`</span></span>


<span data-ttu-id="7e5ef-166">加入新的類別檔案命名為`ProductsTableAdapter.ConnectionAndCommandSettings.vb`並輸入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="7e5ef-166">Add a new class file named `ProductsTableAdapter.ConnectionAndCommandSettings.vb` and enter the following code:</span></span>


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample2.vb)]

<span data-ttu-id="7e5ef-167">這個部分的類別會加入`Public`屬性名為`ConnectionString`至`ProductsTableAdapter`類別，可讓讀取或更新基礎連接的 tableadapter 的連接字串的任何圖層。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-167">This partial class adds a `Public` property named `ConnectionString` to the `ProductsTableAdapter` class that allows any layer to read or update the connection string for the TableAdapter s underlying connection.</span></span>

<span data-ttu-id="7e5ef-168">建立使用此部分類別 （並儲存），開啟`ProductsBLL`類別。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-168">With this partial class created (and saved), open the `ProductsBLL` class.</span></span> <span data-ttu-id="7e5ef-169">移至其中一個現有的方法，在輸入`Adapter`然後按下以顯示 IntelliSense 期間的索引鍵。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-169">Go to one of the existing methods and type in `Adapter` and then hit the period key to bring up IntelliSense.</span></span> <span data-ttu-id="7e5ef-170">您應該會看到新`ConnectionString`IntelliSense，這表示您可以透過程式設計方式讀取或調整此值從 BLL 中可用的屬性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-170">You should see the new `ConnectionString` property available in IntelliSense, meaning that you can programmatically read or adjust this value from the BLL.</span></span>

## <a name="exposing-the-entire-connection-object"></a><span data-ttu-id="7e5ef-171">公開的整個連線物件</span><span class="sxs-lookup"><span data-stu-id="7e5ef-171">Exposing the Entire Connection Object</span></span>

<span data-ttu-id="7e5ef-172">此部分的類別會公開基礎連接物件的一個屬性： `ConnectionString`。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-172">This partial class exposes just one property of the underlying connection object: `ConnectionString`.</span></span> <span data-ttu-id="7e5ef-173">如果您想要提供超過 TableAdapter 的範圍內的整個連線物件，您也可以變更`Connection`屬性的保護層級。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-173">If you want to make the entire connection object available beyond the confines of the TableAdapter, you can alternatively change the `Connection` property s protection level.</span></span> <span data-ttu-id="7e5ef-174">我們在步驟 1 中檢查的自動產生程式碼示範的 tableadapter`Connection`屬性標記為`Friend`，也就是說，它只能存取由相同組件中的類別。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-174">The auto-generated code we examined in Step 1 showed that the TableAdapter s `Connection` property is marked as `Friend`, meaning that it can only be accessed by classes in the same assembly.</span></span> <span data-ttu-id="7e5ef-175">此項可能變更，不過，透過 tableadapter`ConnectionModifier`屬性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-175">This can be changed, however, via the TableAdapter s `ConnectionModifier` property.</span></span>

<span data-ttu-id="7e5ef-176">開啟`Northwind`資料集，請按一下 `ProductsTableAdatper`在設計師中，並瀏覽至 屬性 視窗。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-176">Open the `Northwind` DataSet, click on the `ProductsTableAdatper` in the Designer, and navigate to the Properties window.</span></span> <span data-ttu-id="7e5ef-177">您會看到那里`ConnectionModifier`設為預設值， `Assembly`。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-177">There you will see the `ConnectionModifier` set to its default value, `Assembly`.</span></span> <span data-ttu-id="7e5ef-178">讓`Connection`屬性型別資料集 s 組件，變更之外使用`ConnectionModifier`屬性`Public`。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-178">To make the `Connection` property available outside of the Typed DataSet s assembly, change the `ConnectionModifier` property to `Public`.</span></span>


<span data-ttu-id="7e5ef-179">[![透過 ConnectionModifier 屬性可以設定連接屬性 s 存取範圍層級](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image7.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="7e5ef-179">[![The Connection Property s Accessibility Level Can Be Configured via the ConnectionModifier Property](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image7.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image6.png)</span></span>

<span data-ttu-id="7e5ef-180">**圖 4**:`Connection`屬性存取範圍可以設定層級的 s 透過`ConnectionModifier`屬性 ([按一下以檢視完整大小的影像](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="7e5ef-180">**Figure 4**: The `Connection` Property s Accessibility Level Can Be Configured via the `ConnectionModifier` Property ([Click to view full-size image](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image8.png))</span></span>


<span data-ttu-id="7e5ef-181">儲存資料集，然後返回`ProductsBLL`類別。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-181">Save the DataSet and then return to the `ProductsBLL` class.</span></span> <span data-ttu-id="7e5ef-182">之前，請移至其中一個現有的方法，並輸入`Adapter`然後按下以顯示 IntelliSense 期間的索引鍵。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-182">As before, go to one of the existing methods and type in `Adapter` and then hit the period key to bring up IntelliSense.</span></span> <span data-ttu-id="7e5ef-183">清單應該包括`Connection`屬性，這表示您可以現在以程式設計方式讀取，或從 BLL 指派任何連接層級設定。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-183">The list should include a `Connection` property, meaning that you can now programmatically read or assign any connection-level settings from the BLL.</span></span>

## <a name="step-3-examining-the-command-related-properties"></a><span data-ttu-id="7e5ef-184">步驟 3： 檢查命令相關的屬性</span><span class="sxs-lookup"><span data-stu-id="7e5ef-184">Step 3: Examining the Command-Related Properties</span></span>

<span data-ttu-id="7e5ef-185">TableAdapter 所組成的主要查詢，根據預設，已自動產生`INSERT`， `UPDATE`，和`DELETE`陳述式。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-185">A TableAdapter consists of a main query that, by default, has auto-generated `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="7e5ef-186">此主要查詢 s `INSERT`， `UPDATE`，和`DELETE`陳述式的 TableAdapter s 程式碼中實作以 ADO.NET 資料配接器物件透過`Adapter`屬性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-186">This main query s `INSERT`, `UPDATE`, and `DELETE` statements are implemented in the TableAdapter s code as an ADO.NET data adapter object via the `Adapter` property.</span></span> <span data-ttu-id="7e5ef-187">像使用其`Connection`屬性，`Adapter`屬性的資料類型取決於使用的資料提供者。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-187">Like with its `Connection` property, the `Adapter` property s data type is determined by the data provider used.</span></span> <span data-ttu-id="7e5ef-188">這些教學課程都使用 SqlClient 提供者，因為`Adapter`屬性屬於型別[ `SqlDataAdapter` ](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-188">Since these tutorials use the SqlClient provider, the `Adapter` property is of type [`SqlDataAdapter`](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter(VS.80).aspx).</span></span>

<span data-ttu-id="7e5ef-189">Tableadapter`Adapter`屬性有三個屬性的型別`SqlCommand`，它會使用問題`INSERT`， `UPDATE`，和`DELETE`陳述式：</span><span class="sxs-lookup"><span data-stu-id="7e5ef-189">The TableAdapter s `Adapter` property has three properties of type `SqlCommand` that it uses to issue the `INSERT`, `UPDATE`, and `DELETE` statements:</span></span>

- `InsertCommand`
- `UpdateCommand`
- `DeleteCommand`

<span data-ttu-id="7e5ef-190">A`SqlCommand`物件負責傳送至資料庫的特定查詢，其屬性，例如： [ `CommandText` ](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtext.aspx)，其中包含的特定 SQL 陳述式或預存程序，才可執行，並[ `Parameters`](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.parameters.aspx)，這是集合的`SqlParameter`物件。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-190">A `SqlCommand` object is responsible for sending a particular query to the database and has properties like: [`CommandText`](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtext.aspx), which contains the ad-hoc SQL statement or stored procedure to execute; and [`Parameters`](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.parameters.aspx), which is a collection of `SqlParameter` objects.</span></span> <span data-ttu-id="7e5ef-191">如我們所見回[建立資料存取層](../introduction/creating-a-data-access-layer-vb.md)這些教學課程中，命令物件可以透過 [屬性] 視窗加以自訂。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-191">As we saw back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, these command objects can be customized through the Properties window.</span></span>

<span data-ttu-id="7e5ef-192">除了其主要的查詢，TableAdapter 還可以包含多個方法，叫用時，會分派至資料庫指定的命令。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-192">In addition to its main query, the TableAdapter can include a variable number of methods that, when invoked, dispatch a specified command to the database.</span></span> <span data-ttu-id="7e5ef-193">主要查詢的命令物件和所有其他方法的命令物件會儲存在 tableadapter`CommandCollection`屬性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-193">The main query s command object and the command objects for all additional methods are stored in the TableAdapter s `CommandCollection` property.</span></span>

<span data-ttu-id="7e5ef-194">可讓 s 花點時間查看所產生的程式碼`ProductsTableAdapter`中`Northwind`這兩個屬性及其支援的成員變數和 helper 方法的資料集：</span><span class="sxs-lookup"><span data-stu-id="7e5ef-194">Let s take a moment to look at the code generated by the `ProductsTableAdapter` in the `Northwind` DataSet for these two properties and their supporting member variables and helper methods:</span></span>


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample3.vb)]

<span data-ttu-id="7e5ef-195">程式碼`Adapter`和`CommandCollection`屬性慎的`Connection`屬性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-195">The code for the `Adapter` and `CommandCollection` properties closely mimics that of the `Connection` property.</span></span> <span data-ttu-id="7e5ef-196">沒有保存物件內容所使用的成員變數。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-196">There are member variables that hold the objects used by the properties.</span></span> <span data-ttu-id="7e5ef-197">屬性`Get`開始，檢查是否對應的成員變數的存取子`Nothing`。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-197">The properties `Get` accessors start by checking to see if the corresponding member variable is `Nothing`.</span></span> <span data-ttu-id="7e5ef-198">如果是這樣，初始化呼叫執行方法時建立成員變數的執行個體，並指派核心與命令相關的屬性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-198">If so, an initialization method is called which creates an instance of the member variable and assigns the core command-related properties.</span></span>

## <a name="step-4-exposing-command-level-settings"></a><span data-ttu-id="7e5ef-199">步驟 4： 公開命令層級的設定</span><span class="sxs-lookup"><span data-stu-id="7e5ef-199">Step 4: Exposing Command-Level Settings</span></span>

<span data-ttu-id="7e5ef-200">在理想情況下，命令層級資訊應該維持不在資料存取層中的封裝。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-200">Ideally, the command-level information should remain encapsulated within the Data Access Layer.</span></span> <span data-ttu-id="7e5ef-201">應該架構的其他圖層會需要此資訊，不過，它可以透過公開部分類別中，就像使用的連接層級設定。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-201">Should this information be needed in other layers of the architecture, however, it can be exposed through a partial class, just like with the connection-level settings.</span></span>

<span data-ttu-id="7e5ef-202">因為 TableAdapter 只能有單一`Connection`屬性公開連接層級設定的程式碼是相當簡單。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-202">Since the TableAdapter only has a single `Connection` property, the code for exposing connection-level settings is fairly straightforward.</span></span> <span data-ttu-id="7e5ef-203">TableAdapter 可以有多個命令物件，因為修改命令層級設定時事情就會稍微複雜`InsertCommand`， `UpdateCommand`，和`DeleteCommand`，以及變數命令中的物件數目`CommandCollection`屬性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-203">Things are a bit more complicated when modifying command-level settings because the TableAdapter can have multiple command objects - an `InsertCommand`, `UpdateCommand`, and `DeleteCommand`, along with a variable number of command objects in the `CommandCollection` property.</span></span> <span data-ttu-id="7e5ef-204">當更新命令層級設定，這些設定必須傳播到所有的命令物件。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-204">When updating command-level settings, these settings will need to be propagated to all of the command objects.</span></span>

<span data-ttu-id="7e5ef-205">例如，假設花費了異常長時間執行的 TableAdapter 中發生的特定查詢。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-205">For example, imagine that there were certain queries in the TableAdapter that took an extraordinary long time to execute.</span></span> <span data-ttu-id="7e5ef-206">當使用 TableAdapter 執行這些查詢的其中一個，我們可能會想要增加命令物件 s [ `CommandTimeout`屬性](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtimeout.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-206">When using the TableAdapter to execute one of those queries, we might want to increase the command object s [`CommandTimeout` property](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtimeout.aspx).</span></span> <span data-ttu-id="7e5ef-207">這個屬性會指定無限等候命令執行的秒數，且預設值為 30。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-207">This property specifies the number of seconds to wait for the command to execute and defaults to 30.</span></span>

<span data-ttu-id="7e5ef-208">若要允許`CommandTimeout`屬性，以調整 BLL，加入下列`Public`方法`ProductsDataTable`使用部分類別檔案在步驟 2 中建立 (`ProductsTableAdapter.ConnectionAndCommandSettings.vb`):</span><span class="sxs-lookup"><span data-stu-id="7e5ef-208">To allow the `CommandTimeout` property to be adjusted by the BLL, add the following `Public` method to the `ProductsDataTable` using the partial class file created in Step 2 (`ProductsTableAdapter.ConnectionAndCommandSettings.vb`):</span></span>


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample4.vb)]

<span data-ttu-id="7e5ef-209">這個方法無法 TableAdapter 執行個體所叫用從 BLL 或展示層設定的所有命令問題的命令逾時之用。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-209">This method could be invoked from the BLL or Presentation Layer to set the command timeout for all commands issues by that TableAdapter instance.</span></span>

> [!NOTE]
> <span data-ttu-id="7e5ef-210">`Adapter`和`CommandCollection`屬性標記為`Private`，這表示他們只能存取從內 TableAdapter 的程式碼。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-210">The `Adapter` and `CommandCollection` properties are marked as `Private`, meaning they can only be accessed from code within the TableAdapter.</span></span> <span data-ttu-id="7e5ef-211">不同於`Connection`屬性，這些存取修飾詞不是可設定。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-211">Unlike the `Connection` property, these access modifiers are not configurable.</span></span> <span data-ttu-id="7e5ef-212">因此，如果您要公開命令層級屬性，以在架構中的其他圖層必須使用上述提供的部分類別方法`Public`方法或屬性，可讀取或寫入`Private`命令物件。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-212">Therefore, if you need to expose command-level properties to other layers in the architecture you must use the partial class approach discussed above to provide a `Public` method or property that reads or writes to the `Private` command objects.</span></span>


## <a name="summary"></a><span data-ttu-id="7e5ef-213">總結</span><span class="sxs-lookup"><span data-stu-id="7e5ef-213">Summary</span></span>

<span data-ttu-id="7e5ef-214">Tableadapter 在輸入資料集內提供的服務封裝資料存取的詳細資料和複雜性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-214">The TableAdapters within a Typed DataSet serve to encapsulate data access details and complexity.</span></span> <span data-ttu-id="7e5ef-215">使用 Tableadapter，我們不必擔心撰寫 ADO.NET 程式碼，以連接到資料庫、 發出命令，或填入 DataTable 的結果。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-215">Using TableAdapters, we do not have to worry about writing ADO.NET code to connect to the database, issue a command, or populate the results into a DataTable.</span></span> <span data-ttu-id="7e5ef-216">它是所有處理會自動為我們。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-216">It is all handled automatically for us.</span></span>

<span data-ttu-id="7e5ef-217">不過，可能是我們需要自訂低階的 ADO.NET 特性，例如變更連接字串或預設連線或命令逾時值。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-217">However, there may be times when we need to customize the low-level ADO.NET specifics, such as changing the connection string or the default connection or command timeout values.</span></span> <span data-ttu-id="7e5ef-218">TableAdapter 已自動產生`Connection`， `Adapter`，和`CommandCollection`屬性，但這些都是`Friend`或`Private`，根據預設。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-218">The TableAdapter has auto-generated `Connection`, `Adapter`, and `CommandCollection` properties, but these are either `Friend` or `Private`, by default.</span></span> <span data-ttu-id="7e5ef-219">此內部的資訊可以由擴充 TableAdapter 使用部分類別包含`Public`方法或屬性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-219">This internal information can be exposed by extending the TableAdapter using partial classes to include `Public` methods or properties.</span></span> <span data-ttu-id="7e5ef-220">或者，tableadapter`Connection`透過 tableadapter 可以設定屬性的存取修飾詞`ConnectionModifier`屬性。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-220">Alternatively, the TableAdapter s `Connection` property access modifier can be configured through the TableAdapter s `ConnectionModifier` property.</span></span>

<span data-ttu-id="7e5ef-221">祝您程式設計 ！</span><span class="sxs-lookup"><span data-stu-id="7e5ef-221">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="7e5ef-222">關於作者</span><span class="sxs-lookup"><span data-stu-id="7e5ef-222">About the Author</span></span>

<span data-ttu-id="7e5ef-223">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP/ASP.NET 書籍和的創辦[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已從 1998 年使用 Microsoft Web 技術。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-223">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7e5ef-224">Scott 可做為獨立顧問、 訓練和寫入器。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-224">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7e5ef-225">他最新的活頁簿[ *Sam 教導您自己 ASP.NET 2.0 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-225">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="7e5ef-226">他可以在達到[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或透過他的部落格，這可以在找到[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-226">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="7e5ef-227">特別感謝</span><span class="sxs-lookup"><span data-stu-id="7e5ef-227">Special Thanks To</span></span>

<span data-ttu-id="7e5ef-228">許多有用的檢閱者已檢閱本教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-228">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7e5ef-229">導致檢閱者在此教學課程已 Burnadette Leigh，S ren 因此 Lauritsen 本文菲和 Hilton Geisenow。</span><span class="sxs-lookup"><span data-stu-id="7e5ef-229">Lead reviewers for this tutorial were Burnadette Leigh, S ren Jacob Lauritsen, Teresa Murphy, and Hilton Geisenow.</span></span> <span data-ttu-id="7e5ef-230">檢閱我即將推出的 MSDN 文件有興趣嗎？</span><span class="sxs-lookup"><span data-stu-id="7e5ef-230">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7e5ef-231">如果是這樣，卸除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7e5ef-231">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7e5ef-232">[上一頁](working-with-computed-columns-vb.md)
> [下一頁](protecting-connection-strings-and-other-configuration-information-vb.md)</span><span class="sxs-lookup"><span data-stu-id="7e5ef-232">[Previous](working-with-computed-columns-vb.md)
[Next](protecting-connection-strings-and-other-configuration-information-vb.md)</span></span>
