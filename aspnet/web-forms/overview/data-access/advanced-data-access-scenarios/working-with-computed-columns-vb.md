---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/working-with-computed-columns-vb
title: 使用計算資料行 (VB) |Microsoft 文件
author: rick-anderson
description: 建立資料庫資料表時，Microsoft SQL Server 可讓您定義其值從運算式計算的計算資料行，通常 referen...
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/03/2007
ms.topic: article
ms.assetid: 5811b8ff-ed56-40fc-9397-6b69ae09a8f6
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/working-with-computed-columns-vb
msc.type: authoredcontent
ms.openlocfilehash: 04b39902aae05d815eb11ec7b7163988d017f78c
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/06/2018
ms.locfileid: "30877199"
---
<a name="working-with-computed-columns-vb"></a><span data-ttu-id="05364-103">使用計算資料行 (VB)</span><span class="sxs-lookup"><span data-stu-id="05364-103">Working with Computed Columns (VB)</span></span>
====================
<span data-ttu-id="05364-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="05364-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="05364-105">[下載程式碼](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_71_VB.zip)或[下載 PDF](working-with-computed-columns-vb/_static/datatutorial71vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="05364-105">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_71_VB.zip) or [Download PDF](working-with-computed-columns-vb/_static/datatutorial71vb1.pdf)</span></span>

> <span data-ttu-id="05364-106">建立資料庫資料表時，Microsoft SQL Server 可讓您定義其值從通常參考相同的資料庫記錄中的其他值的運算式計算的計算資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-106">When creating a database table, Microsoft SQL Server allows you to define a computed column whose value is calculated from an expression that usually references other values in the same database record.</span></span> <span data-ttu-id="05364-107">這類值都是唯讀，在資料庫中，使用 Tableadapter 時需要特別考量。</span><span class="sxs-lookup"><span data-stu-id="05364-107">Such values are read-only at the database, which requires special considerations when working with TableAdapters.</span></span> <span data-ttu-id="05364-108">在本教學課程中，我們了解如何符合計算資料行所帶來的挑戰。</span><span class="sxs-lookup"><span data-stu-id="05364-108">In this tutorial we learn how to meet the challenges posed by computed columns.</span></span>


## <a name="introduction"></a><span data-ttu-id="05364-109">簡介</span><span class="sxs-lookup"><span data-stu-id="05364-109">Introduction</span></span>

<span data-ttu-id="05364-110">Microsoft SQL Server 允許*[計算資料行](https://msdn.microsoft.com/library/ms191250.aspx)*，這些是通常來自相同資料表其他資料行參考值的運算式會計算其值的資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-110">Microsoft SQL Server allows for *[computed columns](https://msdn.microsoft.com/library/ms191250.aspx)*, which are columns whose values are calculated from an expression that usually references the values from other columns in the same table.</span></span> <span data-ttu-id="05364-111">例如，追蹤資料模型的時間可能有資料表，名為`ServiceLog`與資料行包括`ServicePerformed`， `EmployeeID`， `Rate`，和`Duration`，和其他項目。</span><span class="sxs-lookup"><span data-stu-id="05364-111">As an example, a time tracking data model might have a table named `ServiceLog` with columns including `ServicePerformed`, `EmployeeID`, `Rate`, and `Duration`, among others.</span></span> <span data-ttu-id="05364-112">雖然金額每個服務項目 （要乘以的持續時間的速率） 無法計算透過網頁或其他的程式設計介面，可能會比較方便包括中的資料行`ServiceLog`資料表名為`AmountDue`，回報這資訊。</span><span class="sxs-lookup"><span data-stu-id="05364-112">While the amount due per service item (being the rate multiplied by the duration) could be calculated through a web page or other programmatic interface, it might be handy to include a column in the `ServiceLog` table named `AmountDue` that reported this information.</span></span> <span data-ttu-id="05364-113">無法建立此資料行，做為一般的資料行，但它需要隨時更新`Rate`或`Duration`變更的資料行值。</span><span class="sxs-lookup"><span data-stu-id="05364-113">This column could be created as a normal column, but it would need to be updated anytime the `Rate` or `Duration` column values changed.</span></span> <span data-ttu-id="05364-114">更好的方法是，建立`AmountDue`使用運算式的計算資料行的資料行`Rate * Duration`。</span><span class="sxs-lookup"><span data-stu-id="05364-114">A better approach would be to make the `AmountDue` column a computed column using the expression `Rate * Duration`.</span></span> <span data-ttu-id="05364-115">這樣做會導致 SQL Server，即可自動計算`AmountDue`每當在查詢中參考的資料行值。</span><span class="sxs-lookup"><span data-stu-id="05364-115">Doing so would cause SQL Server to automatically calculate the `AmountDue` column value whenever it was referenced in a query.</span></span>

<span data-ttu-id="05364-116">計算資料行的值取決於運算式，因為這類資料行是唯讀，因此無法值指派給他們在`INSERT`或`UPDATE`陳述式。</span><span class="sxs-lookup"><span data-stu-id="05364-116">Since a computed column s value is determined by an expression, such columns are read-only and therefore cannot have values assigned to them in `INSERT` or `UPDATE` statements.</span></span> <span data-ttu-id="05364-117">不過，當計算資料行屬於主查詢使用特定 SQL 陳述式的 tableadapter，它們會自動包含在自動產生`INSERT`和`UPDATE`陳述式。</span><span class="sxs-lookup"><span data-stu-id="05364-117">However, when computed columns are part of the main query for a TableAdapter that uses ad-hoc SQL statements, they are automatically included in the auto-generated `INSERT` and `UPDATE` statements.</span></span> <span data-ttu-id="05364-118">因此，tableadapter`INSERT`和`UPDATE`查詢和`InsertCommand`和`UpdateCommand`必須更新屬性，來移除任何計算資料行的參考。</span><span class="sxs-lookup"><span data-stu-id="05364-118">Consequently, the TableAdapter s `INSERT` and `UPDATE` queries and `InsertCommand` and `UpdateCommand` properties must be updated to remove references to any computed columns.</span></span>

<span data-ttu-id="05364-119">使用的一項挑戰的計算資料行，以使用特定 SQL 陳述式的 TableAdapter 是 tableadapter`INSERT`和`UPDATE`查詢就會自動重新產生任何 TableAdapter 組態精靈完成時的時間。</span><span class="sxs-lookup"><span data-stu-id="05364-119">One challenge of using computed columns with a TableAdapter that uses ad-hoc SQL statements is that the TableAdapter s `INSERT` and `UPDATE` queries are automatically regenerated any time the TableAdapter Configuration wizard is completed.</span></span> <span data-ttu-id="05364-120">因此，計算資料行中手動移除從`INSERT`和`UPDATE`查詢將會重新顯示，如果重新執行精靈。</span><span class="sxs-lookup"><span data-stu-id="05364-120">Therefore, the computed columns manually removed from the `INSERT` and `UPDATE` queries will reappear if the wizard is re-run.</span></span> <span data-ttu-id="05364-121">雖然使用預存程序的 Tableadapter 不遭受此損毀，他們擁有自己 quirks 我們解決在步驟 3 中。</span><span class="sxs-lookup"><span data-stu-id="05364-121">Although TableAdapters that use stored procedures don t suffer from this brittleness, they do have their own quirks that we will address in Step 3.</span></span>

<span data-ttu-id="05364-122">在本教學課程中，我們將加入計算資料行`Suppliers`Northwind 資料庫中資料表，然後再建立對應的 TableAdapter，才能使用這個資料表，而且其計算資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-122">In this tutorial we will add a computed column to the `Suppliers` table in the Northwind database and then create a corresponding TableAdapter to work with this table and its computed column.</span></span> <span data-ttu-id="05364-123">我們將會使用預存程序而不是特定 SQL 陳述式，以便使用 TableAdapter 組態精靈時，我們的自訂項目和不 t 遺失我們 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="05364-123">We will have our TableAdapter use stored procedures instead of ad-hoc SQL statements so that our customizations aren t lost when the TableAdapter Configuration wizard is used.</span></span>

<span data-ttu-id="05364-124">Let s 開始 ！</span><span class="sxs-lookup"><span data-stu-id="05364-124">Let s get started!</span></span>

## <a name="step-1-adding-a-computed-column-to-thesupplierstable"></a><span data-ttu-id="05364-125">步驟 1： 加入計算資料行`Suppliers`資料表</span><span class="sxs-lookup"><span data-stu-id="05364-125">Step 1: Adding a Computed Column to the`Suppliers`Table</span></span>

<span data-ttu-id="05364-126">Northwind 資料庫沒有任何計算資料行，因此我們必須加入一個自己。</span><span class="sxs-lookup"><span data-stu-id="05364-126">The Northwind database does not have any computed columns so we will need to add one ourselves.</span></span> <span data-ttu-id="05364-127">針對本教學課程將加入至計算資料行的 s`Suppliers`資料表稱為`FullContactName`以下列格式傳回連絡人的名稱、 標題和它們適用於公司： `ContactName` (`ContactTitle`， `CompanyName`)。</span><span class="sxs-lookup"><span data-stu-id="05364-127">For this tutorial let s add a computed column to the `Suppliers` table called `FullContactName` that returns the contact s name, title, and the company they work for in the following format: `ContactName` (`ContactTitle`, `CompanyName`).</span></span> <span data-ttu-id="05364-128">此計算可能在報表中使用資料行，當顯示供應商的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="05364-128">This computed column might be used in reports when displaying information about suppliers.</span></span>

<span data-ttu-id="05364-129">先開啟`Suppliers`資料表定義，以滑鼠右鍵按一下`Suppliers`資料表在伺服器總管] 中，並從內容功能表中選擇 [開啟資料表定義。</span><span class="sxs-lookup"><span data-stu-id="05364-129">Start by opening the `Suppliers` table definition by right-clicking on the `Suppliers` table in the Server Explorer and choosing Open Table Definition from the context-menu.</span></span> <span data-ttu-id="05364-130">這就會顯示在資料表和其屬性，例如其資料類型的資料行，無論它們允許`NULL`s，依此類推。</span><span class="sxs-lookup"><span data-stu-id="05364-130">This will display the columns of the table and their properties, such as their data type, whether they allow `NULL` s, and so forth.</span></span> <span data-ttu-id="05364-131">若要加入計算資料行，啟動在資料表定義輸入資料行的名稱。</span><span class="sxs-lookup"><span data-stu-id="05364-131">To add a computed column, start by typing in the name of the column into the table definition.</span></span> <span data-ttu-id="05364-132">接下來，在資料行屬性 視窗中的計算資料行規格 區段下方的 (Formula) 文字方塊中輸入其運算式 （請參閱圖 1）。</span><span class="sxs-lookup"><span data-stu-id="05364-132">Next, enter its expression into the (Formula) textbox under the Computed Column Specification section in the Column Properties window (see Figure 1).</span></span> <span data-ttu-id="05364-133">計算資料行的名稱`FullContactName`並使用下列運算式：</span><span class="sxs-lookup"><span data-stu-id="05364-133">Name the computed column `FullContactName` and use the following expression:</span></span>


[!code-sql[Main](working-with-computed-columns-vb/samples/sample1.sql)]

<span data-ttu-id="05364-134">請注意在 SQL 中，可以串連字串使用`+`運算子。</span><span class="sxs-lookup"><span data-stu-id="05364-134">Note that strings can be concatenated in SQL using the `+` operator.</span></span> <span data-ttu-id="05364-135">`CASE`可以用來在傳統的程式設計語言中的條件陳述式。</span><span class="sxs-lookup"><span data-stu-id="05364-135">The `CASE` statement can be used like a conditional in a traditional programming language.</span></span> <span data-ttu-id="05364-136">上面的運算式中`CASE`陳述式可以讀取為： 如果`ContactTitle`不`NULL`接著輸出`ContactTitle`以逗號，否則為串連值發出做任何動作。</span><span class="sxs-lookup"><span data-stu-id="05364-136">In the above expression the `CASE` statement can be read as: If `ContactTitle` is not `NULL` then output the `ContactTitle` value concatenated with a comma, otherwise emit nothing.</span></span> <span data-ttu-id="05364-137">如需詳細資訊的實用性`CASE`陳述式，請參閱[SQL 電源`CASE`陳述式](http://www.4guysfromrolla.com/webtech/102704-1.shtml)。</span><span class="sxs-lookup"><span data-stu-id="05364-137">For more on the usefulness of the `CASE` statement, see [The Power of SQL `CASE` Statements](http://www.4guysfromrolla.com/webtech/102704-1.shtml).</span></span>

> [!NOTE]
> <span data-ttu-id="05364-138">而不是使用`CASE`以下陳述式，我們原也可以另外使用`ISNULL(ContactTitle, '')`。</span><span class="sxs-lookup"><span data-stu-id="05364-138">Instead of using a `CASE` statement here, we could have alternatively used `ISNULL(ContactTitle, '')`.</span></span> <span data-ttu-id="05364-139">[`ISNULL(checkExpression, replacementValue)`](https://msdn.microsoft.com/library/ms184325.aspx) 傳回*checkExpression*如果非 NULL，否則它會傳回*replacementValue*。</span><span class="sxs-lookup"><span data-stu-id="05364-139">[`ISNULL(checkExpression, replacementValue)`](https://msdn.microsoft.com/library/ms184325.aspx) returns *checkExpression* if it is non-NULL, otherwise it returns *replacementValue*.</span></span> <span data-ttu-id="05364-140">而是`ISNULL`或`CASE`運作在本例中，有更複雜的案例其中的彈性`CASE`陳述式就無法比對`ISNULL`。</span><span class="sxs-lookup"><span data-stu-id="05364-140">While either `ISNULL` or `CASE` will work in this instance, there are more intricate scenarios where the flexibility of the `CASE` statement cannot be matched by `ISNULL`.</span></span>


<span data-ttu-id="05364-141">新增此計算資料行後您的畫面看起來應該像螢幕擷取畫面中圖 1。</span><span class="sxs-lookup"><span data-stu-id="05364-141">After adding this computed column your screen should look like the screen shot in Figure 1.</span></span>


<span data-ttu-id="05364-142">[![加入名為 FullContactName 至供應商資料表的計算資料行](working-with-computed-columns-vb/_static/image2.png)](working-with-computed-columns-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="05364-142">[![Add a Computed Column Named FullContactName to the Suppliers Table](working-with-computed-columns-vb/_static/image2.png)](working-with-computed-columns-vb/_static/image1.png)</span></span>

<span data-ttu-id="05364-143">**圖 1**： 加入計算資料行名為`FullContactName`至`Suppliers`資料表 ([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="05364-143">**Figure 1**: Add a Computed Column Named `FullContactName` to the `Suppliers` Table ([Click to view full-size image](working-with-computed-columns-vb/_static/image3.png))</span></span>


<span data-ttu-id="05364-144">命名計算資料行和輸入的運算式之後儲存變更到資料表上，依序按一下工具列中的 儲存 圖示，請按 Ctrl + S、 或移至 檔案 功能表，然後選取 儲存`Suppliers`。</span><span class="sxs-lookup"><span data-stu-id="05364-144">After naming the computed column and entering its expression, save the changes to the table by clicking the Save icon in the toolbar, by hitting Ctrl+S, or by going to the File menu and choosing Save `Suppliers`.</span></span>

<span data-ttu-id="05364-145">儲存資料表應該重新整理伺服器總管 中，包括在剛加入的資料行`Suppliers`資料表 s 資料行清單。</span><span class="sxs-lookup"><span data-stu-id="05364-145">Saving the table should refresh the Server Explorer, including the just-added column in the `Suppliers` table s column list.</span></span> <span data-ttu-id="05364-146">此外，在 [(Formula)] 文字方塊中輸入的運算式會自動調整去除不必要的空白、 資料行名稱使用方括號括住的對等運算式 (`[]`)，並包含括號，以更明確地顯示作業的順序：</span><span class="sxs-lookup"><span data-stu-id="05364-146">Furthermore, the expression entered into the (Formula) textbox will automatically adjust to an equivalent expression that strips unnecessary whitespace, surrounds column names with brackets (`[]`), and includes parentheses to more explicitly show the order of operations:</span></span>


[!code-sql[Main](working-with-computed-columns-vb/samples/sample2.sql)]

<span data-ttu-id="05364-147">如需有關 Microsoft SQL Server 中的計算資料行的詳細資訊，請參閱[技術文件](https://msdn.microsoft.com/library/ms191250.aspx)。</span><span class="sxs-lookup"><span data-stu-id="05364-147">For more information on computed columns in Microsoft SQL Server, refer to the [technical documentation](https://msdn.microsoft.com/library/ms191250.aspx).</span></span> <span data-ttu-id="05364-148">也請參閱[How to: Specify Computed Columns](https://msdn.microsoft.com/library/ms188300.aspx)如建立計算資料行的逐步解說。</span><span class="sxs-lookup"><span data-stu-id="05364-148">Also check out the [How to: Specify Computed Columns](https://msdn.microsoft.com/library/ms188300.aspx) for a step-by-step walkthrough of creating computed columns.</span></span>

> [!NOTE]
> <span data-ttu-id="05364-149">根據預設，並未實際儲存在資料表中計算資料行，但會改為重新計算，每次在查詢中參考這些。</span><span class="sxs-lookup"><span data-stu-id="05364-149">By default, computed columns are not physically stored in the table but are instead recalculated each time they are referenced in a query.</span></span> <span data-ttu-id="05364-150">不過，藉由檢查 保存核取方塊，您可以指示來實際儲存在資料表中的計算資料行的 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="05364-150">By checking the Is Persisted checkbox, however, you can instruct SQL Server to physically store the computed column in the table.</span></span> <span data-ttu-id="05364-151">這樣做可以改善查詢效能的使用中的計算資料行值的計算資料行上建立索引可讓其`WHERE`子句。</span><span class="sxs-lookup"><span data-stu-id="05364-151">Doing so allows an index to be created on the computed column, which can improve the performance of queries that use the computed column value in their `WHERE` clauses.</span></span> <span data-ttu-id="05364-152">請參閱[在計算資料行上建立索引](https://msdn.microsoft.com/library/ms189292.aspx)如需詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="05364-152">See [Creating Indexes on Computed Columns](https://msdn.microsoft.com/library/ms189292.aspx) for more information.</span></span>


## <a name="step-2-viewing-the-computed-column-s-values"></a><span data-ttu-id="05364-153">步驟 2： 檢視計算資料行的值</span><span class="sxs-lookup"><span data-stu-id="05364-153">Step 2: Viewing the Computed Column s Values</span></span>

<span data-ttu-id="05364-154">O d e s 資料存取層在開始工作之前，花點時間檢視`FullContactName`值。</span><span class="sxs-lookup"><span data-stu-id="05364-154">Before we start work on the Data Access Layer, let s take a minute to view the `FullContactName` values.</span></span> <span data-ttu-id="05364-155">從 [伺服器總管] 中，以滑鼠右鍵按一下`Suppliers`資料表名稱，並從內容功能表中選擇新的查詢。</span><span class="sxs-lookup"><span data-stu-id="05364-155">From the Server Explorer, right-click on the `Suppliers` table name and choose New Query from the context-menu.</span></span> <span data-ttu-id="05364-156">這會顯示 [查詢] 視窗，提示我們選取要包含在查詢中的資料表。</span><span class="sxs-lookup"><span data-stu-id="05364-156">This will bring up a Query window that prompts us to choose what tables to include in the query.</span></span> <span data-ttu-id="05364-157">新增`Suppliers`資料表，並按一下 [關閉]。</span><span class="sxs-lookup"><span data-stu-id="05364-157">Add the `Suppliers` table and click Close.</span></span> <span data-ttu-id="05364-158">接下來，檢查`CompanyName`， `ContactName`， `ContactTitle`，和`FullContactName`[Suppliers] 資料表中的資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-158">Next, check the `CompanyName`, `ContactName`, `ContactTitle`, and `FullContactName` columns from the Suppliers table.</span></span> <span data-ttu-id="05364-159">最後，按一下 [執行查詢並檢視結果] 工具列中的紅色驚嘆號圖示。</span><span class="sxs-lookup"><span data-stu-id="05364-159">Finally, click the red exclamation point icon in the Toolbar to execute the query and view the results.</span></span>

<span data-ttu-id="05364-160">如圖 2 所示，結果會包含`FullContactName`，列出`CompanyName`， `ContactName`，和`ContactTitle`使用格式的資料行`ContactName`(`ContactTitle`， `CompanyName`)。</span><span class="sxs-lookup"><span data-stu-id="05364-160">As Figure 2 shows, the results include `FullContactName`, which lists the `CompanyName`, `ContactName`, and `ContactTitle` columns using the format `ContactName` (`ContactTitle`, `CompanyName`) .</span></span>


<span data-ttu-id="05364-161">[![FullContactName 使用格式 ContactName （連絡人職稱、 公司名稱）](working-with-computed-columns-vb/_static/image5.png)](working-with-computed-columns-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="05364-161">[![The FullContactName Uses the Format ContactName (ContactTitle, CompanyName)](working-with-computed-columns-vb/_static/image5.png)](working-with-computed-columns-vb/_static/image4.png)</span></span>

<span data-ttu-id="05364-162">**圖 2**:`FullContactName`使用格式`ContactName`(`ContactTitle`， `CompanyName`) ([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="05364-162">**Figure 2**: The `FullContactName` Uses the Format `ContactName` (`ContactTitle`, `CompanyName`) ([Click to view full-size image](working-with-computed-columns-vb/_static/image6.png))</span></span>


## <a name="step-3-adding-thesupplierstableadapterto-the-data-access-layer"></a><span data-ttu-id="05364-163">步驟 3： 加入`SuppliersTableAdapter`資料存取層</span><span class="sxs-lookup"><span data-stu-id="05364-163">Step 3: Adding the`SuppliersTableAdapter`to the Data Access Layer</span></span>

<span data-ttu-id="05364-164">為了能夠使用我們的應用程式中的供應商資訊，我們需要先建立我們 DAL TableAdapter，並 DataTable。</span><span class="sxs-lookup"><span data-stu-id="05364-164">In order to work with the supplier information in our application we need to first create a TableAdapter and DataTable in our DAL.</span></span> <span data-ttu-id="05364-165">在理想情況下，達成這點會使用相同的簡單步驟，檢查先前的教學課程。</span><span class="sxs-lookup"><span data-stu-id="05364-165">Ideally, this would be accomplished using the same straightforward steps examined in earlier tutorials.</span></span> <span data-ttu-id="05364-166">不過，計算資料行的使用會帶來幾縐折的程度，有些討論。</span><span class="sxs-lookup"><span data-stu-id="05364-166">However, working with computed columns introduces a few wrinkles that merit discussion.</span></span>

<span data-ttu-id="05364-167">如果您將會使用特定 SQL 陳述式的 TableAdapter，您只可以在 TableAdapter s 主查詢，透過 TableAdapter 組態精靈中，包含計算資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-167">If you are using a TableAdapter that uses ad-hoc SQL statements, you can simply include the computed column in the TableAdapter s main query via the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="05364-168">這項目，不過，將會自動產生`INSERT`和`UPDATE`包含計算資料行的陳述式。</span><span class="sxs-lookup"><span data-stu-id="05364-168">This, however, will auto-generate `INSERT` and `UPDATE` statements that include the computed column.</span></span> <span data-ttu-id="05364-169">如果您嘗試執行其中一種方法，`SqlException`訊息資料行與*ColumnName*無法修改，因為它是計算資料行或是 UNION 運算子的結果將會擲回。</span><span class="sxs-lookup"><span data-stu-id="05364-169">If you attempt to execute one of these methods, a `SqlException` with the message The column *ColumnName* cannot be modified because it is either a computed column or is the result of a UNION operator will be thrown.</span></span> <span data-ttu-id="05364-170">雖然`INSERT`和`UPDATE`陳述式可以透過 tableadapter 手動調整`InsertCommand`和`UpdateCommand`屬性，這些自訂將會遺失 TableAdapter 組態精靈時重新執行。</span><span class="sxs-lookup"><span data-stu-id="05364-170">While the `INSERT` and `UPDATE` statement can be manually adjusted through the TableAdapter s `InsertCommand` and `UpdateCommand` properties, these customizations will be lost whenever the TableAdapter Configuration wizard is re-run.</span></span>

<span data-ttu-id="05364-171">使用特定 SQL 陳述式的 Tableadapter 的損毀，因為建議，我們會使用預存程序時使用計算資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-171">Due to the brittleness of TableAdapters that use ad-hoc SQL statements, it is recommended that we use stored procedures when working with computed columns.</span></span> <span data-ttu-id="05364-172">如果您使用現有的預存程序，只要設定 TableAdapter 中所述[使用現有預存程序型別資料集 s Tableadapter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="05364-172">If you are using existing stored procedures, simply configure the TableAdapter as discussed in the [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) tutorial.</span></span> <span data-ttu-id="05364-173">如果您有 TableAdapter 精靈為您建立的預存程序，不過，務必一開始略過從主查詢的任何計算資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-173">If you have the TableAdapter wizard create the stored procedures for you, however, it is important to initially omit any computed columns from the main query.</span></span> <span data-ttu-id="05364-174">如果您主要的查詢中包含計算資料行，TableAdapter 組態精靈會通知您，完成時，它無法建立對應的預存程序。</span><span class="sxs-lookup"><span data-stu-id="05364-174">If you include a computed column in the main query, the TableAdapter Configuration wizard will inform you, upon completion, that it cannot create the corresponding stored procedures.</span></span> <span data-ttu-id="05364-175">簡單地說，我們需要一開始設定使用計算的資料行可用主查詢的 TableAdapter 手動更新對應的預存程序和 tableadapter`SelectCommand`包含計算資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-175">In short, we need to initially configure the TableAdapter using a computed column-free main query and then manually update the corresponding stored procedure and the TableAdapter s `SelectCommand` to include the computed column.</span></span> <span data-ttu-id="05364-176">這個方法很類似於使用中的一個[更新要使用的 TableAdapter](updating-the-tableadapter-to-use-joins-vb.md)`JOIN`*s*教學課程。</span><span class="sxs-lookup"><span data-stu-id="05364-176">This approach is similar to the one used in the [Updating the TableAdapter to Use](updating-the-tableadapter-to-use-joins-vb.md)`JOIN`*s* tutorial.</span></span>

<span data-ttu-id="05364-177">本教學課程，可讓 s 加入新的 TableAdapter，並讓它自動為我們建立預存程序。</span><span class="sxs-lookup"><span data-stu-id="05364-177">For this tutorial, let s add a new TableAdapter and have it automatically create the stored procedures for us.</span></span> <span data-ttu-id="05364-178">因此，我們必須將一開始省略`FullContactName`從主查詢的計算資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-178">Consequently, we will need to initially omit the `FullContactName` computed column from the main query.</span></span>

<span data-ttu-id="05364-179">先開啟`NorthwindWithSprocs`中的資料集`~/App_Code/DAL`資料夾。</span><span class="sxs-lookup"><span data-stu-id="05364-179">Start by opening the `NorthwindWithSprocs` DataSet in the `~/App_Code/DAL` folder.</span></span> <span data-ttu-id="05364-180">以滑鼠右鍵按一下設計工具中，並從內容功能表中，選擇 加入新的 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="05364-180">Right-click in the Designer and, from the context-menu, choose to add a new TableAdapter.</span></span> <span data-ttu-id="05364-181">這會啟動 TableAdapter 組態精靈。</span><span class="sxs-lookup"><span data-stu-id="05364-181">This will launch the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="05364-182">若要查詢資料，從指定的資料庫 (`NORTHWNDConnectionString`從`Web.config`)，按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="05364-182">Specify the database to query data from (`NORTHWNDConnectionString` from `Web.config`) and click Next.</span></span> <span data-ttu-id="05364-183">因為我們尚未建立任何預存程序進行查詢或修改`Suppliers`資料表中，選取 建立新的預存程序選項，讓精靈將為我們建立，並按一下 下一步。</span><span class="sxs-lookup"><span data-stu-id="05364-183">Since we have not yet created any stored procedures for querying or modifying the `Suppliers` table, select the Create new stored procedures option so that the wizard will create them for us and click Next.</span></span>


<span data-ttu-id="05364-184">[![選擇建立新預存程序選項](working-with-computed-columns-vb/_static/image8.png)](working-with-computed-columns-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="05364-184">[![Choose the Create new stored procedures Option](working-with-computed-columns-vb/_static/image8.png)](working-with-computed-columns-vb/_static/image7.png)</span></span>

<span data-ttu-id="05364-185">**圖 3**： 選擇建立新預存程序選項 ([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="05364-185">**Figure 3**: Choose the Create new stored procedures Option ([Click to view full-size image](working-with-computed-columns-vb/_static/image9.png))</span></span>


<span data-ttu-id="05364-186">後續步驟提示我們主查詢。</span><span class="sxs-lookup"><span data-stu-id="05364-186">The subsequent step prompts us for the main query.</span></span> <span data-ttu-id="05364-187">輸入下列查詢會傳回`SupplierID`， `CompanyName`， `ContactName`，和`ContactTitle`每個供應商的資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-187">Enter the following query, which returns the `SupplierID`, `CompanyName`, `ContactName`, and `ContactTitle` columns for each supplier.</span></span> <span data-ttu-id="05364-188">請注意，此查詢會故意省略計算資料行 (`FullContactName`); 我們將會更新對應預存程序的步驟 4 中包含此資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-188">Note that this query purposefully omits the computed column (`FullContactName`); we will update the corresponding stored procedure to include this column in Step 4.</span></span>


[!code-sql[Main](working-with-computed-columns-vb/samples/sample3.sql)]

<span data-ttu-id="05364-189">之後輸入主要的查詢，並按一下 下一步，精靈會讓我們將會產生四個預存程序的名稱。</span><span class="sxs-lookup"><span data-stu-id="05364-189">After entering the main query and clicking Next, the wizard allows us to name the four stored procedures it will generate.</span></span> <span data-ttu-id="05364-190">這些預存程序的名稱`Suppliers_Select`， `Suppliers_Insert`， `Suppliers_Update`，和`Suppliers_Delete`，如圖 4 所示。</span><span class="sxs-lookup"><span data-stu-id="05364-190">Name these stored procedures `Suppliers_Select`, `Suppliers_Insert`, `Suppliers_Update`, and `Suppliers_Delete`, as Figure 4 illustrates.</span></span>


<span data-ttu-id="05364-191">[![自訂的自動產生的預存程序的名稱](working-with-computed-columns-vb/_static/image11.png)](working-with-computed-columns-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="05364-191">[![Customize the Names of the Auto-Generated Stored Procedures](working-with-computed-columns-vb/_static/image11.png)](working-with-computed-columns-vb/_static/image10.png)</span></span>

<span data-ttu-id="05364-192">**圖 4**： 自訂自動產生預存程序的名稱 ([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="05364-192">**Figure 4**: Customize the Names of the Auto-Generated Stored Procedures ([Click to view full-size image](working-with-computed-columns-vb/_static/image12.png))</span></span>


<span data-ttu-id="05364-193">下一個步驟中，精靈可讓我們名稱 TableAdapter 的方法，並指定用來存取及更新資料的模式。</span><span class="sxs-lookup"><span data-stu-id="05364-193">The next wizard step allows us to name the TableAdapter s methods and specify the patterns used to access and update data.</span></span> <span data-ttu-id="05364-194">將所有的三個核取方塊已核取，但重新命名`GetData`方法`GetSuppliers`。</span><span class="sxs-lookup"><span data-stu-id="05364-194">Leave all three checkboxes checked, but rename the `GetData` method to `GetSuppliers`.</span></span> <span data-ttu-id="05364-195">按一下 [完成] 5d; 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="05364-195">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="05364-196">[![重新命名 GetSuppliers GetData 方法](working-with-computed-columns-vb/_static/image14.png)](working-with-computed-columns-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="05364-196">[![Rename the GetData Method to GetSuppliers](working-with-computed-columns-vb/_static/image14.png)](working-with-computed-columns-vb/_static/image13.png)</span></span>

<span data-ttu-id="05364-197">**圖 5**： 重新命名`GetData`方法`GetSuppliers`([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="05364-197">**Figure 5**: Rename the `GetData` Method to `GetSuppliers` ([Click to view full-size image](working-with-computed-columns-vb/_static/image15.png))</span></span>


<span data-ttu-id="05364-198">時按一下 [完成]，精靈會建立四個預存程序，並將 TableAdapter 和對應的資料表加入至型別資料集。</span><span class="sxs-lookup"><span data-stu-id="05364-198">Upon clicking Finish, the wizard will create the four stored procedures and add the TableAdapter and corresponding DataTable to the Typed DataSet.</span></span>

## <a name="step-4-including-the-computed-column-in-the-tableadapter-s-main-query"></a><span data-ttu-id="05364-199">步驟 4： 在 TableAdapter s 主查詢中包括計算資料行</span><span class="sxs-lookup"><span data-stu-id="05364-199">Step 4: Including the Computed Column in the TableAdapter s Main Query</span></span>

<span data-ttu-id="05364-200">我們現在需要更新 TableAdapter 和要包含的步驟 3 中建立 DataTable`FullContactName`計算資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-200">We now need to update the TableAdapter and DataTable created in Step 3 to include the `FullContactName` computed column.</span></span> <span data-ttu-id="05364-201">這牽涉到兩個步驟：</span><span class="sxs-lookup"><span data-stu-id="05364-201">This involves two steps:</span></span>

1. <span data-ttu-id="05364-202">更新`Suppliers_Select`預存程序傳回`FullContactName`計算資料行，以及</span><span class="sxs-lookup"><span data-stu-id="05364-202">Updating the `Suppliers_Select` stored procedure to return the `FullContactName` computed column, and</span></span>
2. <span data-ttu-id="05364-203">更新以包含相對應的 DataTable`FullContactName`資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-203">Updating the DataTable to include a corresponding `FullContactName` column.</span></span>

<span data-ttu-id="05364-204">開始瀏覽至 [伺服器總管] 中，並向下切入至 [預存程序] 資料夾。</span><span class="sxs-lookup"><span data-stu-id="05364-204">Start by navigating to the Server Explorer and drilling down into the Stored Procedures folder.</span></span> <span data-ttu-id="05364-205">開啟`Suppliers_Select`預存程序和更新`SELECT`查詢來包含`FullContactName`計算資料行：</span><span class="sxs-lookup"><span data-stu-id="05364-205">Open the `Suppliers_Select` stored procedure and update the `SELECT` query to include the `FullContactName` computed column:</span></span>


[!code-sql[Main](working-with-computed-columns-vb/samples/sample4.sql)]

<span data-ttu-id="05364-206">儲存預存程序的變更，按一下工具列中的 儲存 圖示、 按下 Ctrl + S 鍵，或選擇 儲存`Suppliers_Select`從 檔案 功能表選項。</span><span class="sxs-lookup"><span data-stu-id="05364-206">Save the changes to the stored procedure by clicking the Save icon in the Toolbar, by hitting Ctrl+S, or by choosing the Save `Suppliers_Select` option from the File menu.</span></span>

<span data-ttu-id="05364-207">接下來，返回 DataSet 設計工具，請以滑鼠右鍵按一下`SuppliersTableAdapter`，並從內容功能表選擇 設定。</span><span class="sxs-lookup"><span data-stu-id="05364-207">Next, return to the DataSet Designer, right-click on the `SuppliersTableAdapter`, and choose Configure from the context-menu.</span></span> <span data-ttu-id="05364-208">請注意，`Suppliers_Select`資料行現在包含`FullContactName`其資料行集合中的資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-208">Note that the `Suppliers_Select` column now includes the `FullContactName` column in its Data Columns collection.</span></span>


<span data-ttu-id="05364-209">[![執行 TableAdapter 的組態精靈來更新資料表 s 資料行](working-with-computed-columns-vb/_static/image17.png)](working-with-computed-columns-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="05364-209">[![Run the TableAdapter s Configuration Wizard to Update the DataTable s Columns](working-with-computed-columns-vb/_static/image17.png)](working-with-computed-columns-vb/_static/image16.png)</span></span>

<span data-ttu-id="05364-210">**圖 6**： 執行 tableadapter 組態精靈以更新資料表 s 中的資料行 ([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="05364-210">**Figure 6**: Run the TableAdapter s Configuration Wizard to Update the DataTable s Columns ([Click to view full-size image](working-with-computed-columns-vb/_static/image18.png))</span></span>


<span data-ttu-id="05364-211">按一下 [完成] 5d; 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="05364-211">Click Finish to complete the wizard.</span></span> <span data-ttu-id="05364-212">這會自動加入至對應的資料行`SuppliersDataTable`。</span><span class="sxs-lookup"><span data-stu-id="05364-212">This will automatically add a corresponding column to the `SuppliersDataTable`.</span></span> <span data-ttu-id="05364-213">[Tabaleadapter 精靈] 是聰明，可以偵測出`FullContactName`資料行是計算資料行，因此唯讀。</span><span class="sxs-lookup"><span data-stu-id="05364-213">The TableAdapter wizard is smart enough to detect that the `FullContactName` column is a computed column and therefore read-only.</span></span> <span data-ttu-id="05364-214">因此，它會設定資料行 s`ReadOnly`屬性`true`。</span><span class="sxs-lookup"><span data-stu-id="05364-214">Consequently, it sets the column s `ReadOnly` property to `true`.</span></span> <span data-ttu-id="05364-215">若要確認這種情況，選取 從資料行`SuppliersDataTable`然後移至 屬性 視窗 （請參閱圖 7）。</span><span class="sxs-lookup"><span data-stu-id="05364-215">To verify this, select the column from the `SuppliersDataTable` and then go to the Properties window (see Figure 7).</span></span> <span data-ttu-id="05364-216">請注意，`FullContactName`資料行 s`DataType`和`MaxLength`屬性也會據此設定。</span><span class="sxs-lookup"><span data-stu-id="05364-216">Note that the `FullContactName` column s `DataType` and `MaxLength` properties are also set accordingly.</span></span>


<span data-ttu-id="05364-217">[![FullContactName 資料行標示為唯讀](working-with-computed-columns-vb/_static/image20.png)](working-with-computed-columns-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="05364-217">[![The FullContactName Column is Marked as Read-Only](working-with-computed-columns-vb/_static/image20.png)](working-with-computed-columns-vb/_static/image19.png)</span></span>

<span data-ttu-id="05364-218">**圖 7**:`FullContactName`資料行標示為唯讀 ([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="05364-218">**Figure 7**: The `FullContactName` Column is Marked as Read-Only ([Click to view full-size image](working-with-computed-columns-vb/_static/image21.png))</span></span>


## <a name="step-5-adding-agetsupplierbysupplieridmethod-to-the-tableadapter"></a><span data-ttu-id="05364-219">步驟 5： 加入`GetSupplierBySupplierID`TableAdapter 方法</span><span class="sxs-lookup"><span data-stu-id="05364-219">Step 5: Adding a`GetSupplierBySupplierID`Method to the TableAdapter</span></span>

<span data-ttu-id="05364-220">在此教學課程中，我們將建立的 ASP.NET 網頁，顯示在可更新方格中的供應商。</span><span class="sxs-lookup"><span data-stu-id="05364-220">For this tutorial we will create an ASP.NET page that displays the suppliers in an updateable grid.</span></span> <span data-ttu-id="05364-221">在過去的教學課程我們已更新商務邏輯層的單一記錄擷取特定資料錄從做為強型別 DataTable，更新其內容，然後將傳送更新的 DataTable DAL 回將變更傳播至 DAL資料庫中。</span><span class="sxs-lookup"><span data-stu-id="05364-221">In past tutorials we have updated a single record from the Business Logic Layer by retrieving that particular record from the DAL as a strongly-typed DataTable, updating its properties, and then sending the updated DataTable back to the DAL to propagate the changes to the database.</span></span> <span data-ttu-id="05364-222">若要完成第一個步驟-擷取從 DAL 正在更新的資料錄集我們需要先加入`GetSupplierBySupplierID(supplierID)`dal 的方法。</span><span class="sxs-lookup"><span data-stu-id="05364-222">To accomplish this first step - retrieving the record being updated from the DAL - we need to first add a `GetSupplierBySupplierID(supplierID)` method to the DAL.</span></span>

<span data-ttu-id="05364-223">以滑鼠右鍵按一下`SuppliersTableAdapter`資料集設計中，然後從內容功能表中選擇 加入查詢選項。</span><span class="sxs-lookup"><span data-stu-id="05364-223">Right-click on the `SuppliersTableAdapter` in the DataSet Design and choose the Add Query option from the context-menu.</span></span> <span data-ttu-id="05364-224">我們在步驟 3 中，讓精靈為我們產生新的預存程序，選取 建立新的預存程序選項 （請參閱上一步圖 3 提供此精靈步驟的螢幕擷取畫面）。</span><span class="sxs-lookup"><span data-stu-id="05364-224">As we did in Step 3, let the wizard generate a new stored procedure for us by selecting the Create new stored procedure option (refer back to Figure 3 for a screenshot of this wizard step).</span></span> <span data-ttu-id="05364-225">由於這個方法會傳回多個資料行的記錄，表示我們想要使用 SQL 查詢的 SELECT 會傳回資料列，然後按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="05364-225">Since this method will return a record with multiple columns, indicate that we want to use a SQL query that is a SELECT which returns rows and click Next.</span></span>


<span data-ttu-id="05364-226">[![選擇 選取會傳回資料列選項](working-with-computed-columns-vb/_static/image23.png)](working-with-computed-columns-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="05364-226">[![Choose the SELECT which returns rows Option](working-with-computed-columns-vb/_static/image23.png)](working-with-computed-columns-vb/_static/image22.png)</span></span>

<span data-ttu-id="05364-227">**圖 8**： 選擇 選取會傳回資料列選項 ([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="05364-227">**Figure 8**: Choose the SELECT which returns rows Option ([Click to view full-size image](working-with-computed-columns-vb/_static/image24.png))</span></span>


<span data-ttu-id="05364-228">後續的步驟會提示的查詢，以使用這個方法。</span><span class="sxs-lookup"><span data-stu-id="05364-228">The subsequent step prompts us for the query to use for this method.</span></span> <span data-ttu-id="05364-229">輸入下列命令，它會傳回相同的資料欄位做為主要的查詢，但特定供應商。</span><span class="sxs-lookup"><span data-stu-id="05364-229">Enter the following, which returns the same data fields as the main query but for a particular supplier.</span></span>


[!code-sql[Main](working-with-computed-columns-vb/samples/sample5.sql)]

<span data-ttu-id="05364-230">下一個畫面會詢問我們將會自動產生預存程序的名稱。</span><span class="sxs-lookup"><span data-stu-id="05364-230">The next screen asks us to name the stored procedure that will be auto-generated.</span></span> <span data-ttu-id="05364-231">這個預存程序的名稱`Suppliers_SelectBySupplierID`，按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="05364-231">Name this stored procedure `Suppliers_SelectBySupplierID` and click Next.</span></span>


<span data-ttu-id="05364-232">[![預存程序 Suppliers_SelectBySupplierID 名稱](working-with-computed-columns-vb/_static/image26.png)](working-with-computed-columns-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="05364-232">[![Name the Stored Procedure Suppliers_SelectBySupplierID](working-with-computed-columns-vb/_static/image26.png)](working-with-computed-columns-vb/_static/image25.png)</span></span>

<span data-ttu-id="05364-233">**圖 9**： 命名預存程序`Suppliers_SelectBySupplierID`([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="05364-233">**Figure 9**: Name the Stored Procedure `Suppliers_SelectBySupplierID` ([Click to view full-size image](working-with-computed-columns-vb/_static/image27.png))</span></span>


<span data-ttu-id="05364-234">最後，精靈的提示給我們的資料存取模式和 tableadapter 所用的方法名稱。</span><span class="sxs-lookup"><span data-stu-id="05364-234">Lastly, the wizard prompts us for the data access patterns and method names to use for the TableAdapter.</span></span> <span data-ttu-id="05364-235">將這兩個核取方塊，選取此選項，但重新命名`FillBy`和`GetDataBy`方法`FillBySupplierID`和`GetSupplierBySupplierID`分別。</span><span class="sxs-lookup"><span data-stu-id="05364-235">Leave both checkboxes checked, but rename the `FillBy` and `GetDataBy` methods to `FillBySupplierID` and `GetSupplierBySupplierID`, respectively.</span></span>


<span data-ttu-id="05364-236">[![名稱 TableAdapter 方法 FillBySupplierID 和 GetSupplierBySupplierID](working-with-computed-columns-vb/_static/image29.png)](working-with-computed-columns-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="05364-236">[![Name the TableAdapter Methods FillBySupplierID and GetSupplierBySupplierID](working-with-computed-columns-vb/_static/image29.png)](working-with-computed-columns-vb/_static/image28.png)</span></span>

<span data-ttu-id="05364-237">**圖 10**： 命名 TableAdapter 方法`FillBySupplierID`和`GetSupplierBySupplierID`([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="05364-237">**Figure 10**: Name the TableAdapter Methods `FillBySupplierID` and `GetSupplierBySupplierID` ([Click to view full-size image](working-with-computed-columns-vb/_static/image30.png))</span></span>


<span data-ttu-id="05364-238">按一下 [完成] 5d; 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="05364-238">Click Finish to complete the wizard.</span></span>

## <a name="step-6-creating-the-business-logic-layer"></a><span data-ttu-id="05364-239">步驟 6： 建立商務邏輯層</span><span class="sxs-lookup"><span data-stu-id="05364-239">Step 6: Creating the Business Logic Layer</span></span>

<span data-ttu-id="05364-240">我們建立的 ASP.NET 網頁，會使用步驟 1 中建立計算資料行之前，我們需要先在 BLL 中加入對應的方法。</span><span class="sxs-lookup"><span data-stu-id="05364-240">Before we create an ASP.NET page that uses the computed column created in Step 1, we first need to add the corresponding methods in the BLL.</span></span> <span data-ttu-id="05364-241">我們的 ASP.NET 頁面上，我們將會在步驟 7 中建立，可讓使用者檢視及編輯供應商。</span><span class="sxs-lookup"><span data-stu-id="05364-241">Our ASP.NET page, which we will create in Step 7, will allow users to view and edit suppliers.</span></span> <span data-ttu-id="05364-242">因此，我們需要我們 BLL 最小值，提供方法來取得所有供應商，另一種更新特定供應商。</span><span class="sxs-lookup"><span data-stu-id="05364-242">Therefore, we need our BLL to provide, at minimum, a method to get all of the suppliers and another to update a particular supplier.</span></span>

<span data-ttu-id="05364-243">建立新的類別檔案命名為`SuppliersBLLWithSprocs`中`~/App_Code/BLL`資料夾並加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="05364-243">Create a new class file named `SuppliersBLLWithSprocs` in the `~/App_Code/BLL` folder and add the following code:</span></span>


[!code-vb[Main](working-with-computed-columns-vb/samples/sample6.vb)]

<span data-ttu-id="05364-244">類似其他 BLL 類別`SuppliersBLLWithSprocs`具有`Protected``Adapter`傳回的執行個體的屬性`SuppliersTableAdapter`類別以及兩個`Public`方法：`GetSuppliers`和`UpdateSupplier`。</span><span class="sxs-lookup"><span data-stu-id="05364-244">Like the other BLL classes, `SuppliersBLLWithSprocs` has a `Protected` `Adapter` property that returns an instance of the `SuppliersTableAdapter` class along with two `Public` methods: `GetSuppliers` and `UpdateSupplier`.</span></span> <span data-ttu-id="05364-245">`GetSuppliers`方法呼叫，並傳回`SuppliersDataTable`由相對應傳回`GetSupplier`資料存取層中的方法。</span><span class="sxs-lookup"><span data-stu-id="05364-245">The `GetSuppliers` method calls and returns the `SuppliersDataTable` returned by the corresponding `GetSupplier` method in the Data Access Layer.</span></span> <span data-ttu-id="05364-246">`UpdateSupplier`方法擷取特定供應商，透過對 DAL s 呼叫正在更新的相關資訊`GetSupplierBySupplierID(supplierID)`方法。</span><span class="sxs-lookup"><span data-stu-id="05364-246">The `UpdateSupplier` method retrieves information about the particular supplier being updated via a call to the DAL s `GetSupplierBySupplierID(supplierID)` method.</span></span> <span data-ttu-id="05364-247">然後更新`CategoryName`， `ContactName`，和`ContactTitle`屬性和這些變更認可到資料庫，藉由呼叫資料存取層 s`Update`方法，傳入修改`SuppliersRow`物件。</span><span class="sxs-lookup"><span data-stu-id="05364-247">It then updates the `CategoryName`, `ContactName`, and `ContactTitle` properties and commits these changes to the database by calling the Data Access Layer s `Update` method, passing in the modified `SuppliersRow` object.</span></span>

> [!NOTE]
> <span data-ttu-id="05364-248">除了`SupplierID`和`CompanyName`，供應商資料表的所有資料行允許`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="05364-248">Except for `SupplierID` and `CompanyName`, all columns in the Suppliers table allow `NULL` values.</span></span> <span data-ttu-id="05364-249">因此，如果傳入的`contactName`或`contactTitle`參數`Nothing`我們需要設定對應`ContactName`和`ContactTitle`屬性`NULL`資料庫值使用`SetContactNameNull`和`SetContactTitleNull`方法，分別。</span><span class="sxs-lookup"><span data-stu-id="05364-249">Therefore, if the passed-in `contactName` or `contactTitle` parameters are `Nothing` we need to set the corresponding `ContactName` and `ContactTitle` properties to a `NULL` database value using the `SetContactNameNull` and `SetContactTitleNull` methods, respectively.</span></span>


## <a name="step-7-working-with-the-computed-column-from-the-presentation-layer"></a><span data-ttu-id="05364-250">步驟 7： 使用從展示層的計算資料行</span><span class="sxs-lookup"><span data-stu-id="05364-250">Step 7: Working with the Computed Column from the Presentation Layer</span></span>

<span data-ttu-id="05364-251">使用計算資料行加入至`Suppliers`資料表和 DAL 和 BLL 據以更新，我們就可以開始建置適用於 ASP.NET 網頁`FullContactName`計算資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-251">With the computed column added to the `Suppliers` table and the DAL and BLL updated accordingly, we are ready to build an ASP.NET page that works with the `FullContactName` computed column.</span></span> <span data-ttu-id="05364-252">先開啟`ComputedColumns.aspx`頁面`AdvancedDAL`資料夾，然後從 [工具箱] 拖曳至設計工具拖曳 GridView。</span><span class="sxs-lookup"><span data-stu-id="05364-252">Start by opening the `ComputedColumns.aspx` page in the `AdvancedDAL` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="05364-253">設定 GridView s`ID`屬性`Suppliers`和其智慧標籤上，從繫結到名為新 ObjectDataSource `SuppliersDataSource`。</span><span class="sxs-lookup"><span data-stu-id="05364-253">Set the GridView s `ID` property to `Suppliers` and, from its smart tag, bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="05364-254">設定用於 ObjectDataSource`SuppliersBLLWithSprocs`類別，我們加入在步驟 6 中備份，並按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="05364-254">Configure the ObjectDataSource to use the `SuppliersBLLWithSprocs` class we added back in Step 6 and click Next.</span></span>


<span data-ttu-id="05364-255">[![設定使用 SuppliersBLLWithSprocs 類別 ObjectDataSource](working-with-computed-columns-vb/_static/image32.png)](working-with-computed-columns-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="05364-255">[![Configure the ObjectDataSource to Use the SuppliersBLLWithSprocs Class](working-with-computed-columns-vb/_static/image32.png)](working-with-computed-columns-vb/_static/image31.png)</span></span>

<span data-ttu-id="05364-256">**圖 11**： 設定要使用 ObjectDataSource`SuppliersBLLWithSprocs`類別 ([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="05364-256">**Figure 11**: Configure the ObjectDataSource to Use the `SuppliersBLLWithSprocs` Class ([Click to view full-size image](working-with-computed-columns-vb/_static/image33.png))</span></span>


<span data-ttu-id="05364-257">只有兩個方法中定義`SuppliersBLLWithSprocs`類別：`GetSuppliers`和`UpdateSupplier`。</span><span class="sxs-lookup"><span data-stu-id="05364-257">There are only two methods defined in the `SuppliersBLLWithSprocs` class: `GetSuppliers` and `UpdateSupplier`.</span></span> <span data-ttu-id="05364-258">請確認這兩種方法指定在 選取和分別更新索引標籤上，按一下 完成 以完成 ObjectDataSource 設定。</span><span class="sxs-lookup"><span data-stu-id="05364-258">Ensure that these two methods are specified in the SELECT and UPDATE tabs, respectively, and click Finish to complete the configuration of the ObjectDataSource.</span></span>

<span data-ttu-id="05364-259">完成 資料來源組態精靈的詳細資訊，Visual Studio 會將 BoundField 之每個傳回的資料欄位。</span><span class="sxs-lookup"><span data-stu-id="05364-259">Upon completion of the Data Source Configuration wizard, Visual Studio will add a BoundField for each of the data fields returned.</span></span> <span data-ttu-id="05364-260">移除`SupplierID`BoundField 並變更`HeaderText`屬性`CompanyName`， `ContactName`， `ContactTitle`，和`FullContactName`BoundFields 公司、 Contact Name、 標題和完整的連絡人名稱，以分別。</span><span class="sxs-lookup"><span data-stu-id="05364-260">Remove the `SupplierID` BoundField and change the `HeaderText` properties of the `CompanyName`, `ContactName`, `ContactTitle`, and `FullContactName` BoundFields to Company, Contact Name, Title, and Full Contact Name, respectively.</span></span> <span data-ttu-id="05364-261">從智慧標籤，檢查 啟用編輯核取方塊以開啟 GridView s 內建編輯的功能。</span><span class="sxs-lookup"><span data-stu-id="05364-261">From the smart tag, check the Enable Editing checkbox to turn on the GridView s built-in editing capabilities.</span></span>

<span data-ttu-id="05364-262">除了新增 BoundFields 至 GridView，完成 資料來源精靈也會設定 ObjectDataSource s Visual Studio`OldValuesParameterFormatString`屬性至原始\_{0}。</span><span class="sxs-lookup"><span data-stu-id="05364-262">In addition to adding BoundFields to the GridView, completion of the Data Source Wizard also causes Visual Studio to set the ObjectDataSource s `OldValuesParameterFormatString` property to original\_{0}.</span></span> <span data-ttu-id="05364-263">還原回此設定為其預設值，{0}。</span><span class="sxs-lookup"><span data-stu-id="05364-263">Revert this setting back to its default value, {0} .</span></span>

<span data-ttu-id="05364-264">之後的 GridView 和 ObjectDataSource 進行這些編輯，其宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="05364-264">After making these edits to the GridView and ObjectDataSource, their declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](working-with-computed-columns-vb/samples/sample7.aspx)]

<span data-ttu-id="05364-265">接下來，請造訪此頁面，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="05364-265">Next, visit this page through a browser.</span></span> <span data-ttu-id="05364-266">如圖 12 所示，每個供應商出現在一個方格，其中包含`FullContactName`資料行，只要其他三個資料行串連後得出其值格式化為`ContactName`(`ContactTitle`， `CompanyName`)。</span><span class="sxs-lookup"><span data-stu-id="05364-266">As Figure 12 shows, each supplier is listed in a grid that includes the `FullContactName` column, whose value is simply the concatenation of the other three columns formatted as `ContactName` (`ContactTitle`, `CompanyName`) .</span></span>


<span data-ttu-id="05364-267">[![方格會列出每個供應商](working-with-computed-columns-vb/_static/image35.png)](working-with-computed-columns-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="05364-267">[![Each Supplier is Listed in the Grid](working-with-computed-columns-vb/_static/image35.png)](working-with-computed-columns-vb/_static/image34.png)</span></span>

<span data-ttu-id="05364-268">**圖 12**： 方格會列出每個供應商 ([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="05364-268">**Figure 12**: Each Supplier is Listed in the Grid ([Click to view full-size image](working-with-computed-columns-vb/_static/image36.png))</span></span>


<span data-ttu-id="05364-269">針對特定供應商導致回傳，和該資料列呈現中，按一下 [編輯] 按鈕 （請參閱圖 13） 其編輯介面。</span><span class="sxs-lookup"><span data-stu-id="05364-269">Clicking the Edit button for a particular supplier causes a postback and has that row rendered in its editing interface (see Figure 13).</span></span> <span data-ttu-id="05364-270">前三個資料行轉譯中其編輯介面的預設值-將 TextBox 控制項`Text`屬性設定為資料欄位的值。</span><span class="sxs-lookup"><span data-stu-id="05364-270">The first three columns render in their default editing interface - a TextBox control whose `Text` property is set to the value of the data field.</span></span> <span data-ttu-id="05364-271">`FullContactName`資料行，不過，仍然維持為文字。</span><span class="sxs-lookup"><span data-stu-id="05364-271">The `FullContactName` column, however, remains as text.</span></span> <span data-ttu-id="05364-272">當 BoundFields 已加入至資料來源組態精靈中，完成 GridView `FullContactName` BoundField s`ReadOnly`屬性設定為`True`因為對應`FullContactName`中的資料行`SuppliersDataTable`具有其`ReadOnly`屬性設定為`True`。</span><span class="sxs-lookup"><span data-stu-id="05364-272">When the BoundFields were added to the GridView at the completion of the Data Source Configuration wizard, the `FullContactName` BoundField s `ReadOnly` property was set to `True` because the corresponding `FullContactName` column in the `SuppliersDataTable` has its `ReadOnly` property set to `True`.</span></span> <span data-ttu-id="05364-273">步驟 4 中註明`FullContactName`s`ReadOnly`屬性設定為`True`因為 TableAdapter 偵測到資料行是計算資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-273">As noted in Step 4, the `FullContactName` s `ReadOnly` property was set to `True` because the TableAdapter detected that the column was a computed column.</span></span>


<span data-ttu-id="05364-274">[![FullContactName 資料行是不可編輯](working-with-computed-columns-vb/_static/image38.png)](working-with-computed-columns-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="05364-274">[![The FullContactName Column is Not Editable](working-with-computed-columns-vb/_static/image38.png)](working-with-computed-columns-vb/_static/image37.png)</span></span>

<span data-ttu-id="05364-275">**圖 13**:`FullContactName`資料行是無法編輯 ([按一下以檢視完整大小的影像](working-with-computed-columns-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="05364-275">**Figure 13**: The `FullContactName` Column is Not Editable ([Click to view full-size image](working-with-computed-columns-vb/_static/image39.png))</span></span>


<span data-ttu-id="05364-276">請繼續並更新一或多個可編輯的資料行的值，然後按一下 更新。</span><span class="sxs-lookup"><span data-stu-id="05364-276">Go ahead and update the value of one or more of the editable columns and click Update.</span></span> <span data-ttu-id="05364-277">請注意如何`FullContactName`的值會自動更新以反映變更。</span><span class="sxs-lookup"><span data-stu-id="05364-277">Note how the `FullContactName` s value is automatically updated to reflect the change.</span></span>

> [!NOTE]
> <span data-ttu-id="05364-278">GridView 目前使用 BoundFields 可編輯的欄位，導致預設的編輯介面。</span><span class="sxs-lookup"><span data-stu-id="05364-278">The GridView currently uses BoundFields for the editable fields, resulting in the default editing interface.</span></span> <span data-ttu-id="05364-279">因為`CompanyName`是必填欄位，它應該轉換成包含 RequiredFieldValidator TemplateField。</span><span class="sxs-lookup"><span data-stu-id="05364-279">Since the `CompanyName` field is required, it should be converted into a TemplateField that includes a RequiredFieldValidator.</span></span> <span data-ttu-id="05364-280">我將保留這為一項工作有興趣的讀取器。</span><span class="sxs-lookup"><span data-stu-id="05364-280">I leave this as an exercise for the interested reader.</span></span> <span data-ttu-id="05364-281">請參閱[新增驗證控制項的編輯和插入介面](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)教學課程，如需有關將轉換為 TemplateField BoundField 並加入驗證控制項的逐步指示。</span><span class="sxs-lookup"><span data-stu-id="05364-281">Consult the [Adding Validation Controls to the Editing and Inserting Interfaces](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md) tutorial for step-by-step instructions on converting a BoundField to a TemplateField and adding validation controls.</span></span>


## <a name="summary"></a><span data-ttu-id="05364-282">總結</span><span class="sxs-lookup"><span data-stu-id="05364-282">Summary</span></span>

<span data-ttu-id="05364-283">當定義資料表的結構描述，Microsoft SQL Server 可讓包含的計算資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-283">When defining the schema for a table, Microsoft SQL Server allows the inclusion of computed columns.</span></span> <span data-ttu-id="05364-284">這些是通常是從同一筆記錄中的其他資料行參考值的運算式會計算其值的資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-284">These are columns whose values are calculated from an expression that usually references the values from other columns in the same record.</span></span> <span data-ttu-id="05364-285">因為值計算資料行是根據運算式，它們是唯讀且無法指派中的值`INSERT`或`UPDATE`陳述式。</span><span class="sxs-lookup"><span data-stu-id="05364-285">Since the values for computed columns are based on an expression, they are read-only and cannot be assigned a value in an `INSERT` or `UPDATE` statement.</span></span> <span data-ttu-id="05364-286">嘗試自動產生對應的 TableAdapter 的主要查詢中使用計算資料行時，這會帶來的挑戰`INSERT`， `UPDATE`，和`DELETE`陳述式。</span><span class="sxs-lookup"><span data-stu-id="05364-286">This introduces challenges when using a computed column in the main query of a TableAdapter that tries to automatically generate corresponding `INSERT`, `UPDATE`, and `DELETE` statements.</span></span>

<span data-ttu-id="05364-287">在本教學課程，我們會討論規避計算資料行所造成的驗證題目的技術。</span><span class="sxs-lookup"><span data-stu-id="05364-287">In this tutorial we discussed techniques for circumventing the challenges posed by computed columns.</span></span> <span data-ttu-id="05364-288">特別是，我們使用預存程序中我們 TableAdapter 克服固有使用特定 SQL 陳述式的 Tableadapter 中損毀。</span><span class="sxs-lookup"><span data-stu-id="05364-288">In particular, we used stored procedures in our TableAdapter to overcome the brittleness inherent in TableAdapters that use ad-hoc SQL statements.</span></span> <span data-ttu-id="05364-289">當使用 TableAdapter 精靈建立新的預存程序時，很重要，我們有一開始省略任何計算資料行，因為它們的存在可防止資料修改預存程序產生的主查詢。</span><span class="sxs-lookup"><span data-stu-id="05364-289">When having the TableAdapter wizard create new stored procedures, it is important that we have the main query initially omit any computed columns because their presence prevents the data modification stored procedures from being generated.</span></span> <span data-ttu-id="05364-290">一開始設定 TableAdapter 之後，其`SelectCommand`預存程序可以改裝包含任何計算資料行。</span><span class="sxs-lookup"><span data-stu-id="05364-290">After the TableAdapter has been initially configured, its `SelectCommand` stored procedure can be retooled to include any computed columns.</span></span>

<span data-ttu-id="05364-291">祝您程式設計 ！</span><span class="sxs-lookup"><span data-stu-id="05364-291">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="05364-292">關於作者</span><span class="sxs-lookup"><span data-stu-id="05364-292">About the Author</span></span>

<span data-ttu-id="05364-293">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP/ASP.NET 書籍和的創辦[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已從 1998 年使用 Microsoft Web 技術。</span><span class="sxs-lookup"><span data-stu-id="05364-293">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="05364-294">Scott 可做為獨立顧問、 訓練和寫入器。</span><span class="sxs-lookup"><span data-stu-id="05364-294">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="05364-295">他最新的活頁簿[ *Sam 教導您自己 ASP.NET 2.0 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="05364-295">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="05364-296">他可以在達到[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或透過他的部落格，這可以在找到[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="05364-296">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="05364-297">特別感謝</span><span class="sxs-lookup"><span data-stu-id="05364-297">Special Thanks To</span></span>

<span data-ttu-id="05364-298">許多有用的檢閱者已檢閱本教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="05364-298">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="05364-299">此教學課程中的前導檢閱者已 Hilton Geisenow 和本文菲。</span><span class="sxs-lookup"><span data-stu-id="05364-299">Lead reviewers for this tutorial were Hilton Geisenow and Teresa Murphy.</span></span> <span data-ttu-id="05364-300">檢閱我即將推出的 MSDN 文件有興趣嗎？</span><span class="sxs-lookup"><span data-stu-id="05364-300">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="05364-301">如果是這樣，卸除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="05364-301">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="05364-302">[上一頁](adding-additional-datatable-columns-vb.md)
> [下一頁](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb.md)</span><span class="sxs-lookup"><span data-stu-id="05364-302">[Previous](adding-additional-datatable-columns-vb.md)
[Next](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb.md)</span></span>
