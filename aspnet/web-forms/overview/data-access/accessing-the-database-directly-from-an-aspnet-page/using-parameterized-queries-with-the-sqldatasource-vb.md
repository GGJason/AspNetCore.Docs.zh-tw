---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-vb
title: 使用 SqlDataSource (VB) 中使用參數化的查詢 |Microsoft 文件
author: rick-anderson
description: 在本教學課程中，我們會繼續我們查看 SqlDataSource 控制項，並了解如何定義參數化的查詢。 參數可以指定兩個 decla...
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2007
ms.topic: article
ms.assetid: e322f34c-83b7-41ea-ab65-ab1e0bdcc609
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-vb
msc.type: authoredcontent
ms.openlocfilehash: a7442ef3bebb2742cc36d695914b745aa2dfa721
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/06/2018
ms.locfileid: "30878135"
---
<a name="using-parameterized-queries-with-the-sqldatasource-vb"></a><span data-ttu-id="d8bcf-104">使用 SqlDataSource (VB) 中使用參數化的查詢</span><span class="sxs-lookup"><span data-stu-id="d8bcf-104">Using Parameterized Queries with the SqlDataSource (VB)</span></span>
====================
<span data-ttu-id="d8bcf-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d8bcf-106">[下載範例應用程式](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_VB.exe)或[下載 PDF](using-parameterized-queries-with-the-sqldatasource-vb/_static/datatutorial48vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_VB.exe) or [Download PDF](using-parameterized-queries-with-the-sqldatasource-vb/_static/datatutorial48vb1.pdf)</span></span>

> <span data-ttu-id="d8bcf-107">在本教學課程中，我們會繼續我們查看 SqlDataSource 控制項，並了解如何定義參數化的查詢。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-107">In this tutorial, we continue our look at the SqlDataSource control and learn how to define parameterized queries.</span></span> <span data-ttu-id="d8bcf-108">以宣告方式和以程式設計的方式，可以指定的參數，並且可以取自的位置，例如查詢字串、 工作階段狀態，其他控制項和更多的數字。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-108">The parameters can be specified both declaratively and programmatically, and can be pulled from a number of locations such as the querystring, Session state, other controls, and more.</span></span>


## <a name="introduction"></a><span data-ttu-id="d8bcf-109">簡介</span><span class="sxs-lookup"><span data-stu-id="d8bcf-109">Introduction</span></span>

<span data-ttu-id="d8bcf-110">在上一個教學課程中我們可了解如何使用 SqlDataSource 控制項直接從資料庫擷取資料。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-110">In the previous tutorial we saw how to use the SqlDataSource control to retrieve data directly from a database.</span></span> <span data-ttu-id="d8bcf-111">使用 「 設定資料來源精靈 」，我們可以選擇資料庫，然後將： 挑選要從資料表或檢視則傳回的資料行輸入自訂的 SQL 陳述式。或使用預存程序。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-111">Using the Configure Data Source wizard, we could choose the database and then either: pick the columns to return from a table or view; enter a custom SQL statement; or use a stored procedure.</span></span> <span data-ttu-id="d8bcf-112">從資料表或檢視表選取資料行，或輸入自訂的 SQL 陳述式，SqlDataSource 控制項是否 s`SelectCommand`屬性會被指派結果的特定 SQL`SELECT`陳述式，而且這是此`SELECT`陳述式時執行SqlDataSource 的`Select()`叫用方法時 (以程式設計方式或自動從 Web 控制項的資料)。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-112">Whether selecting columns from a table or view or entering a custom SQL statement, the SqlDataSource control s `SelectCommand` property is assigned the resulting ad-hoc SQL `SELECT` statement and it is this `SELECT` statement that is executed when the SqlDataSource s `Select()` method is invoked (either programmatically or automatically from a data Web control).</span></span>

<span data-ttu-id="d8bcf-113">SQL`SELECT`陳述式中先前的教學課程的示範缺乏使用`WHERE`子句。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-113">The SQL `SELECT` statements used in the previous tutorial s demos lacked `WHERE` clauses.</span></span> <span data-ttu-id="d8bcf-114">在`SELECT`陳述式，`WHERE`子句可以用來限制傳回的結果。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-114">In a `SELECT` statement, the `WHERE` clause can be used to limit the results returned.</span></span> <span data-ttu-id="d8bcf-115">例如，若要顯示的成本大於 $50.00 的產品名稱，我們可以使用下列查詢：</span><span class="sxs-lookup"><span data-stu-id="d8bcf-115">For example, to display the names of products costing more than $50.00, we could use the following query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample1.sql)]

<span data-ttu-id="d8bcf-116">一般而言，使用中的值`WHERE`子句會決定某些外部來源，例如查詢字串值、 工作階段變數或頁面上的 Web 控制項的使用者輸入。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-116">Typically, the values used in a `WHERE` clause are determine by some external source, such as a querystring value, a session variable, or user input from a Web control on the page.</span></span> <span data-ttu-id="d8bcf-117">透過使用的理想上，指定此類輸入*參數*。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-117">Ideally, such inputs are specified through the use of *parameters*.</span></span> <span data-ttu-id="d8bcf-118">與 Microsoft SQL Server，參數會表示使用`@parameterName`，如下所示：</span><span class="sxs-lookup"><span data-stu-id="d8bcf-118">With Microsoft SQL Server, parameters are denoted using `@parameterName`, as in:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample2.sql)]

<span data-ttu-id="d8bcf-119">SqlDataSource 支援參數化的查詢，兩者`SELECT`陳述式和`INSERT`， `UPDATE`，和`DELETE`陳述式。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-119">The SqlDataSource supports parameterized queries, both for `SELECT` statements and `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="d8bcf-120">此外，參數值可以自動從各種來源的 querystring，工作階段狀態，在頁面上，控制項和等等或可以透過程式設計方式指定。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-120">Moreover, the parameter values can be automatically pulled from a variety of sources the querystring, session state, controls on the page, and so on or can be assigned programmatically.</span></span> <span data-ttu-id="d8bcf-121">在本教學課程中，我們會看到如何定義參數化的查詢以及如何指定參數值以宣告方式和以程式設計的方式。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-121">In this tutorial, we'll see how to define parameterized queries as well as how to specify the parameter values both declaratively and programmatically.</span></span>

> [!NOTE]
> <span data-ttu-id="d8bcf-122">在上一個教學課程中，我們會比較 ObjectDataSource 透過使用 SqlDataSource，注意其概念相似之處的第一次 46 教學課程已我們選擇的工具。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-122">In the previous tutorial we compared the ObjectDataSource which has been our tool of choice over the first 46 tutorials with the SqlDataSource, noting their conceptual similarities.</span></span> <span data-ttu-id="d8bcf-123">這些相似之處也會延伸至參數。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-123">These similarities also extend to parameters.</span></span> <span data-ttu-id="d8bcf-124">ObjectDataSource 的參數對應到商務邏輯層中的方法的輸入參數。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-124">The ObjectDataSource s parameters mapped to the input parameters for the methods in the Business Logic Layer.</span></span> <span data-ttu-id="d8bcf-125">使用 SqlDataSource，參數會定義直接在 SQL 查詢。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-125">With the SqlDataSource, the parameters are defined directly within the SQL query.</span></span> <span data-ttu-id="d8bcf-126">這兩個控制項具有參數的集合，這些其`Select()`， `Insert()`， `Update()`，和`Delete()`方法，兩者均可以從預先定義的來源 （querystring 值、 工作階段變數等填入這些參數值) 或透過程式設計方式指定。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-126">Both controls have collections of parameters for their `Select()`, `Insert()`, `Update()`, and `Delete()` methods, and both can have these parameter values populated from pre-defined sources (querystring values, session variables, and so on) or assigned programmatically.</span></span>


## <a name="creating-a-parameterized-query"></a><span data-ttu-id="d8bcf-127">建立參數型查詢</span><span class="sxs-lookup"><span data-stu-id="d8bcf-127">Creating a Parameterized Query</span></span>

<span data-ttu-id="d8bcf-128">SqlDataSource 控制項 s 設定資料來源精靈提供三種途徑，以定義要擷取資料庫中的記錄執行的命令：</span><span class="sxs-lookup"><span data-stu-id="d8bcf-128">The SqlDataSource control s Configure Data Source wizard offers three avenues for defining the command to execute to retrieve database records:</span></span>

- <span data-ttu-id="d8bcf-129">選取的現有資料表或檢視表中的資料行</span><span class="sxs-lookup"><span data-stu-id="d8bcf-129">By picking the columns from an existing table or view,</span></span>
- <span data-ttu-id="d8bcf-130">輸入自訂的 SQL 陳述式，或</span><span class="sxs-lookup"><span data-stu-id="d8bcf-130">By entering a custom SQL statement, or</span></span>
- <span data-ttu-id="d8bcf-131">選擇預存程序</span><span class="sxs-lookup"><span data-stu-id="d8bcf-131">By choosing a stored procedure</span></span>

<span data-ttu-id="d8bcf-132">當挑選現有的資料表或檢視表，為參數的資料行`WHERE`子句必須指定透過 「 新增`WHERE`子句對話方塊。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-132">When picking columns from an existing table or view, the parameters for the `WHERE` clause must be specified through the Add `WHERE` Clause dialog box.</span></span> <span data-ttu-id="d8bcf-133">在建立自訂的 SQL 陳述式，不過，您可以輸入的參數，直接將`WHERE`子句 (使用`@parameterName`代表每個參數)。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-133">When creating a custom SQL statement, however, you can enter the parameters directly into the `WHERE` clause (using `@parameterName` to denote each parameter).</span></span> <span data-ttu-id="d8bcf-134">A[預存程序](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1)組成一或多個 SQL 陳述式，而且這些陳述式可以參數化。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-134">A [stored procedure](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) consists of one or more SQL statements, and these statements can be parameterized.</span></span> <span data-ttu-id="d8bcf-135">SQL 陳述式中使用的參數不過，必須傳遞中做為輸入參數給預存程序。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-135">The parameters used in the SQL statements, however, must be passed in as input parameters to the stored procedure.</span></span>

<span data-ttu-id="d8bcf-136">因為建立參數化的查詢取決於如何 SqlDataSource 的`SelectCommand`已指定，讓 s 看看這三種方法。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-136">Since creating a parameterized query depends on how the SqlDataSource s `SelectCommand` is specified, let s take a look at all three approaches.</span></span> <span data-ttu-id="d8bcf-137">若要開始使用，請開啟`ParameterizedQueries.aspx`頁面`SqlDataSource`資料夾中，將 SqlDataSource 控制項從工具箱拖曳至設計工具中，並設定其`ID`至`Products25BucksAndUnderDataSource`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-137">To get started, open the `ParameterizedQueries.aspx` page in the `SqlDataSource` folder, drag a SqlDataSource control from the Toolbox onto the Designer, and set its `ID` to `Products25BucksAndUnderDataSource`.</span></span> <span data-ttu-id="d8bcf-138">接下來，在按一下 設定資料來源連結控制項 s 智慧標籤。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-138">Next, click the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="d8bcf-139">選取要使用的資料庫 (`NORTHWINDConnectionString`)，按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-139">Select the database to use (`NORTHWINDConnectionString`) and click Next.</span></span>

## <a name="step-1-adding-awhereclause-when-picking-the-columns-from-a-table-or-view"></a><span data-ttu-id="d8bcf-140">步驟 1： 加入`WHERE`子句時挑選資料行從資料表或檢視</span><span class="sxs-lookup"><span data-stu-id="d8bcf-140">Step 1: Adding a`WHERE`Clause When Picking the Columns from a Table or View</span></span>

<span data-ttu-id="d8bcf-141">選取要從 SqlDataSource 控制項使用資料庫所傳回的資料，設定資料來源精靈可讓我們只要挑選要傳回從現有的資料表或檢視 （請參閱圖 1） 的資料行。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-141">When selecting the data to return from the database with the SqlDataSource control, the Configure Data Source wizard allows us to simply pick the columns to return from an existing table or view (see Figure 1).</span></span> <span data-ttu-id="d8bcf-142">自動執行組建 sql`SELECT`陳述式，這是什麼傳送至資料庫時 SqlDataSource 的`Select()`叫用方法。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-142">Doing so automatically builds up a SQL `SELECT` statement, which is what is sent to the database when the SqlDataSource s `Select()` method is invoked.</span></span> <span data-ttu-id="d8bcf-143">如同上一個教學課程中，從下拉式清單中選取 [產品] 資料表，並檢查`ProductID`， `ProductName`，和`UnitPrice`資料行。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-143">As we did in the previous tutorial, select the Products table from the drop-down list and check the `ProductID`, `ProductName`, and `UnitPrice` columns.</span></span>


<span data-ttu-id="d8bcf-144">[![挑選要從資料表或檢視傳回的資料行](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-144">[![Pick the Columns to Return from a Table or View](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.png)</span></span>

<span data-ttu-id="d8bcf-145">**圖 1**： 挑選要從資料表或檢視傳回的資料行 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-145">**Figure 1**: Pick the Columns to Return from a Table or View ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.png))</span></span>


<span data-ttu-id="d8bcf-146">要包含`WHERE`中的子句`SELECT`陳述式中，按一下 `WHERE`按鈕，這會開啟 新增`WHERE`子句對話方塊 （請參閱圖 2）。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-146">To include a `WHERE` clause in the `SELECT` statement, click the `WHERE` button, which brings up the Add `WHERE` Clause dialog box (see Figure 2).</span></span> <span data-ttu-id="d8bcf-147">若要加入參數來限制所傳回的結果`SELECT`查詢，首先選擇篩選的資料行的資料。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-147">To add a parameter to limit the results returned by the `SELECT` query, first choose the column to filter the data by.</span></span> <span data-ttu-id="d8bcf-148">接下來，選擇要用於篩選的運算子 (=、 &lt;， &lt;=、&gt;等等)。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-148">Next, choose the operator to use for filtering (=, &lt;, &lt;=, &gt;, and so on).</span></span> <span data-ttu-id="d8bcf-149">最後，請選擇來源參數 s 的值，例如查詢字串或工作階段狀態。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-149">Finally, choose the source of the parameter s value, such as from the querystring or session state.</span></span> <span data-ttu-id="d8bcf-150">之後設定參數，按一下 [新增] 按鈕，將它併入`SELECT`查詢。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-150">After configuring the parameter, click the Add button to include it in the `SELECT` query.</span></span>

<span data-ttu-id="d8bcf-151">例如，o d e s 只傳回這些結果其中`UnitPrice`值小於或等於 $25.00。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-151">For this example, let s only return those results where the `UnitPrice` value is less than or equal to $25.00.</span></span> <span data-ttu-id="d8bcf-152">因此，挑選`UnitPrice`從資料行的下拉式清單和&lt;= 從 [運算子] 下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-152">Therefore, pick `UnitPrice` from the Column drop-down list and &lt;= from the Operator drop-down list.</span></span> <span data-ttu-id="d8bcf-153">使用硬式編碼的參數值 （例如 $25.00) 時，或以程式設計方式指定為參數值，選取 無從 來源 下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-153">When using a hard-coded parameter value (such as $25.00) or if the parameter value is to be specified programmatically, select None from the Source drop-down list.</span></span> <span data-ttu-id="d8bcf-154">接下來，25.00 中的 [值] 文字方塊中輸入硬式編碼的參數值，然後按一下 [新增] 按鈕以完成程序。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-154">Next, enter the hard-coded parameter value in the Value textbox 25.00 and complete the process by clicking the Add button.</span></span>


<span data-ttu-id="d8bcf-155">[![限制傳回的結果加入 WHERE 子句對話方塊](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-155">[![Limit the Results Returned from the Add WHERE Clause Dialog Box](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.png)</span></span>

<span data-ttu-id="d8bcf-156">**圖 2**： 限制從 新增傳回的結果`WHERE`子句對話方塊 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-156">**Figure 2**: Limit the Results Returned from the Add `WHERE` Clause Dialog Box ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.png))</span></span>


<span data-ttu-id="d8bcf-157">加入參數之後, 按一下 確定 以返回至 設定資料來源精靈。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-157">After adding the parameter, click OK to return to the Configure Data Source wizard.</span></span> <span data-ttu-id="d8bcf-158">`SELECT`現在應該包含在精靈的下方的陳述式`WHERE`具有名為參數的子句`@UnitPrice`:</span><span class="sxs-lookup"><span data-stu-id="d8bcf-158">The `SELECT` statement at the bottom of the wizard should now include a `WHERE` clause with a parameter named `@UnitPrice`:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample3.sql)]

> [!NOTE]
> <span data-ttu-id="d8bcf-159">如果您指定多個條件中的`WHERE`從 [新增子句`WHERE`子句] 對話方塊中，精靈加入它們與`AND`運算子。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-159">If you specify multiple conditions in the `WHERE` clause from the Add `WHERE` Clause dialog box, the wizard joins them with the `AND` operator.</span></span> <span data-ttu-id="d8bcf-160">如果您需要包含`OR`中`WHERE`子句 (例如`WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`)，您需要建置`SELECT`陳述式利用自訂的 SQL 陳述式螢幕。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-160">If you need to include an `OR` in the `WHERE` clause (such as `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`) then you have to build the `SELECT` statement through the custom SQL statement screen.</span></span>


<span data-ttu-id="d8bcf-161">完成設定的 SqlDataSource （按 下一步，然後完成），然後檢查 SqlDataSource s 宣告式標記。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-161">Complete configuring the SqlDataSource (click Next, then Finish) and then inspect the SqlDataSource s declarative markup.</span></span> <span data-ttu-id="d8bcf-162">現在包含標記`<SelectParameters>`集合中的參數的來源會列出`SelectCommand`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-162">The markup now includes a `<SelectParameters>` collection, which spells out the sources for the parameters in the `SelectCommand`.</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample4.aspx)]

<span data-ttu-id="d8bcf-163">當 SqlDataSource s`Select()`叫用方法時，`UnitPrice`參數值 (25.00) 套用至`@UnitPrice`中的參數`SelectCommand`再傳送至資料庫。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-163">When the SqlDataSource s `Select()` method is invoked, the `UnitPrice` parameter value (25.00) is applied to the `@UnitPrice` parameter in the `SelectCommand` before being sent to the database.</span></span> <span data-ttu-id="d8bcf-164">最後結果就是，只有那些產品從傳回小於或等於 $25.00`Products`資料表。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-164">The net result is that only those products less than or equal to $25.00 are returned from the `Products` table.</span></span> <span data-ttu-id="d8bcf-165">若要確認這個項目，將 GridView 加入頁面中，繫結到此資料來源，並檢視透過瀏覽器頁面。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-165">To confirm this, add a GridView to the page, bind it to this data source, and then view the page through a browser.</span></span> <span data-ttu-id="d8bcf-166">您只能看到列出為確認圖 3 是小於或等於 $25.00，這些產品。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-166">You should only see those products listed that are less than or equal to $25.00, as Figure 3 confirms.</span></span>


<span data-ttu-id="d8bcf-167">[![會顯示只有那些產品的小於或等於 $25.00](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-167">[![Only Those Products Less Than or Equal to $25.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.png)</span></span>

<span data-ttu-id="d8bcf-168">**圖 3**： 顯示只有那些產品的小於或等於 $25.00 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-168">**Figure 3**: Only Those Products Less Than or Equal to $25.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.png))</span></span>


## <a name="step-2-adding-parameters-to-a-custom-sql-statement"></a><span data-ttu-id="d8bcf-169">步驟 2： 將參數加入至自訂的 SQL 陳述式</span><span class="sxs-lookup"><span data-stu-id="d8bcf-169">Step 2: Adding Parameters to a Custom SQL Statement</span></span>

<span data-ttu-id="d8bcf-170">加入自訂的 SQL 陳述式時您可以輸入`WHERE`子句明確或在查詢產生器的篩選器儲存格中指定值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-170">When adding a custom SQL statement you can enter the `WHERE` clause explicitly or specify a value in the Filter cell of the Query Builder.</span></span> <span data-ttu-id="d8bcf-171">若要示範這點，可讓顯示只是那些產品價格會低於特定臨界值的 GridView 中的 s。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-171">To demonstrate this, let s display just those products in a GridView whose prices are less than a certain threshold.</span></span> <span data-ttu-id="d8bcf-172">藉由新增到文字方塊中啟動`ParameterizedQueries.aspx`頁面，即可從使用者收集此臨界值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-172">Start by adding a TextBox to the `ParameterizedQueries.aspx` page to collect this threshold value from the user.</span></span> <span data-ttu-id="d8bcf-173">設定文字方塊中 s`ID`屬性`MaxPrice`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-173">Set the TextBox s `ID` property to `MaxPrice`.</span></span> <span data-ttu-id="d8bcf-174">加入按鈕 Web 控制項並設定其`Text`顯示比對產品的屬性。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-174">Add a Button Web control and set its `Text` property to Display Matching Products .</span></span>

<span data-ttu-id="d8bcf-175">下一步，拖曳到頁面的 GridView 和從其智慧標籤中，選擇建立新的 SqlDataSource 名為`ProductsFilteredByPriceDataSource`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-175">Next, drag a GridView onto the page and from its smart tag choose to create a new SqlDataSource named `ProductsFilteredByPriceDataSource`.</span></span> <span data-ttu-id="d8bcf-176">在設定資料來源精靈中，繼續進行 [指定自訂 SQL 陳述式或預存程序] 畫面 （請參閱圖 4），並輸入下列查詢：</span><span class="sxs-lookup"><span data-stu-id="d8bcf-176">From the Configure Data Source wizard, proceed to the Specify a custom SQL statement or stored procedure screen (see Figure 4) and enter the following query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample5.sql)]

<span data-ttu-id="d8bcf-177">（手動或透過查詢產生器），請輸入查詢之後, 按 下一步。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-177">After entering the query (either manually or through the Query Builder), click Next.</span></span>


<span data-ttu-id="d8bcf-178">[![傳回小於或等於參數值，只有那些產品](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-178">[![Return Only Those Products Less Than or Equal to a Parameter Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.png)</span></span>

<span data-ttu-id="d8bcf-179">**圖 4**： 傳回只有那些產品的小於或等於參數值 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-179">**Figure 4**: Return Only Those Products Less Than or Equal to a Parameter Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.png))</span></span>


<span data-ttu-id="d8bcf-180">因為查詢包含參數，請在精靈中的下一個畫面會提示我們參數值的來源。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-180">Since the query includes parameters, the next screen in the wizard prompts us for the source of the parameters values.</span></span> <span data-ttu-id="d8bcf-181">從參數來源下拉式清單中選擇控制項和`MaxPrice`(TextBox 控制項的`ID`值) 從 [ControlID] 下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-181">Choose Control from the Parameter source drop-down list and `MaxPrice` (the TextBox control s `ID` value) from the ControlID drop-down list.</span></span> <span data-ttu-id="d8bcf-182">您也可以輸入要在使用者未輸入任何文字放到其中的情況下使用選擇性的預設值`MaxPrice`文字方塊。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-182">You can also enter an optional default value to use in the case where the user has not entered any text into the `MaxPrice` TextBox.</span></span> <span data-ttu-id="d8bcf-183">時間之外，請勿輸入預設值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-183">For the time being, do not enter a default value.</span></span>


<span data-ttu-id="d8bcf-184">[![MaxPrice 文字方塊中文字的屬性用做為參數來源](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-184">[![The MaxPrice TextBox s Text Property is Used as the Parameter Source](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.png)</span></span>

<span data-ttu-id="d8bcf-185">**圖 5**:`MaxPrice`文字方塊 s`Text`屬性做為參數來源 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-185">**Figure 5**: The `MaxPrice` TextBox s `Text` Property is Used as the Parameter Source ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.png))</span></span>


<span data-ttu-id="d8bcf-186">完成接下來，按一下 [設定資料來源精靈]，然後完成。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-186">Complete the Configure Data Source wizard by clicking Next, then Finish.</span></span> <span data-ttu-id="d8bcf-187">GridView、 文字方塊、 按鈕和 SqlDataSource 的宣告式標記如下：</span><span class="sxs-lookup"><span data-stu-id="d8bcf-187">The declarative markup for the GridView, TextBox, Button, and SqlDataSource follows:</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample6.aspx)]

<span data-ttu-id="d8bcf-188">請注意，此參數在 SqlDataSource s 中的`<SelectParameters>`區段是`ControlParameter`，其中包括額外的屬性，例如`ControlID`和`PropertyName`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-188">Note that the parameter within the SqlDataSource s `<SelectParameters>` section is a `ControlParameter`, which includes additional properties like `ControlID` and `PropertyName`.</span></span> <span data-ttu-id="d8bcf-189">當 SqlDataSource s`Select()`叫用方法時， `ControlParameter` grabs 示範從指定的 Web 控制項屬性的值，並將它指派給對應的參數中`SelectCommand`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-189">When the SqlDataSource s `Select()` method is invoked, the `ControlParameter` grabs the value from the specified Web control property and assigns it to the corresponding parameter in the `SelectCommand`.</span></span> <span data-ttu-id="d8bcf-190">在此範例中， `MaxPrice` Text 屬性用做為`@MaxPrice`參數值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-190">In this example, the `MaxPrice` s Text property is used as the `@MaxPrice` parameter value.</span></span>

<span data-ttu-id="d8bcf-191">花一分鐘，以檢視這個頁面，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-191">Take a minute to view this page through a browser.</span></span> <span data-ttu-id="d8bcf-192">當第一次瀏覽頁面時，或每當`MaxPrice`文字方塊中缺少任何記錄會顯示在 GridView 的值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-192">When first visiting the page or whenever the `MaxPrice` TextBox lacks a value no records are displayed in the GridView.</span></span>


<span data-ttu-id="d8bcf-193">[![沒有記錄會顯示當 MaxPrice 文字方塊是空的](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-193">[![No Records are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.png)</span></span>

<span data-ttu-id="d8bcf-194">**圖 6**： 否記錄會顯示當`MaxPrice`文字方塊是空的 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-194">**Figure 6**: No Records are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.png))</span></span>


<span data-ttu-id="d8bcf-195">會顯示任何產品的原因是因為依預設，參數值為空字串轉換成資料庫`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-195">The reason no products are shown is because, by default, an empty string for a parameter value is converted into a database `NULL` value.</span></span> <span data-ttu-id="d8bcf-196">因為比較的`[UnitPrice] <= NULL`一律會評估為 False，就會傳回任何結果。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-196">Since the comparison of `[UnitPrice] <= NULL` always evaluates as False, no results are returned.</span></span>

<span data-ttu-id="d8bcf-197">文字方塊中輸入值，例如 5.00，，然後按一下 [顯示比對的產品] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-197">Enter a value into the textbox, like 5.00, and click the Display Matching Products button.</span></span> <span data-ttu-id="d8bcf-198">在回傳時，SqlDataSource 通知 GridView 的其中一個其參數的來源已變更。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-198">On postback, the SqlDataSource informs the GridView that one of its parameter sources has changed.</span></span> <span data-ttu-id="d8bcf-199">因此，GridView 重新繫結至 SqlDataSource，顯示這些產品小於或等於 $5.00 美元。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-199">Consequently, the GridView rebinds to the SqlDataSource, displaying those products less than or equal to $5.00.</span></span>


<span data-ttu-id="d8bcf-200">[![顯示產品的小於或等於 $5.00](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-200">[![Products Less Than or Equal to $5.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.png)</span></span>

<span data-ttu-id="d8bcf-201">**圖 7**： 顯示產品的小於或等於 $5.00 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-201">**Figure 7**: Products Less Than or Equal to $5.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.png))</span></span>


## <a name="initially-displaying-all-products"></a><span data-ttu-id="d8bcf-202">一開始顯示所有產品</span><span class="sxs-lookup"><span data-stu-id="d8bcf-202">Initially Displaying All Products</span></span>

<span data-ttu-id="d8bcf-203">而不是第一次載入頁面時顯示任何產品，我們可能會想要顯示*所有*產品。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-203">Rather than displaying no products when the page is first loaded, we may want to display *all* products.</span></span> <span data-ttu-id="d8bcf-204">一種方法來列出所有產品每當`MaxPrice`文字方塊是空的是將參數 s 的預設值設定為某個 insanely 高的值，例如 1000000，因為它不太可能，Northwind Traders 會曾有清查單價 s 超過 $1,000,000。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-204">One way to list all products whenever the `MaxPrice` TextBox is empty is to set the parameter s default value to some insanely high value, like 1000000, since it s unlikely that Northwind Traders will ever have inventory whose unit price exceeds $1,000,000.</span></span> <span data-ttu-id="d8bcf-205">不過，這種方法是 shortsighted，而且在其他情況下可能無法運作。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-205">However, this approach is shortsighted and might not work in other situations.</span></span>

<span data-ttu-id="d8bcf-206">在先前的教學課程-[宣告式的參數](../basic-reporting/declarative-parameters-vb.md)和[主要/詳細資料篩選與 DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md)我們所面臨類似的問題。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-206">In previous tutorials - [Declarative Parameters](../basic-reporting/declarative-parameters-vb.md) and [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) we were faced with a similar problem.</span></span> <span data-ttu-id="d8bcf-207">我們的解決方案是將此邏輯放在商務邏輯層。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-207">Our solution there was to put this logic in the Business Logic Layer.</span></span> <span data-ttu-id="d8bcf-208">具體來說，BLL 檢查傳入的值，而如果它是`NULL`或部分保留值，請呼叫已傳送到傳回的所有記錄的 DAL 方法。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-208">Specifically, the BLL examined the incoming value and, if it was `NULL` or some reserved value, the call was routed to the DAL method that returned all records.</span></span> <span data-ttu-id="d8bcf-209">如果輸入的值是正常的篩選值，已進行呼叫以執行使用參數化 SQL 陳述式的 DAL 方法`WHERE`子句，但所提供的值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-209">If the incoming value was a normal filtering value, a call was made to the DAL method that executed a SQL statement that used a parameterized `WHERE` clause with the supplied value.</span></span>

<span data-ttu-id="d8bcf-210">不幸的是，我們會略過架構使用 SqlDataSource 時。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-210">Unfortunately, we bypass the architecture when using the SqlDataSource.</span></span> <span data-ttu-id="d8bcf-211">相反地，我們需要自訂 SQL 陳述式，以聰明的方式擷取所有記錄，如果`@MaximumPrice`參數是`NULL`或某些保留的值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-211">Instead, we need to customize the SQL statement to intelligently grab all records if the `@MaximumPrice` parameter is `NULL` or some reserved value.</span></span> <span data-ttu-id="d8bcf-212">針對此練習，可讓 s 有它因此，如果`@MaximumPrice`參數等於`-1.0`，然後*所有*的記錄會傳回 (`-1.0`做為保留的值運作，因為沒有產品可以有負`UnitPrice`值)。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-212">For this exercise, let s have it so that if the `@MaximumPrice` parameter is equal to `-1.0`, then *all* of the records are to be returned (`-1.0` works as a reserved value since no product can have a negative `UnitPrice` value).</span></span> <span data-ttu-id="d8bcf-213">若要完成這項作業中，我們可以使用下列 SQL 陳述式：</span><span class="sxs-lookup"><span data-stu-id="d8bcf-213">To accomplish this we can use the following SQL statement:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample7.sql)]

<span data-ttu-id="d8bcf-214">這`WHERE`子句會傳回*所有*記錄如果`@MaximumPrice`參數等於`-1.0`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-214">This `WHERE` clause returns *all* records if the `@MaximumPrice` parameter equals `-1.0`.</span></span> <span data-ttu-id="d8bcf-215">如果參數值不是`-1.0`，只有那些產品的`UnitPrice`小於或等於`@MaximumPrice`傳回參數值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-215">If the parameter value is not `-1.0`, only those products whose `UnitPrice` is less than or equal to the `@MaximumPrice` parameter value are returned.</span></span> <span data-ttu-id="d8bcf-216">藉由設定的預設值`@MaximumPrice`參數`-1.0`，第一個載入的頁面 (或每當`MaxPrice`文字方塊是空的)，`@MaximumPrice`的值將會`-1.0`，並且會顯示所有產品。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-216">By setting the default value of the `@MaximumPrice` parameter to `-1.0`, on the first page load (or whenever the `MaxPrice` TextBox is empty), `@MaximumPrice` will have a value of `-1.0` and all products will be displayed.</span></span>


<span data-ttu-id="d8bcf-217">[![顯示當 MaxPrice 文字方塊現在所有產品都不是空的](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-217">[![Now All Products are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.png)</span></span>

<span data-ttu-id="d8bcf-218">**圖 8**： 所有產品現在都會顯示當`MaxPrice`文字方塊是空的 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-218">**Figure 8**: Now All Products are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image16.png))</span></span>


<span data-ttu-id="d8bcf-219">有幾個警告，請注意，這個方法。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-219">There are a couple of caveats to note with this approach.</span></span> <span data-ttu-id="d8bcf-220">首先，請了解參數 s 的資料類型由其推斷 s SQL 查詢中的使用方式。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-220">First, realize that the parameter s data type is inferred by it s usage in the SQL query.</span></span> <span data-ttu-id="d8bcf-221">如果您變更`WHERE`子句從`@MaximumPrice = -1.0`至`@MaximumPrice = -1`，執行階段視為整數參數。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-221">If you change the `WHERE` clause from `@MaximumPrice = -1.0` to `@MaximumPrice = -1`, the runtime treats the parameter as an integer.</span></span> <span data-ttu-id="d8bcf-222">如果您隨後嘗試指派`MaxPrice`（例如 5.00) 的十進位值的文字方塊中，會發生錯誤，因為它無法將 5.00 轉換成整數。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-222">If you then attempt to assign the `MaxPrice` TextBox to a decimal value (like 5.00 ), an error will occur because it cannot convert 5.00 to an integer.</span></span> <span data-ttu-id="d8bcf-223">若要補救這種情況，請請確定您使用`@MaximumPrice = -1.0`中`WHERE`子句或更棒的是，設定`ControlParameter`物件的`Type`為十進位的屬性。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-223">To remedy this, either make sure that you use `@MaximumPrice = -1.0` in the `WHERE` clause or, better yet, set the `ControlParameter` object s `Type` property to Decimal .</span></span>

<span data-ttu-id="d8bcf-224">其次，藉由加入`OR @MaximumPrice = -1.0`至`WHERE`子句，查詢引擎無法使用索引上`UnitPrice`（假設其存在），因而導致資料表掃描。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-224">Secondly, by adding the `OR @MaximumPrice = -1.0` to the `WHERE` clause, the query engine cannot use an index on `UnitPrice` (assuming one exists), thereby resulting in a table scan.</span></span> <span data-ttu-id="d8bcf-225">如果沒有夠大的數字中的記錄，這會影響效能`Products`資料表。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-225">This can impact performance if there are a sufficiently large number of records in the `Products` table.</span></span> <span data-ttu-id="d8bcf-226">更好的方法，可將此邏輯移到預存程序所在`IF`陳述式會執行`SELECT`查詢從`Products`資料表沒有`WHERE`子句時要傳回需要的所有記錄，或其中一個其`WHERE`子句只包含`UnitPrice`準則，以便可以使用索引。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-226">A better approach would be to move this logic to a stored procedure where an `IF` statement would either perform a `SELECT` query from the `Products` table without a `WHERE` clause when all records need to be returned or one whose `WHERE` clause contains just the `UnitPrice` criteria, so that an index can be used.</span></span>

## <a name="step-3-creating-and-using-parameterized-stored-procedures"></a><span data-ttu-id="d8bcf-227">步驟 3： 建立和使用參數化預存程序</span><span class="sxs-lookup"><span data-stu-id="d8bcf-227">Step 3: Creating and Using Parameterized Stored Procedures</span></span>

<span data-ttu-id="d8bcf-228">預存程序可以包含一組可用的輸入參數的預存程序內所定義的 SQL 陳述式中。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-228">Stored procedures can include a set of input parameters that can then be used in the SQL statement(s) defined within the stored procedure.</span></span> <span data-ttu-id="d8bcf-229">設定時使用預存程序可接受輸入的參數 SqlDataSource，可以與特定 SQL 陳述式使用相同的技術指定這些參數值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-229">When configuring the SqlDataSource to use a stored procedure that accepts input parameters, these parameter values can be specified using the same techniques as with ad-hoc SQL statements.</span></span>

<span data-ttu-id="d8bcf-230">O d e s 為了說明使用 SqlDataSource 中預存程序，在名為 Northwind 資料庫中建立新的預存程序`GetProductsByCategory`，它會接受名為`@CategoryID`並傳回所有產品的資料行其`CategoryID`資料行比對`@CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-230">To illustrate using stored procedures in the SqlDataSource, let s create a new stored procedure in the Northwind database named `GetProductsByCategory`, which accepts a parameter named `@CategoryID` and returns all of the columns of the products whose `CategoryID` column matches `@CategoryID`.</span></span> <span data-ttu-id="d8bcf-231">若要建立預存程序，請移至 [伺服器總管] 中，並向下鑽研至`NORTHWND.MDF`資料庫。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-231">To create a stored procedure, go to the Server Explorer and drill down into the `NORTHWND.MDF` database.</span></span> <span data-ttu-id="d8bcf-232">（如果您不要看到 [伺服器總管] 中，使其移至 [檢視] 功能表，然後選取 [伺服器總管] 選項。）</span><span class="sxs-lookup"><span data-stu-id="d8bcf-232">(If you don t see the Server Explorer, bring it up by going to the View menu and selecting the Server Explorer option.)</span></span>

<span data-ttu-id="d8bcf-233">從`NORTHWND.MDF`資料庫，預存程序資料夾上按一下滑鼠右鍵，選擇 加入新預存程序，並輸入下列語法：</span><span class="sxs-lookup"><span data-stu-id="d8bcf-233">From the `NORTHWND.MDF` database, right-click on the Stored Procedures folder, choose Add New Stored Procedure, and enter the following syntax:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample8.sql)]

<span data-ttu-id="d8bcf-234">按一下儲存圖示 （或 Ctrl + S） 來儲存預存程序。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-234">Click the Save icon (or Ctrl+S) to save the stored procedure.</span></span> <span data-ttu-id="d8bcf-235">您可以從預存程序資料夾上按一下滑鼠右鍵，然後選擇 執行測試的預存程序。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-235">You can test the stored procedure by right-clicking it from the Stored Procedures folder and choosing Execute.</span></span> <span data-ttu-id="d8bcf-236">這會提示您輸入的預存程序的參數 (`@CategoryID`，這個執行個體中) 之後，結果會顯示在 [輸出] 視窗中。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-236">This will prompt you for the stored procedure s parameters (`@CategoryID`, in this instance), after which the results will be displayed in the Output window.</span></span>


<span data-ttu-id="d8bcf-237">[![GetProductsByCategory 預存程序執行時未使用@CategoryID的 1](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-237">[![The GetProductsByCategory Stored Procedure when Executed with a @CategoryID of 1](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image17.png)</span></span>

<span data-ttu-id="d8bcf-238">**圖 9**:`GetProductsByCategory`預存程序執行時未使用`@CategoryID`為 1 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-238">**Figure 9**: The `GetProductsByCategory` Stored Procedure when Executed with a `@CategoryID` of 1 ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image18.png))</span></span>


<span data-ttu-id="d8bcf-239">可讓使用此預存程序在 GridView 中的飲料類別目錄中顯示所有產品的 s。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-239">Let s use this stored procedure to display all products in the Beverages category in a GridView.</span></span> <span data-ttu-id="d8bcf-240">將新的 GridView 加入頁面和繫結到名為新 SqlDataSource `BeverageProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-240">Add a new GridView to the page and bind it to a new SqlDataSource named `BeverageProductsDataSource`.</span></span> <span data-ttu-id="d8bcf-241">繼續指定自訂 SQL 陳述式或預存程序 畫面，選取預存程序選項按鈕，然後挑選`GetProductsByCategory`預存程序，從下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-241">Continue to the Specify a custom SQL statement or stored procedure screen, select the Stored procedure radio button, and pick the `GetProductsByCategory` stored procedure from the drop-down list.</span></span>


<span data-ttu-id="d8bcf-242">[![選取 GetProductsByCategory 預存程序，從下拉式清單](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-242">[![Select the GetProductsByCategory Stored Procedure from the Drop-Down List](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image19.png)</span></span>

<span data-ttu-id="d8bcf-243">**圖 10**： 選取`GetProductsByCategory`預存程序，從下拉式清單 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-243">**Figure 10**: Select the `GetProductsByCategory` Stored Procedure from the Drop-Down List ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image20.png))</span></span>


<span data-ttu-id="d8bcf-244">由於預存程序接受一個輸入的參數 (`@CategoryID`)，按一下 下一步提示我們指定這個參數 s 的值的來源。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-244">Since the stored procedure accepts an input parameter (`@CategoryID`), clicking Next prompts us to specify the source for this parameter s value.</span></span> <span data-ttu-id="d8bcf-245">飲料`CategoryID`為 1，因此保留無參數來源下拉式清單，然後在 [預設值] 文字方塊中輸入 1。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-245">The Beverages `CategoryID` is 1, so leave the Parameter source drop-down list at None and enter 1 into the DefaultValue textbox.</span></span>


<span data-ttu-id="d8bcf-246">[![使用硬式編碼值為 1，以傳回 「 飲料 」 分類中的產品](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-246">[![Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image21.png)</span></span>

<span data-ttu-id="d8bcf-247">**圖 11**： 使用 Hard-Coded 值為 1，傳回 「 飲料 」 分類中的產品 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-247">**Figure 11**: Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image22.png))</span></span>


<span data-ttu-id="d8bcf-248">下列所示宣告式標記，當使用預存程序，SqlDataSource s`SelectCommand`屬性設定為預存程序名稱和[`SelectCommandType`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx)設`StoredProcedure`，這表示`SelectCommand`是預存程序，而不是特定 SQL 陳述式的名稱。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-248">As the following declarative markup shows, when using a stored procedure, the SqlDataSource s `SelectCommand` property is set to the name of the stored procedure and the [`SelectCommandType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) is set to `StoredProcedure`, indicating that the `SelectCommand` is the name of a stored procedure rather than an ad-hoc SQL statement.</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample9.aspx)]

<span data-ttu-id="d8bcf-249">測試瀏覽器中。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-249">Test out the page in a browser.</span></span> <span data-ttu-id="d8bcf-250">顯示屬於 「 飲料 」 分類的產品，雖然*所有*產品的欄位會顯示自`GetProductsByCategory`預存程序會傳回所有資料行從`Products`資料表。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-250">Only those products that belong to the Beverages category are displayed, although *all* of the product fields are displayed since the `GetProductsByCategory` stored procedure returns all of the columns from the `Products` table.</span></span> <span data-ttu-id="d8bcf-251">當然，我們可以限制或自訂 GridView 從 GridView s 編輯資料行 對話方塊中顯示的欄位。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-251">We could, of course, limit or customize the fields displayed in the GridView from the GridView s Edit Columns dialog box.</span></span>


<span data-ttu-id="d8bcf-252">[![會顯示所有飲料的](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-252">[![All of the Beverages are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image23.png)</span></span>

<span data-ttu-id="d8bcf-253">**圖 12**： 會顯示所有飲料 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-253">**Figure 12**: All of the Beverages are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image24.png))</span></span>


## <a name="step-4-programmatically-invoking-a-sqldatasource-sselectstatement"></a><span data-ttu-id="d8bcf-254">步驟 4： 以程式設計方式叫用 SqlDataSource 的`Select()`陳述式</span><span class="sxs-lookup"><span data-stu-id="d8bcf-254">Step 4: Programmatically Invoking a SqlDataSource s`Select()`Statement</span></span>

<span data-ttu-id="d8bcf-255">範例我們目前為止所見上一個教學課程與本教學課程中我們有直接繫結 SqlDataSource 控制項至 GridView。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-255">The examples we ve seen in the previous tutorial and this tutorial so far have bound SqlDataSource controls directly to a GridView.</span></span> <span data-ttu-id="d8bcf-256">SqlDataSource 控制項的資料，不過，可以透過程式設計方式存取和列舉程式碼中。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-256">The SqlDataSource control s data, however, can be programmatically accessed and enumerated in code.</span></span> <span data-ttu-id="d8bcf-257">當您需要查詢資料檢查，但不要需要加以顯示，這會特別有用。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-257">This can be particularly useful when you need to query data to inspect it, but don t need to display it.</span></span> <span data-ttu-id="d8bcf-258">而不需要撰寫所有未定案 ADO.NET 程式碼，以連接到資料庫中，指定的命令，並擷取結果，您可以讓 SqlDataSource 處理這個 monotonous 的程式碼。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-258">Rather than having to write all of the boilerplate ADO.NET code to connect to the database, specify the command, and retrieve the results, you can let the SqlDataSource handle this monotonous code.</span></span>

<span data-ttu-id="d8bcf-259">若要說明使用 SqlDataSource 的資料以程式設計的方式，假設老闆已接近您使用的要求建立網頁，顯示隨機選取的類別和其相關聯的產品名稱。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-259">To illustrate working with the SqlDataSource s data programmatically, imagine that your boss has approached you with a request to create a web page that displays the name of a randomly selected category and its associated products.</span></span> <span data-ttu-id="d8bcf-260">也就是說，當使用者存取此頁面，我們想要隨機選擇的類別目錄`Categories`資料表，並顯示類別目錄名稱，然後再列出屬於該類別目錄的產品。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-260">That is, when a user visits this page, we want to randomly choose a category from the `Categories` table, display the category name, and then list the products belonging to that category.</span></span>

<span data-ttu-id="d8bcf-261">若要完成這項作業中，我們需要兩個 SqlDataSource 控制項一個抓取隨機類別從`Categories`資料表，而另一個取得 s 產品類別目錄。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-261">To accomplish this we need two SqlDataSource controls one to grab a random category from the `Categories` table and another to get the category s products.</span></span> <span data-ttu-id="d8bcf-262">我們會建置 SqlDataSource 擷取隨機分類資料錄，在此步驟。製作擷取類別的產品的 SqlDataSource 查看步驟 5。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-262">We'll build the SqlDataSource that retrieves a random category record in this step; Step 5 looks at crafting the SqlDataSource that retrieves the category s products.</span></span>

<span data-ttu-id="d8bcf-263">啟動新增至 SqlDataSource`ParameterizedQueries.aspx`並設定其`ID`至`RandomCategoryDataSource`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-263">Start by adding a SqlDataSource to `ParameterizedQueries.aspx` and set its `ID` to `RandomCategoryDataSource`.</span></span> <span data-ttu-id="d8bcf-264">設定，讓它可以使用下列 SQL 查詢：</span><span class="sxs-lookup"><span data-stu-id="d8bcf-264">Configure it so that it uses the following SQL query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample10.sql)]

<span data-ttu-id="d8bcf-265">`ORDER BY NEWID()` 傳回以隨機順序排序的記錄 (請參閱[使用`NEWID()`隨機排序記錄](http://www.sqlteam.com/item.asp?ItemID=8747))。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-265">`ORDER BY NEWID()` returns the records sorted in random order (see [Using `NEWID()` to Randomly Sort Records](http://www.sqlteam.com/item.asp?ItemID=8747)).</span></span> <span data-ttu-id="d8bcf-266">`SELECT TOP 1` 從結果集傳回第一筆記錄。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-266">`SELECT TOP 1` returns the first record from the result set.</span></span> <span data-ttu-id="d8bcf-267">放在一起，此查詢會傳回`CategoryID`和`CategoryName`從單一的隨機選取的分類資料行值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-267">Put together, this query returns the `CategoryID` and `CategoryName` column values from a single, randomly selected category.</span></span>

<span data-ttu-id="d8bcf-268">若要顯示類別目錄 s`CategoryName`值、 標籤 Web 控制項加入網頁，請設定其`ID`屬性`CategoryNameLabel`，並以清除其`Text`屬性。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-268">To display the category s `CategoryName` value, add a Label Web control to the page, set its `ID` property to `CategoryNameLabel`, and clear out its `Text` property.</span></span> <span data-ttu-id="d8bcf-269">若要從 SqlDataSource 控制項，以程式設計方式擷取資料，我們要叫用其`Select()`方法。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-269">To programmatically retrieve the data from a SqlDataSource control, we need to invoke its `Select()` method.</span></span> <span data-ttu-id="d8bcf-270">[ `Select()`方法](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx)單一輸入的參數的型別必須要有[ `DataSourceSelectArguments` ](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx)，以指定如何將資料應該依現狀在傳回之前。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-270">The [`Select()` method](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) expects a single input parameter of type [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), which specifies how the data should be messaged before being returned.</span></span> <span data-ttu-id="d8bcf-271">這可以包含指示排序及篩選資料，而且由 Web 控制項時排序，或從 SqlDataSource 控制項的資料進行分頁的資料。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-271">This can include instructions on sorting and filtering the data, and is used by the data Web controls when sorting or paging through the data from a SqlDataSource control.</span></span> <span data-ttu-id="d8bcf-272">我們的範例，我們不 t 需要資料在傳回之前修改，因此將會傳入`DataSourceSelectArguments.Empty`物件。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-272">For our example, though, we don t need the data to be modified before being returned, and therefore will pass in the `DataSourceSelectArguments.Empty` object.</span></span>

<span data-ttu-id="d8bcf-273">`Select()`方法會傳回該物件會實作`IEnumerable`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-273">The `Select()` method returns an object that implements `IEnumerable`.</span></span> <span data-ttu-id="d8bcf-274">SqlDataSource 控制項 s 的值而定的精確的類型傳回[`DataSourceMode`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx)。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-274">The precise type returned depends on the value of the SqlDataSource control s [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span></span> <span data-ttu-id="d8bcf-275">上一個教學課程所述，這個屬性可以設定為值的其中一個`DataSet`或`DataReader`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-275">As discussed in the previous tutorial, this property can be set to a value of either `DataSet` or `DataReader`.</span></span> <span data-ttu-id="d8bcf-276">如果設定為`DataSet`、`Select()`方法會傳回[DataView](https://msdn.microsoft.com/library/01s96x0z.aspx)物件; 如果設為`DataReader`，它會傳回該物件會實作[ `IDataReader` ](https://msdn.microsoft.com/library/system.data.idatareader.aspx)。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-276">If set to `DataSet`, the `Select()` method returns a [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) object; if set to `DataReader`, it returns an object that implements [`IDataReader`](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span></span> <span data-ttu-id="d8bcf-277">因為`RandomCategoryDataSource`SqlDataSource 具有其`DataSourceMode`屬性設定為`DataSet`（預設值），我們會使用 DataView 物件。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-277">Since the `RandomCategoryDataSource` SqlDataSource has its `DataSourceMode` property set to `DataSet` (the default), we will be working with a DataView object.</span></span>

<span data-ttu-id="d8bcf-278">下列程式碼說明如何擷取的記錄從`RandomCategoryDataSource`為 DataView SqlDataSource 以及如何讀取`CategoryName`從第一個 DataView 資料列的資料行值：</span><span class="sxs-lookup"><span data-stu-id="d8bcf-278">The following code illustrates how to retrieve the records from the `RandomCategoryDataSource` SqlDataSource as a DataView as well as how to read the `CategoryName` column value from the first DataView row:</span></span>


[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample11.vb)]

<span data-ttu-id="d8bcf-279">`randomCategoryView(0)` 傳回第一個`DataRowView`在 DataView 中。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-279">`randomCategoryView(0)` returns the first `DataRowView` in the DataView.</span></span> <span data-ttu-id="d8bcf-280">`randomCategoryView(0)("CategoryName")` 傳回的值`CategoryName`此第一個資料列中的資料行。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-280">`randomCategoryView(0)("CategoryName")` returns the value of the `CategoryName` column in this first row.</span></span> <span data-ttu-id="d8bcf-281">請注意，在 DataView 鬆散型別。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-281">Note that the DataView is loosely-typed.</span></span> <span data-ttu-id="d8bcf-282">若要參考特定資料行值，我們需要傳入資料行做為字串 （類別名稱，在此情況下）。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-282">To reference a particular column value we need to pass in the name of the column as a string ( CategoryName, in this case).</span></span> <span data-ttu-id="d8bcf-283">圖 13 顯示中顯示的訊息`CategoryNameLabel`檢視網頁時。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-283">Figure 13 shows the message displayed in the `CategoryNameLabel` when viewing the page.</span></span> <span data-ttu-id="d8bcf-284">當然，顯示的實際類別目錄名稱會隨機選取`RandomCategoryDataSource`SqlDataSource 每個開啟的頁面 （包括回傳）。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-284">Of course, the actual category name displayed is randomly selected by the `RandomCategoryDataSource` SqlDataSource on each visit to the page (including postbacks).</span></span>


<span data-ttu-id="d8bcf-285">[![名稱會顯示在隨機選取的類別 s](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-285">[![The Randomly Selected Category s Name is Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image25.png)</span></span>

<span data-ttu-id="d8bcf-286">**圖 13**: 隨機選取類別目錄名稱會顯示的 s ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-286">**Figure 13**: The Randomly Selected Category s Name is Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image26.png))</span></span>


> [!NOTE]
> <span data-ttu-id="d8bcf-287">如果 SqlDataSource 控制項 s`DataSourceMode`屬性已設定為`DataReader`，傳回的值從`Select()`方法，需要轉換成`IDataReader`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-287">If the SqlDataSource control s `DataSourceMode` property had been set to `DataReader`, the return value from the `Select()` method would have needed to be cast to `IDataReader`.</span></span> <span data-ttu-id="d8bcf-288">讀取`CategoryName`從第一個資料列中，我們 d 的資料行值使用類似的程式碼：</span><span class="sxs-lookup"><span data-stu-id="d8bcf-288">To read the `CategoryName` column value from the first row, we d use code like:</span></span>


[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample12.vb)]

<span data-ttu-id="d8bcf-289">使用 SqlDataSource 隨機選取類別目錄時，我們將會列出類別的產品 GridView 準備好。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-289">With the SqlDataSource randomly selecting a category, we re ready to add the GridView that lists the category s products.</span></span>

> [!NOTE]
> <span data-ttu-id="d8bcf-290">而不是使用標籤 Web 控制項來顯示類別 s 的名稱，我們無法加入 FormView 或 DetailsView 的頁面上，繫結至 SqlDataSource。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-290">Rather than using a Label Web control to display the category s name, we could have added a FormView or DetailsView to the page, binding it to the SqlDataSource.</span></span> <span data-ttu-id="d8bcf-291">使用標籤，不過，允許我們探討如何以程式設計方式叫用 SqlDataSource 的`Select()`陳述式和其產生的資料，在程式碼中使用工作。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-291">Using the Label, however, allowed us to explore how to programmatically invoke the SqlDataSource s `Select()` statement and work with its resulting data in code.</span></span>


## <a name="step-5-assigning-parameter-values-programmatically"></a><span data-ttu-id="d8bcf-292">步驟 5： 以程式設計的方式指派參數值</span><span class="sxs-lookup"><span data-stu-id="d8bcf-292">Step 5: Assigning Parameter Values Programmatically</span></span>

<span data-ttu-id="d8bcf-293">所有範例我們目前為止所見，在此教學課程中我們已經使用硬式編碼的參數值或一個來自其中一個預先定義的參數來源 （querystring 值、 Web 上的控制項 頁面上，依此類推）。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-293">All of the examples we ve seen so far in this tutorial have used either a hard-coded parameter value or one taken from one of the pre-defined parameter sources (a querystring value, a Web control on the page, and so on).</span></span> <span data-ttu-id="d8bcf-294">不過，SqlDataSource 控制項的參數也可以設定以程式設計的方式。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-294">However, the SqlDataSource control s parameters can also be set programmatically.</span></span> <span data-ttu-id="d8bcf-295">若要完成目前範例中，我們需要傳回所有屬於指定的類別目錄的產品的 SqlDataSource。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-295">To complete our current example, we need a SqlDataSource that returns all of the products belonging to a specified category.</span></span> <span data-ttu-id="d8bcf-296">將會有這個 SqlDataSource`CategoryID`參數必須設定其值為基礎`CategoryID`所傳回的資料行值`RandomCategoryDataSource`在 SqlDataSource`Page_Load`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-296">This SqlDataSource will have a `CategoryID` parameter whose value needs to be set based on the `CategoryID` column value returned by the `RandomCategoryDataSource` SqlDataSource in the `Page_Load` event handler.</span></span>

<span data-ttu-id="d8bcf-297">啟動頁面中加入 GridView 和繫結到名為新 SqlDataSource `ProductsByCategoryDataSource`。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-297">Start by adding a GridView to the page and bind it to a new SqlDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="d8bcf-298">我們未在步驟 3 中的像是，請設定 SqlDataSource，讓它會叫用`GetProductsByCategory`預存程序。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-298">Much like we did in Step 3, configure the SqlDataSource so that it invokes the `GetProductsByCategory` stored procedure.</span></span> <span data-ttu-id="d8bcf-299">保留參數來源下拉式清單設定為 [無]，但不是會輸入預設值，因為我們會以程式設計方式設定這個預設值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-299">Leave the Parameter source drop-down list set to None, but do not enter a default value, as we will set this default value programmatically.</span></span>


<span data-ttu-id="d8bcf-300">[![未指定參數的來源或預設值](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-300">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image27.png)</span></span>

<span data-ttu-id="d8bcf-301">**圖 14**： 未指定參數的來源或預設值 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-301">**Figure 14**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image28.png))</span></span>


<span data-ttu-id="d8bcf-302">完成 SqlDataSource 精靈之後，產生的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="d8bcf-302">After completing the SqlDataSource wizard, the resulting declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample13.aspx)]

<span data-ttu-id="d8bcf-303">我們可以指派`DefaultValue`的`CategoryID`參數以程式設計方式在`Page_Load`事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="d8bcf-303">We can assign the `DefaultValue` of the `CategoryID` parameter programmatically in the `Page_Load` event handler:</span></span>


[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample14.vb)]

<span data-ttu-id="d8bcf-304">與此新增功能，此頁面包含的 GridView 會顯示與隨機選取的類別相關聯的產品。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-304">With this addition, the page includes a GridView that shows the products associated with the randomly selected category.</span></span>


<span data-ttu-id="d8bcf-305">[![未指定參數的來源或預設值](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-305">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image29.png)</span></span>

<span data-ttu-id="d8bcf-306">**圖 15**： 未指定參數的來源或預設值 ([按一下以檢視完整大小的影像](using-parameterized-queries-with-the-sqldatasource-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="d8bcf-306">**Figure 15**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image30.png))</span></span>


## <a name="summary"></a><span data-ttu-id="d8bcf-307">總結</span><span class="sxs-lookup"><span data-stu-id="d8bcf-307">Summary</span></span>

<span data-ttu-id="d8bcf-308">SqlDataSource 可讓網頁開發人員定義參數化的查詢，其參數值可以是硬式編碼，從預先定義的參數來源提取或以程式設計的方式指派。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-308">The SqlDataSource enables page developers to define parameterized queries whose parameter values can be hard-coded, pulled from pre-defined parameter sources, or assigned programmatically.</span></span> <span data-ttu-id="d8bcf-309">在此教學課程中我們可了解如何製作特定 SQL 查詢和預存程序的設定資料來源精靈的參數化的查詢。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-309">In this tutorial we saw how to craft a parameterized query from the Configure Data Source wizard for both ad-hoc SQL queries and stored procedures.</span></span> <span data-ttu-id="d8bcf-310">我們也會探討使用硬式編碼參數的來源，Web 控制項做為參數來源，並以程式設計方式指定參數值。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-310">We also looked at using hard-coded parameter sources, a Web control as a parameter source, and programmatically specifying the parameter value.</span></span>

<span data-ttu-id="d8bcf-311">像 ObjectDataSource 與 SqlDataSource 也提供功能來修改其基礎資料。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-311">Like with the ObjectDataSource, the SqlDataSource also provides capabilities to modify its underlying data.</span></span> <span data-ttu-id="d8bcf-312">在下一個教學課程中我們會探討如何定義`INSERT`， `UPDATE`，和`DELETE`SqlDataSource 陳述式。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-312">In the next tutorial we'll look at how to define `INSERT`, `UPDATE`, and `DELETE` statements with the SqlDataSource.</span></span> <span data-ttu-id="d8bcf-313">一旦加這些陳述式之後，我們可以利用內建插入、 編輯和刪除固有 GridView、 DetailsView 和 FormView 控制項的功能。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-313">Once these statements have been added, we can utilize the built-in inserting, editing, and deleting features inherent to the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="d8bcf-314">祝您程式設計 ！</span><span class="sxs-lookup"><span data-stu-id="d8bcf-314">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="d8bcf-315">關於作者</span><span class="sxs-lookup"><span data-stu-id="d8bcf-315">About the Author</span></span>

<span data-ttu-id="d8bcf-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP/ASP.NET 書籍和的創辦[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已從 1998 年使用 Microsoft Web 技術。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d8bcf-317">Scott 可做為獨立顧問、 訓練和寫入器。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-317">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d8bcf-318">他最新的活頁簿[ *Sam 教導您自己 ASP.NET 2.0 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-318">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="d8bcf-319">他可以在達到[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或透過他的部落格，這可以在找到[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-319">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="d8bcf-320">特別感謝</span><span class="sxs-lookup"><span data-stu-id="d8bcf-320">Special Thanks To</span></span>

<span data-ttu-id="d8bcf-321">許多有用的檢閱者已檢閱本教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-321">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="d8bcf-322">此教學課程中的前導檢閱者已 Scott 西與克萊德 Randell Schmidt，Ken Pespisa。</span><span class="sxs-lookup"><span data-stu-id="d8bcf-322">Lead reviewers for this tutorial were Scott Clyde, Randell Schmidt, and Ken Pespisa.</span></span> <span data-ttu-id="d8bcf-323">檢閱我即將推出的 MSDN 文件有興趣嗎？</span><span class="sxs-lookup"><span data-stu-id="d8bcf-323">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="d8bcf-324">如果是這樣，卸除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-324">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="d8bcf-325">[上一頁](querying-data-with-the-sqldatasource-control-vb.md)
> [下一頁](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)</span><span class="sxs-lookup"><span data-stu-id="d8bcf-325">[Previous](querying-data-with-the-sqldatasource-control-vb.md)
[Next](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)</span></span>
