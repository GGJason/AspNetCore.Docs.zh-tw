---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-vb
title: 建置自訂資料庫驅動的站台地圖提供者 (VB) |Microsoft 文件
author: rick-anderson
description: 在 ASP.NET 2.0 的預設站台對應提供者會從靜態的 XML 檔案擷取其資料。 雖然許多小型和中型 siz 適合以 XML 為基礎的提供者...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/26/2007
ms.topic: article
ms.assetid: f904cd2c-a408-4484-9324-8b8d7fe33893
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-vb
msc.type: authoredcontent
ms.openlocfilehash: df295f1b8bf0b83647ffb90501936181894634d7
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/06/2018
ms.locfileid: "30877966"
---
<a name="building-a-custom-database-driven-site-map-provider-vb"></a><span data-ttu-id="6f537-104">建置自訂資料庫驅動的站台地圖提供者 (VB)</span><span class="sxs-lookup"><span data-stu-id="6f537-104">Building a Custom Database-Driven Site Map Provider (VB)</span></span>
====================
<span data-ttu-id="6f537-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6f537-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6f537-106">[下載程式碼](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_VB.zip)或[下載 PDF](building-a-custom-database-driven-site-map-provider-vb/_static/datatutorial62vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="6f537-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_VB.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-vb/_static/datatutorial62vb1.pdf)</span></span>

> <span data-ttu-id="6f537-107">在 ASP.NET 2.0 的預設站台對應提供者會從靜態的 XML 檔案擷取其資料。</span><span class="sxs-lookup"><span data-stu-id="6f537-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="6f537-108">以 XML 為基礎的提供者適合有許多小型和中型網站時，較大的 Web 應用程式需要更具動態網站地圖。</span><span class="sxs-lookup"><span data-stu-id="6f537-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="6f537-109">在此教學課程中，我們將建立自訂站台地圖提供者從商務邏輯層擷取其資料，這會從資料庫擷取資料。</span><span class="sxs-lookup"><span data-stu-id="6f537-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>


## <a name="introduction"></a><span data-ttu-id="6f537-110">簡介</span><span class="sxs-lookup"><span data-stu-id="6f537-110">Introduction</span></span>

<span data-ttu-id="6f537-111">ASP.NET 2.0 s 站台地圖 功能可讓網頁開發人員定義 web 應用程式的網站導覽某些永續性的媒介，例如，在 XML 檔案。</span><span class="sxs-lookup"><span data-stu-id="6f537-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="6f537-112">定義之後，可以透過程式設計方式存取網站導覽資料[`SiteMap`類別](https://msdn.microsoft.com/library/system.web.sitemap.aspx)中[`System.Web`命名空間](https://msdn.microsoft.com/library/system.web.aspx)或透過不同的瀏覽 Web 控制項，例如SiteMapPath、 功能表和樹狀檢視控制項。</span><span class="sxs-lookup"><span data-stu-id="6f537-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="6f537-113">站台對應系統會使用[提供者模型](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)使不同的站台對應序列化實作可建立及插入 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="6f537-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="6f537-114">ASP.NET 2.0 隨附的預設站台對應提供者保存網站導覽結構中的 XML 檔案。</span><span class="sxs-lookup"><span data-stu-id="6f537-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="6f537-115">回到[主版頁面和站台瀏覽](../introduction/master-pages-and-site-navigation-vb.md)教學課程中我們建立了名為`Web.sitemap`，包含此結構，並具有已更新其 XML 與每個新的教學課程 > 一節。</span><span class="sxs-lookup"><span data-stu-id="6f537-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-vb.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="6f537-116">如果網站導覽的結構是靜態的例如針對這些教學課程的運作方式的預設 XML 為基礎的站台對應提供者。</span><span class="sxs-lookup"><span data-stu-id="6f537-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="6f537-117">在許多案例中，不過，更具動態網站地圖需要。</span><span class="sxs-lookup"><span data-stu-id="6f537-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="6f537-118">請考量圖 1，其中每個分類和產品會顯示為網站結構中的章節中的站台對應。</span><span class="sxs-lookup"><span data-stu-id="6f537-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="6f537-119">與此站台對應，對應至根節點的網頁瀏覽可能會列出所有類別，而瀏覽特定分類 s web 網頁會列出該分類產品，並檢視特定產品 s web 網頁會顯示該產品 s 詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6f537-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>


<span data-ttu-id="6f537-120">[![分類和產品架構的站台對應的結構](building-a-custom-database-driven-site-map-provider-vb/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="6f537-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-vb/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image1.png)</span></span>

<span data-ttu-id="6f537-121">**圖 1**: 分類和產品結構網站地圖的結構 ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="6f537-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image2.png))</span></span>


<span data-ttu-id="6f537-122">雖然此類別目錄和產品基礎結構可能是硬式編碼成`Web.sitemap`檔案，檔案會想要每次一個類別目錄更新或產品已加入、 移除或重新命名。</span><span class="sxs-lookup"><span data-stu-id="6f537-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="6f537-123">因此，站台對應維護會大幅簡化如果其結構已擷取從資料庫或在理想情況下，從應用程式的架構的商務邏輯層。</span><span class="sxs-lookup"><span data-stu-id="6f537-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="6f537-124">這樣一來，當產品和分類已新增，請重新命名或刪除，站台地圖會自動更新以反映這些變更。</span><span class="sxs-lookup"><span data-stu-id="6f537-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="6f537-125">因為 ASP.NET 2.0 s 站台對應序列化已內建在提供者模型之上，我們可以建立自己 grabs 示範的替代資料存放區，例如資料庫或架構從其資料的自訂站台地圖提供者。</span><span class="sxs-lookup"><span data-stu-id="6f537-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="6f537-126">在本教學課程中，我們會建置 BLL 從擷取其資料的自訂提供者。</span><span class="sxs-lookup"><span data-stu-id="6f537-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="6f537-127">Let s 開始 ！</span><span class="sxs-lookup"><span data-stu-id="6f537-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="6f537-128">在本教學課程中建立的自訂站台對應提供者會緊密結合的應用程式的架構和資料模型。</span><span class="sxs-lookup"><span data-stu-id="6f537-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="6f537-129">Jeff Prosise s[儲存在 SQL Server 中的站台對應](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/)和[SQL 站台地圖提供者等候您已如](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)文章檢查將網站導覽資料儲存在 SQL Server 中的一般化的方法。</span><span class="sxs-lookup"><span data-stu-id="6f537-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>


## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="6f537-130">步驟 1： 建立自訂站台對應提供者 Web 網頁</span><span class="sxs-lookup"><span data-stu-id="6f537-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="6f537-131">我們可以開始建立自訂站台地圖提供者之前，可讓 s 先加入 ASP.NET 網頁，我們需要在此教學課程。</span><span class="sxs-lookup"><span data-stu-id="6f537-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="6f537-132">加入新的資料夾，名為啟動`SiteMapProvider`。</span><span class="sxs-lookup"><span data-stu-id="6f537-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="6f537-133">接下來，將下列 ASP.NET 網頁新增至該資料夾中，務必要建立關聯的每一頁`Site.master`主版頁面：</span><span class="sxs-lookup"><span data-stu-id="6f537-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="6f537-134">也新增`CustomProviders`子資料夾以`App_Code`資料夾。</span><span class="sxs-lookup"><span data-stu-id="6f537-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>


![如需站台對應提供者相關教學課程中加入 ASP.NET 網頁](building-a-custom-database-driven-site-map-provider-vb/_static/image2.gif)

<span data-ttu-id="6f537-136">**圖 2**： 加入 ASP.NET 網頁站台對應提供者相關的教學課程</span><span class="sxs-lookup"><span data-stu-id="6f537-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>


<span data-ttu-id="6f537-137">因為沒有為此區段只有一個教學課程，我們不需要 t`Default.aspx`列出 s 區段教學課程。</span><span class="sxs-lookup"><span data-stu-id="6f537-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="6f537-138">相反地，`Default.aspx`將 GridView 控制項中顯示的類別。</span><span class="sxs-lookup"><span data-stu-id="6f537-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="6f537-139">我們將會處理這在步驟 2 中。</span><span class="sxs-lookup"><span data-stu-id="6f537-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="6f537-140">接下來，更新`Web.sitemap`參考`Default.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="6f537-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="6f537-141">具體來說，在快取之後加入下列標記`<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="6f537-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample1.xml)]

<span data-ttu-id="6f537-142">在更新之後， `Web.sitemap`，花一點時間來檢視此教學課程網站，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="6f537-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="6f537-143">左側功能表現在包含唯一的站台對應提供者教學課程中的項目。</span><span class="sxs-lookup"><span data-stu-id="6f537-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>


![站台對應提供者教學課程網站導覽現在包含的項目](building-a-custom-database-driven-site-map-provider-vb/_static/image3.gif)

<span data-ttu-id="6f537-145">**圖 3**： 網站導覽現在包含一個項目，站台對應提供者教學課程</span><span class="sxs-lookup"><span data-stu-id="6f537-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>


<span data-ttu-id="6f537-146">此教學課程 s 的主要重點是要說明建立自訂站台地圖提供者及設定 web 應用程式使用該提供者。</span><span class="sxs-lookup"><span data-stu-id="6f537-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="6f537-147">特別是，我們會建置的提供者，傳回包含根節點的節點代表每個分類和產品，以及站台對應，如圖 1 所示。</span><span class="sxs-lookup"><span data-stu-id="6f537-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="6f537-148">一般情況下，站台對應中的每個節點可能指定的 URL。</span><span class="sxs-lookup"><span data-stu-id="6f537-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="6f537-149">針對我們的站台對應，將會在根節點的 URL `~/SiteMapProvider/Default.aspx`，其中會列出所有資料庫中的類別。</span><span class="sxs-lookup"><span data-stu-id="6f537-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="6f537-150">站台對應中的每個類別目錄節點必須指向的 URL `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`，其中會列出所有指定的產品*categoryID*。</span><span class="sxs-lookup"><span data-stu-id="6f537-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="6f537-151">最後，將會為每個產品網站導覽節點`~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`，這會顯示特定產品 s 詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6f537-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="6f537-152">若要開始建立所需的`Default.aspx`， `ProductsByCategory.aspx`，和`ProductDetails.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="6f537-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="6f537-153">這些頁面是在步驟 2、 3 和 4 分別完成。</span><span class="sxs-lookup"><span data-stu-id="6f537-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="6f537-154">因為介面的本教學課程的主要目的是在站台對應提供者，但因為過去的教學課程涵蓋了建立多頁主要/詳細資料這類報告，我們將會快步驟 2 到 4。</span><span class="sxs-lookup"><span data-stu-id="6f537-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="6f537-155">如果您需要建立跨越多個頁面的主要/詳細資料報表的重新整理程式，請參閱上一步[主要/詳細資料篩選跨兩個頁面](../masterdetail/master-detail-filtering-across-two-pages-vb.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="6f537-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-vb.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="6f537-156">步驟 2： 顯示類別目錄的清單</span><span class="sxs-lookup"><span data-stu-id="6f537-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="6f537-157">開啟`Default.aspx`頁面`SiteMapProvider`資料夾，然後拖曳 GridView 從工具箱拖曳至設計工具中，設定其`ID`至`Categories`。</span><span class="sxs-lookup"><span data-stu-id="6f537-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="6f537-158">從 GridView s 智慧標籤，將它繫結至名為新 ObjectDataSource`CategoriesDataSource`並加以設定，讓它會擷取其資料使用`CategoriesBLL`類別的`GetCategories`方法。</span><span class="sxs-lookup"><span data-stu-id="6f537-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="6f537-159">由於此 GridView 只會顯示類別，而且不會提供資料修改功能，設定下拉式清單中更新、 插入和刪除索引標籤為 （無）。</span><span class="sxs-lookup"><span data-stu-id="6f537-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="6f537-160">[![設定要傳回使用 GetCategories 方法的類別 ObjectDataSource](building-a-custom-database-driven-site-map-provider-vb/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="6f537-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-vb/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image3.png)</span></span>

<span data-ttu-id="6f537-161">**圖 4**： 設定要傳回的類別使用 ObjectDataSource`GetCategories`方法 ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="6f537-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image4.png))</span></span>


<span data-ttu-id="6f537-162">[![設定下拉式清單中更新、 插入和刪除 （無） 索引標籤](building-a-custom-database-driven-site-map-provider-vb/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="6f537-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.png)</span></span>

<span data-ttu-id="6f537-163">**圖 5**： 下拉式清單中設定更新、 插入和刪除的索引標籤 （無） ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="6f537-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image6.png))</span></span>


<span data-ttu-id="6f537-164">完成設定資料來源精靈之後，Visual Studio 會加入為 BoundField `CategoryID`， `CategoryName`， `Description`， `NumberOfProducts`，和`BrochurePath`。</span><span class="sxs-lookup"><span data-stu-id="6f537-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="6f537-165">編輯 GridView，使其只包含`CategoryName`和`Description`BoundFields 並更新`CategoryName`BoundField 的`HeaderText`類別目錄的屬性。</span><span class="sxs-lookup"><span data-stu-id="6f537-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="6f537-166">接下來，新增 HyperLinkField，並因此放在它 s 最左邊的欄位。</span><span class="sxs-lookup"><span data-stu-id="6f537-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="6f537-167">設定`DataNavigateUrlFields`屬性`CategoryID`和`DataNavigateUrlFormatString`屬性`~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`。</span><span class="sxs-lookup"><span data-stu-id="6f537-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="6f537-168">設定`Text`檢視產品的屬性。</span><span class="sxs-lookup"><span data-stu-id="6f537-168">Set the `Text` property to View Products .</span></span>


![加入類別 GridView HyperLinkField](building-a-custom-database-driven-site-map-provider-vb/_static/image6.gif)

<span data-ttu-id="6f537-170">**圖 6**： 新增至 HyperLinkField `Categories` GridView</span><span class="sxs-lookup"><span data-stu-id="6f537-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>


<span data-ttu-id="6f537-171">在之後建立 ObjectDataSource 和自訂 GridView 的欄位時，兩個控制項的宣告式標記看起來如下所示：</span><span class="sxs-lookup"><span data-stu-id="6f537-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample2.aspx)]

<span data-ttu-id="6f537-172">圖 7 顯示`Default.aspx`透過瀏覽器檢視時。</span><span class="sxs-lookup"><span data-stu-id="6f537-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="6f537-173">按一下 類別檢視產品的連結會帶您前往`ProductsByCategory.aspx?CategoryID=categoryID`，我們將在步驟 3 中建置的。</span><span class="sxs-lookup"><span data-stu-id="6f537-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>


<span data-ttu-id="6f537-174">[![每個類別目錄會列出沿著檢視產品連結](building-a-custom-database-driven-site-map-provider-vb/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="6f537-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-vb/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image7.png)</span></span>

<span data-ttu-id="6f537-175">**圖 7**： 每個類別是列出沿著檢視產品連結 ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="6f537-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image8.png))</span></span>


## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="6f537-176">步驟 3： 列出選取的類別的產品</span><span class="sxs-lookup"><span data-stu-id="6f537-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="6f537-177">開啟`ProductsByCategory.aspx`頁面上，並加入 GridView，其命名為`ProductsByCategory`。</span><span class="sxs-lookup"><span data-stu-id="6f537-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="6f537-178">從其智慧標籤，將繫結 GridView 至名為新 ObjectDataSource `ProductsByCategoryDataSource`。</span><span class="sxs-lookup"><span data-stu-id="6f537-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="6f537-179">設定用於 ObjectDataSource`ProductsBLL`類別的`GetProductsByCategoryID(categoryID)`標籤中的 UPDATE、 INSERT 和 DELETE 方法並將下拉式清單列出為 （無）。</span><span class="sxs-lookup"><span data-stu-id="6f537-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>


<span data-ttu-id="6f537-180">[![使用 ProductsBLL 類別的 GetProductsByCategoryID(categoryID) 方法](building-a-custom-database-driven-site-map-provider-vb/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="6f537-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-vb/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image9.png)</span></span>

<span data-ttu-id="6f537-181">**圖 8**： 使用`ProductsBLL`類別 s`GetProductsByCategoryID(categoryID)`方法 ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="6f537-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image10.png))</span></span>


<span data-ttu-id="6f537-182">設定資料來源精靈的最後一個步驟會提示輸入參數的來源*categoryID*。</span><span class="sxs-lookup"><span data-stu-id="6f537-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="6f537-183">因為這項資訊透過查詢字串欄位傳遞`CategoryID`、 從下拉式清單中選取 QueryString 和 QueryStringField 文字方塊中輸入 CategoryID，如圖 9 所示。</span><span class="sxs-lookup"><span data-stu-id="6f537-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="6f537-184">按一下 [完成] 5d; 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="6f537-184">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="6f537-185">[![用於 categoryID 參數 CategoryID Querystring 欄位](building-a-custom-database-driven-site-map-provider-vb/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="6f537-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-vb/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image11.png)</span></span>

<span data-ttu-id="6f537-186">**圖 9**： 使用`CategoryID`Querystring 欄位針對*categoryID*參數 ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="6f537-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image12.png))</span></span>


<span data-ttu-id="6f537-187">完成精靈之後，Visual Studio 將會加入對應 BoundFields 及其產品資料欄位的 GridView。</span><span class="sxs-lookup"><span data-stu-id="6f537-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="6f537-188">移除以外的所有`ProductName`， `UnitPrice`，和`SupplierName`BoundFields。</span><span class="sxs-lookup"><span data-stu-id="6f537-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="6f537-189">自訂這些三個 BoundFields`HeaderText`分別讀取產品、 價格和供應商的屬性。</span><span class="sxs-lookup"><span data-stu-id="6f537-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="6f537-190">格式`UnitPrice`BoundField 為貨幣。</span><span class="sxs-lookup"><span data-stu-id="6f537-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="6f537-191">接下來，新增 HyperLinkField，並將它移至最左邊的位置。</span><span class="sxs-lookup"><span data-stu-id="6f537-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="6f537-192">設定其`Text`屬性以檢視詳細資料，其`DataNavigateUrlFields`屬性`ProductID`，且其`DataNavigateUrlFormatString`屬性`~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`。</span><span class="sxs-lookup"><span data-stu-id="6f537-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>


![加入指向 ProductDetails.aspx 檢視詳細資料 HyperLinkField](building-a-custom-database-driven-site-map-provider-vb/_static/image10.gif)

<span data-ttu-id="6f537-194">**圖 10**： 加入 檢視詳細資料 HyperLinkField 指向 `ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="6f537-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>


<span data-ttu-id="6f537-195">進行這些自訂後, GridView 和 ObjectDataSource s 宣告式標記應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="6f537-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample3.aspx)]

<span data-ttu-id="6f537-196">返回檢視`Default.aspx`透過瀏覽器，並按一下 檢視產品飲料的連結。</span><span class="sxs-lookup"><span data-stu-id="6f537-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="6f537-197">這會帶您到`ProductsByCategory.aspx?CategoryID=1`，顯示名稱、 價格以及產品的供應商屬於 「 飲料 」 分類的 Northwind 資料庫中 （請參閱圖 11）。</span><span class="sxs-lookup"><span data-stu-id="6f537-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="6f537-198">歡迎進一步加強此頁面來包含使用者返回類別目錄清單頁面的連結 (`Default.aspx`) 和顯示選取的類別 s 的名稱和描述的 DetailsView 或 FormView 控制項。</span><span class="sxs-lookup"><span data-stu-id="6f537-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>


<span data-ttu-id="6f537-199">[![顯示飲料名稱、 價格以及供應商](building-a-custom-database-driven-site-map-provider-vb/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="6f537-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-vb/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image13.png)</span></span>

<span data-ttu-id="6f537-200">**圖 11**： 顯示飲料名稱、 價格以及供應商 ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="6f537-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image14.png))</span></span>


## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="6f537-201">步驟 4： 顯示產品 s 詳細資料</span><span class="sxs-lookup"><span data-stu-id="6f537-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="6f537-202">最後一頁， `ProductDetails.aspx`，顯示所選的產品詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6f537-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="6f537-203">開啟`ProductDetails.aspx`拖曳 DetailsView 從 [工具箱] 拖曳至設計工具。</span><span class="sxs-lookup"><span data-stu-id="6f537-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="6f537-204">設定 DetailsView s`ID`屬性`ProductInfo`和清除其`Height`和`Width`屬性值。</span><span class="sxs-lookup"><span data-stu-id="6f537-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="6f537-205">從其智慧標籤，將繫結 DetailsView 至名為新 ObjectDataSource `ProductDataSource`，設定提取資料的來源 ObjectDataSource`ProductsBLL`類別的`GetProductByProductID(productID)`方法。</span><span class="sxs-lookup"><span data-stu-id="6f537-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="6f537-206">如同在步驟 2 和 3 中建立的上一個網頁，設定下拉式清單中更新、 插入和刪除索引標籤，以 （無）。</span><span class="sxs-lookup"><span data-stu-id="6f537-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="6f537-207">[![設定為使用 GetProductByProductID(productID) 方法 ObjectDataSource](building-a-custom-database-driven-site-map-provider-vb/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="6f537-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-vb/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.png)</span></span>

<span data-ttu-id="6f537-208">**圖 12**： 設定要使用 ObjectDataSource`GetProductByProductID(productID)`方法 ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="6f537-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image16.png))</span></span>


<span data-ttu-id="6f537-209">設定資料來源精靈的最後一個步驟會提示輸入的來源*productID*參數。</span><span class="sxs-lookup"><span data-stu-id="6f537-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="6f537-210">因為這項資料是透過查詢字串欄位`ProductID`，設 QueryString 和以 ProductID QueryStringField 文字方塊中的下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="6f537-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="6f537-211">最後，按一下 [完成] 按鈕以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="6f537-211">Finally, click the Finish button to complete the wizard.</span></span>


<span data-ttu-id="6f537-212">[![設定產品識別碼 ProductID Querystring 欄位從提取其值的參數](building-a-custom-database-driven-site-map-provider-vb/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="6f537-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-vb/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image17.png)</span></span>

<span data-ttu-id="6f537-213">**圖 13**： 設定*productID*提取從其值的參數`ProductID`Querystring 欄位 ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="6f537-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image18.png))</span></span>


<span data-ttu-id="6f537-214">完成設定資料來源精靈之後，Visual Studio 會建立對應的 BoundFields 及其 DetailsView 產品資料欄位中。</span><span class="sxs-lookup"><span data-stu-id="6f537-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="6f537-215">移除`ProductID`， `SupplierID`，和`CategoryID`BoundFields 並適當地設定其餘的欄位。</span><span class="sxs-lookup"><span data-stu-id="6f537-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="6f537-216">在少數幾個美觀的組態之後, 我 DetailsView 和 ObjectDataSource s 宣告式標記看起來如下所示：</span><span class="sxs-lookup"><span data-stu-id="6f537-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample4.aspx)]

<span data-ttu-id="6f537-217">若要測試此頁面，返回`Default.aspx`，按一下 檢視產品上針對 「 飲料 」 分類。</span><span class="sxs-lookup"><span data-stu-id="6f537-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="6f537-218">飲料產品清單中，按一下 [Chai 茶杯的檢視詳細資料] 連結。</span><span class="sxs-lookup"><span data-stu-id="6f537-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="6f537-219">這會帶您到`ProductDetails.aspx?ProductID=1`，其中顯示 Chai 茶杯 s （請參閱圖 14） 的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6f537-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>


<span data-ttu-id="6f537-220">[![顯示 Chai 茶杯 s 供應商，類別目錄、 價格和其他資訊](building-a-custom-database-driven-site-map-provider-vb/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="6f537-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-vb/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image19.png)</span></span>

<span data-ttu-id="6f537-221">**圖 14**: Chai 茶杯 s 供應商，類別目錄、 價格和其他資訊會顯示 ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="6f537-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image20.png))</span></span>


## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="6f537-222">步驟 5： 了解站台地圖提供者的內部運作方式</span><span class="sxs-lookup"><span data-stu-id="6f537-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="6f537-223">站台地圖以 web 伺服器記憶體中的集合`SiteMapNode`形成階層的執行個體。</span><span class="sxs-lookup"><span data-stu-id="6f537-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="6f537-224">必須有一個根，所有的非根節點必須剛好只有一個父節點，而且所有節點都可能都有任意數目的子系。</span><span class="sxs-lookup"><span data-stu-id="6f537-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="6f537-225">每個`SiteMapNode`物件表示的區段內的網站的結構; 這些章節通常會有對應的網頁。</span><span class="sxs-lookup"><span data-stu-id="6f537-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="6f537-226">因此， [ `SiteMapNode`類別](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx)具有屬性，例如`Title`， `Url`，和`Description`，提供資訊區段`SiteMapNode`代表。</span><span class="sxs-lookup"><span data-stu-id="6f537-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="6f537-227">另外還有`Key`屬性可唯一識別每個`SiteMapNode`階層，以及用來建立此階層的屬性`ChildNodes`， `ParentNode`， `NextSibling`， `PreviousSibling`，依此類推。</span><span class="sxs-lookup"><span data-stu-id="6f537-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="6f537-228">圖 15 顯示一般網站導覽結構來自圖 1 中，但具有勾勒出詳細程度的實作詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6f537-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>


<span data-ttu-id="6f537-229">[![每個 SiteMapNode 具有屬性類似標題、 Url、 金鑰和等等](building-a-custom-database-driven-site-map-provider-vb/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="6f537-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-vb/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.gif)</span></span>

<span data-ttu-id="6f537-230">**圖 15**： 每個`SiteMapNode`有屬性例如`Title`， `Url`，`Key`等等 ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="6f537-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image17.gif))</span></span>


<span data-ttu-id="6f537-231">站台對應是透過可存取[`SiteMap`類別](https://msdn.microsoft.com/library/system.web.sitemap.aspx)中[`System.Web`命名空間](https://msdn.microsoft.com/library/system.web.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6f537-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx).</span></span> <span data-ttu-id="6f537-232">這個類別 s`RootNode`屬性會傳回站台對應的根目錄`SiteMapNode`執行個體。`CurrentNode`傳回`SiteMapNode`其`Url`屬性會比對的目前要求的網頁 URL。</span><span class="sxs-lookup"><span data-stu-id="6f537-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="6f537-233">這個類別是由 ASP.NET 2.0 s 瀏覽 Web 控制項的內部使用。</span><span class="sxs-lookup"><span data-stu-id="6f537-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="6f537-234">當`SiteMap`類別的屬性存取，它必須將某些永續性的媒體中的站台對應結構序列化至記憶體。</span><span class="sxs-lookup"><span data-stu-id="6f537-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="6f537-235">不過，站台對應序列化邏輯不是硬式編碼至`SiteMap`類別。</span><span class="sxs-lookup"><span data-stu-id="6f537-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="6f537-236">相反地，在執行階段`SiteMap`類別會決定哪一個站台地圖*提供者*供序列化使用。</span><span class="sxs-lookup"><span data-stu-id="6f537-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="6f537-237">根據預設， [ `XmlSiteMapProvider`類別](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx)使用時，從格式正確的 XML 檔案讀取站台對應的結構。</span><span class="sxs-lookup"><span data-stu-id="6f537-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="6f537-238">不過，利用最少的工作，我們可以建立自己的自訂站台地圖提供者。</span><span class="sxs-lookup"><span data-stu-id="6f537-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="6f537-239">所有站台對應提供者必須衍生自[`SiteMapProvider`類別](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx)、 包含重要的方法和屬性所需的站台對應提供者，但是省略許多實作詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6f537-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="6f537-240">第二個類別[ `StaticSiteMapProvider` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx)，擴充`SiteMapProvider`類別，並包含所需的功能較為複雜的實作。</span><span class="sxs-lookup"><span data-stu-id="6f537-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="6f537-241">就內部而言，`StaticSiteMapProvider`儲存`SiteMapNode`站台的執行個體對應在`Hashtable`，並提供等方法`AddNode(child, parent)`，`RemoveNode(siteMapNode),`和`Clear()`，加入和移除`SiteMapNode`s 至內部`Hashtable`。</span><span class="sxs-lookup"><span data-stu-id="6f537-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="6f537-242">`XmlSiteMapProvider` 衍生自 `StaticSiteMapProvider`。</span><span class="sxs-lookup"><span data-stu-id="6f537-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="6f537-243">當建立自訂站台地圖提供者擴充`StaticSiteMapProvider`，有兩種抽象方法，必須覆寫： [ `BuildSiteMap` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx)和[ `GetRootNodeCore` ](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6f537-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="6f537-244">`BuildSiteMap`正如其名，負責從永續性儲存體載入網站導覽結構並建構在記憶體中。</span><span class="sxs-lookup"><span data-stu-id="6f537-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="6f537-245">`GetRootNodeCore` 傳回站台對應中的根節點。</span><span class="sxs-lookup"><span data-stu-id="6f537-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="6f537-246">之前的 web 應用程式可以使用站台對應的提供者，則必須在應用程式的組態中註冊。</span><span class="sxs-lookup"><span data-stu-id="6f537-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="6f537-247">根據預設，`XmlSiteMapProvider`名稱註冊類別`AspNetXmlSiteMapProvider`。</span><span class="sxs-lookup"><span data-stu-id="6f537-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="6f537-248">若要註冊額外的站台對應提供者，加入下列標記以`Web.config`:</span><span class="sxs-lookup"><span data-stu-id="6f537-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample5.xml)]

<span data-ttu-id="6f537-249">*名稱*值將人類看得懂的名稱指派給提供者時*類型*指定站台地圖提供者的完整限定類型名稱。</span><span class="sxs-lookup"><span data-stu-id="6f537-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="6f537-250">我們將探討的具象值*名稱*和*類型*步驟 7 中的值之後，我們已建立我們的自訂站台地圖提供者。</span><span class="sxs-lookup"><span data-stu-id="6f537-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="6f537-251">站台對應提供者類別具現化第一次從存取`SiteMap`類別並維持在記憶體中的 web 應用程式的存留期。</span><span class="sxs-lookup"><span data-stu-id="6f537-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="6f537-252">因為只有一個執行個體可能會從叫用多個並行的網站訪客的站台對應提供者，請務必提供者的方法，是*安全執行緒*。</span><span class="sxs-lookup"><span data-stu-id="6f537-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="6f537-253">效能和延展性的原因，它 s 重要我們快取記憶體中的站台對應的結構，並傳回此快取結構，而非每次重新建立`BuildSiteMap`叫用方法。</span><span class="sxs-lookup"><span data-stu-id="6f537-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="6f537-254">`BuildSiteMap` 可能會呼叫多次，每個頁面要求每位使用者，根據導覽控制項中使用的頁面及網站導覽結構的深度。</span><span class="sxs-lookup"><span data-stu-id="6f537-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="6f537-255">在任何情況下，如果我們不要快取中的站台對應結構`BuildSiteMap`然後我們會需要每次叫用時重新擷取的架構 （這會導致查詢資料庫） 的產品和分類資訊。</span><span class="sxs-lookup"><span data-stu-id="6f537-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="6f537-256">如我們所討論在先前的快取教學課程中，快取的資料可能會變成過時。</span><span class="sxs-lookup"><span data-stu-id="6f537-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="6f537-257">若要避免此問題，我們可以使用時間-或 SQL 快取相依性為基礎的 expiries。</span><span class="sxs-lookup"><span data-stu-id="6f537-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="6f537-258">站台地圖提供者可能會選擇性地覆寫[`Initialize`方法](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6f537-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="6f537-259">`Initialize` 當站台對應提供者會先具現化會傳遞給提供者中的任何自訂屬性時，會叫用`Web.config`中`<add>`類似的項目： `<add name="name" type="type" customAttribute="value" />`。</span><span class="sxs-lookup"><span data-stu-id="6f537-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="6f537-260">如果您想要允許網頁開發人員指定各種站台對應提供者相關設定，而不需要修改提供者 s 程式碼，就會很有用。</span><span class="sxs-lookup"><span data-stu-id="6f537-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="6f537-261">例如，如果我們已分類和產品資料直接從資料庫讀取與架構中，我們 d 可能想要讓網頁開發人員指定資料庫連接字串透過`Web.config`而不是使用硬式編碼提供者 s 程式碼中的值。</span><span class="sxs-lookup"><span data-stu-id="6f537-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="6f537-262">步驟 6 中，我們將建立的自訂站台對應提供者不會覆寫這`Initialize`方法。</span><span class="sxs-lookup"><span data-stu-id="6f537-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="6f537-263">如需使用`Initialize`方法，是指[Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s[儲存在 SQL Server 中的站台對應](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/)發行項。</span><span class="sxs-lookup"><span data-stu-id="6f537-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>


## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="6f537-264">步驟 6： 建立自訂站台地圖提供者</span><span class="sxs-lookup"><span data-stu-id="6f537-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="6f537-265">若要建立自訂站台地圖提供者可建立站台的對應的分類和產品 Northwind 資料庫中的，我們必須建立該類別可擴充`StaticSiteMapProvider`。</span><span class="sxs-lookup"><span data-stu-id="6f537-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="6f537-266">在步驟 1 中詢問您要加入`CustomProviders`資料夾中的`App_Code`資料夾將新類別加入名為此資料夾`NorthwindSiteMapProvider`。</span><span class="sxs-lookup"><span data-stu-id="6f537-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="6f537-267">將下列程式碼加入 `NorthwindSiteMapProvider` 類別：</span><span class="sxs-lookup"><span data-stu-id="6f537-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>


[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample6.vb)]

<span data-ttu-id="6f537-268">可讓開始瀏覽此類別 s 的 s`BuildSiteMap`方法，以開始[`lock`陳述式](https://msdn.microsoft.com/library/c5kehkcz.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6f537-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="6f537-269">`lock`陳述式只允許一個執行緒每次輸入，藉以序列化其程式碼存取，並防止在另一個 s 腳趾算得出來逐步執行兩個並行執行緒。</span><span class="sxs-lookup"><span data-stu-id="6f537-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="6f537-270">類別層級`SiteMapNode`變數`root`用來快取網站導覽結構。</span><span class="sxs-lookup"><span data-stu-id="6f537-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="6f537-271">第一次，或第一次之後已修改基礎資料，建構網站導覽時`root`會`Nothing`和網站導覽結構會在建構。</span><span class="sxs-lookup"><span data-stu-id="6f537-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `Nothing` and the site map structure will be constructed.</span></span> <span data-ttu-id="6f537-272">站台對應的根節點指派給`root`建構期間處理程序，以便在下一次這個方法呼叫時，`root`將不會`Nothing`。</span><span class="sxs-lookup"><span data-stu-id="6f537-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `Nothing`.</span></span> <span data-ttu-id="6f537-273">因此，只要`root`不`Nothing`網站導覽結構將傳回給呼叫端，而不必重新建立它。</span><span class="sxs-lookup"><span data-stu-id="6f537-273">Consequently, so long as `root` is not `Nothing` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="6f537-274">如果是根`Nothing`，網站導覽結構從產品和分類的資訊建立。</span><span class="sxs-lookup"><span data-stu-id="6f537-274">If root is `Nothing`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="6f537-275">藉由建立建置網站導覽`SiteMapNode`執行個體，然後再建構透過呼叫階層`StaticSiteMapProvider`類別的`AddNode`方法。</span><span class="sxs-lookup"><span data-stu-id="6f537-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="6f537-276">`AddNode` 執行內部簿記，儲存各種`SiteMapNode`中執行個體`Hashtable`。</span><span class="sxs-lookup"><span data-stu-id="6f537-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="6f537-277">我們一開始建構階層之前，我們一開始呼叫`Clear`方法，從內部的項目可清除`Hashtable`。</span><span class="sxs-lookup"><span data-stu-id="6f537-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="6f537-278">下一步`ProductsBLL`類別 s`GetProducts`方法，並產生`ProductsDataTable`儲存在本機變數。</span><span class="sxs-lookup"><span data-stu-id="6f537-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="6f537-279">站台對應的建構開始建立根節點，並將它指派給`root`。</span><span class="sxs-lookup"><span data-stu-id="6f537-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="6f537-280">多載[ `SiteMapNode` s 建構函式](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx)使用此處，而這整個`BuildSiteMap`傳遞下列資訊：</span><span class="sxs-lookup"><span data-stu-id="6f537-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="6f537-281">站台對應提供者的參考 (`Me`)。</span><span class="sxs-lookup"><span data-stu-id="6f537-281">A reference to the site map provider (`Me`).</span></span>
- <span data-ttu-id="6f537-282">`SiteMapNode` s `Key`。</span><span class="sxs-lookup"><span data-stu-id="6f537-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="6f537-283">需要這個值必須是唯一的每個`SiteMapNode`。</span><span class="sxs-lookup"><span data-stu-id="6f537-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="6f537-284">`SiteMapNode` s `Url`。</span><span class="sxs-lookup"><span data-stu-id="6f537-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="6f537-285">`Url` 是選擇性的但如果提供，每個`SiteMapNode`s`Url`值必須是唯一。</span><span class="sxs-lookup"><span data-stu-id="6f537-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="6f537-286">`SiteMapNode` s `Title`，這是必要。</span><span class="sxs-lookup"><span data-stu-id="6f537-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="6f537-287">`AddNode(root)`方法呼叫加入`SiteMapNode``root`做為根的站台對應。</span><span class="sxs-lookup"><span data-stu-id="6f537-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="6f537-288">接著，每個`ProductRow`中`ProductsDataTable`列舉。</span><span class="sxs-lookup"><span data-stu-id="6f537-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="6f537-289">如果已經有`SiteMapNode`目前產品 s 分類中，參考它。</span><span class="sxs-lookup"><span data-stu-id="6f537-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="6f537-290">否則，新`SiteMapNode`的類別目錄會建立並新增為子系`SiteMapNode``root`透過`AddNode(categoryNode, root)`方法呼叫。</span><span class="sxs-lookup"><span data-stu-id="6f537-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="6f537-291">在適當的類別之後`SiteMapNode`節點已找到或建立，`SiteMapNode`為目前的產品建立並加入做為子類別目錄的`SiteMapNode`透過`AddNode(productNode, categoryNode)`。</span><span class="sxs-lookup"><span data-stu-id="6f537-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="6f537-292">請注意，類別目錄`SiteMapNode`s`Url`屬性值是`~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`而產品`SiteMapNode`s`Url`屬性會被指派`~/SiteMapNode/ProductDetails.aspx?ProductID=productID`。</span><span class="sxs-lookup"><span data-stu-id="6f537-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="6f537-293">這些資料庫的產品`NULL`值及其`CategoryID`在類別目錄底下的分組`SiteMapNode`其`Title`屬性設定為 None，其`Url`屬性設定為空字串。</span><span class="sxs-lookup"><span data-stu-id="6f537-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="6f537-294">我決定設定`Url`設為空字串，因為`ProductBLL`類別 s`GetProductsByCategory(categoryID)`方法目前缺少傳回僅具有產品`NULL``CategoryID`值。</span><span class="sxs-lookup"><span data-stu-id="6f537-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="6f537-295">我想要示範導覽控制項的呈現方式的同時，`SiteMapNode`所缺少的值及其`Url`屬性。</span><span class="sxs-lookup"><span data-stu-id="6f537-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="6f537-296">建議您延伸本教學課程，讓 無`SiteMapNode`s`Url`屬性會指向`ProductsByCategory.aspx`，但只會顯示與產品`NULL``CategoryID`值。</span><span class="sxs-lookup"><span data-stu-id="6f537-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>


<span data-ttu-id="6f537-297">任意的物件新增至使用上的 SQL 快取相依性的資料快取後建構站台對應，`Categories`和`Products`資料表透過`AggregateCacheDependency`物件。</span><span class="sxs-lookup"><span data-stu-id="6f537-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="6f537-298">我們已在先前的教學課程中，使用 SQL 快取相依性探索*使用 SQL 快取相依性*。</span><span class="sxs-lookup"><span data-stu-id="6f537-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="6f537-299">自訂站台地圖提供者，不過，會使用多載的資料快取的`Insert`方法我們尚未來瀏覽過。</span><span class="sxs-lookup"><span data-stu-id="6f537-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="6f537-300">這個多載會接受做為其最終的輸入參數，從快取中移除物件時呼叫委派。</span><span class="sxs-lookup"><span data-stu-id="6f537-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="6f537-301">具體來說，我們會傳送新[`CacheItemRemovedCallback`委派](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx)，它會指向`OnSiteMapChanged`方法定義中的進一步向下`NorthwindSiteMapProvider`類別。</span><span class="sxs-lookup"><span data-stu-id="6f537-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="6f537-302">站台對應的記憶體中表示法會透過類別層級變數快取`root`。</span><span class="sxs-lookup"><span data-stu-id="6f537-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="6f537-303">因為只有一個執行個體的自訂站台對應提供者類別，因為該執行個體 web 應用程式中所有執行緒之間共用，此類別變數可做為快取中。</span><span class="sxs-lookup"><span data-stu-id="6f537-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="6f537-304">`BuildSiteMap`方法也會使用資料快取，但僅做為基礎資料庫中的資料時收到通知`Categories`或`Products`資料表的變更。</span><span class="sxs-lookup"><span data-stu-id="6f537-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="6f537-305">請注意，此值放入資料快取目前的日期和時間。</span><span class="sxs-lookup"><span data-stu-id="6f537-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="6f537-306">實際站台地圖資料是*不*放置於資料快取。</span><span class="sxs-lookup"><span data-stu-id="6f537-306">The actual site map data is *not* put in the data cache.</span></span>


<span data-ttu-id="6f537-307">`BuildSiteMap`方法完成所傳回的站台地圖的根節點。</span><span class="sxs-lookup"><span data-stu-id="6f537-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="6f537-308">其餘的方法都相當直接明瞭。</span><span class="sxs-lookup"><span data-stu-id="6f537-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="6f537-309">`GetRootNodeCore` 會負責傳回的根節點。</span><span class="sxs-lookup"><span data-stu-id="6f537-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="6f537-310">因為`BuildSiteMap`傳回根`GetRootNodeCore`只會傳回`BuildSiteMap`s 傳回值。</span><span class="sxs-lookup"><span data-stu-id="6f537-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="6f537-311">`OnSiteMapChanged`方法會設定`root`回到`Nothing`移除快取項目時。</span><span class="sxs-lookup"><span data-stu-id="6f537-311">The `OnSiteMapChanged` method sets `root` back to `Nothing` when the cache item is removed.</span></span> <span data-ttu-id="6f537-312">根設回`Nothing`，下次`BuildSiteMap`是叫用，網站導覽結構將會重建。</span><span class="sxs-lookup"><span data-stu-id="6f537-312">With root set back to `Nothing`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="6f537-313">最後，`CachedDate`如果存在於這類的值，屬性會傳回儲存在資料快取的日期和時間值。</span><span class="sxs-lookup"><span data-stu-id="6f537-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="6f537-314">這個屬性可以供網頁開發人員，以判斷當站台地圖資料上一次快取。</span><span class="sxs-lookup"><span data-stu-id="6f537-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="6f537-315">步驟 7： 註冊`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="6f537-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="6f537-316">在我們的 web 應用程式，才能使用`NorthwindSiteMapProvider`步驟 6 中建立的站台對應提供者，我們需要註冊在`<siteMap>`區段`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="6f537-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="6f537-317">具體來說，加入下列標記內`<system.web>`中的項目`Web.config`:</span><span class="sxs-lookup"><span data-stu-id="6f537-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample7.xml)]

<span data-ttu-id="6f537-318">這個標記會執行兩項工作： 首先，它會指出內建`AspNetXmlSiteMapProvider`為預設站台對應提供者; 第二，它會註冊以人類看得易記名稱 Northwind 步驟 6 中建立的自訂站台對應提供者。</span><span class="sxs-lookup"><span data-stu-id="6f537-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="6f537-319">站台對應提供者位於應用程式 s`App_Code`資料夾、 值`type`屬性就是類別名稱。</span><span class="sxs-lookup"><span data-stu-id="6f537-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="6f537-320">或者，自訂站台地圖提供者可建立個別的類別庫專案中使用編譯的組件放在 web 應用程式的`/Bin`目錄。</span><span class="sxs-lookup"><span data-stu-id="6f537-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="6f537-321">在此情況下，`type`屬性值會是*命名空間*。*ClassName*， *AssemblyName* 。</span><span class="sxs-lookup"><span data-stu-id="6f537-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>


<span data-ttu-id="6f537-322">在更新之後， `Web.config`，請花一點時間瀏覽器中檢視任何頁面上，從教學課程。</span><span class="sxs-lookup"><span data-stu-id="6f537-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="6f537-323">請注意，在左側瀏覽介面仍會顯示各節，教學課程中定義`Web.sitemap`。</span><span class="sxs-lookup"><span data-stu-id="6f537-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="6f537-324">這是因為我們保留`AspNetXmlSiteMapProvider`做為預設提供者。</span><span class="sxs-lookup"><span data-stu-id="6f537-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="6f537-325">若要建立使用的瀏覽使用者介面項目`NorthwindSiteMapProvider`，我們需要明確指定應 Northwind 站台地圖提供者。</span><span class="sxs-lookup"><span data-stu-id="6f537-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="6f537-326">我們會了解如何完成這項作業在步驟 8。</span><span class="sxs-lookup"><span data-stu-id="6f537-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="6f537-327">步驟 8： 顯示使用自訂站台地圖提供者的站台對應資訊</span><span class="sxs-lookup"><span data-stu-id="6f537-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="6f537-328">使用自訂站台地圖提供者建立並註冊在`Web.config`，我們要加入導覽控制項，以準備好`Default.aspx`， `ProductsByCategory.aspx`，和`ProductDetails.aspx`中的分頁`SiteMapProvider`資料夾。</span><span class="sxs-lookup"><span data-stu-id="6f537-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="6f537-329">先開啟`Default.aspx`頁面上，拖曳`SiteMapPath`從 [工具箱] 拖曳至設計工具。</span><span class="sxs-lookup"><span data-stu-id="6f537-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="6f537-330">SiteMapPath 控制項位於 [工具箱] 的 [導覽] 區段中。</span><span class="sxs-lookup"><span data-stu-id="6f537-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>


<span data-ttu-id="6f537-331">[![SiteMapPath 加入 Default.aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="6f537-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image18.gif)</span></span>

<span data-ttu-id="6f537-332">**圖 16**： 新增至 SiteMapPath `Default.aspx` ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="6f537-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image20.gif))</span></span>


<span data-ttu-id="6f537-333">SiteMapPath 控制項顯示階層連結列，指出目前的網頁的位置內站台對應。</span><span class="sxs-lookup"><span data-stu-id="6f537-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="6f537-334">我們加入主版頁面的頂端加入 SiteMapPath 回*主版頁面和站台瀏覽*教學課程。</span><span class="sxs-lookup"><span data-stu-id="6f537-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="6f537-335">請花一點時間來檢視此頁面，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="6f537-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="6f537-336">圖 16 加入 SiteMapPath 會使用預設站台對應提供者，提取資料的來源`Web.sitemap`。</span><span class="sxs-lookup"><span data-stu-id="6f537-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="6f537-337">因此，階層連結顯示首頁&gt;自訂站台對應，就像在右上角階層連結。</span><span class="sxs-lookup"><span data-stu-id="6f537-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>


<span data-ttu-id="6f537-338">[![階層會使用預設站台地圖提供者](building-a-custom-database-driven-site-map-provider-vb/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="6f537-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-vb/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.gif)</span></span>

<span data-ttu-id="6f537-339">**圖 17**： 階層會使用預設的站台地圖提供者 ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="6f537-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image23.gif))</span></span>


<span data-ttu-id="6f537-340">若要加入圖 16 SiteMapPath，使用您在步驟 6 中我們建立的自訂站台對應提供者，請設定其[`SiteMapProvider`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx)至 Northwind，我們指派給名稱`NorthwindSiteMapProvider`中`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="6f537-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="6f537-341">不幸的是，設計工具會繼續使用預設站台對應提供者，但如果您可透過瀏覽器頁面瀏覽屬性變更之後您會看到階層連結現在會使用自訂站台地圖提供者。</span><span class="sxs-lookup"><span data-stu-id="6f537-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>


<span data-ttu-id="6f537-342">[![階層連結現在會使用自訂站台對應提供者 NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="6f537-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image24.gif)</span></span>

<span data-ttu-id="6f537-343">**圖 18**： 階層連結現在會使用自訂站台地圖提供者`NorthwindSiteMapProvider`([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="6f537-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image26.gif))</span></span>


<span data-ttu-id="6f537-344">SiteMapPath 控制項顯示的其他功能的使用者介面中`ProductsByCategory.aspx`和`ProductDetails.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="6f537-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="6f537-345">加入這些頁，設定 SiteMapPath`SiteMapProvider`中都為 Northwind 的屬性。</span><span class="sxs-lookup"><span data-stu-id="6f537-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="6f537-346">從`Default.aspx`按一下檢視詳細資料 連結以 Chai 茶杯的飲料，檢視產品連結，然後按一下。</span><span class="sxs-lookup"><span data-stu-id="6f537-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="6f537-347">階層圖 19 所示，包含目前的站台對應區段 （Chai 茶杯） 以及其上階： Beverages 和所有類別目錄。</span><span class="sxs-lookup"><span data-stu-id="6f537-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>


<span data-ttu-id="6f537-348">[![階層連結現在會使用自訂站台對應提供者 NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="6f537-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.png)</span></span>

<span data-ttu-id="6f537-349">**圖 19**： 階層連結現在會使用自訂站台地圖提供者`NorthwindSiteMapProvider`([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="6f537-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image22.png))</span></span>


<span data-ttu-id="6f537-350">除了 SiteMapPath，例如功能表和 TreeView 控制項可使用其他瀏覽使用者介面項目。</span><span class="sxs-lookup"><span data-stu-id="6f537-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="6f537-351">`Default.aspx`， `ProductsByCategory.aspx`，和`ProductDetails.aspx`頁面下載此教學課程中，例如，在所有包含功能表控制項 （請參閱圖 20）。</span><span class="sxs-lookup"><span data-stu-id="6f537-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="6f537-352">請參閱[檢查 ASP.NET 2.0 的網站瀏覽功能](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)和[使用站台瀏覽控制項](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx)區段[ASP.NET 2.0 快速入門](https://quickstarts.asp.net/QuickStartv20/aspnet/)的更深入探討導覽控制與 ASP.NET 2.0 中的站台對應系統。</span><span class="sxs-lookup"><span data-stu-id="6f537-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>


<span data-ttu-id="6f537-353">[![此功能表控制項列出每個分類和產品](building-a-custom-database-driven-site-map-provider-vb/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="6f537-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-vb/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image28.gif)</span></span>

<span data-ttu-id="6f537-354">**圖 20**: 功能表控制項列出每個分類和產品 ([按一下以檢視完整大小的影像](building-a-custom-database-driven-site-map-provider-vb/_static/image30.gif))</span><span class="sxs-lookup"><span data-stu-id="6f537-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image30.gif))</span></span>


<span data-ttu-id="6f537-355">如稍早在本教學課程中所述，可以透過程式設計方式存取網站導覽結構`SiteMap`類別。</span><span class="sxs-lookup"><span data-stu-id="6f537-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="6f537-356">下列程式碼會傳回根`SiteMapNode`的預設提供者：</span><span class="sxs-lookup"><span data-stu-id="6f537-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>


[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample8.vb)]

<span data-ttu-id="6f537-357">因為`AspNetXmlSiteMapProvider`是預設提供者應用程式中，如上述程式碼會傳回中所定義的根節點`Web.sitemap`。</span><span class="sxs-lookup"><span data-stu-id="6f537-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="6f537-358">若要參考非預設的站台地圖提供者，使用`SiteMap`類別 s [ `Providers`屬性](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx)就像這樣：</span><span class="sxs-lookup"><span data-stu-id="6f537-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) like so:</span></span>


[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample9.vb)]

<span data-ttu-id="6f537-359">其中*名稱*自訂站台地圖提供者 (Northwind，web 應用程式) 的名稱。</span><span class="sxs-lookup"><span data-stu-id="6f537-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="6f537-360">若要存取站台對應提供者專屬的成員，請使用`SiteMap.Providers["name"]`擷取提供者執行個體，並再將它轉換成適當的型別。</span><span class="sxs-lookup"><span data-stu-id="6f537-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="6f537-361">例如，若要顯示`NorthwindSiteMapProvider`s`CachedDate`屬性在 ASP.NET 網頁，可使用下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="6f537-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>


[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample10.vb)]

> [!NOTE]
> <span data-ttu-id="6f537-362">請務必測試 SQL 快取相依性功能。</span><span class="sxs-lookup"><span data-stu-id="6f537-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="6f537-363">之後造訪`Default.aspx`， `ProductsByCategory.aspx`，和`ProductDetails.aspx`頁面，請移至其中一個編輯、 插入和刪除 > 一節中的教學課程，以及編輯分類或產品的名稱。</span><span class="sxs-lookup"><span data-stu-id="6f537-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="6f537-364">然後返回的其中一個在分頁`SiteMapProvider`資料夾。</span><span class="sxs-lookup"><span data-stu-id="6f537-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="6f537-365">假設要注意基礎資料庫變更的輪詢機制，如有充裕的時間，站台對應應該更新以顯示新的產品或分類名稱。</span><span class="sxs-lookup"><span data-stu-id="6f537-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>


## <a name="summary"></a><span data-ttu-id="6f537-366">總結</span><span class="sxs-lookup"><span data-stu-id="6f537-366">Summary</span></span>

<span data-ttu-id="6f537-367">ASP.NET 2.0 s 站台地圖功能包括`SiteMap`類別的數字的內建瀏覽 Web 控制項，和預設站台地圖提供者預期的站台對應資訊保存為 XML 檔案。</span><span class="sxs-lookup"><span data-stu-id="6f537-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="6f537-368">若要使用來自其他來源這類資料庫中的站台對應資訊，將應用程式的架構或遠端的 Web 服務，我們必須建立自訂的站台對應提供者。</span><span class="sxs-lookup"><span data-stu-id="6f537-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="6f537-369">這項作業包括建立直接或間接衍生的類別從`SiteMapProvider`類別。</span><span class="sxs-lookup"><span data-stu-id="6f537-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="6f537-370">本教學課程中我們可了解如何建立自訂站台對應提供者基礎挑選從應用程式架構的產品和類別目錄資訊的站台對應。</span><span class="sxs-lookup"><span data-stu-id="6f537-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="6f537-371">我們提供者的擴充`StaticSiteMapProvider`類別並產生建立`BuildSiteMap`擷取資料的方法建構網站導覽階層架構，並快取所產生的結構，在類別層級變數。</span><span class="sxs-lookup"><span data-stu-id="6f537-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="6f537-372">我們要使其失效的快取使用的回呼函式與 SQL 快取相依性結構時的基本`Categories`或`Products`資料修改。</span><span class="sxs-lookup"><span data-stu-id="6f537-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="6f537-373">祝您程式設計 ！</span><span class="sxs-lookup"><span data-stu-id="6f537-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="6f537-374">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="6f537-374">Further Reading</span></span>

<span data-ttu-id="6f537-375">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="6f537-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="6f537-376">[在 SQL Server 中儲存站台對應](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/)和[等您 ve SQL 站台地圖提供者](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span><span class="sxs-lookup"><span data-stu-id="6f537-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="6f537-377">ASP.NET 2.0 看 s 提供者模型</span><span class="sxs-lookup"><span data-stu-id="6f537-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="6f537-378">提供者的工具組</span><span class="sxs-lookup"><span data-stu-id="6f537-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/asp.net/aa336558.aspx)
- [<span data-ttu-id="6f537-379">檢查 ASP.NET 2.0 的網站瀏覽功能</span><span class="sxs-lookup"><span data-stu-id="6f537-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="6f537-380">關於作者</span><span class="sxs-lookup"><span data-stu-id="6f537-380">About the Author</span></span>

<span data-ttu-id="6f537-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP/ASP.NET 書籍和的創辦[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已從 1998 年使用 Microsoft Web 技術。</span><span class="sxs-lookup"><span data-stu-id="6f537-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="6f537-382">Scott 可做為獨立顧問、 訓練和寫入器。</span><span class="sxs-lookup"><span data-stu-id="6f537-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="6f537-383">他最新的活頁簿[ *Sam 教導您自己 ASP.NET 2.0 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="6f537-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="6f537-384">他可以在達到[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或透過他的部落格，這可以在找到[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="6f537-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="6f537-385">特別感謝</span><span class="sxs-lookup"><span data-stu-id="6f537-385">Special Thanks To</span></span>

<span data-ttu-id="6f537-386">許多有用的檢閱者已檢閱本教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="6f537-386">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="6f537-387">此教學課程中的前導檢閱者已 Dave Gardner、 Zack Jones、 本文菲和 Bernadette Leigh。</span><span class="sxs-lookup"><span data-stu-id="6f537-387">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="6f537-388">檢閱我即將推出的 MSDN 文件有興趣嗎？</span><span class="sxs-lookup"><span data-stu-id="6f537-388">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="6f537-389">如果是這樣，卸除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="6f537-389">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="6f537-390">上一步</span><span class="sxs-lookup"><span data-stu-id="6f537-390">Previous</span></span>](building-a-custom-database-driven-site-map-provider-cs.md)
