---
uid: web-forms/overview/data-access/working-with-batched-data/batch-updating-cs
title: 批次更新 (C#) |Microsoft 文件
author: rick-anderson
description: 了解如何更新在單一作業中的多個資料庫記錄。 在使用者介面層級中，我們會建置其中每個資料列都可編輯的 GridView。 在資料...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/26/2007
ms.topic: article
ms.assetid: 4e849bcc-c557-4bc3-937e-f7453ee87265
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-updating-cs
msc.type: authoredcontent
ms.openlocfilehash: 9f1bad4f0b58175a8437ebfedf161db057bb2bd2
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/06/2018
ms.locfileid: "30888548"
---
<a name="batch-updating-c"></a><span data-ttu-id="c8e1f-105">批次更新 (C#)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-105">Batch Updating (C#)</span></span>
====================
<span data-ttu-id="c8e1f-106">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c8e1f-107">[下載程式碼](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_CS.zip)或[下載 PDF](batch-updating-cs/_static/datatutorial64cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-107">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_CS.zip) or [Download PDF](batch-updating-cs/_static/datatutorial64cs1.pdf)</span></span>

> <span data-ttu-id="c8e1f-108">了解如何更新在單一作業中的多個資料庫記錄。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-108">Learn how to update multiple database records in a single operation.</span></span> <span data-ttu-id="c8e1f-109">在使用者介面層級中，我們會建置其中每個資料列都可編輯的 GridView。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-109">In the User Interface Layer we build a GridView where each row is editable.</span></span> <span data-ttu-id="c8e1f-110">資料存取層中我們會換行以確保所有更新會都成功，或所有更新會都回復在交易內的多個更新作業。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-110">In the Data Access Layer we wrap the multiple Update operations within a transaction to ensure that all updates succeed or all updates are rolled back.</span></span>


## <a name="introduction"></a><span data-ttu-id="c8e1f-111">簡介</span><span class="sxs-lookup"><span data-stu-id="c8e1f-111">Introduction</span></span>

<span data-ttu-id="c8e1f-112">在[前述教學課程](wrapping-database-modifications-within-a-transaction-cs.md)我們可了解如何將延伸資料的存取層，若要加入的資料庫交易支援。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-112">In the [preceding tutorial](wrapping-database-modifications-within-a-transaction-cs.md) we saw how to extend the Data Access Layer to add support for database transactions.</span></span> <span data-ttu-id="c8e1f-113">資料庫交易保證一系列的資料修改陳述式將會被視為一個不可部分完成的作業，可確保所有的修改將會失敗，或所有將會成功。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-113">Database transactions guarantee that a series of data modification statements will be treated as one atomic operation, which ensures that all modifications will fail or all will succeed.</span></span> <span data-ttu-id="c8e1f-114">利用此低階 DAL 功能的方式，我們重新已準備好開啟我們注意到建立批次資料修改的介面。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-114">With this low-level DAL functionality out of the way, we re ready to turn our attention to creating batch data modification interfaces.</span></span>

<span data-ttu-id="c8e1f-115">在本教學課程中，我們會建置的 GridView，其中每個資料列都可編輯 （請參閱圖 1）。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-115">In this tutorial we'll build a GridView where each row is editable (see Figure 1).</span></span> <span data-ttu-id="c8e1f-116">因為編輯的資料行不需要時，會在其編輯介面上，該處 s 轉譯每個資料列，更新和取消按鈕。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-116">Since each row is rendered in its editing interface, there s no need for a column of Edit, Update, and Cancel buttons.</span></span> <span data-ttu-id="c8e1f-117">相反地，有兩個更新的產品按鈕頁面上，按一下時，列舉的 GridView 資料列，並更新資料庫。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-117">Instead, there are two Update Products buttons on the page that, when clicked, enumerate the GridView rows and update the database.</span></span>


<span data-ttu-id="c8e1f-118">[![在 GridView 中的每個資料列是編輯](batch-updating-cs/_static/image1.gif)](batch-updating-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-118">[![Each Row in the GridView is Editable](batch-updating-cs/_static/image1.gif)](batch-updating-cs/_static/image1.png)</span></span>

<span data-ttu-id="c8e1f-119">**圖 1**: GridView 中的每個資料列是編輯 ([按一下以檢視完整大小的影像](batch-updating-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="c8e1f-119">**Figure 1**: Each Row in the GridView is Editable ([Click to view full-size image](batch-updating-cs/_static/image2.png))</span></span>


<span data-ttu-id="c8e1f-120">Let s 開始 ！</span><span class="sxs-lookup"><span data-stu-id="c8e1f-120">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="c8e1f-121">在[執行批次更新](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md)教學課程中我們建立批次編輯介面使用 DataList 控制項。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-121">In the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) tutorial we created a batch editing interface using the DataList control.</span></span> <span data-ttu-id="c8e1f-122">本教學課程會不同於先前的其中一個，是使用 GridView 且在交易範圍內執行批次更新。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-122">This tutorial differs from the previous one in that is uses a GridView and the batch update is performed within the scope of a transaction.</span></span> <span data-ttu-id="c8e1f-123">完成本教學課程之後建議您將返回先前的教學課程，並更新它使用的資料庫與交易相關功能加入在先前的教學課程。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-123">After completing this tutorial I encourage you to return to the earlier tutorial and update it to use the database transaction-related functionality added in the preceding tutorial.</span></span>


## <a name="examining-the-steps-for-making-all-gridview-rows-editable"></a><span data-ttu-id="c8e1f-124">檢查進行所有的 GridView 資料列可編輯的步驟</span><span class="sxs-lookup"><span data-stu-id="c8e1f-124">Examining the Steps for Making All GridView Rows Editable</span></span>

<span data-ttu-id="c8e1f-125">中所述[概觀的插入、 更新和刪除資料](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)教學課程中，GridView 提供編輯每個資料列依其基礎資料的內建支援。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-125">As discussed in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, the GridView offers built-in support for editing its underlying data on a per-row basis.</span></span> <span data-ttu-id="c8e1f-126">就內部而言，GridView 記哪些資料列是透過可編輯其[`EditIndex`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-126">Internally, the GridView notes what row is editable through its [`EditIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span></span> <span data-ttu-id="c8e1f-127">GridView 繫結至其資料來源，因為它會檢查以查看的資料列索引是否等於值的每個資料列`EditIndex`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-127">As the GridView is being bound to its data source, it checks each row to see if the index of the row equals the value of `EditIndex`.</span></span> <span data-ttu-id="c8e1f-128">如果是的話，該資料列的欄位就會使用呈現其編輯介面。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-128">If so, that row s fields are rendered using their editing interfaces.</span></span> <span data-ttu-id="c8e1f-129">編輯介面是文字方塊 BoundFields，其`Text`BoundField s 所指定的資料欄位的值指派給屬性`DataField`屬性。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-129">For BoundFields, the editing interface is a TextBox whose `Text` property is assigned the value of the data field specified by the BoundField s `DataField` property.</span></span> <span data-ttu-id="c8e1f-130">TemplateFields，如`EditItemTemplate`用來取代`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-130">For TemplateFields, the `EditItemTemplate` is used in place of the `ItemTemplate`.</span></span>

<span data-ttu-id="c8e1f-131">前文提過編輯工作流程會啟動，當使用者按一下資料列 s [編輯] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-131">Recall that the editing workflow starts when a user clicks a row s Edit button.</span></span> <span data-ttu-id="c8e1f-132">這會導致回傳，請設定 GridView 的`EditIndex`屬性設為按下後的資料列的索引並重新繫結至資料格的資料。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-132">This causes a postback, sets the GridView s `EditIndex` property to the clicked row s index, and rebinds the data to the grid.</span></span> <span data-ttu-id="c8e1f-133">資料列 s [取消] 按鈕按一下的時間，在回傳`EditIndex`設定的值為`-1`重新繫結至資料格的資料。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-133">When a row s Cancel button is clicked, on postback the `EditIndex` is set to a value of `-1` before rebinding the data to the grid.</span></span> <span data-ttu-id="c8e1f-134">GridView s 資料列開始索引零，因為設定`EditIndex`至`-1`在唯讀模式中顯示的 GridView 的效果。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-134">Since the GridView s rows start indexing at zero, setting `EditIndex` to `-1` has the effect of displaying the GridView in read-only mode.</span></span>

<span data-ttu-id="c8e1f-135">`EditIndex`屬性適用於每個資料列編輯，但不是編輯批次。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-135">The `EditIndex` property works well for per-row editing, but is not designed for batch editing.</span></span> <span data-ttu-id="c8e1f-136">若要讓整個 GridView 可編輯，我們必須將每個資料列呈現使用其編輯介面。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-136">To make the entire GridView editable, we need to have each row render using its editing interface.</span></span> <span data-ttu-id="c8e1f-137">完成這項作業的最簡單方式是建立每個可編輯欄位，實作中定義其編輯介面具有為 TemplateField `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-137">The easiest way to accomplish this is to create where each editable field is implemented as a TemplateField with its editing interface defined in the `ItemTemplate`.</span></span>

<span data-ttu-id="c8e1f-138">下一步 透過幾個步驟我們將建立完全可編輯的 GridView。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-138">Over the next several steps we'll create a completely editable GridView.</span></span> <span data-ttu-id="c8e1f-139">在步驟 1 中我們將開始建立 GridView 以及其 ObjectDataSource，並將其 BoundFields 和 CheckBoxField 轉換成 TemplateFields。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-139">In Step 1 we'll start by creating the GridView and its ObjectDataSource and convert its BoundFields and CheckBoxField into TemplateFields.</span></span> <span data-ttu-id="c8e1f-140">步驟 2 和 3 中，我們會說明編輯介面從 TemplateFields`EditItemTemplate`以其`ItemTemplate`s。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-140">In Steps 2 and 3 we'll move the editing interfaces from the TemplateFields `EditItemTemplate` s to their `ItemTemplate` s.</span></span>

## <a name="step-1-displaying-product-information"></a><span data-ttu-id="c8e1f-141">步驟 1： 顯示產品資訊</span><span class="sxs-lookup"><span data-stu-id="c8e1f-141">Step 1: Displaying Product Information</span></span>

<span data-ttu-id="c8e1f-142">我們會擔心建立 GridView 之前的資料列都可以編輯，讓 s 首先會只顯示產品資訊。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-142">Before we worry about creating a GridView where are rows are editable, let s start by simply displaying the product information.</span></span> <span data-ttu-id="c8e1f-143">開啟`BatchUpdate.aspx`頁面`BatchData`資料夾，然後從 [工具箱] 拖曳至設計工具拖曳 GridView。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-143">Open the `BatchUpdate.aspx` page in the `BatchData` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="c8e1f-144">設定 GridView s`ID`至`ProductsGrid`和從其智慧標籤上，選擇 繫結至名為新 ObjectDataSource `ProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-144">Set the GridView s `ID` to `ProductsGrid` and, from its smart tag, choose to bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="c8e1f-145">設定要擷取其資料從 ObjectDataSource`ProductsBLL`類別的`GetProducts`方法。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-145">Configure the ObjectDataSource to retrieve its data from the `ProductsBLL` class s `GetProducts` method.</span></span>


<span data-ttu-id="c8e1f-146">[![設定使用 ProductsBLL 類別 ObjectDataSource](batch-updating-cs/_static/image2.gif)](batch-updating-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-146">[![Configure the ObjectDataSource to Use the ProductsBLL Class](batch-updating-cs/_static/image2.gif)](batch-updating-cs/_static/image3.png)</span></span>

<span data-ttu-id="c8e1f-147">**圖 2**： 設定要使用 ObjectDataSource`ProductsBLL`類別 ([按一下以檢視完整大小的影像](batch-updating-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="c8e1f-147">**Figure 2**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](batch-updating-cs/_static/image4.png))</span></span>


<span data-ttu-id="c8e1f-148">[![擷取產品資料使用 GetProducts 方法](batch-updating-cs/_static/image3.gif)](batch-updating-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-148">[![Retrieve the Product Data Using the GetProducts Method](batch-updating-cs/_static/image3.gif)](batch-updating-cs/_static/image5.png)</span></span>

<span data-ttu-id="c8e1f-149">**圖 3**： 擷取產品資料使用`GetProducts`方法 ([按一下以檢視完整大小的影像](batch-updating-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c8e1f-149">**Figure 3**: Retrieve the Product Data Using the `GetProducts` Method ([Click to view full-size image](batch-updating-cs/_static/image6.png))</span></span>


<span data-ttu-id="c8e1f-150">GridView，像是 ObjectDataSource 的修改功能專為每個資料列為基礎。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-150">Like the GridView, the ObjectDataSource s modification features are designed to work on a per-row basis.</span></span> <span data-ttu-id="c8e1f-151">若要更新的一組記錄，我們需要在批次的資料，並將其傳遞給 BLL ASP.NET 頁面 s 程式碼後置類別中撰寫許多程式碼。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-151">In order to update a set of records, we'll need to write a bit of code in the ASP.NET page s code-behind class that batches the data and passes it to the BLL.</span></span> <span data-ttu-id="c8e1f-152">因此，下拉式清單中設定 ObjectDataSource s 為 (None) UPDATE、 INSERT 和 DELETE 的索引標籤。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-152">Therefore, set the drop-down lists in the ObjectDataSource s UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="c8e1f-153">按一下 [完成] 5d; 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-153">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="c8e1f-154">[![設定下拉式清單中更新、 插入和刪除 （無） 索引標籤](batch-updating-cs/_static/image4.gif)](batch-updating-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-154">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-updating-cs/_static/image4.gif)](batch-updating-cs/_static/image7.png)</span></span>

<span data-ttu-id="c8e1f-155">**圖 4**： 下拉式清單中設定更新、 插入和刪除的索引標籤 （無） ([按一下以檢視完整大小的影像](batch-updating-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="c8e1f-155">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-cs/_static/image8.png))</span></span>


<span data-ttu-id="c8e1f-156">完成設定資料來源精靈之後，ObjectDataSource s 宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="c8e1f-156">After completing the Configure Data Source wizard, the ObjectDataSource s declarative markup should look like the following:</span></span>


[!code-aspx[Main](batch-updating-cs/samples/sample1.aspx)]

<span data-ttu-id="c8e1f-157">完成設定資料來源精靈也會造成 Visual Studio 建立 BoundFields 及其產品資料欄位在 GridView。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-157">Completing the Configure Data Source wizard also causes Visual Studio to create BoundFields and a CheckBoxField for the product data fields in the GridView.</span></span> <span data-ttu-id="c8e1f-158">本教學課程，可讓 s 只允許使用者檢視和編輯產品的名稱、 類別、 價格和已停止的狀態。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-158">For this tutorial, let s only allow the user to view and edit the product s name, category, price, and discontinued status.</span></span> <span data-ttu-id="c8e1f-159">移除以外的所有`ProductName`， `CategoryName`， `UnitPrice`，和`Discontinued`欄位和重新命名`HeaderText`的前三個屬性欄位產品、 類別和價格，分別。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-159">Remove all but the `ProductName`, `CategoryName`, `UnitPrice`, and `Discontinued` fields and rename the `HeaderText` properties of the first three fields to Product, Category, and Price, respectively.</span></span> <span data-ttu-id="c8e1f-160">最後，請檢查 GridView s 智慧標籤中的啟用分頁，並啟用排序核取方塊。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-160">Lastly, check the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="c8e1f-161">在 GridView 此時有三個 BoundFields (`ProductName`， `CategoryName`，和`UnitPrice`) 及其 (`Discontinued`)。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-161">At this point the GridView has three BoundFields (`ProductName`, `CategoryName`, and `UnitPrice`) and a CheckBoxField (`Discontinued`).</span></span> <span data-ttu-id="c8e1f-162">我們需要將這四個欄位轉換成 TemplateFields，然後將編輯介面移從 TemplateField s`EditItemTemplate`至其`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-162">We need to convert these four fields into TemplateFields and then move the editing interface from the TemplateField s `EditItemTemplate` to its `ItemTemplate`.</span></span>

> [!NOTE]
> <span data-ttu-id="c8e1f-163">我們已探索的建立和自訂 TemplateFields 中的[自訂的資料修改介面](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-163">We explored creating and customizing TemplateFields in the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial.</span></span> <span data-ttu-id="c8e1f-164">我們將逐步 BoundFields 及其轉換 TemplateFields 步驟，並定義其編輯介面在其`ItemTemplate`s，但如果您碰到或需要重新整理程式，不要直接以回頭參考此較早的教學課程。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-164">We'll walk through the steps of converting the BoundFields and CheckBoxField into TemplateFields and defining their editing interfaces in their `ItemTemplate` s, but if you get stuck or need a refresher, don t hesitate to refer back to this earlier tutorial.</span></span>


<span data-ttu-id="c8e1f-165">從 GridView s 智慧標籤，按一下 編輯資料行連結以開啟 欄位 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-165">From the GridView s smart tag, click the Edit Columns link to open the Fields dialog box.</span></span> <span data-ttu-id="c8e1f-166">接下來，選取每個欄位，並按一下轉換此欄位為 TemplateField 連結。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-166">Next, select each field and click the Convert this field into a TemplateField link.</span></span>


![現有 BoundFields 及其轉換為 TemplateField](batch-updating-cs/_static/image5.gif)

<span data-ttu-id="c8e1f-168">**圖 5**： 現有 BoundFields 及其轉換為 TemplateField</span><span class="sxs-lookup"><span data-stu-id="c8e1f-168">**Figure 5**: Convert the Existing BoundFields and CheckBoxField Into TemplateField</span></span>


<span data-ttu-id="c8e1f-169">現在，每個欄位都為 TemplateField，我們準備好要移動的編輯介面從`EditItemTemplate`s `ItemTemplate` s。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-169">Now that each field is a TemplateField, we re ready to move the editing interface from the `EditItemTemplate` s to the `ItemTemplate` s.</span></span>

## <a name="step-2-creating-theproductnameunitprice-anddiscontinuedediting-interfaces"></a><span data-ttu-id="c8e1f-170">步驟 2： 建立`ProductName`，`UnitPrice`，和`Discontinued`編輯介面</span><span class="sxs-lookup"><span data-stu-id="c8e1f-170">Step 2: Creating the`ProductName`,`UnitPrice`, and`Discontinued`Editing Interfaces</span></span>

<span data-ttu-id="c8e1f-171">建立`ProductName`， `UnitPrice`，和`Discontinued`編輯介面此步驟中的主題，而很簡單，因為每個介面已經定義於 TemplateField 的`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-171">Creating the `ProductName`, `UnitPrice`, and `Discontinued` editing interfaces are the topic of this step and are pretty straightforward, as each interface is already defined in the TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="c8e1f-172">建立`CategoryName`編輯介面是稍微複雜，因為我們要建立 DropDownList 一個適用的類別目錄。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-172">Creating the `CategoryName` editing interface is a bit more involved since we need to create a DropDownList of the applicable categories.</span></span> <span data-ttu-id="c8e1f-173">這`CategoryName`編輯介面在步驟 3 中處理。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-173">This `CategoryName` editing interface is tackled in Step 3.</span></span>

<span data-ttu-id="c8e1f-174">將開頭的 s `ProductName` TemplateField。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-174">Let s start with the `ProductName` TemplateField.</span></span> <span data-ttu-id="c8e1f-175">按一下 [編輯樣板] 連結，從 GridView s 智慧標籤，然後向下鑽研至`ProductName`TemplateField 的`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-175">Click on the Edit Templates link from the GridView s smart tag and drill down to the `ProductName` TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="c8e1f-176">選取文字方塊中，將它複製到剪貼簿，然後將它貼到`ProductName`TemplateField 的`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-176">Select the TextBox, copy it to the clipboard, and then paste it to the `ProductName` TemplateField s `ItemTemplate`.</span></span> <span data-ttu-id="c8e1f-177">變更文字方塊 s`ID`屬性`ProductName`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-177">Change the TextBox s `ID` property to `ProductName`.</span></span>

<span data-ttu-id="c8e1f-178">接下來，加入至 RequiredFieldValidator`ItemTemplate`以確保使用者提供值，為每個產品 s 的名稱。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-178">Next, add a RequiredFieldValidator to the `ItemTemplate` to ensure that the user provides a value for each product s name.</span></span> <span data-ttu-id="c8e1f-179">設定`ControlToValidate`屬性 ProductName，`ErrorMessage`屬性，您必須提供產品的名稱。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-179">Set the `ControlToValidate` property to ProductName, the `ErrorMessage` property to You must provide the product's name.</span></span> <span data-ttu-id="c8e1f-180">和`Text`屬性\*。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-180">and the `Text` property to \*.</span></span> <span data-ttu-id="c8e1f-181">進行這些新增項目後`ItemTemplate`，畫面看起來應該類似於圖 6。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-181">After making these additions to the `ItemTemplate`, your screen should look similar to Figure 6.</span></span>


<span data-ttu-id="c8e1f-182">[![ProductName TemplateField 現在包含文字方塊和 RequiredFieldValidator](batch-updating-cs/_static/image6.gif)](batch-updating-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-182">[![The ProductName TemplateField Now Includes a TextBox and a RequiredFieldValidator](batch-updating-cs/_static/image6.gif)](batch-updating-cs/_static/image9.png)</span></span>

<span data-ttu-id="c8e1f-183">**圖 6**: `ProductName` TemplateField 現在包含文字方塊和 RequiredFieldValidator ([按一下以檢視完整大小的影像](batch-updating-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="c8e1f-183">**Figure 6**: The `ProductName` TemplateField Now Includes a TextBox and a RequiredFieldValidator ([Click to view full-size image](batch-updating-cs/_static/image10.png))</span></span>


<span data-ttu-id="c8e1f-184">如`UnitPrice`藉由複製從文字方塊中編輯介面，開始`EditItemTemplate`至`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-184">For the `UnitPrice` editing interface, start by copying the TextBox from the `EditItemTemplate` to the `ItemTemplate`.</span></span> <span data-ttu-id="c8e1f-185">接下來，將 $ 前面的文字方塊和設定其`ID`UnitPrice 的屬性和其`Columns`8 的屬性。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-185">Next, place a $ in front of the TextBox and set its `ID` property to UnitPrice and its `Columns` property to 8 .</span></span>

<span data-ttu-id="c8e1f-186">也新增至 CompareValidator `UnitPrice` s`ItemTemplate`以確保使用者所輸入的值大於或等於 $0.00 有效貨幣值。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-186">Also add a CompareValidator to the `UnitPrice` s `ItemTemplate` to ensure that the value entered by the user is a valid currency value greater than or equal to $0.00.</span></span> <span data-ttu-id="c8e1f-187">設定驗證程式 s`ControlToValidate`屬性 UnitPrice，其`ErrorMessage`屬性，您必須輸入有效的貨幣值。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-187">Set the validator s `ControlToValidate` property to UnitPrice, its `ErrorMessage` property to You must enter a valid currency value.</span></span> <span data-ttu-id="c8e1f-188">請省略任何貨幣符號。，其`Text`屬性\*、 其`Type`屬性`Currency`、 其`Operator`屬性`GreaterThanEqual`，且其`ValueToCompare`屬性設為 0。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-188">Please omit any currency symbols., its `Text` property to \*, its `Type` property to `Currency`, its `Operator` property to `GreaterThanEqual`, and its `ValueToCompare` property to 0 .</span></span>


<span data-ttu-id="c8e1f-189">[![加入 CompareValidator 確保價格輸入非負值的貨幣值](batch-updating-cs/_static/image7.gif)](batch-updating-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-189">[![Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value](batch-updating-cs/_static/image7.gif)](batch-updating-cs/_static/image11.png)</span></span>

<span data-ttu-id="c8e1f-190">**圖 7**： 加入 CompareValidator 確保價格輸入非負值的貨幣值 ([按一下以檢視完整大小的影像](batch-updating-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="c8e1f-190">**Figure 7**: Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value ([Click to view full-size image](batch-updating-cs/_static/image12.png))</span></span>


<span data-ttu-id="c8e1f-191">如`Discontinued`TemplateField，您可以使用已經定義中的核取方塊`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-191">For the `Discontinued` TemplateField you can use the CheckBox already defined in the `ItemTemplate`.</span></span> <span data-ttu-id="c8e1f-192">直接將其`ID`至 Discontinued 及其`Enabled`屬性`true`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-192">Simply set its `ID` to Discontinued and its `Enabled` property to `true`.</span></span>

## <a name="step-3-creating-thecategorynameediting-interface"></a><span data-ttu-id="c8e1f-193">步驟 3： 建立`CategoryName`編輯介面</span><span class="sxs-lookup"><span data-stu-id="c8e1f-193">Step 3: Creating the`CategoryName`Editing Interface</span></span>

<span data-ttu-id="c8e1f-194">中的編輯介面`CategoryName`TemplateField s`EditItemTemplate`包含顯示之值的文字方塊`CategoryName`資料欄位。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-194">The editing interface in the `CategoryName` TemplateField s `EditItemTemplate` contains a TextBox that displays the value of the `CategoryName` data field.</span></span> <span data-ttu-id="c8e1f-195">我們需要列出可能的類別目錄的 DropDownList 以取代此項。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-195">We need to replace this with a DropDownList that lists the possible categories.</span></span>

> [!NOTE]
> <span data-ttu-id="c8e1f-196">[自訂的資料修改介面](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md)教學課程包含自訂範本以包含而不是 TextBox 的 DropDownList 更徹底且更完整討論。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-196">The [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial contains a more thorough and complete discussion on customizing a template to include a DropDownList as opposed to a TextBox.</span></span> <span data-ttu-id="c8e1f-197">這裡的步驟完成時，他們會看到 tersely。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-197">While the steps here are complete, they are presented tersely.</span></span> <span data-ttu-id="c8e1f-198">如建立並設定分類 DropDownList 更深入探討，請參閱上一步[自訂的資料修改介面](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-198">For a more in-depth look at creating and configuring the categories DropDownList, refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial.</span></span>


<span data-ttu-id="c8e1f-199">從工具箱拖曳至拖曳 DropDownList `CategoryName` TemplateField s `ItemTemplate`，設定其`ID`至`Categories`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-199">Drag a DropDownList from the Toolbox onto the `CategoryName` TemplateField s `ItemTemplate`, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="c8e1f-200">此時我們會定義通常 DropDownLists 的資料來源透過其智慧標籤上，建立新的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-200">At this point we would usually define the DropDownLists s data source through its smart tag, creating a new ObjectDataSource.</span></span> <span data-ttu-id="c8e1f-201">不過，這會增加內 ObjectDataSource `ItemTemplate`，以產生每個 GridView 資料列建立 ObjectDataSource 執行個體。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-201">However, this will add the ObjectDataSource within the `ItemTemplate`, which will result in an ObjectDataSource instance created for each GridView row.</span></span> <span data-ttu-id="c8e1f-202">相反地，可讓建立 GridView 的 TemplateFields 之外 ObjectDataSource s。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-202">Instead, let s create the ObjectDataSource outside of the GridView s TemplateFields.</span></span> <span data-ttu-id="c8e1f-203">結束樣板編輯，然後從 [工具箱] 拖曳至設計工具下方拖曳 ObjectDataSource `ProductsDataSource` ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-203">End the template editing and drag an ObjectDataSource from the Toolbox onto the Designer beneath the `ProductsDataSource` ObjectDataSource.</span></span> <span data-ttu-id="c8e1f-204">命名新 ObjectDataSource`CategoriesDataSource`並將它設定為使用`CategoriesBLL`類別的`GetCategories`方法。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-204">Name the new ObjectDataSource `CategoriesDataSource` and configure it to use the `CategoriesBLL` class s `GetCategories` method.</span></span>


<span data-ttu-id="c8e1f-205">[![設定要使用 CategoriesBLL Clas ObjectDataSource](batch-updating-cs/_static/image8.gif)](batch-updating-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-205">[![Configure the ObjectDataSource to Use the CategoriesBLL Clas](batch-updating-cs/_static/image8.gif)](batch-updating-cs/_static/image13.png)</span></span>

<span data-ttu-id="c8e1f-206">**圖 8**： 設定要使用 ObjectDataSource `CategoriesBLL` Clas ([按一下以檢視完整大小的影像](batch-updating-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="c8e1f-206">**Figure 8**: Configure the ObjectDataSource to Use the `CategoriesBLL` Clas ([Click to view full-size image](batch-updating-cs/_static/image14.png))</span></span>


<span data-ttu-id="c8e1f-207">[![擷取使用 GetCategories 方法的類別目錄資料](batch-updating-cs/_static/image9.gif)](batch-updating-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-207">[![Retrieve the Category Data Using the GetCategories Method](batch-updating-cs/_static/image9.gif)](batch-updating-cs/_static/image15.png)</span></span>

<span data-ttu-id="c8e1f-208">**圖 9**： 擷取類別目錄資料使用`GetCategories`方法 ([按一下以檢視完整大小的影像](batch-updating-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="c8e1f-208">**Figure 9**: Retrieve the Category Data Using the `GetCategories` Method ([Click to view full-size image](batch-updating-cs/_static/image16.png))</span></span>


<span data-ttu-id="c8e1f-209">因為此 ObjectDataSource 僅用來擷取資料，設定下拉式清單中更新和刪除索引標籤，為 （無）。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-209">Since this ObjectDataSource is used merely to retrieve data, set the drop-down lists in the UPDATE and DELETE tabs to (None).</span></span> <span data-ttu-id="c8e1f-210">按一下 [完成] 5d; 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-210">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="c8e1f-211">[![設定下拉式清單，更新和刪除索引標籤，為 （無）](batch-updating-cs/_static/image10.gif)](batch-updating-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-211">[![Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None)](batch-updating-cs/_static/image10.gif)](batch-updating-cs/_static/image17.png)</span></span>

<span data-ttu-id="c8e1f-212">**圖 10**： 下拉式清單中設定的更新和刪除的索引標籤 （無） ([按一下以檢視完整大小的影像](batch-updating-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="c8e1f-212">**Figure 10**: Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-cs/_static/image18.png))</span></span>


<span data-ttu-id="c8e1f-213">完成精靈之後`CategoriesDataSource`s 宣告式標記應該看起來如下：</span><span class="sxs-lookup"><span data-stu-id="c8e1f-213">After completing the wizard, the `CategoriesDataSource` s declarative markup should look like the following:</span></span>


[!code-aspx[Main](batch-updating-cs/samples/sample2.aspx)]

<span data-ttu-id="c8e1f-214">與`CategoriesDataSource`建立及設定，回到`CategoryName`TemplateField 的`ItemTemplate`和 DropDownList s 智慧標籤，按一下 選擇資料來源連結。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-214">With the `CategoriesDataSource` created and configured, return to the `CategoryName` TemplateField s `ItemTemplate` and, from the DropDownList s smart tag, click on the Choose Data Source link.</span></span> <span data-ttu-id="c8e1f-215">在資料來源組態精靈中，選取`CategoriesDataSource`從第一個下拉式清單選項，然後選擇有`CategoryName`用來顯示和`CategoryID`做為值。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-215">In the Data Source Configuration wizard, select the `CategoriesDataSource` option from the first drop-down list and choose to have `CategoryName` used for the display and `CategoryID` as the value.</span></span>


<span data-ttu-id="c8e1f-216">[![繫結至 CategoriesDataSource 的 DropDownList](batch-updating-cs/_static/image11.gif)](batch-updating-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-216">[![Bind the DropDownList to the CategoriesDataSource](batch-updating-cs/_static/image11.gif)](batch-updating-cs/_static/image19.png)</span></span>

<span data-ttu-id="c8e1f-217">**圖 11**： 繫結至 DropDownList `CategoriesDataSource` ([按一下以檢視完整大小的影像](batch-updating-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="c8e1f-217">**Figure 11**: Bind the DropDownList to the `CategoriesDataSource` ([Click to view full-size image](batch-updating-cs/_static/image20.png))</span></span>


<span data-ttu-id="c8e1f-218">此時`Categories`DropDownList 列出所有類別，但是它不會還會自動選取適當的類別繫結至 GridView 資料列的產品。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-218">At this point the `Categories` DropDownList lists all of the categories, but it does not yet automatically select the appropriate category for the product bound to the GridView row.</span></span> <span data-ttu-id="c8e1f-219">若要完成此我們需要設定`Categories`DropDownList s`SelectedValue`產品 s`CategoryID`值。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-219">To accomplish this we need to set the `Categories` DropDownList s `SelectedValue` to the product s `CategoryID` value.</span></span> <span data-ttu-id="c8e1f-220">按一下 編輯資料繫結連結從 DropDownList s 智慧標籤，並建立關聯`SelectedValue`屬性`CategoryID`資料欄位，圖 12 中所示。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-220">Click on the Edit DataBindings link from the DropDownList s smart tag and associate the `SelectedValue` property with the `CategoryID` data field as shown in Figure 12.</span></span>


![將產品的 CategoryID 值繫結至 DropDownList 的 SelectedValue 屬性](batch-updating-cs/_static/image12.gif)

<span data-ttu-id="c8e1f-222">**圖 12**： 繫結產品 s `CategoryID` DropDownList s 值`SelectedValue`屬性</span><span class="sxs-lookup"><span data-stu-id="c8e1f-222">**Figure 12**: Bind the Product s `CategoryID` Value to the DropDownList s `SelectedValue` Property</span></span>


<span data-ttu-id="c8e1f-223">一個過去的問題會維持： 如果有產品規定 t`CategoryID`值指定，則資料繫結陳述式上`SelectedValue`會導致例外狀況。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-223">One last problem remains: if the product doesn t have a `CategoryID` value specified then the databinding statement on `SelectedValue` will result in an exception.</span></span> <span data-ttu-id="c8e1f-224">這是因為 DropDownList 包含類別的項目，不提供的產品選項`NULL`資料庫值`CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-224">This is because the DropDownList contains only items for the categories and does not offer an option for those products that have a `NULL` database value for `CategoryID`.</span></span> <span data-ttu-id="c8e1f-225">若要補救這種情況，將 DropDownList s`AppendDataBoundItems`屬性`true`並將新的項目加入至 DropDownList 省略`Value`屬性的宣告式語法。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-225">To remedy this, set the DropDownList s `AppendDataBoundItems` property to `true` and add a new item to the DropDownList, omitting the `Value` property from the declarative syntax.</span></span> <span data-ttu-id="c8e1f-226">也就是確定`Categories`DropDownList s 宣告式語法看起來如下：</span><span class="sxs-lookup"><span data-stu-id="c8e1f-226">That is, make sure that the `Categories` DropDownList s declarative syntax looks like the following:</span></span>


[!code-aspx[Main](batch-updating-cs/samples/sample3.aspx)]

<span data-ttu-id="c8e1f-227">請注意如何`<asp:ListItem Value="">`-選取一個-有其`Value`屬性明確設定為空字串。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-227">Note how the `<asp:ListItem Value="">` -- Select One -- has its `Value` attribute explicitly set to an empty string.</span></span> <span data-ttu-id="c8e1f-228">回頭參考[自訂的資料修改介面](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md)為何需要這個額外的 DropDownList 項目用來處理的更完整討論的教學課程，`NULL`案例和原因指派`Value`屬性為空字串是不可或缺的。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-228">Refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial for a more thorough discussion on why this additional DropDownList item is needed to handle the `NULL` case and why assignment of the `Value` property to an empty string is essential.</span></span>

> [!NOTE]
> <span data-ttu-id="c8e1f-229">沒有潛在效能和延展性問題值得一提。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-229">There is a potential performance and scalability issue here that is worth mentioning.</span></span> <span data-ttu-id="c8e1f-230">因為每個資料列都有使用 DropDownList`CategoriesDataSource`當做其資料來源，`CategoriesBLL`類別 s`GetCategories`方法會呼叫*n*瀏覽每個分頁的時間，其中*n*是數目在 GridView 的資料列。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-230">Since each row has a DropDownList that uses the `CategoriesDataSource` as its data source, the `CategoriesBLL` class s `GetCategories` method will be called *n* times per page visit, where *n* is the number of rows in the GridView.</span></span> <span data-ttu-id="c8e1f-231">這些*n*呼叫`GetCategories`導致*n*向資料庫查詢。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-231">These *n* calls to `GetCategories` result in *n* queries to the database.</span></span> <span data-ttu-id="c8e1f-232">這樣的影響力，在資料庫上無法減少快取傳回的類別目錄要求每個快取中或透過使用快取相依性或非常短的時間為基礎的到期 SQL 快取層。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-232">This impact on the database could be lessened by caching the returned categories either in a per-request cache or through the Caching Layer using a SQL caching dependency or a very short time-based expiry.</span></span> <span data-ttu-id="c8e1f-233">如需有關每個要求快取選項，請參閱[`HttpContext.Items`每秒要求的快取存放區](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-233">For more information on the per-request caching option, see [`HttpContext.Items` a Per-Request Cache Store](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span></span>


## <a name="step-4-completing-the-editing-interface"></a><span data-ttu-id="c8e1f-234">步驟 4： 完成編輯介面</span><span class="sxs-lookup"><span data-stu-id="c8e1f-234">Step 4: Completing the Editing Interface</span></span>

<span data-ttu-id="c8e1f-235">我們 ve 範本所做的變更數目 GridView s 停頓檢視進度。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-235">We ve made a number of changes to the GridView s templates without pausing to view our progress.</span></span> <span data-ttu-id="c8e1f-236">請花一點時間來檢視進度透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-236">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="c8e1f-237">如圖 13 所示，每個資料列使用呈現其`ItemTemplate`，其中包含儲存格 s 中的編輯介面。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-237">As Figure 13 shows, each row is rendered using its `ItemTemplate`, which contains the cell s editing interface.</span></span>


<span data-ttu-id="c8e1f-238">[![每個 GridView 資料列是編輯](batch-updating-cs/_static/image13.gif)](batch-updating-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-238">[![Each GridView Row is Editable](batch-updating-cs/_static/image13.gif)](batch-updating-cs/_static/image21.png)</span></span>

<span data-ttu-id="c8e1f-239">**圖 13**： 每個 GridView 資料列會編輯 ([按一下以檢視完整大小的影像](batch-updating-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="c8e1f-239">**Figure 13**: Each GridView Row is Editable ([Click to view full-size image](batch-updating-cs/_static/image22.png))</span></span>


<span data-ttu-id="c8e1f-240">有幾個次要的格式化問題，我們應該會負責處理這個時候。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-240">There are a few minor formatting issues that we should take care of at this point.</span></span> <span data-ttu-id="c8e1f-241">首先，請注意，`UnitPrice`值包含四個小數位數。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-241">First, note that the `UnitPrice` value contains four decimal points.</span></span> <span data-ttu-id="c8e1f-242">若要修正此問題，傳回到`UnitPrice`TemplateField 的`ItemTemplate`和文字方塊 s 智慧標籤，按一下 編輯資料繫結連結。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-242">To fix this, return to the `UnitPrice` TemplateField s `ItemTemplate` and, from the TextBox s smart tag, click on the Edit DataBindings link.</span></span> <span data-ttu-id="c8e1f-243">接下來，指定`Text`應為數字格式屬性。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-243">Next, specify that the `Text` property should be formatted as a number.</span></span>


![格式化的數字的文字屬性](batch-updating-cs/_static/image14.gif)

<span data-ttu-id="c8e1f-245">**圖 14**： 格式`Text`的數字屬性</span><span class="sxs-lookup"><span data-stu-id="c8e1f-245">**Figure 14**: Format the `Text` Property as a Number</span></span>


<span data-ttu-id="c8e1f-246">第二，讓 s 置中的核取方塊`Discontinued`資料行 （而不需要它是靠左對齊）。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-246">Second, let s center the checkbox in the `Discontinued` column (rather than having it left-aligned).</span></span> <span data-ttu-id="c8e1f-247">按一下 編輯資料行中，從 GridView s 智慧標籤，然後選取`Discontinued`TemplateField 從左下角中的欄位清單。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-247">Click on Edit Columns from the GridView s smart tag and select the `Discontinued` TemplateField from the list of fields in the bottom left corner.</span></span> <span data-ttu-id="c8e1f-248">向下鑽研至`ItemStyle`並設定`HorizontalAlign`Center 圖 15 所示的屬性。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-248">Drill down into `ItemStyle` and set the `HorizontalAlign` property to Center as shown in Figure 15.</span></span>


![置中已停止的核取方塊](batch-updating-cs/_static/image15.gif)

<span data-ttu-id="c8e1f-250">**圖 15**: Center`Discontinued`核取方塊</span><span class="sxs-lookup"><span data-stu-id="c8e1f-250">**Figure 15**: Center the `Discontinued` CheckBox</span></span>


<span data-ttu-id="c8e1f-251">接下來，ValidationSummary 控制項加入網頁，並設定其`ShowMessageBox`屬性`true`及其`ShowSummary`屬性`false`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-251">Next, add a ValidationSummary control to the page and set its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="c8e1f-252">也新增按鈕 Web 控制項，在按下時，會更新使用者的變更。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-252">Also add the Button Web controls that, when clicked, will update the user s changes.</span></span> <span data-ttu-id="c8e1f-253">具體來說，新增兩個按鈕 Web 控制項，一個 GridView 上方，另一個下方，設定兩個控制項`Text`更新產品的屬性。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-253">Specifically, add two Button Web controls, one above the GridView and one below it, setting both controls `Text` properties to Update Products .</span></span>

<span data-ttu-id="c8e1f-254">GridView s 自編輯介面定義在其 TemplateFields `ItemTemplate` s， `EditItemTemplate` s 是多餘的而且可能遭到刪除。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-254">Since the GridView s editing interface is defined in its TemplateFields `ItemTemplate` s, the `EditItemTemplate` s are superfluous and may be deleted.</span></span>

<span data-ttu-id="c8e1f-255">進行上述提到格式變更之後，將按鈕控制項，加入和移除不必要`EditItemTemplate`s，您的頁面 s 宣告式語法看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="c8e1f-255">After making the above mentioned formatting changes, adding the Button controls, and removing the unnecessary `EditItemTemplate` s, your page s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](batch-updating-cs/samples/sample4.aspx)]

<span data-ttu-id="c8e1f-256">圖 16 顯示此頁面已加入按鈕 Web 控制項之後，透過瀏覽器檢視時，以及格式所做的變更。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-256">Figure 16 shows this page when viewed through a browser after the Button Web controls have been added and the formatting changes made.</span></span>


<span data-ttu-id="c8e1f-257">[![頁面現在包含兩個產品更新 按鈕](batch-updating-cs/_static/image16.gif)](batch-updating-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-257">[![The Page Now Includes Two Update Products Buttons](batch-updating-cs/_static/image16.gif)](batch-updating-cs/_static/image23.png)</span></span>

<span data-ttu-id="c8e1f-258">**圖 16**: 頁面現在包含兩個更新產品按鈕 ([按一下以檢視完整大小的影像](batch-updating-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="c8e1f-258">**Figure 16**: The Page Now Includes Two Update Products Buttons ([Click to view full-size image](batch-updating-cs/_static/image24.png))</span></span>


## <a name="step-5-updating-the-products"></a><span data-ttu-id="c8e1f-259">步驟 5： 更新產品</span><span class="sxs-lookup"><span data-stu-id="c8e1f-259">Step 5: Updating the Products</span></span>

<span data-ttu-id="c8e1f-260">當使用者造訪此頁他們進行其的修改，然後按一下其中一個的兩個更新產品按鈕。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-260">When a user visits this page they will make their modifications and then click one of the two Update Products buttons.</span></span> <span data-ttu-id="c8e1f-261">此時，我們需要以某種方式儲存每個資料列插入的使用者輸入值`ProductsDataTable`執行個體，然後將它傳遞至 BLL 方法會再將之`ProductsDataTable`DAL s 的執行個體`UpdateWithTransaction`方法。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-261">At that point we need to somehow save the user-entered values for each row into a `ProductsDataTable` instance and then pass that to a BLL method that will then pass that `ProductsDataTable` instance to the DAL s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="c8e1f-262">`UpdateWithTransaction`方法，我們在建立[前述教學課程](wrapping-database-modifications-within-a-transaction-cs.md)，可確保批次的變更將會更新以不可部分完成的作業。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-262">The `UpdateWithTransaction` method, which we created in the [preceding tutorial](wrapping-database-modifications-within-a-transaction-cs.md), ensures that the batch of changes will be updated as an atomic operation.</span></span>

<span data-ttu-id="c8e1f-263">建立名為方法`BatchUpdate`中`BatchUpdate.aspx.cs`並加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="c8e1f-263">Create a method named `BatchUpdate` in `BatchUpdate.aspx.cs` and add the following code:</span></span>


[!code-csharp[Main](batch-updating-cs/samples/sample5.cs)]

<span data-ttu-id="c8e1f-264">這個方法一開始會取得所有產品回`ProductsDataTable`透過呼叫 BLL 的`GetProducts`方法。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-264">This method starts out by getting all of the products back in a `ProductsDataTable` via a call to the BLL s `GetProducts` method.</span></span> <span data-ttu-id="c8e1f-265">接著它會列舉`ProductGrid`GridView s [ `Rows`集合](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-265">It then enumerates the `ProductGrid` GridView s [`Rows` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span></span> <span data-ttu-id="c8e1f-266">`Rows`集合包含[`GridViewRow`執行個體](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx)GridView 中顯示每一個資料列。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-266">The `Rows` collection contains a [`GridViewRow` instance](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) for each row displayed in the GridView.</span></span> <span data-ttu-id="c8e1f-267">因為我們會顯示最多十個資料列每個分頁，GridView 的`Rows`集合會有十個以上的項目。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-267">Since we are showing at most ten rows per page, the GridView s `Rows` collection will have no more than ten items.</span></span>

<span data-ttu-id="c8e1f-268">每個資料列`ProductID`捕捉從`DataKeys`集合和適當`ProductsRow`選取從`ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-268">For each row the `ProductID` is grabbed from the `DataKeys` collection and the appropriate `ProductsRow` is selected from the `ProductsDataTable`.</span></span> <span data-ttu-id="c8e1f-269">以程式設計方式參考的四個 TemplateField 輸入的控制項，且其值指派給`ProductsRow`執行個體內容。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-269">The four TemplateField input controls are programmatically referenced and their values assigned to the `ProductsRow` instance s properties.</span></span> <span data-ttu-id="c8e1f-270">每個 GridView 之後列值 s 已用來更新`ProductsDataTable`，它 s 傳遞至 BLL s`UpdateWithTransaction`方法，如我們所見前述教學課程中，只會呼叫向下到 DAL 的`UpdateWithTransaction`方法。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-270">After each GridView row s values have been used to update the `ProductsDataTable`, it s passed to the BLL s `UpdateWithTransaction` method which, as we saw in the preceding tutorial, simply calls down into the DAL s `UpdateWithTransaction` method.</span></span>

<span data-ttu-id="c8e1f-271">本教學課程使用的批次更新演算法更新中的每個資料列`ProductsDataTable`對應至 GridView，不論是否已變更的產品的資訊中的資料列。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-271">The batch update algorithm used for this tutorial updates each row in the `ProductsDataTable` that corresponds to a row in the GridView, regardless of whether the product s information has been changed.</span></span> <span data-ttu-id="c8e1f-272">這類 blind 更新通常並不是效能問題，而它們可能會導致過多記錄如果作為稽核您變更至資料庫資料表。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-272">While such blind updates aren t usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="c8e1f-273">回到[執行批次更新](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md)教學課程中我們探索批次更新 DataList 介面，加入程式碼，只會更新使用者實際修改這些記錄。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-273">Back in the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) tutorial we explored a batch updating interface with the DataList and added code that would only update those records that were actually modified by the user.</span></span> <span data-ttu-id="c8e1f-274">歡迎使用從技術[執行批次更新](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md)如有需要，在本教學課程中，更新程式碼。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-274">Feel free to use the techniques from [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) to update the code in this tutorial, if desired.</span></span>

> [!NOTE]
> <span data-ttu-id="c8e1f-275">當繫結透過其智慧標籤在 GridView 的資料來源，Visual Studio 自動將資料來源 s 主要值指派給 GridView 的`DataKeyNames`屬性。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-275">When binding the data source to the GridView through its smart tag, Visual Studio automatically assigns the data source s primary key value(s) to the GridView s `DataKeyNames` property.</span></span> <span data-ttu-id="c8e1f-276">如果您未繫結 ObjectDataSource 透過 GridView s 智慧標籤在 GridView 中步驟 1 所述，則您必須手動設定 GridView s`DataKeyNames`屬性才能存取 ProductID`ProductID`透過每個資料列的值`DataKeys`集合。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-276">If you did not bind the ObjectDataSource to the GridView through the GridView s smart tag as outlined in Step 1, then you will need to manually set the GridView s `DataKeyNames` property to ProductID in order to access the `ProductID` value for each row through the `DataKeys` collection.</span></span>


<span data-ttu-id="c8e1f-277">使用中的程式碼`BatchUpdate`類似於用於 BLL s`UpdateProduct`方法、 主要的差異在於，在`UpdateProduct`方法只會有一個`ProductRow`從架構擷取執行個體。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-277">The code used in `BatchUpdate` is similar to that used in the BLL s `UpdateProduct` methods, the main difference being that in the `UpdateProduct` methods only a single `ProductRow` instance is retrieved from the architecture.</span></span> <span data-ttu-id="c8e1f-278">指派的屬性的程式碼`ProductRow`之間相同`UpdateProducts`方法和中的程式碼`foreach`迴圈`BatchUpdate`，如整體模式。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-278">The code that assigns the properties of the `ProductRow` is the same between the `UpdateProducts` methods and the code within the `foreach` loop in `BatchUpdate`, as is the overall pattern.</span></span>

<span data-ttu-id="c8e1f-279">若要完成本教學課程中，我們必須將`BatchUpdate`時叫用方法的更新產品按鈕按下。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-279">To complete this tutorial, we need to have the `BatchUpdate` method invoked when either of the Update Products buttons is clicked.</span></span> <span data-ttu-id="c8e1f-280">建立事件處理常式`Click`事件的這兩個按鈕控制項和事件處理常式中加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="c8e1f-280">Create event handlers for the `Click` events of these two Button controls and add the following code in the event handlers:</span></span>


[!code-csharp[Main](batch-updating-cs/samples/sample6.cs)]

<span data-ttu-id="c8e1f-281">第一次進行呼叫以`BatchUpdate`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-281">First a call is made to `BatchUpdate`.</span></span> <span data-ttu-id="c8e1f-282">下一步`ClientScript property`用來插入將會顯示讀取已更新之產品的 messagebox 的 JavaScript。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-282">Next, the `ClientScript property` is used to inject JavaScript that will display a messagebox that reads The products have been updated.</span></span>

<span data-ttu-id="c8e1f-283">花一分鐘，若要測試這段程式碼。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-283">Take a minute to test out this code.</span></span> <span data-ttu-id="c8e1f-284">請瀏覽`BatchUpdate.aspx`透過瀏覽器中，編輯資料列數目，並按一下其中一個更新產品按鈕。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-284">Visit `BatchUpdate.aspx` through a browser, edit a number of rows, and click one of the Update Products buttons.</span></span> <span data-ttu-id="c8e1f-285">假設沒有任何輸入的驗證錯誤，您應該會看到讀取已更新之產品的 messagebox。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-285">Assuming there are no input validation errors, you should see a messagebox that reads The products have been updated.</span></span> <span data-ttu-id="c8e1f-286">若要確認不可部分完成的更新，請考慮加入的隨機`CHECK`條件約束，例如不允許的其中一個`UnitPrice`1234.56 的值。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-286">To verify the atomicity of the update, consider adding a random `CHECK` constraint, like one that disallows `UnitPrice` values of 1234.56.</span></span> <span data-ttu-id="c8e1f-287">然後從`BatchUpdate.aspx`，編輯的記錄數，務必要設定其中一個產品的`UnitPrice`禁止的值 (1234.56) 的值。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-287">Then from `BatchUpdate.aspx`, edit a number of records, making sure to set one of the product s `UnitPrice` value to the forbidden value ( 1234.56 ).</span></span> <span data-ttu-id="c8e1f-288">這應該與其他變更的更新產品按一下該批次作業期間復原為其原始值時產生錯誤。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-288">This should result in an error when clicking Update Products with the other changes during that batch operation rolled back to their original values.</span></span>

## <a name="an-alternativebatchupdatemethod"></a><span data-ttu-id="c8e1f-289">替代`BatchUpdate`方法</span><span class="sxs-lookup"><span data-stu-id="c8e1f-289">An Alternative`BatchUpdate`Method</span></span>

<span data-ttu-id="c8e1f-290">`BatchUpdate`我們剛的方法檢查擷取*所有*BLL s 從產品的`GetProducts`方法，然後更新只會出現在 GridView 的記錄。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-290">The `BatchUpdate` method we just examined retrieves *all* of the products from the BLL s `GetProducts` method and then updates just those records that appear in the GridView.</span></span> <span data-ttu-id="c8e1f-291">如果 GridView 不會使用分頁，但如果是的話，可能有數百、 千或數以萬計的產品，但是在 GridView 中的只有 10 個資料列，這個方法很理想。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-291">This approach is ideal if the GridView does not use paging, but if it does, there may be hundreds, thousands, or tens of thousands of products, but only ten rows in the GridView.</span></span> <span data-ttu-id="c8e1f-292">在這種情況下，取得所有產品資料庫時，才能修改其中 10 個為小於理想。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-292">In such a case, getting all of the products from the database only to modify 10 of them is less than ideal.</span></span>

<span data-ttu-id="c8e1f-293">這些類型的情況中，請考慮使用下列`BatchUpdateAlternate`方法改為：</span><span class="sxs-lookup"><span data-stu-id="c8e1f-293">For those types of situations, consider using the following `BatchUpdateAlternate` method instead:</span></span>


[!code-csharp[Main](batch-updating-cs/samples/sample7.cs)]

<span data-ttu-id="c8e1f-294">`BatchMethodAlternate` 藉由建立新的空白啟動`ProductsDataTable`名為`products`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-294">`BatchMethodAlternate` starts by creating a new empty `ProductsDataTable` named `products`.</span></span> <span data-ttu-id="c8e1f-295">接著，它會逐一 GridView s`Rows`集合，在每個資料列取得特定產品資訊使用 BLL 的`GetProductByProductID(productID)`方法。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-295">It then steps through the GridView s `Rows` collection and for each row gets the particular product information using the BLL s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="c8e1f-296">擷取`ProductsRow`執行個體有以相同的方式，以更新其屬性`BatchUpdate`，但在更新匯入的資料列之後`products``ProductsDataTable`經由 DataTable s [ `ImportRow(DataRow)`方法](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-296">The retrieved `ProductsRow` instance has its properties updated in the same fashion as `BatchUpdate`, but after updating the row it is imported into the `products``ProductsDataTable` via the DataTable s [`ImportRow(DataRow)` method](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span></span>

<span data-ttu-id="c8e1f-297">之後`foreach`迴圈完成時，`products`包含一個`ProductsRow`GridView 中每個資料列的執行個體。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-297">After the `foreach` loop completes, `products` contains one `ProductsRow` instance for each row in the GridView.</span></span> <span data-ttu-id="c8e1f-298">由於每個的`ProductsRow`執行個體已新增至`products`（而不是更新），如果我們盲目地將它傳遞給`UpdateWithTransaction`方法`ProductsTableAdatper`會嘗試每筆記錄插入資料庫。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-298">Since each of the `ProductsRow` instances have been added to the `products` (instead of updated), if we blindly pass it to the `UpdateWithTransaction` method the `ProductsTableAdatper` will try to insert each of the records into the database.</span></span> <span data-ttu-id="c8e1f-299">相反地，我們需要指定這些資料列的每個已修改的 （不會新增）。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-299">Instead, we need to specify that each of these rows has been modified (not added).</span></span>

<span data-ttu-id="c8e1f-300">這可以透過將新方法加入至名為 BLL `UpdateProductsWithTransaction`。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-300">This can be accomplished by adding a new method to the BLL named `UpdateProductsWithTransaction`.</span></span> <span data-ttu-id="c8e1f-301">`UpdateProductsWithTransaction`如下所示，設定`RowState`的每個`ProductsRow`中執行個體`ProductsDataTable`至`Modified`然後將傳遞`ProductsDataTable`DAL s`UpdateWithTransaction`方法。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-301">`UpdateProductsWithTransaction`, shown below, sets the `RowState` of each of the `ProductsRow` instances in the `ProductsDataTable` to `Modified` and then passes the `ProductsDataTable` to the DAL s `UpdateWithTransaction` method.</span></span>


[!code-csharp[Main](batch-updating-cs/samples/sample8.cs)]

## <a name="summary"></a><span data-ttu-id="c8e1f-302">總結</span><span class="sxs-lookup"><span data-stu-id="c8e1f-302">Summary</span></span>

<span data-ttu-id="c8e1f-303">在 GridView 提供內建的每一列編輯功能，但不支援建立完整的可編輯的介面。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-303">The GridView provides built-in per-row editing capabilities, but lacks support for creating fully editable interfaces.</span></span> <span data-ttu-id="c8e1f-304">當我們在本教學課程中所見，這類介面是可行的但需要的工作。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-304">As we saw in this tutorial, such interfaces are possible, but require a bit of work.</span></span> <span data-ttu-id="c8e1f-305">若要建立其中每個資料列都可編輯的 GridView，我們需要將 GridView 的欄位轉換成 TemplateFields，定義中的編輯介面`ItemTemplate`s。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-305">To create a GridView where every row is editable, we need to convert the GridView s fields into TemplateFields and define the editing interface within the `ItemTemplate` s.</span></span> <span data-ttu-id="c8e1f-306">此外，更新所有按鈕 Web 控制項的類型必須新增至頁面上，個別從 GridView。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-306">Additionally, Update All -type Button Web controls must be added to the page, separate from the GridView.</span></span> <span data-ttu-id="c8e1f-307">這些按鈕`Click`事件處理常式必須列舉 GridView s`Rows`集合中，存放區中的變更`ProductsDataTable`，並將更新的資訊傳遞至適當的 BLL 方法。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-307">These Buttons `Click` event handlers need to enumerate the GridView s `Rows` collection, store the changes in a `ProductsDataTable`, and pass the updated information into the appropriate BLL method.</span></span>

<span data-ttu-id="c8e1f-308">在下一個教學課程中，我們會看到如何建立批次刪除介面。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-308">In the next tutorial we'll see how to create an interface for batch deleting.</span></span> <span data-ttu-id="c8e1f-309">特別是，每個 GridView 資料列會包含核取方塊，並而不是更新所有-輸入按鈕，我們必須刪除選取的資料列按鈕。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-309">In particular, each GridView row will include a checkbox and instead of Update All -type buttons, we'll have Delete Selected Rows buttons.</span></span>

<span data-ttu-id="c8e1f-310">祝您程式設計 ！</span><span class="sxs-lookup"><span data-stu-id="c8e1f-310">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="c8e1f-311">關於作者</span><span class="sxs-lookup"><span data-stu-id="c8e1f-311">About the Author</span></span>

<span data-ttu-id="c8e1f-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP/ASP.NET 書籍和的創辦[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已從 1998 年使用 Microsoft Web 技術。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c8e1f-313">Scott 可做為獨立顧問、 訓練和寫入器。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-313">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c8e1f-314">他最新的活頁簿[ *Sam 教導您自己 ASP.NET 2.0 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-314">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c8e1f-315">他可以在達到[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或透過他的部落格，這可以在找到[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-315">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="c8e1f-316">特別感謝</span><span class="sxs-lookup"><span data-stu-id="c8e1f-316">Special Thanks To</span></span>

<span data-ttu-id="c8e1f-317">許多有用的檢閱者已檢閱本教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-317">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c8e1f-318">此教學課程中的前導檢閱者已本文菲和 David Suru。</span><span class="sxs-lookup"><span data-stu-id="c8e1f-318">Lead reviewers for this tutorial were Teresa Murphy and David Suru.</span></span> <span data-ttu-id="c8e1f-319">檢閱我即將推出的 MSDN 文件有興趣嗎？</span><span class="sxs-lookup"><span data-stu-id="c8e1f-319">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c8e1f-320">如果是這樣，卸除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-320">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c8e1f-321">[上一頁](wrapping-database-modifications-within-a-transaction-cs.md)
> [下一頁](batch-deleting-cs.md)</span><span class="sxs-lookup"><span data-stu-id="c8e1f-321">[Previous](wrapping-database-modifications-within-a-transaction-cs.md)
[Next](batch-deleting-cs.md)</span></span>
