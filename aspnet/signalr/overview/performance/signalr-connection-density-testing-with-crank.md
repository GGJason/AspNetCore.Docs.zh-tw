---
uid: signalr/overview/performance/signalr-connection-density-testing-with-crank
title: 測試區軸與 SignalR 連線密度 |Microsoft 文件
author: tfitzmac
description: 測試區軸與 SignalR 連線密度
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/22/2015
ms.topic: article
ms.assetid: 148d9ca7-1af1-44b6-a9fb-91e261b9b463
ms.technology: dotnet-signalr
ms.prod: .net-framework
msc.legacyurl: /signalr/overview/performance/signalr-connection-density-testing-with-crank
msc.type: authoredcontent
ms.openlocfilehash: a3e8fdb47bd80d819358f9c48cd82fd51d6c0400
ms.sourcegitcommit: fe880bf4ed1c8116071c0e47c0babf3623b7f44a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/21/2017
ms.locfileid: "26535327"
---
<a name="signalr-connection-density-testing-with-crank"></a><span data-ttu-id="dab6e-103">測試區軸與 SignalR 連線密度</span><span class="sxs-lookup"><span data-stu-id="dab6e-103">SignalR Connection Density Testing with Crank</span></span>
====================
<span data-ttu-id="dab6e-104">由[Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="dab6e-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="dab6e-105">本文說明如何使用區軸工具來測試與多個模擬用戶端應用程式。</span><span class="sxs-lookup"><span data-stu-id="dab6e-105">This article describes how to use the Crank tool to test an application with multiple simulated clients.</span></span>


<span data-ttu-id="dab6e-106">一旦您的應用程式 （任一 Azure web 角色，IIS，或自我裝載使用 Owin） 其主控環境中執行，您可以測試使用區軸工具連接密度的高層級的應用程式的回應。</span><span class="sxs-lookup"><span data-stu-id="dab6e-106">Once your application is running in its hosting environment (either an Azure web role, IIS, or self-hosted using Owin), you can test application's response to a high level of connection density using the Crank tool.</span></span> <span data-ttu-id="dab6e-107">網際網路資訊服務 (IIS) 伺服器、 Owin 主機或 Azure web 角色，可以是裝載環境。</span><span class="sxs-lookup"><span data-stu-id="dab6e-107">The hosting environment can be an Internet Information Services (IIS) server, an Owin host, or an Azure web role.</span></span> <span data-ttu-id="dab6e-108">(注意： 效能計數器並不適用於 Azure App Service Web 應用程式，因此無法從連接密度測試取得效能資料。)</span><span class="sxs-lookup"><span data-stu-id="dab6e-108">(Note: Performance counters are not available on Azure App Service Web Apps, so you will not be able to get performance data from a connection density test.)</span></span>

<span data-ttu-id="dab6e-109">連接密度是指同時可以建立在伺服器的 TCP 連線的數目。</span><span class="sxs-lookup"><span data-stu-id="dab6e-109">Connection Density refers to the number of simultaneous TCP connections that can be established on a server.</span></span> <span data-ttu-id="dab6e-110">每個 TCP 連線會產生其本身的額外負荷，並開啟大量閒置連線的最終將會建立記憶體瓶頸。</span><span class="sxs-lookup"><span data-stu-id="dab6e-110">Each TCP connection incurs its own overhead, and opening a large number of idle connections will eventually create a memory bottleneck.</span></span>

<span data-ttu-id="dab6e-111">[程式碼基底 SignalR](https://github.com/signalr/signalr)包含負載測試的工具，稱為**Crank**。</span><span class="sxs-lookup"><span data-stu-id="dab6e-111">[The SignalR codebase](https://github.com/signalr/signalr) includes a load-testing tool called **Crank**.</span></span> <span data-ttu-id="dab6e-112">區軸的最新版本位於[Dev 分支](https://github.com/SignalR/signalr/tree/dev)GitHub 上。</span><span class="sxs-lookup"><span data-stu-id="dab6e-112">The latest version of Crank can be found in [the Dev branch](https://github.com/SignalR/signalr/tree/dev) on GitHub.</span></span> <span data-ttu-id="dab6e-113">您可以下載的 Zip 封存 SignalR 的 Dev 分支的程式碼基底[這裡](https://github.com/SignalR/SignalR/archive/dev.zip)。</span><span class="sxs-lookup"><span data-stu-id="dab6e-113">You can download a Zip archive of the Dev branch of the SignalR codebase [here](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span>

<span data-ttu-id="dab6e-114">區軸可能用來完全飽和伺服器的記憶體，以便能夠計算總數的伺服器硬體上可能的閒置連接。</span><span class="sxs-lookup"><span data-stu-id="dab6e-114">Crank may be used to fully saturate the server's memory in order to calculate the total number of idle connections possible on the server hardware.</span></span> <span data-ttu-id="dab6e-115">或者，您也可以使用區軸對進行負載測試中的伺服器記憶體不足的壓力，數量由根本上連線，直到達到特定的計數或特定的記憶體臨界值。</span><span class="sxs-lookup"><span data-stu-id="dab6e-115">Alternatively, you may also use Crank to load test the server under a certain amount of memory pressure, by ramping up connections until a specific count or a specific memory threshold is reached.</span></span>

<span data-ttu-id="dab6e-116">測試時，務必使用遠端用戶端，以避免任何競爭資源 （亦即，TCP 連線和記憶體）。</span><span class="sxs-lookup"><span data-stu-id="dab6e-116">When testing, it is important to use remote client(s) to avoid any competition for resources (i.e., TCP connections and memory).</span></span> <span data-ttu-id="dab6e-117">監視用戶端，以確保它們不到達可能防止伺服器到達其完整的容量 （記憶體或 CPU） 的任何瓶頸。</span><span class="sxs-lookup"><span data-stu-id="dab6e-117">Monitor the client(s) to ensure that they are not hitting any bottlenecks that may prevent the server from reaching its full capacity (memory or CPU).</span></span> <span data-ttu-id="dab6e-118">您可能需要增加用戶端數目，以便可以完全載入伺服器。</span><span class="sxs-lookup"><span data-stu-id="dab6e-118">You may need to increase the number of clients in order to fully load the server.</span></span>

### <a name="running-a-connection-density-test"></a><span data-ttu-id="dab6e-119">執行連線密度測試</span><span class="sxs-lookup"><span data-stu-id="dab6e-119">Running a Connection Density Test</span></span>

<span data-ttu-id="dab6e-120">本章節描述 SignalR 應用程式上執行連接密度測試所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="dab6e-120">This section describes the steps needed to run a connection density test on a SignalR application.</span></span>

1. <span data-ttu-id="dab6e-121">下載並建置[SignalR 的 Dev 分支程式碼基底](https://github.com/SignalR/SignalR/archive/dev.zip)。</span><span class="sxs-lookup"><span data-stu-id="dab6e-121">Download and build the [Dev branch of the SignalR codebase](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span> <span data-ttu-id="dab6e-122">在命令提示字元，瀏覽至&lt;專案目錄&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug。</span><span class="sxs-lookup"><span data-stu-id="dab6e-122">In a command prompt, navigate to &lt;project directory&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span></span>
2. <span data-ttu-id="dab6e-123">應用程式部署至指定的裝載環境。</span><span class="sxs-lookup"><span data-stu-id="dab6e-123">Deploy your application to its intended hosting environment.</span></span> <span data-ttu-id="dab6e-124">請記下之端點的應用程式使用。例如，在應用程式中建立[快速入門教學課程](../getting-started/tutorial-getting-started-with-signalr.md)，端點`http://<yourhost>:8080/signalr`。</span><span class="sxs-lookup"><span data-stu-id="dab6e-124">Make a note of the endpoint that your application uses; for example, in the application created in the [Getting Started tutorial](../getting-started/tutorial-getting-started-with-signalr.md), the endpoint is `http://<yourhost>:8080/signalr`.</span></span>
3. <span data-ttu-id="dab6e-125">安裝[SignalR 效能計數器](signalr-performance.md#perfcounters)在伺服器上。</span><span class="sxs-lookup"><span data-stu-id="dab6e-125">Install [SignalR performance counters](signalr-performance.md#perfcounters) on the server.</span></span> <span data-ttu-id="dab6e-126">如果您的應用程式在 Azure 上執行，請參閱[Azure Web 角色中使用 SignalR 效能計數器](using-signalr-performance-counters-in-an-azure-web-role.md)。</span><span class="sxs-lookup"><span data-stu-id="dab6e-126">If your application is running on Azure, see [Using SignalR Performance Counters in an Azure Web Role](using-signalr-performance-counters-in-an-azure-web-role.md).</span></span>

<span data-ttu-id="dab6e-127">一旦您下載及建置程式碼基底，並在主機上安裝效能計數器，區軸命令列工具位於`src\Microsoft.AspNet.SignalR.Crank\bin\Debug`資料夾。</span><span class="sxs-lookup"><span data-stu-id="dab6e-127">Once you've downloaded and built the codebase, and installed performance counters on your host, the Crank command-line tool can be found in the `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` folder.</span></span>

<span data-ttu-id="dab6e-128">區軸工具可用的選項包括：</span><span class="sxs-lookup"><span data-stu-id="dab6e-128">Available options for the Crank tool include:</span></span>

- <span data-ttu-id="dab6e-129">**/?**： 顯示說明畫面。</span><span class="sxs-lookup"><span data-stu-id="dab6e-129">**/?**: Shows the help screen.</span></span> <span data-ttu-id="dab6e-130">可用的選項也會顯示如果**Url**省略參數。</span><span class="sxs-lookup"><span data-stu-id="dab6e-130">The available options are also displayed if the **Url** parameter is omitted.</span></span>
- <span data-ttu-id="dab6e-131">**/ Url**: SignalR 連線的 URL。</span><span class="sxs-lookup"><span data-stu-id="dab6e-131">**/Url**: The URL for SignalR connections.</span></span> <span data-ttu-id="dab6e-132">這是必要參數。</span><span class="sxs-lookup"><span data-stu-id="dab6e-132">This parameter is required.</span></span> <span data-ttu-id="dab6e-133">將 SignalR 應用程式中使用預設的對應，在結束路徑 」 / signalr"。</span><span class="sxs-lookup"><span data-stu-id="dab6e-133">For a SignalR application using the default mapping, the path will end in "/signalr".</span></span>
- <span data-ttu-id="dab6e-134">**/ 傳輸**： 所用之傳輸的名稱。</span><span class="sxs-lookup"><span data-stu-id="dab6e-134">**/Transport**: The name of the transport used.</span></span> <span data-ttu-id="dab6e-135">預設值是`auto`，這將會選取最適合可用通訊協定。</span><span class="sxs-lookup"><span data-stu-id="dab6e-135">The default is `auto`, which will select the best available protocol.</span></span> <span data-ttu-id="dab6e-136">選項包括`WebSockets`， `ServerSentEvents`，和`LongPolling`(`ForeverFrame`不的選項區軸，因為.NET 用戶端而不使用 Internet Explorer)。</span><span class="sxs-lookup"><span data-stu-id="dab6e-136">Options include `WebSockets`, `ServerSentEvents`, and `LongPolling` (`ForeverFrame` is not an option for Crank, since the .NET client rather than Internet Explorer is used).</span></span> <span data-ttu-id="dab6e-137">如需有關 SignalR 選取傳輸方式的詳細資訊，請參閱[傳輸和後援](../getting-started/introduction-to-signalr.md#transports)。</span><span class="sxs-lookup"><span data-stu-id="dab6e-137">For more information on how SignalR selects transports, see [Transports and Fallbacks](../getting-started/introduction-to-signalr.md#transports).</span></span>
- <span data-ttu-id="dab6e-138">**/ BatchSize**： 加入每個批次中的用戶端數目。</span><span class="sxs-lookup"><span data-stu-id="dab6e-138">**/BatchSize**: The number of clients added in each batch.</span></span> <span data-ttu-id="dab6e-139">預設值為 50。</span><span class="sxs-lookup"><span data-stu-id="dab6e-139">The default is 50.</span></span>
- <span data-ttu-id="dab6e-140">**/ ConnectInterval**： 以毫秒為單位之間加入連接的間隔。</span><span class="sxs-lookup"><span data-stu-id="dab6e-140">**/ConnectInterval**: The interval in milliseconds between adding connections.</span></span> <span data-ttu-id="dab6e-141">預設值為 500。</span><span class="sxs-lookup"><span data-stu-id="dab6e-141">The default is 500.</span></span>
- <span data-ttu-id="dab6e-142">**/ Connections**： 用於負載測試應用程式的連接數目。</span><span class="sxs-lookup"><span data-stu-id="dab6e-142">**/Connections**: The number of connections used to load-test the application.</span></span> <span data-ttu-id="dab6e-143">預設值為 100,000。</span><span class="sxs-lookup"><span data-stu-id="dab6e-143">The default is 100,000.</span></span>
- <span data-ttu-id="dab6e-144">**/ ConnectTimeout**: 逾時中止測試之前的秒數。</span><span class="sxs-lookup"><span data-stu-id="dab6e-144">**/ConnectTimeout**: The timeout in seconds before aborting the test.</span></span> <span data-ttu-id="dab6e-145">預設值為 300。</span><span class="sxs-lookup"><span data-stu-id="dab6e-145">The default is 300.</span></span>
- <span data-ttu-id="dab6e-146">**MinServerMBytes**： 連線到最小的伺服器 （mb)。</span><span class="sxs-lookup"><span data-stu-id="dab6e-146">**MinServerMBytes**: The minimum server megabytes to reach.</span></span> <span data-ttu-id="dab6e-147">預設值為 500。</span><span class="sxs-lookup"><span data-stu-id="dab6e-147">The default is 500.</span></span>
- <span data-ttu-id="dab6e-148">**SendBytes**： 裝載傳送至伺服器，以位元組為單位的大小。</span><span class="sxs-lookup"><span data-stu-id="dab6e-148">**SendBytes**: The size of the payload sent to the server in bytes.</span></span> <span data-ttu-id="dab6e-149">預設值為 0。</span><span class="sxs-lookup"><span data-stu-id="dab6e-149">The default is 0.</span></span>
- <span data-ttu-id="dab6e-150">**SendInterval**： 以毫秒為單位之伺服器的訊息之間的延遲。</span><span class="sxs-lookup"><span data-stu-id="dab6e-150">**SendInterval**: The delay in milliseconds between messages to the server.</span></span> <span data-ttu-id="dab6e-151">預設值為 500。</span><span class="sxs-lookup"><span data-stu-id="dab6e-151">The default is 500.</span></span>
- <span data-ttu-id="dab6e-152">**SendTimeout**： 以毫秒為單位的訊息，伺服器逾時。</span><span class="sxs-lookup"><span data-stu-id="dab6e-152">**SendTimeout**: The timeout in milliseconds for messages to the server.</span></span> <span data-ttu-id="dab6e-153">預設值為 300。</span><span class="sxs-lookup"><span data-stu-id="dab6e-153">The default is 300.</span></span>
- <span data-ttu-id="dab6e-154">**ControllerUrl**： 其中一個用戶端將裝載控制站集線器的 Url。</span><span class="sxs-lookup"><span data-stu-id="dab6e-154">**ControllerUrl**: The Url where one client will host a controller hub.</span></span> <span data-ttu-id="dab6e-155">預設為 null （沒有中樞控制站）。</span><span class="sxs-lookup"><span data-stu-id="dab6e-155">The default is null (no controller hub).</span></span> <span data-ttu-id="dab6e-156">中樞控制站會在啟動區軸工作階段啟動。沒有進一步進行區軸中樞控制站之間的連絡人。</span><span class="sxs-lookup"><span data-stu-id="dab6e-156">The controller hub is started when the Crank session starts; no further contact between the controller hub and Crank is made.</span></span>
- <span data-ttu-id="dab6e-157">**NumClients**： 模擬用戶端連線到應用程式數目。</span><span class="sxs-lookup"><span data-stu-id="dab6e-157">**NumClients**: The number of simulated clients to connect to the application.</span></span> <span data-ttu-id="dab6e-158">預設為其中一個。</span><span class="sxs-lookup"><span data-stu-id="dab6e-158">The default is one.</span></span>
- <span data-ttu-id="dab6e-159">**記錄檔**： 測試回合記錄檔的檔名。</span><span class="sxs-lookup"><span data-stu-id="dab6e-159">**Logfile**: The filename for the logfile for the test run.</span></span> <span data-ttu-id="dab6e-160">預設為 `crank.csv`。</span><span class="sxs-lookup"><span data-stu-id="dab6e-160">The default is `crank.csv`.</span></span>
- <span data-ttu-id="dab6e-161">**SampleInterval**： 以毫秒為單位的效能計數器樣本之間的時間。</span><span class="sxs-lookup"><span data-stu-id="dab6e-161">**SampleInterval**: The time in milliseconds between performance counter samples.</span></span> <span data-ttu-id="dab6e-162">預設值為 1000。</span><span class="sxs-lookup"><span data-stu-id="dab6e-162">The default is 1000.</span></span>
- <span data-ttu-id="dab6e-163">**SignalRInstance**： 伺服器上的效能計數器的執行個體名稱。</span><span class="sxs-lookup"><span data-stu-id="dab6e-163">**SignalRInstance**: The instance name for the performance counters on the server.</span></span> <span data-ttu-id="dab6e-164">預設值是使用用戶端連線狀態。</span><span class="sxs-lookup"><span data-stu-id="dab6e-164">The default is to use the client connection state.</span></span>

### <a name="example"></a><span data-ttu-id="dab6e-165">範例</span><span class="sxs-lookup"><span data-stu-id="dab6e-165">Example</span></span>

<span data-ttu-id="dab6e-166">下列命令會測試網站，呼叫`pfsignalr`在 Azure 上裝載以名為"ControllerHub"集線器連接埠 8080 上的應用程式，使用 100 個連接。</span><span class="sxs-lookup"><span data-stu-id="dab6e-166">The following command will test a site called `pfsignalr` on Azure that hosts an application on port 8080 with a hub named "ControllerHub", using 100 connections.</span></span>

`crank /Connections:100 /Url:http://pfsignalr.cloudapp.net:8080/signalr`
