---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: 如何： 將行動網頁加入 ASP.NET Web Form / MVC 應用程式 |Microsoft 文件
author: rick-anderson
description: 此作法 」 說明各種方法來提供適合您的 ASP.NET Web Form 中的行動裝置的網頁 / MVC 應用程式，並建議架構和...
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/20/2011
ms.topic: article
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: a8358b91ca424f4f3e576057ab43d850081dda60
ms.sourcegitcommit: 6784510cfb589308c3875ccb5113eb31031766b4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/08/2018
ms.locfileid: "30898979"
---
<a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a><span data-ttu-id="f625a-103">如何： 將行動網頁加入 ASP.NET Web Form / MVC 應用程式</span><span class="sxs-lookup"><span data-stu-id="f625a-103">How To: Add Mobile Pages to Your ASP.NET Web Forms / MVC Application</span></span>
====================
> <span data-ttu-id="f625a-104">**適用於**</span><span class="sxs-lookup"><span data-stu-id="f625a-104">**Applies To**</span></span>
> 
> - <span data-ttu-id="f625a-105">ASP.NET Web Form 4.0 版</span><span class="sxs-lookup"><span data-stu-id="f625a-105">ASP.NET Web Forms version 4.0</span></span>
> - <span data-ttu-id="f625a-106">ASP.NET MVC 3.0 版</span><span class="sxs-lookup"><span data-stu-id="f625a-106">ASP.NET MVC version 3.0</span></span>
> 
> <span data-ttu-id="f625a-107">**摘要**</span><span class="sxs-lookup"><span data-stu-id="f625a-107">**Summary**</span></span>
> 
> <span data-ttu-id="f625a-108">此作法 」 說明各種方法來提供適合您的 ASP.NET Web Form 中的行動裝置的網頁 / MVC 應用程式，並建議架構和設計各種裝置為目標時應該考量的問題。</span><span class="sxs-lookup"><span data-stu-id="f625a-108">This How To describes various ways to serve pages optimized for mobile devices from your ASP.NET Web Forms / MVC application, and suggests architectural and design issues to consider when targeting a broad range of devices.</span></span> <span data-ttu-id="f625a-109">本文件也會說明為何 ASP.NET 行動控制項從 ASP.NET 2.0 3.5 已經過時，並討論一些現代的替代方案。</span><span class="sxs-lookup"><span data-stu-id="f625a-109">This document also explains why the ASP.NET Mobile Controls from ASP.NET 2.0 to 3.5 are now obsolete, and discusses some modern alternatives.</span></span>


## <a name="contents"></a><span data-ttu-id="f625a-110">內容</span><span class="sxs-lookup"><span data-stu-id="f625a-110">Contents</span></span>

- <span data-ttu-id="f625a-111">總覽</span><span class="sxs-lookup"><span data-stu-id="f625a-111">Overview</span></span>
- <span data-ttu-id="f625a-112">架構選項</span><span class="sxs-lookup"><span data-stu-id="f625a-112">Architectural options</span></span>
- <span data-ttu-id="f625a-113">瀏覽器及裝置偵測</span><span class="sxs-lookup"><span data-stu-id="f625a-113">Browser and device detection</span></span>
- <span data-ttu-id="f625a-114">ASP.NET Web Form 應用程式可以如何呈現行動特定頁面</span><span class="sxs-lookup"><span data-stu-id="f625a-114">How ASP.NET Web Forms applications can present mobile-specific pages</span></span>
- <span data-ttu-id="f625a-115">ASP.NET MVC 應用程式可以如何呈現行動特定頁面</span><span class="sxs-lookup"><span data-stu-id="f625a-115">How ASP.NET MVC applications can present mobile-specific pages</span></span>
- <span data-ttu-id="f625a-116">其他資源</span><span class="sxs-lookup"><span data-stu-id="f625a-116">Additional resources</span></span>

<span data-ttu-id="f625a-117">如需示範這份技術白皮書的技術，ASP.NET Web Form 和 MVC 的可下載程式碼範例，請參閱[行動應用程式 （& s) 與 ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="f625a-117">For downloadable code samples demonstrating this white paper's techniques for both ASP.NET Web Forms and MVC, see [Mobile Apps & Sites with ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span></span>

## <a name="overview"></a><span data-ttu-id="f625a-118">總覽</span><span class="sxs-lookup"><span data-stu-id="f625a-118">Overview</span></span>

<span data-ttu-id="f625a-119">– 智慧型手機、 功能手機和平板電腦 – 行動裝置繼續中做為存取 Web 的人氣指數成長。</span><span class="sxs-lookup"><span data-stu-id="f625a-119">Mobile devices – smartphones, feature phones, and tablets – continue to grow in popularity as a means to access the Web.</span></span> <span data-ttu-id="f625a-120">許多 web 開發人員及 web 導向公司，這表示它是提供絕佳的瀏覽體驗訪客使用這些裝置越來越重要。</span><span class="sxs-lookup"><span data-stu-id="f625a-120">For many web developers and web-oriented businesses, this means it's increasingly important to provide a great browsing experience for visitors using those devices.</span></span>

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a><span data-ttu-id="f625a-121">如何較早版本的 ASP.NET 支援行動瀏覽器</span><span class="sxs-lookup"><span data-stu-id="f625a-121">How earlier versions of ASP.NET supported mobile browsers</span></span>

<span data-ttu-id="f625a-122">ASP.NET 版本 2.0 到 3.5，包含*ASP.NET 行動控制項*： 一組伺服器控制項中的行動裝置的*System.Web.Mobile.dll*組件和*System.Web.UI.MobileControls*命名空間。</span><span class="sxs-lookup"><span data-stu-id="f625a-122">ASP.NET versions 2.0 to 3.5 included *ASP.NET Mobile Controls*: a set of server controls for mobile devices in the *System.Web.Mobile.dll* assembly and the *System.Web.UI.MobileControls* namespace.</span></span> <span data-ttu-id="f625a-123">在 ASP.NET 4 中，仍然包含該組件，但已被取代。</span><span class="sxs-lookup"><span data-stu-id="f625a-123">The assembly is still included in ASP.NET 4, but it is deprecated.</span></span> <span data-ttu-id="f625a-124">開發人員建議移轉到更現代的方法，例如這份文件中所述。</span><span class="sxs-lookup"><span data-stu-id="f625a-124">Developers are advised to migrate to more modern approaches, such as those described in this paper.</span></span>

<span data-ttu-id="f625a-125">ASP.NET 行動控制項為什麼標示為過時的原因是其設計導向周圍常見周圍 2005年和更早版本的行動電話。</span><span class="sxs-lookup"><span data-stu-id="f625a-125">The reason why ASP.NET Mobile Controls have been marked as obsolete is that their design is oriented around the mobile phones that were common around 2005 and earlier.</span></span> <span data-ttu-id="f625a-126">該紀元的 WAP 瀏覽器，控制項主要被設計來呈現 WML 或 cHTML 標記 （而不是標準 HTML)。</span><span class="sxs-lookup"><span data-stu-id="f625a-126">The controls are mainly designed to render WML or cHTML markup (instead of regular HTML) for the WAP browsers of that era.</span></span> <span data-ttu-id="f625a-127">但 WAP、 WML 和 cHTML 不再相關的大部分的專案，因為 HTML 現在已成為行動和桌面瀏覽器，類似於無所不在標記語言。</span><span class="sxs-lookup"><span data-stu-id="f625a-127">But WAP, WML, and cHTML are no longer relevant for most projects, because HTML has now become the ubiquitous markup language for mobile and desktop browsers alike.</span></span>

### <a name="the-challenges-of-supporting-mobile-devices-today"></a><span data-ttu-id="f625a-128">現在支援行動裝置的挑戰</span><span class="sxs-lookup"><span data-stu-id="f625a-128">The challenges of supporting mobile devices today</span></span>

<span data-ttu-id="f625a-129">雖然行動瀏覽器時，現在幾乎都支援 HTML，您仍然會面臨許多挑戰時以期能讓建立絕佳的行動瀏覽經驗：</span><span class="sxs-lookup"><span data-stu-id="f625a-129">Even though mobile browsers now almost universally support HTML, you will still face many challenges when aiming to create great mobile browsing experiences:</span></span>

- <span data-ttu-id="f625a-130">***螢幕大小***-行動裝置明顯不同表單中，和他們的螢幕通常是大部分小於桌上型監視器。</span><span class="sxs-lookup"><span data-stu-id="f625a-130">***Screen size*** - Mobile devices vary dramatically in form, and their screens are often much smaller than desktop monitors.</span></span> <span data-ttu-id="f625a-131">因此，您可能需要設計完全不同的版面配置。</span><span class="sxs-lookup"><span data-stu-id="f625a-131">So, you may need to design completely different page layouts for them.</span></span>
- <span data-ttu-id="f625a-132">***輸入方法***– 某些裝置具有 keypads，某些 styluses，而其他則使用觸控。</span><span class="sxs-lookup"><span data-stu-id="f625a-132">***Input methods*** – Some devices have keypads, some have styluses, others use touch.</span></span> <span data-ttu-id="f625a-133">您可能需要考慮多個瀏覽機制和資料的輸入的法。</span><span class="sxs-lookup"><span data-stu-id="f625a-133">You may need to consider multiple navigation mechanisms and data input methods.</span></span>
- <span data-ttu-id="f625a-134">***標準相容性***– 多行動瀏覽器不支援的最新的 HTML、 CSS 或 JavaScript 標準。</span><span class="sxs-lookup"><span data-stu-id="f625a-134">***Standards compliance*** – Many mobile browsers do not support the latest HTML, CSS, or JavaScript standards.</span></span>
- <span data-ttu-id="f625a-135">***頻寬***– 行動數據網路效能變化 （implementation），而某些使用者位於關稅收費的 mb 數。</span><span class="sxs-lookup"><span data-stu-id="f625a-135">***Bandwidth*** – Cellular data network performance varies wildly, and some end users are on tariffs that charge by the megabyte.</span></span>

<span data-ttu-id="f625a-136">沒有一體適用的解決方案。您的應用程式必須的外觀和行為以不同的方式根據裝置存取它。</span><span class="sxs-lookup"><span data-stu-id="f625a-136">There's no one-size-fits-all solution; your application will have to look and behave differently according to the device accessing it.</span></span> <span data-ttu-id="f625a-137">根據您要何種行動裝置層級，這可能是支援的更大的挑戰 web 開發人員比桌面 「 瀏覽器戰爭"曾經。</span><span class="sxs-lookup"><span data-stu-id="f625a-137">Depending on what level of mobile support you want, this can be a bigger challenge for web developers than the desktop "browser wars" ever was.</span></span>

<span data-ttu-id="f625a-138">一開始通常接近的第一次行動瀏覽器支援的開發人員認為務必只支援最新和最高性能智慧型手機 （例如 Windows Phone 7、 iPhone 或 Android） 時，可能是因為開發人員通常個人擁有這類裝置。</span><span class="sxs-lookup"><span data-stu-id="f625a-138">Developers approaching mobile browser support for the first time often initially think it's only important to support the latest and most sophisticated smartphones (e.g., Windows Phone 7, iPhone, or Android), perhaps because developers often personally own such devices.</span></span> <span data-ttu-id="f625a-139">不過，仍非常受歡迎，成本較低的電話，其擁有者執行並用來瀏覽網頁 – 尤其是在您更輕鬆地取得比寬頻連線的行動電話所在的國家 （地區）。</span><span class="sxs-lookup"><span data-stu-id="f625a-139">However, cheaper phones are still extremely popular, and their owners do use them to browse the web – especially in countries where mobile phones are easier to get than a broadband connection.</span></span> <span data-ttu-id="f625a-140">您的業務需要決定哪些範圍的裝置來支援以方法為考慮其可能購買的客戶。</span><span class="sxs-lookup"><span data-stu-id="f625a-140">Your business will need to decide what range of devices to support by considering its likely customers.</span></span> <span data-ttu-id="f625a-141">如果您要建置的 luxury 健全狀況 spa 線上冊，您就可能會讓只為目標進階的智慧型手機，商業決策，而如果您要建立影片的票證預約系統，您可能需要較不強大的功能與訪客帳戶電話。</span><span class="sxs-lookup"><span data-stu-id="f625a-141">If you're building an online brochure for a luxury health spa, you might make a business decision only to target advanced smartphones, whereas if you're creating a ticket booking system for a cinema, you probably need to account for visitors with less powerful feature phones.</span></span>

## <a name="architectural-options"></a><span data-ttu-id="f625a-142">架構選項</span><span class="sxs-lookup"><span data-stu-id="f625a-142">Architectural options</span></span>

<span data-ttu-id="f625a-143">我們要的 ASP.NET Web Form 或 MVC 的特定技術詳細資料之前，請注意，web 開發人員通常有三個主要的可能選項，可支援行動瀏覽器：</span><span class="sxs-lookup"><span data-stu-id="f625a-143">Before we get to the specific technical details of ASP.NET Web Forms or MVC, note that web developers in general have three main possible options for supporting mobile browsers:</span></span>

1. <span data-ttu-id="f625a-144">***不執行任何動作-*** 可以只建立標準的桌面導向的 web 應用程式，並依賴行動瀏覽器進行水平時轉譯。</span><span class="sxs-lookup"><span data-stu-id="f625a-144">***Do nothing –*** You can simply create a standard, desktop-oriented web application, and rely on mobile browsers to render it acceptably.</span></span> 

    - <span data-ttu-id="f625a-145">**利用**： 它是實作和維護 – 不需要額外工作最便宜的選項</span><span class="sxs-lookup"><span data-stu-id="f625a-145">**Advantage**: It's the cheapest option to implement and maintain – no extra work</span></span>
    - <span data-ttu-id="f625a-146">**缺點**： 提供的最差的使用者體驗：</span><span class="sxs-lookup"><span data-stu-id="f625a-146">**Disadvantage**: Gives the worst end-user experience:</span></span> 

        - <span data-ttu-id="f625a-147">最新的智慧型手機可能呈現您的 HTML 一樣桌面瀏覽器，但縮放和捲動水平與垂直取用您小型螢幕上的內容，仍會強制使用者。</span><span class="sxs-lookup"><span data-stu-id="f625a-147">The latest smartphones may render your HTML just as well as a desktop browser, but users will still be forced to zoom and scroll horizontally and vertically to consume your content on a small screen.</span></span> <span data-ttu-id="f625a-148">這是遠低於最佳化。</span><span class="sxs-lookup"><span data-stu-id="f625a-148">This is far from optimal.</span></span>
        - <span data-ttu-id="f625a-149">較舊的裝置和功能的電話可能無法令人滿意的方式呈現您的標記。</span><span class="sxs-lookup"><span data-stu-id="f625a-149">Older devices and feature phones may fail to render your markup in a satisfactory way.</span></span>
        - <span data-ttu-id="f625a-150">即使在最新平板電腦的裝置上 （其螢幕可以是膝上型電腦螢幕的大小），套用不同的互動規則。</span><span class="sxs-lookup"><span data-stu-id="f625a-150">Even on the latest tablet devices (whose screens can be as big as laptop screens), different interaction rules apply.</span></span> <span data-ttu-id="f625a-151">觸控輸入最適合具有較大的按鈕連結擴散的進一步切割，並沒有任何方法可以將滑鼠游標暫留飛出視窗功能表。</span><span class="sxs-lookup"><span data-stu-id="f625a-151">Touch-based input works best with larger buttons and links spread further apart, and there's no way to hover a mouse cursor over a fly-out menu.</span></span>
2. <span data-ttu-id="f625a-152">***解決這個問題，在用戶端上的*–** 小心使用 CSS 和[漸進式增強功能](http://en.wikipedia.org/wiki/Progressive_enhancement)標記、 樣式和指令碼，以調整為任何瀏覽器執行它們，您可以建立。</span><span class="sxs-lookup"><span data-stu-id="f625a-152">***Solve the problem on the client* –** With careful use of CSS and [progressive enhancement](http://en.wikipedia.org/wiki/Progressive_enhancement) you can create markup, styles, and scripts that adapt to whatever browser is running them.</span></span> <span data-ttu-id="f625a-153">例如，與[CSS 3 媒體查詢](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/)，您可以建立多欄版面配置，以開啟到單一資料行配置裝置的螢幕較窄比選擇的閾值。</span><span class="sxs-lookup"><span data-stu-id="f625a-153">For example, with [CSS 3 media queries](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), you could create a multi-column layout that turns into a single column layout on devices whose screens are narrower than a chosen threshold.</span></span> 

    - <span data-ttu-id="f625a-154">**利用**： 最佳化中使用，即使根據任何螢幕和輸入的特性它們有未知的新款裝置的特定裝置的轉譯</span><span class="sxs-lookup"><span data-stu-id="f625a-154">**Advantage**: Optimizes rendering for the specific device in use, even for unknown future devices according to whatever screen and input characteristics they have</span></span>
    - <span data-ttu-id="f625a-155">**利用**： 輕鬆可讓您跨所有裝置類型 – 最小的重複程式碼或投入時間的共用伺服器端邏輯</span><span class="sxs-lookup"><span data-stu-id="f625a-155">**Advantage**: Easily lets you share server-side logic across all device types – minimal duplication of code or effort</span></span>
    - <span data-ttu-id="f625a-156">**缺點**： 行動裝置會因此不同桌上型裝置，您可能會真的要行動頁面是完全不同於您桌面的網頁，顯示不同的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="f625a-156">**Disadvantage**: Mobile devices are so different from desktop devices that you may really want your mobile pages to be completely different from your desktop pages, showing different information.</span></span> <span data-ttu-id="f625a-157">這類變化可能會沒有效率或不可能達成穩當地 CSS 光是透過特別考慮如何不一致較舊的裝置解譯 CSS 規則。</span><span class="sxs-lookup"><span data-stu-id="f625a-157">Such variations can be inefficient or impossible to achieve robustly through CSS alone, especially considering how inconsistently older devices interpret CSS rules.</span></span> <span data-ttu-id="f625a-158">這是非常有用的 CSS 3 屬性。</span><span class="sxs-lookup"><span data-stu-id="f625a-158">This is particularly true of CSS 3 attributes.</span></span>
    - <span data-ttu-id="f625a-159">**缺點**： 不提供支援各種不同的伺服器端邏輯和工作流程中的不同的裝置。</span><span class="sxs-lookup"><span data-stu-id="f625a-159">**Disadvantage**: Provides no support for varying server-side logic and workflows for different devices.</span></span> <span data-ttu-id="f625a-160">您，例如無法透過單獨 CSS 實作簡化購物車簽出工作流程為行動使用者。</span><span class="sxs-lookup"><span data-stu-id="f625a-160">You can't, for example, implement a simplified shopping cart checkout workflow for mobile users by means of CSS alone.</span></span>
    - <span data-ttu-id="f625a-161">**缺點**： 效率不佳的頻寬用量。</span><span class="sxs-lookup"><span data-stu-id="f625a-161">**Disadvantage**: Inefficient bandwidth use.</span></span> <span data-ttu-id="f625a-162">您的伺服器可能要傳輸的標記和樣式套用至所有可能的裝置，即使目標裝置只會使用該資訊的子集。</span><span class="sxs-lookup"><span data-stu-id="f625a-162">You server may have to transmit the markup and styles that apply to all possible devices, even though the target device will only use a subset of that information.</span></span>
3. <span data-ttu-id="f625a-163">***解決這個問題，在伺服器上的*–** 如果您的伺服器可讓您知道哪些裝置正在存取它-，或在該裝置，例如其螢幕大小和輸入的法，最低的特性，無論是行動裝置-網域控制站可以執行不同的邏輯和輸出不同的 HTML 標記。</span><span class="sxs-lookup"><span data-stu-id="f625a-163">***Solve the problem on the server* –** If your server knows what device is accessing it – or at least the characteristics of that device, such as its screen size and input method, and whether it's a mobile device – it can run different logic and output different HTML markup.</span></span> 

    - <span data-ttu-id="f625a-164">**優點：** 最大的彈性。</span><span class="sxs-lookup"><span data-stu-id="f625a-164">**Advantage:** Maximum flexibility.</span></span> <span data-ttu-id="f625a-165">沒有任何限制，您可以在多少改變您的伺服器端邏輯的 asp.net 或最佳化您想要的裝置特定配置的標記。</span><span class="sxs-lookup"><span data-stu-id="f625a-165">There's no limit to how much you can vary your server-side logic for mobiles or optimize your markup for the desired, device-specific layout.</span></span>
    - <span data-ttu-id="f625a-166">**優點：** 有效率的頻寬用量。</span><span class="sxs-lookup"><span data-stu-id="f625a-166">**Advantage:** Efficient bandwidth use.</span></span> <span data-ttu-id="f625a-167">您只需要傳輸的標記和目標裝置所要使用的樣式資訊。</span><span class="sxs-lookup"><span data-stu-id="f625a-167">You only need to transmit the markup and styling information that the target device is going to use.</span></span>
    - <span data-ttu-id="f625a-168">**缺點：** 有時候會強制投入時間量或程式碼的重複 （例如，讓您建立 Web Form 網頁的 MVC 檢視相似但稍微不同的複本）。</span><span class="sxs-lookup"><span data-stu-id="f625a-168">**Disadvantage:** Sometimes forces repetition of effort or code (e.g., making you create similar but slightly different copies of your Web Forms pages or MVC views).</span></span> <span data-ttu-id="f625a-169">其中可能會分解一般邏輯為基礎的圖層或服務，但儘管如此，您的 UI 程式碼或標記的某些部分可能需要複製而且以平行方式加以維護。</span><span class="sxs-lookup"><span data-stu-id="f625a-169">Where possible you will factor out common logic into an underlying layer or service, but still, some parts of your UI code or markup may have to be duplicated and then maintained in parallel.</span></span>
    - <span data-ttu-id="f625a-170">**缺點：** 裝置偵測並非易事。</span><span class="sxs-lookup"><span data-stu-id="f625a-170">**Disadvantage:** Device detection is not trivial.</span></span> <span data-ttu-id="f625a-171">它需要的清單或已知的裝置類型和它們的特性 （這不一定完全保持最新狀態） 的資料庫，並不保證能夠正確地符合每個傳入要求。</span><span class="sxs-lookup"><span data-stu-id="f625a-171">It requires a list or database of known device types and their characteristics (which may not always be perfectly up-to-date) and isn't guaranteed to accurately match every incoming request.</span></span> <span data-ttu-id="f625a-172">本文件稍後說明某些選項，且其犯的錯誤。</span><span class="sxs-lookup"><span data-stu-id="f625a-172">This document describes some options and their pitfalls later.</span></span>

<span data-ttu-id="f625a-173">若要取得最佳結果，大部分的開發人員會發現他們需要結合選項 (2) 和 (3)。</span><span class="sxs-lookup"><span data-stu-id="f625a-173">To get the best results, most developers find they need to combine options (2) and (3).</span></span> <span data-ttu-id="f625a-174">次要文體差異使用 CSS 或甚至 JavaScript，在用戶端上最適合可調整，而資料、 工作流程或標記中的主要差異最有效地實作伺服器端程式碼中。</span><span class="sxs-lookup"><span data-stu-id="f625a-174">Minor stylistic differences are best accommodated on the client using CSS or even JavaScript, whereas major differences in data, workflow, or markup are most effectively implemented in server-side code.</span></span>

### <a name="this-paper-focuses-on-server-side-techniques"></a><span data-ttu-id="f625a-175">本文著重於伺服器端技術</span><span class="sxs-lookup"><span data-stu-id="f625a-175">This paper focuses on server-side techniques</span></span>

<span data-ttu-id="f625a-176">因為 ASP.NET Web Form 和 MVC 是這兩種主要伺服器端技術，這份技術白皮書將著重於伺服器端技術，可讓您產生不同的標記和行動瀏覽器的邏輯。</span><span class="sxs-lookup"><span data-stu-id="f625a-176">Since ASP.NET Web Forms and MVC are both primarily server-side technologies, this white paper will focus on server-side techniques that let you produce different markup and logic for mobile browsers.</span></span> <span data-ttu-id="f625a-177">當然，您也可以結合這與任何用戶端技術 （例如，CSS 3 媒體查詢，JavaScript 漸進式增強功能），但是，就是更網頁設計比 ASP.NET 程式開發。</span><span class="sxs-lookup"><span data-stu-id="f625a-177">Of course, you can also combine this with any client-side technique (e.g., CSS 3 media queries, progressive-enhancement JavaScript), but that's more a matter of web design than ASP.NET development.</span></span>

## <a name="browser-and-device-detection"></a><span data-ttu-id="f625a-178">瀏覽器及裝置偵測</span><span class="sxs-lookup"><span data-stu-id="f625a-178">Browser and device detection</span></span>

<span data-ttu-id="f625a-179">如需支援行動裝置的所有伺服器端技術金鑰先決條件是，知道您的訪客使用哪一種裝置。</span><span class="sxs-lookup"><span data-stu-id="f625a-179">The key prerequisite for all server-side techniques for supporting mobile devices is to know what device your visitor is using.</span></span> <span data-ttu-id="f625a-180">事實上，甚至更好了解該裝置的製造商和型號號碼知道*特性*的裝置。</span><span class="sxs-lookup"><span data-stu-id="f625a-180">In fact, even better than knowing the manufacturer and model number of that device is knowing the *characteristics* of the device.</span></span> <span data-ttu-id="f625a-181">特性可能包括：</span><span class="sxs-lookup"><span data-stu-id="f625a-181">Characteristics may include:</span></span>

- <span data-ttu-id="f625a-182">為行動裝置嗎？</span><span class="sxs-lookup"><span data-stu-id="f625a-182">Is it a mobile device?</span></span>
- <span data-ttu-id="f625a-183">輸入的法 （滑鼠] / [鍵盤、 觸控、 數字鍵台、 搖桿，...）</span><span class="sxs-lookup"><span data-stu-id="f625a-183">Input method (mouse/keyboard, touch, keypad, joystick, …)</span></span>
- <span data-ttu-id="f625a-184">螢幕大小 （實體和像素為單位）</span><span class="sxs-lookup"><span data-stu-id="f625a-184">Screen size (physically and in pixels)</span></span>
- <span data-ttu-id="f625a-185">支援的媒體和資料格式</span><span class="sxs-lookup"><span data-stu-id="f625a-185">Supported media and data formats</span></span>
- <span data-ttu-id="f625a-186">等等。</span><span class="sxs-lookup"><span data-stu-id="f625a-186">Etc.</span></span>

<span data-ttu-id="f625a-187">最好是讓特性與模型數目為基礎的決策，因為，然後您會更有能力處理新款裝置。</span><span class="sxs-lookup"><span data-stu-id="f625a-187">It's better to make decisions based on characteristics than model number, because then you'll be better equipped to handle future devices.</span></span>

### <a name="using-aspnets-built-in-browser-detection-support"></a><span data-ttu-id="f625a-188">使用 ASP。網路的內建瀏覽器偵測支援</span><span class="sxs-lookup"><span data-stu-id="f625a-188">Using ASP.NET's built-in browser detection support</span></span>

<span data-ttu-id="f625a-189">ASP.NET Web Form 和 MVC 的開發人員可以藉由檢查的內容立即探索造訪瀏覽器的重要特性*Request.Browser*物件。</span><span class="sxs-lookup"><span data-stu-id="f625a-189">ASP.NET Web Forms and MVC developers can immediately discover important characteristics of a visiting browser by inspecting properties of the *Request.Browser* object.</span></span> <span data-ttu-id="f625a-190">例如，請參閱</span><span class="sxs-lookup"><span data-stu-id="f625a-190">For example, see</span></span>

- <span data-ttu-id="f625a-191">Request.Browser.IsMobileDevice</span><span class="sxs-lookup"><span data-stu-id="f625a-191">Request.Browser.IsMobileDevice</span></span>
- <span data-ttu-id="f625a-192">Request.Browser.MobileDeviceManufacturer Request.Browser.MobileDeviceModel</span><span class="sxs-lookup"><span data-stu-id="f625a-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span></span>
- <span data-ttu-id="f625a-193">Request.Browser.ScreenPixelsWidth</span><span class="sxs-lookup"><span data-stu-id="f625a-193">Request.Browser.ScreenPixelsWidth</span></span>
- <span data-ttu-id="f625a-194">Request.Browser.SupportsXmlHttp</span><span class="sxs-lookup"><span data-stu-id="f625a-194">Request.Browser.SupportsXmlHttp</span></span>
- <span data-ttu-id="f625a-195">..和許多其他</span><span class="sxs-lookup"><span data-stu-id="f625a-195">…and many others</span></span>

<span data-ttu-id="f625a-196">在幕後，ASP.NET 平台符合傳入*User-agent* (UAC) 的 HTTP 標頭，針對一組瀏覽器定義 XML 檔案中的規則運算式。</span><span class="sxs-lookup"><span data-stu-id="f625a-196">Behind the scenes, the ASP.NET platform matches the incoming *User-Agent* (UA) HTTP header against regular expressions in a set of Browser Definition XML files.</span></span> <span data-ttu-id="f625a-197">預設平台包括定義許多常見的行動裝置，而且您可以加入自訂瀏覽器定義檔案代表您想要識別的其他項目。</span><span class="sxs-lookup"><span data-stu-id="f625a-197">By default the platform includes definitions for many common mobile devices, and you can add custom Browser Definition files for others you wish to recognize.</span></span> <span data-ttu-id="f625a-198">如需詳細資訊，請參閱 MSDN 頁面[ASP.NET Web 伺服器控制項和瀏覽器能力](https://msdn.microsoft.com/library/x3k2ssx2.aspx)。</span><span class="sxs-lookup"><span data-stu-id="f625a-198">For more details, see the MSDN page [ASP.NET Web Server Controls and Browser Capabilities](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span></span>

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a><span data-ttu-id="f625a-199">使用透過 51Degrees.mobi Foundation WURFL 裝置資料庫</span><span class="sxs-lookup"><span data-stu-id="f625a-199">Using the WURFL device database via 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="f625a-200">雖然 ASP。網路的內建瀏覽器偵測支援將足以說明許多應用程式時，有兩種主要的情況下它可能不夠：</span><span class="sxs-lookup"><span data-stu-id="f625a-200">While ASP.NET's built-in browser detection support will be sufficient for many applications, there are two main cases when it might not be enough:</span></span>

- <span data-ttu-id="f625a-201">***您想要識別最新裝置***（而不需要手動建立它們的瀏覽器定義檔案）。</span><span class="sxs-lookup"><span data-stu-id="f625a-201">***You want to recognize the latest devices***(without manually creating Browser Definition files for them).</span></span> <span data-ttu-id="f625a-202">請注意，.NET 4 的瀏覽器定義檔案不是不夠新，無法辨識 Windows Phone 7、 Android 手機、 Opera Mobile 瀏覽器或 Apple Ipad。</span><span class="sxs-lookup"><span data-stu-id="f625a-202">Note that .NET 4's Browser Definition files are not recent enough to recognize Windows Phone 7, Android phones, Opera Mobile browsers, or Apple iPads.</span></span>
- <span data-ttu-id="f625a-203">***您需要裝置功能的詳細的資訊***。</span><span class="sxs-lookup"><span data-stu-id="f625a-203">***You need more detailed information about device capabilities***.</span></span> <span data-ttu-id="f625a-204">您可能需要了解裝置的輸入法 （例如觸控 vs 字鍵台），或哪些音訊格式瀏覽器支援。</span><span class="sxs-lookup"><span data-stu-id="f625a-204">You may need to know about a device's input method (e.g., touch vs keypad), or what audio formats the browser supports.</span></span> <span data-ttu-id="f625a-205">這項資訊無法使用標準的瀏覽器定義檔案中。</span><span class="sxs-lookup"><span data-stu-id="f625a-205">This information isn't available in the standard Browser Definition files.</span></span>

<span data-ttu-id="f625a-206">[*無線通用資源檔*(WURFL) 專案](http://wurfl.sourceforge.net/)維護更多保持最新狀態和詳細資訊在使用行動裝置今天。</span><span class="sxs-lookup"><span data-stu-id="f625a-206">The [*Wireless Universal Resource File* (WURFL) project](http://wurfl.sourceforge.net/) maintains much more up-to-date and detailed information about mobile devices in use today.</span></span>

<span data-ttu-id="f625a-207">適用於.NET 開發人員最棒的工具是該 ASP。網路的瀏覽器偵測功能，所以可強化克服這些問題。</span><span class="sxs-lookup"><span data-stu-id="f625a-207">The great news for .NET developers is that ASP.NET's browser detection feature is extensible, so it's possible to enhance it to overcome these problems.</span></span> <span data-ttu-id="f625a-208">例如，您可以在其中加入開放原始碼[ *51Degrees.mobi Foundation* ](https://github.com/51Degrees/dotNET-Device-Detection)至您的專案程式庫。</span><span class="sxs-lookup"><span data-stu-id="f625a-208">For example, you can add the open source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) library to your project.</span></span> <span data-ttu-id="f625a-209">是瀏覽器功能提供者 （可用於 Web Form 和 MVC 應用程式），會直接讀取 WURFL 資料並將它連結到 ASP 或 ASP.NET IHttpModule。網路的內建瀏覽器偵測機制。</span><span class="sxs-lookup"><span data-stu-id="f625a-209">It's an ASP.NET IHttpModule or Browser Capabilities Provider (usable on both Web Forms and MVC applications), that directly reads WURFL data and hooks it into ASP.NET's built-in browser detection mechanism.</span></span> <span data-ttu-id="f625a-210">一旦您已安裝模組， *Request.Browser*會突然包含許多比較精確和詳細資訊： 則會正確辨識許多先前所述的裝置，並列出其功能 （包括其他功能，例如輸入法）。</span><span class="sxs-lookup"><span data-stu-id="f625a-210">Once you've installed the module, *Request.Browser* will suddenly contain a lot more accurate and detailed information: it will correctly recognize many of the devices previously mentioned and list their capabilities (including additional capabilities such as input method).</span></span> <span data-ttu-id="f625a-211">請參閱專案的文件，如需詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="f625a-211">See the project's documentation for more details.</span></span>

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="f625a-212">Web Form 應用程式可以如何呈現行動特定頁面</span><span class="sxs-lookup"><span data-stu-id="f625a-212">How Web Forms applications can present mobile-specific pages</span></span>

<span data-ttu-id="f625a-213">根據預設，以下是常見的行動裝置上顯示新的 Web Form 應用程式的方式：</span><span class="sxs-lookup"><span data-stu-id="f625a-213">By default, here's how a brand new Web Forms application displays on common mobile devices:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

<span data-ttu-id="f625a-214">很明顯地，未配置看起來非常行動設備友善 – 此頁面針對大型、 橫向的監視器，不適用於小型縱向導向螢幕的設計。</span><span class="sxs-lookup"><span data-stu-id="f625a-214">Clearly, neither layout looks very mobile-friendly – this page was designed for a large, landscape-oriented monitor, not for a small portrait-oriented screen.</span></span> <span data-ttu-id="f625a-215">因此可以您做什麼資訊？</span><span class="sxs-lookup"><span data-stu-id="f625a-215">So what can you do about it?</span></span>

<span data-ttu-id="f625a-216">如本文稍早所述，有許多方式來調整您的行動裝置的網頁。</span><span class="sxs-lookup"><span data-stu-id="f625a-216">As discussed earlier in this paper, there are many ways to tailor your pages for mobile devices.</span></span> <span data-ttu-id="f625a-217">有些技術則是伺服器為基礎，其他用戶端上執行。</span><span class="sxs-lookup"><span data-stu-id="f625a-217">Some techniques are server-based, others run on the client.</span></span>

### <a name="creating-a-mobile-specific-master-page"></a><span data-ttu-id="f625a-218">建立行動裝置特定的主版頁面</span><span class="sxs-lookup"><span data-stu-id="f625a-218">Creating a mobile-specific master page</span></span>

<span data-ttu-id="f625a-219">根據您的需求，您可以使用相同的 Web Form 所有造訪者，但有兩個不同的主版頁面： 一個用於桌上型電腦的訪客，另一個用於行動裝置的訪客。</span><span class="sxs-lookup"><span data-stu-id="f625a-219">Depending on your requirements, you may be able to use the same Web Forms for all visitors, but have two separate master pages: one for desktop visitors, another for mobile visitors.</span></span> <span data-ttu-id="f625a-220">這可讓您變更 CSS 樣式表或您最上層的 HTML 標記，以符合行動裝置，而不未強制您重複的任何頁面邏輯的彈性。</span><span class="sxs-lookup"><span data-stu-id="f625a-220">This gives you the flexibility of changing the CSS stylesheet or your top-level HTML markup to suit mobile devices, without forcing you to duplicate any page logic.</span></span>

<span data-ttu-id="f625a-221">這是容易的。</span><span class="sxs-lookup"><span data-stu-id="f625a-221">This is easy to do.</span></span> <span data-ttu-id="f625a-222">例如，您可以加入 PreInit 處理常式，如下所示的 Web 表單：</span><span class="sxs-lookup"><span data-stu-id="f625a-222">For example, you can add a PreInit handler such as the following to a Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

<span data-ttu-id="f625a-223">現在，建立您的應用程式的最上層資料夾中呼叫 Mobile.Master 主版頁面，將會在偵測到行動裝置時使用。</span><span class="sxs-lookup"><span data-stu-id="f625a-223">Now, create a master page called Mobile.Master in the top-level folder of your application, and it will be used when a mobile device is detected.</span></span> <span data-ttu-id="f625a-224">視您行動主要頁面可以參考特定行動裝置版的 CSS 樣式表。</span><span class="sxs-lookup"><span data-stu-id="f625a-224">Your mobile master page can reference a mobile-specific CSS stylesheet if necessary.</span></span> <span data-ttu-id="f625a-225">桌面的訪客還是會看到您預設主版頁面上，行動非。</span><span class="sxs-lookup"><span data-stu-id="f625a-225">Desktop visitors will still see your default master page, not the mobile one.</span></span>

### <a name="creating-independent-mobile-specific-web-forms"></a><span data-ttu-id="f625a-226">建立獨立的行動裝置特定 Web Form</span><span class="sxs-lookup"><span data-stu-id="f625a-226">Creating independent mobile-specific Web Forms</span></span>

<span data-ttu-id="f625a-227">最大的彈性，您可以深入比有不同的主版頁面進行不同的裝置類型。</span><span class="sxs-lookup"><span data-stu-id="f625a-227">For maximum flexibility, you can go much further than just having separate master pages for different device types.</span></span> <span data-ttu-id="f625a-228">您可以實作兩個*完全分隔的 Web Form 網頁的設定*– 一個設定的桌面瀏覽器，另一個設定行動裝置的 asp.net。</span><span class="sxs-lookup"><span data-stu-id="f625a-228">You can implement two *totally separate sets of Web Forms pages* – one set for desktop browsers, another set for mobiles.</span></span> <span data-ttu-id="f625a-229">這最適合如果您想要呈現給行動裝置的訪客的非常不同的資訊或工作流程。</span><span class="sxs-lookup"><span data-stu-id="f625a-229">This works best if you want to present very different information or workflows to mobile visitors.</span></span> <span data-ttu-id="f625a-230">本章節的其餘部分將說明這種方法，在詳細資料。</span><span class="sxs-lookup"><span data-stu-id="f625a-230">The rest of this section describes this approach in detail.</span></span>

<span data-ttu-id="f625a-231">假設您已經有的桌面瀏覽器所設計的 Web Form 應用程式，是建立在您的專案中，稱為 「 行動 」 的子資料夾，並建置行動頁面有最簡單的方式繼續進行。</span><span class="sxs-lookup"><span data-stu-id="f625a-231">Assuming you already have a Web Forms application designed for desktop browsers, the easiest way to proceed is to create a subfolder called "Mobile" within your project, and build your mobile pages there.</span></span> <span data-ttu-id="f625a-232">您可以建構完整的子站台，與它自己的主版頁面、 樣式表和頁面，使用完全相同的技巧，您會使用任何其他 Web Form 應用程式。</span><span class="sxs-lookup"><span data-stu-id="f625a-232">You can construct an entire sub-site, with its own master pages, style sheets, and pages, using all the same techniques that you'd use for any other Web Forms application.</span></span> <span data-ttu-id="f625a-233">您不需要產生行動裝置對等*每*頁面中您桌面的網站; 您可以選擇哪些功能子集的合理行動訪客。</span><span class="sxs-lookup"><span data-stu-id="f625a-233">You don't necessarily need to produce a mobile equivalent for *every* page in your desktop site; you can choose what subset of functionality makes sense for mobile visitors.</span></span>

<span data-ttu-id="f625a-234">您的行動網頁可以共用一般靜態資源 (例如影像、 JavaScript 或 CSS 檔案) 您一般的頁面，如果您想使用。</span><span class="sxs-lookup"><span data-stu-id="f625a-234">Your mobile pages can share common static resources (such as images, JavaScript, or CSS files) with your regular pages if you wish.</span></span> <span data-ttu-id="f625a-235">「 行動 」 資料夾將會因為*不*標示為個別的應用程式裝載在 IIS 中 （它是只 Web Form 網頁的簡單子資料夾），它會也共用所有相同設定、 工作階段資料和其他基礎結構做為您桌面的頁面。</span><span class="sxs-lookup"><span data-stu-id="f625a-235">Since your "Mobile" folder will *not* be marked as a separate application when hosted in IIS (it's just a simple subfolder of Web Forms pages), it will also share all the same configuration, Session data, and other infrastructure as your desktop pages.</span></span>

> [!NOTE]
> <span data-ttu-id="f625a-236">由於這種方法通常牽涉到某些程式碼的重複 （行動頁面可能會與桌面的網頁共用一些相似之處），請務必出任何一般商務邏輯或資料存取程式碼至共用的基礎層或服務的因素。</span><span class="sxs-lookup"><span data-stu-id="f625a-236">Since this approach usually involves some duplication of code (mobile pages are likely to share some similarities with desktop pages), it's important to factor out any common business logic or data access code into a shared underlying layer or service.</span></span> <span data-ttu-id="f625a-237">否則，您將 double 建立和維護您的應用程式的投入時間。</span><span class="sxs-lookup"><span data-stu-id="f625a-237">Otherwise, you'll double the effort of creating and maintaining your application.</span></span>


#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a><span data-ttu-id="f625a-238">重新導向至您的行動網頁行動訪客</span><span class="sxs-lookup"><span data-stu-id="f625a-238">Redirecting mobile visitors to your mobile pages</span></span>

<span data-ttu-id="f625a-239">通常很方便只在重新導向行動頁面行動訪客*第一個*要求其瀏覽工作階段中，不是在其工作階段中的每個要求，因為：</span><span class="sxs-lookup"><span data-stu-id="f625a-239">It's often convenient to redirect mobile visitors to the mobile pages only on the *first* request in their browsing session (and not on every request in their session), because:</span></span>

- <span data-ttu-id="f625a-240">您可以輕鬆地讓行動裝置存取您桌面的網頁，當中 – 只要您前往 「 桌面版本 」 的主版頁面上放置連結訪客。</span><span class="sxs-lookup"><span data-stu-id="f625a-240">You can then easily allow mobile visitors to access your desktop pages if they wish – just put a link on your master page that goes to "Desktop version".</span></span> <span data-ttu-id="f625a-241">造訪者將不會重新導向回到行動裝置 頁面上，因為它已不再第一個要求其工作階段中。</span><span class="sxs-lookup"><span data-stu-id="f625a-241">The visitor won't be redirected back to a mobile page, because it's no longer the first request in their session.</span></span>
- <span data-ttu-id="f625a-242">它可避免干擾要求的任何動態資源 （例如，如果您有網站的桌面和行動裝置版的組件會顯示在 IFRAME 中或特定 Ajax 處理常式中的通用 Web 表單），您的站台桌面和行動裝置版的組件之間共用的風險</span><span class="sxs-lookup"><span data-stu-id="f625a-242">It avoids the risk of interfering with requests for any dynamic resources shared between desktop and mobile parts of your site (e.g., if you have a common Web Form that both desktop and mobile parts of your site display in an IFRAME, or certain Ajax handlers)</span></span>

<span data-ttu-id="f625a-243">若要這樣做，您可以將放在您重新導向邏輯**工作階段\_啟動**方法。</span><span class="sxs-lookup"><span data-stu-id="f625a-243">To do this, you can place your redirection logic in a **Session\_Start** method.</span></span> <span data-ttu-id="f625a-244">例如，將下列方法加入 Global.asax.cs 檔案：</span><span class="sxs-lookup"><span data-stu-id="f625a-244">For example, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="f625a-245">設定表單驗證以尊重您的行動裝置頁面</span><span class="sxs-lookup"><span data-stu-id="f625a-245">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="f625a-246">請注意，表單驗證會使特定假設，它可以將重新導向訪客期間和之後驗證程序：</span><span class="sxs-lookup"><span data-stu-id="f625a-246">Note that Forms Authentication makes certain assumptions about where it can redirect visitors during and after the authentication process:</span></span>

- <span data-ttu-id="f625a-247">當使用者需要驗證時，表單驗證將會重新導向至您的桌面登入頁面，不論它們是否桌面或行動裝置的使用者 (因為它只需要的概念*一個*登入 URL)。</span><span class="sxs-lookup"><span data-stu-id="f625a-247">When a user needs to be authenticated, Forms Authentication will redirect them to your desktop login page, regardless of whether they're a desktop or mobile user (because it only has a concept of *one* login URL).</span></span> <span data-ttu-id="f625a-248">假設您想要以不同的方式設定您的行動裝置的登入頁面的樣式，您需要加強桌面登入頁面，以便將行動裝置的使用者重新導向至不同的行動裝置登入頁面。</span><span class="sxs-lookup"><span data-stu-id="f625a-248">Assuming you want to style your mobile login page differently, you need to enhance your desktop login page so that it redirects mobile users to a separate mobile login page.</span></span> <span data-ttu-id="f625a-249">例如，加入下列程式碼加入您**桌面**登入頁面程式碼後置：</span><span class="sxs-lookup"><span data-stu-id="f625a-249">For example, add the following code to your **desktop** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- <span data-ttu-id="f625a-250">使用者成功登入之後，表單驗證會根據預設將他們重新導向到您桌面的首頁 (因為它只需要的概念*一個*預設頁面)。</span><span class="sxs-lookup"><span data-stu-id="f625a-250">After a user successfully logs in, Forms Authentication will by default redirect them to your desktop home page (because it only has a concept of *one* default page).</span></span> <span data-ttu-id="f625a-251">您要增強您的行動裝置的登入頁面，使它會重新導向至行動首頁之後成功登入。</span><span class="sxs-lookup"><span data-stu-id="f625a-251">You need to enhance your mobile login page so that it redirects to the mobile home page after a successful log-in.</span></span> <span data-ttu-id="f625a-252">例如，加入下列程式碼加入您**行動**登入頁面程式碼後置：</span><span class="sxs-lookup"><span data-stu-id="f625a-252">For example, add the following code to your **mobile** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  <span data-ttu-id="f625a-253">此程式碼假設您的網頁有稱為 LoginUser，如所示的預設專案範本 」 的登入伺服器控制項。</span><span class="sxs-lookup"><span data-stu-id="f625a-253">This code assumes your page has a Login server control called LoginUser, as in the default project template.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="f625a-254">使用輸出快取</span><span class="sxs-lookup"><span data-stu-id="f625a-254">Working with Output Caching</span></span>

<span data-ttu-id="f625a-255">如果您使用輸出快取，請注意，根據預設，它是桌面的使用者，可以造訪 （導致快取其輸出） 的特定的 URL，後面接著就會接收的快取的桌面輸出的行動使用者。</span><span class="sxs-lookup"><span data-stu-id="f625a-255">If you're using output caching, beware that by default it's possible for a desktop user to visit a certain URL (causing its output to be cached), followed by a mobile user who then receives the cached desktop output.</span></span> <span data-ttu-id="f625a-256">不論您只是不同的主版頁面依裝置類型或實作完全不同的 Web Form，每個裝置類型，這項警告皆適用。</span><span class="sxs-lookup"><span data-stu-id="f625a-256">This warning applies whether you're just varying your master page by device type, or implementing totally separate Web Forms per device type.</span></span>

<span data-ttu-id="f625a-257">若要避免此問題，您可以指示要變更快取項目，根據是否訪客使用行動裝置的 ASP.NET。</span><span class="sxs-lookup"><span data-stu-id="f625a-257">To avoid the problem, you can instruct ASP.NET to vary the cache entry according to whether the visitor is using a mobile device.</span></span> <span data-ttu-id="f625a-258">VaryByCustom 將參數加入至您的頁面 OutputCache 宣告，如下所示：</span><span class="sxs-lookup"><span data-stu-id="f625a-258">Add a VaryByCustom parameter to your page's OutputCache declaration as follows:</span></span>

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

<span data-ttu-id="f625a-259">接下來，定義*isMobileDevice*做為自訂快取新增下列方法的參數會覆寫以 Global.asax.cs 檔案：</span><span class="sxs-lookup"><span data-stu-id="f625a-259">Next, define *isMobileDevice* as a custom cache parameter by adding the following method override to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

<span data-ttu-id="f625a-260">這可確保行動網頁訪客沒有收到先前置於快取中的桌面的訪客的輸出。</span><span class="sxs-lookup"><span data-stu-id="f625a-260">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="f625a-261">工作範例</span><span class="sxs-lookup"><span data-stu-id="f625a-261">A working example</span></span>

<span data-ttu-id="f625a-262">若要查看作用中的這些技術，請下載[這份技術白皮書的程式碼範例](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="f625a-262">To see these techniques in action, download [this white paper's code samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="f625a-263">Web Form 範例應用程式會自動重新導向至行動使用者一組稱為 「 行動裝置版的子資料夾中的行動特定頁面。</span><span class="sxs-lookup"><span data-stu-id="f625a-263">The Web Forms sample application automatically redirects mobile users to a set of mobile-specific pages in a subfolder called Mobile.</span></span> <span data-ttu-id="f625a-264">標記和那些頁面的樣式更適合行動瀏覽器，您可以看到從下列螢幕擷取畫面：</span><span class="sxs-lookup"><span data-stu-id="f625a-264">The markup and styling of those pages is better optimized for mobile browsers, as you can see from the following screenshots:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

<span data-ttu-id="f625a-265">更多秘訣行動瀏覽器最佳化您的標記和 CSS 的詳細資訊，請參閱 「 樣式行動頁面行動瀏覽器 」 在本文件稍後的一節。</span><span class="sxs-lookup"><span data-stu-id="f625a-265">For more tips about optimizing your markup and CSS for mobile browsers, see the section "Styling mobile pages for mobile browsers" later in this document.</span></span>

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="f625a-266">ASP.NET MVC 應用程式可以如何呈現行動特定頁面</span><span class="sxs-lookup"><span data-stu-id="f625a-266">How ASP.NET MVC applications can present mobile-specific pages</span></span>

<span data-ttu-id="f625a-267">由於模型-檢視-控制器模式可分隔 （在控制站） 的應用程式邏輯，從呈現邏輯 （在檢視中），您可以選擇從任何下列方式來處理伺服器端程式碼中的行動支援：</span><span class="sxs-lookup"><span data-stu-id="f625a-267">Since the Model-View-Controller pattern decouples application logic (in controllers) from presentation logic (in views), you can choose from any of the following approaches to handling mobile support in server-side code:</span></span>

1. <span data-ttu-id="f625a-268">***桌上型電腦和行動瀏覽器，使用相同的控制器和檢視，但會呈現不同的 Razor 版面配置，根據裝置類型 * 檢視。**</span><span class="sxs-lookup"><span data-stu-id="f625a-268">***Use the same controllers and views for both desktop and mobile browsers, but render the views with different Razor layouts depending on the device type*.**</span></span> <span data-ttu-id="f625a-269">如果您在所有的裝置上顯示相同的資料，但只想要提供不同的 CSS 樣式表，或是變更幾個最上層的 HTML 項目，行動裝置的 asp.net，這個選項最有用。</span><span class="sxs-lookup"><span data-stu-id="f625a-269">This option works best if you're displaying identical data on all devices, but simply want to supply different CSS stylesheets or change a few top-level HTML elements for mobiles.</span></span>
2. <span data-ttu-id="f625a-270">***對於桌面和行動裝置版的瀏覽器，使用相同的控制站，但會呈現每種裝置類型的不同檢視***。</span><span class="sxs-lookup"><span data-stu-id="f625a-270">***Use the same controllers for both desktop and mobile browsers, but render different views depending on the device type***.</span></span> <span data-ttu-id="f625a-271">如果您使用大約顯示相同的資料，對於使用者，提供相同的工作流程，這個選項最有用，但要轉譯非常不同的 HTML 標記，以符合所用的裝置。</span><span class="sxs-lookup"><span data-stu-id="f625a-271">This option works best if you're displaying roughly the same data and providing the same workflows for end users, but want to render very different HTML markup to suit the device being used.</span></span>
3. <span data-ttu-id="f625a-272">***建立桌面和行動瀏覽器，實作無關的控制器和檢視每個不同的區域 *。**</span><span class="sxs-lookup"><span data-stu-id="f625a-272">***Create separate areas for desktop and mobile browsers, implementing independent controllers and views for each*.**</span></span> <span data-ttu-id="f625a-273">如果您正在顯示非常不同的螢幕，包含不同的資訊，導致使用者透過不同的工作流程適合他們的裝置類型，這個選項最有用。</span><span class="sxs-lookup"><span data-stu-id="f625a-273">This option works best if you're displaying very different screens, containing different information and leading the user through different workflows optimized for their device type.</span></span> <span data-ttu-id="f625a-274">這可能表示部分重複程式碼，但您可以最小化，析出至基礎的圖層或服務的一般邏輯。</span><span class="sxs-lookup"><span data-stu-id="f625a-274">It may mean some repetition of code, but you can minimize that by factoring out common logic into an underlying layer or service.</span></span>

<span data-ttu-id="f625a-275">如果您想要採取**第一個**選項而有所不同 Razor 版面配置每個裝置類型，是非常簡單。</span><span class="sxs-lookup"><span data-stu-id="f625a-275">If you want to take the **first** option and vary only the Razor layout per device type, it's very easy.</span></span> <span data-ttu-id="f625a-276">只需修改您\_ViewStart.cshtml 檔案，如下所示：</span><span class="sxs-lookup"><span data-stu-id="f625a-276">Just modify your \_ViewStart.cshtml file as follows:</span></span>

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

<span data-ttu-id="f625a-277">現在您可以建立行動裝置特定版面配置，稱為\_LayoutMobile.cshtml 與頁面結構和 CSS 規則針對行動裝置最佳化。</span><span class="sxs-lookup"><span data-stu-id="f625a-277">Now you can create a mobile-specific layout called \_LayoutMobile.cshtml with a page structure and CSS rules optimized for mobile devices.</span></span>

<span data-ttu-id="f625a-278">如果您想要採取**第二個**選項呈現根據訪客的裝置類型完全不同的檢視，請參閱[Scott Hanselman 部落格文章](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx)。</span><span class="sxs-lookup"><span data-stu-id="f625a-278">If you want to take the **second** option render totally different views according to the visitor's device type, see [Scott Hanselman's blog post](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span></span>

<span data-ttu-id="f625a-279">這份文件的其餘部分著重於**第三個**選項 – 建立個別的控制站*和*行動裝置 – 讓您能夠控制對行動裝置的訪客提供哪些功能子集的完全檢視。</span><span class="sxs-lookup"><span data-stu-id="f625a-279">The rest of this paper focuses on the **third** option – creating separate controllers *and* views for mobile devices – so you can control exactly what subset of functionality is offered for mobile visitors.</span></span>

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a><span data-ttu-id="f625a-280">設定 ASP.NET MVC 應用程式中的行動裝置的區域</span><span class="sxs-lookup"><span data-stu-id="f625a-280">Setting up a Mobile area within your ASP.NET MVC application</span></span>

<span data-ttu-id="f625a-281">您可以新增以一般方式稱為 「 行動 」，在現有的 ASP.NET MVC 應用程式的區域： 在方案總管] 中，您的專案名稱上按一下滑鼠右鍵，然後選擇 [新增 à 區域。</span><span class="sxs-lookup"><span data-stu-id="f625a-281">You can add an area called "Mobile" to an existing ASP.NET MVC application in the normal way: right-click on your project name in Solution Explorer, then choose Add à Area.</span></span> <span data-ttu-id="f625a-282">在 ASP.NET MVC 應用程式內的任何其他區域一樣，您可以再新增控制器和檢視。</span><span class="sxs-lookup"><span data-stu-id="f625a-282">You can then add controllers and views as you would for any other area within an ASP.NET MVC application.</span></span> <span data-ttu-id="f625a-283">例如，將加入至您行動區域新的控制器呼叫 HomeController 作為行動裝置的訪客的首頁。</span><span class="sxs-lookup"><span data-stu-id="f625a-283">For example, add to your Mobile area a new controller called HomeController to act as a homepage for mobile visitors.</span></span>

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a><span data-ttu-id="f625a-284">確保 URL /Mobile 到達行動首頁</span><span class="sxs-lookup"><span data-stu-id="f625a-284">Ensuring the URL /Mobile reaches the mobile homepage</span></span>

<span data-ttu-id="f625a-285">如果您想 URL /Mobile 到達 HomeController 您行動區域內的索引動作，您必須進行兩個小變更路由設定。</span><span class="sxs-lookup"><span data-stu-id="f625a-285">If you want the URL /Mobile to reach the Index action on HomeController inside your Mobile area, you will need to make two small changes to your routing configuration.</span></span> <span data-ttu-id="f625a-286">首先，更新 MobileAreaRegistration 類別使 HomeController 預設的控制站在行動裝置的區域中，如下列程式碼所示：</span><span class="sxs-lookup"><span data-stu-id="f625a-286">First, update your MobileAreaRegistration class so that HomeController is the default controller in your Mobile area, as shown in the following code:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

<span data-ttu-id="f625a-287">這表示行動首頁現在即將放置 /Mobile，而非行動/首頁，因為 「 家用 」 現在是以隱含方式控制站的預設名稱行動頁面。</span><span class="sxs-lookup"><span data-stu-id="f625a-287">This means the mobile homepage will now be located at /Mobile, rather than /Mobile/Home, because "Home" is now the implicitly default controller name for mobile pages.</span></span>

<span data-ttu-id="f625a-288">接下來，請注意，將第二個 HomeController 加入至您的應用程式 （也就是行動一，除了現有的桌面一個），您將會中斷一般桌面首頁。</span><span class="sxs-lookup"><span data-stu-id="f625a-288">Next, note that by adding a second HomeController to your application (i.e., the mobile one, in addition to the existing desktop one), you'll have broken your regular desktop homepage.</span></span> <span data-ttu-id="f625a-289">它將會失敗，發生錯誤 「*符合控制器名稱為 '首頁' 找到多個型別*"。</span><span class="sxs-lookup"><span data-stu-id="f625a-289">It will fail with the error "*Multiple types were found that match the controller named 'Home'*".</span></span> <span data-ttu-id="f625a-290">若要解決此問題，更新 （中 Global.asax.cs) 的最上層路由組態來指定您的桌面 HomeController 在模稜兩可時，應該採取優先順序：</span><span class="sxs-lookup"><span data-stu-id="f625a-290">To resolve this, update your top-level routing configuration (in Global.asax.cs) to specify that your desktop HomeController should take priority when there's ambiguity:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

<span data-ttu-id="f625a-291">現在會離開和 URL http:// 錯誤<em>您的站台</em>會到達桌面的首頁和 http:// /<em>您的站台</em>/mobile/ 會到達行動首頁。</span><span class="sxs-lookup"><span data-stu-id="f625a-291">Now the error will go away, and the URL http://<em>yoursite</em>/ will reach the desktop homepage, and http://<em>yoursite</em>/mobile/ will reach the mobile homepage.</span></span>

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a><span data-ttu-id="f625a-292">重新導向至您行動區域行動訪客</span><span class="sxs-lookup"><span data-stu-id="f625a-292">Redirecting mobile visitors to your mobile area</span></span>

<span data-ttu-id="f625a-293">因此有許多可能的方法，將重新導向邏輯中 ASP.NET MVC 中，有許多不同的擴充點。</span><span class="sxs-lookup"><span data-stu-id="f625a-293">There are many different extensibility points in ASP.NET MVC, so there are many possible ways to inject redirection logic.</span></span> <span data-ttu-id="f625a-294">一個很棒的選項是建立一個篩選屬性、 [RedirectMobileDevicesToMobileArea]，執行重新導向，如果符合下列條件：</span><span class="sxs-lookup"><span data-stu-id="f625a-294">One neat option is to create a filter attribute, [RedirectMobileDevicesToMobileArea], that performs a redirection if the following conditions are met:</span></span>

1. <span data-ttu-id="f625a-295">它是使用者工作階段中的第一個要求 （亦即，Session.IsNewSession 等於 true）</span><span class="sxs-lookup"><span data-stu-id="f625a-295">It's the first request in the user's session (i.e., Session.IsNewSession equals true)</span></span>
2. <span data-ttu-id="f625a-296">要求來自行動瀏覽器 （亦即，Request.Browser.IsMobileDevice 等於 true）</span><span class="sxs-lookup"><span data-stu-id="f625a-296">The request comes from a mobile browser (i.e., Request.Browser.IsMobileDevice equals true)</span></span>
3. <span data-ttu-id="f625a-297">使用者不已要求行動區域中的資源 (亦即，*路徑*URL 部分的開頭不是 /Mobile)</span><span class="sxs-lookup"><span data-stu-id="f625a-297">The user is not already requesting a resource in the mobile area (i.e., the *path* part of the URL does not begin with /Mobile)</span></span>

<span data-ttu-id="f625a-298">包含與這份技術白皮書的可下載範例包含實作此邏輯。</span><span class="sxs-lookup"><span data-stu-id="f625a-298">The downloadable sample included with this white paper includes an implementation of this logic.</span></span> <span data-ttu-id="f625a-299">它會實作為衍生自 AuthorizeAttribute，這表示它在即使您使用輸出快取 （否則如果桌面訪客第一次存取特定 URL，桌面的輸出可能會快取，並提供服務到可以正確運作的授權篩選條件後續行動訪客）。</span><span class="sxs-lookup"><span data-stu-id="f625a-299">It's implemented as an authorization filter, derived from AuthorizeAttribute, which means it can work correctly even if you are using output caching (otherwise, if a desktop visitor first accesses a certain URL, the desktop output might be cached and then served to subsequent mobile visitors).</span></span>

<span data-ttu-id="f625a-300">因為它是篩選器，您可以選擇要套用到特定的控制器和動作例如</span><span class="sxs-lookup"><span data-stu-id="f625a-300">As it's a filter, you can choose either to apply it to specific controllers and actions, e.g.,</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

<span data-ttu-id="f625a-301">…</span><span class="sxs-lookup"><span data-stu-id="f625a-301">…</span></span> <span data-ttu-id="f625a-302">或套用至所有控制器和動作為 MVC 3*全域篩選*Global.asax.cs 檔案中：</span><span class="sxs-lookup"><span data-stu-id="f625a-302">or you can apply it to all controllers and actions as an MVC 3 *global filter* in your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

<span data-ttu-id="f625a-303">可下載的範例也示範如何建立此屬性的重新導向至您行動區域內的特定位置的子類別。</span><span class="sxs-lookup"><span data-stu-id="f625a-303">The downloadable sample also demonstrates how you can create subclasses of this attribute that redirect to specific locations within your mobile area.</span></span> <span data-ttu-id="f625a-304">這表示，例如，您可以：</span><span class="sxs-lookup"><span data-stu-id="f625a-304">This means, for example, you can:</span></span>

- <span data-ttu-id="f625a-305">註冊全域篩選為顯示上述的預設傳送行動首頁行動訪客。</span><span class="sxs-lookup"><span data-stu-id="f625a-305">Register a global filter as shown above that sends mobile visitors to the mobile homepage by default.</span></span>
- <span data-ttu-id="f625a-306">也要採取行動的訪客便具有要求所有產品網頁的行動裝置版本的 「 檢視產品 」 動作套用特殊的 [RedirectMobileDevicesToMobileProductPage] 篩選器。</span><span class="sxs-lookup"><span data-stu-id="f625a-306">Also apply a special [RedirectMobileDevicesToMobileProductPage] filter to a "view product" action that takes mobile visitors to the mobile version of whatever product page they had requested.</span></span>
- <span data-ttu-id="f625a-307">也適用於特定的動作，重新導向至相同行動頁面行動訪客的 篩選器的其他特殊子類別</span><span class="sxs-lookup"><span data-stu-id="f625a-307">Also apply other special subclasses of the filter to specific actions, redirecting mobile visitors to the equivalent mobile page</span></span>

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="f625a-308">設定表單驗證以尊重您的行動裝置頁面</span><span class="sxs-lookup"><span data-stu-id="f625a-308">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="f625a-309">如果您使用表單驗證，您應該注意，當使用者需要登入，它會自動將使用者導向至單一特定 「 登入 」 的 URL，其預設值是 **/帳戶/登入**。</span><span class="sxs-lookup"><span data-stu-id="f625a-309">If you're using Forms Authentication, you should note that when a user needs to log in, it automatically redirects the user to a single specific "log on" URL, which by default is **/Account/LogOn**.</span></span> <span data-ttu-id="f625a-310">這表示行動使用者，可能會重新導向到您桌面 「 登入 」 的動作。</span><span class="sxs-lookup"><span data-stu-id="f625a-310">This means that mobile users may be redirected to your desktop "log on" action.</span></span>

<span data-ttu-id="f625a-311">若要避免這個問題，邏輯加入您桌面的 「 登入 」 動作，以便將重新導向行動使用者一次行動裝置的 「 登入 」 動作。</span><span class="sxs-lookup"><span data-stu-id="f625a-311">To avoid this problem, add logic to your desktop "log on" action so that it redirects mobile users again to a mobile "log on" action.</span></span> <span data-ttu-id="f625a-312">如果您使用預設 ASP.NET MVC 應用程式範本，更新 AccountController 的登入的動作，如下所示：</span><span class="sxs-lookup"><span data-stu-id="f625a-312">If you're using the default ASP.NET MVC application template, update AccountController's LogOn action as follows:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

<span data-ttu-id="f625a-313">…</span><span class="sxs-lookup"><span data-stu-id="f625a-313">…</span></span> <span data-ttu-id="f625a-314">然後實作適當的行動裝置特定 「 登入 」 動作稱為 AccountController 行動當地的控制站上。</span><span class="sxs-lookup"><span data-stu-id="f625a-314">and then implement a suitable mobile-specific "log on" action on a controller called AccountController in your Mobile area.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="f625a-315">使用輸出快取</span><span class="sxs-lookup"><span data-stu-id="f625a-315">Working with Output Caching</span></span>

<span data-ttu-id="f625a-316">如果您使用 [OutputCache] 篩選器，您必須強制快取項目，若要依裝置類型。</span><span class="sxs-lookup"><span data-stu-id="f625a-316">If you're using the [OutputCache] filter, you must force the cache entry to vary by device type.</span></span> <span data-ttu-id="f625a-317">例如，寫入：</span><span class="sxs-lookup"><span data-stu-id="f625a-317">For example, write:</span></span>

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

<span data-ttu-id="f625a-318">然後，將下列方法加入至 Global.asax.cs 檔案：</span><span class="sxs-lookup"><span data-stu-id="f625a-318">Then, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

<span data-ttu-id="f625a-319">這可確保行動網頁訪客沒有收到先前置於快取中的桌面的訪客的輸出。</span><span class="sxs-lookup"><span data-stu-id="f625a-319">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="f625a-320">工作範例</span><span class="sxs-lookup"><span data-stu-id="f625a-320">A working example</span></span>

<span data-ttu-id="f625a-321">若要查看作用中的這些技術，請下載[這份技術白皮書的程式碼相關聯的範例](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="f625a-321">To see these techniques in action, download [this white paper's code associated samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="f625a-322">此範例包含 ASP.NET MVC 3 （發行候選版本） 應用程式增強為支援行動裝置使用上面所述的方法。</span><span class="sxs-lookup"><span data-stu-id="f625a-322">The sample includes an ASP.NET MVC 3 (Release Candidate) application enhanced to support mobile devices using the methods described above.</span></span>

## <a name="further-guidance-and-suggestions"></a><span data-ttu-id="f625a-323">進一步的指引和建議</span><span class="sxs-lookup"><span data-stu-id="f625a-323">Further guidance and suggestions</span></span>

<span data-ttu-id="f625a-324">下列討論適用於 Web Form 和 MVC 開發人員使用本文件涵蓋的技術。</span><span class="sxs-lookup"><span data-stu-id="f625a-324">The following discussion applies both to Web Forms and MVC developers who are using the techniques covered in this document.</span></span>

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a><span data-ttu-id="f625a-325">強化您的重新導向邏輯使用 51Degrees.mobi Foundation</span><span class="sxs-lookup"><span data-stu-id="f625a-325">Enhancing your redirection logic using 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="f625a-326">本文件中所示的重新導向邏輯可能完全足以用於您的應用程式，但如果您要停用工作階段，將無法運作或與拒絕的 cookie （這些不能有工作階段），因為它不會知道是否指定要求的行動瀏覽器第一個從該訪客。</span><span class="sxs-lookup"><span data-stu-id="f625a-326">The redirection logic shown in this document may be perfectly sufficient for your application, but it won't work if you need to disable sessions, or with mobile browsers that reject cookies (these can't have sessions), because it won't know whether a given request is the first one from that visitor.</span></span>

<span data-ttu-id="f625a-327">您已學到如何改善開放原始碼 51Degrees.mobi Foundation ASP 的精確度。網路的瀏覽器偵測。</span><span class="sxs-lookup"><span data-stu-id="f625a-327">You already learned how the open source 51Degrees.mobi Foundation can improve the accuracy of ASP.NET's browser detection.</span></span> <span data-ttu-id="f625a-328">它也有內建的功能，將重新導向至特定位置，在 Web.config 中設定的行動訪客。可以運作，而不根據 ASP.NET 工作階段 (因此 cookie) 儲存的雜湊訪客 HTTP 標頭及 IP 位址的暫存記錄檔，使它知道每一個要求是否從給定 vistor 的第一個。</span><span class="sxs-lookup"><span data-stu-id="f625a-328">It also has a built-in ability to redirect mobile visitors to specific locations configured in Web.config. It's able to work without depending on ASP.NET Sessions (and hence cookies) by storing a temporary log of hashes of visitors' HTTP headers and IP addresses, so it knows whether or not each request is the first one from a given vistor.</span></span>

<span data-ttu-id="f625a-329">下列項目新增至 web.config 檔 fiftyOne 區段將會重新導向至頁面偵測到的行動裝置從第一個要求 ~ / Mobile/Default.aspx。</span><span class="sxs-lookup"><span data-stu-id="f625a-329">The following element added to the fiftyOne section of the web.config file will redirect the first request from a detected mobile device to the page ~/Mobile/Default.aspx.</span></span> <span data-ttu-id="f625a-330">將頁面行動資料夾下的任何要求*不*重新導向，無論裝置類型。</span><span class="sxs-lookup"><span data-stu-id="f625a-330">Any requests to pages under the Mobile folder will *not* be redirected, regardless of device type.</span></span> <span data-ttu-id="f625a-331">如果行動裝置未作用一段時間的 20 分鐘或更多裝置將遭到忽略，後續要求將會被視為新的用途的重新導向。</span><span class="sxs-lookup"><span data-stu-id="f625a-331">If the mobile device has been inactive for a period of 20 minutes or more the device will be forgotten and subsequent requests will be treated as new ones for the purposes of redirection.</span></span>

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

<span data-ttu-id="f625a-332">如需詳細資訊，請參閱[51degrees.mobi Foundation 文件](https://github.com/51Degrees/dotNET-Device-Detection)。</span><span class="sxs-lookup"><span data-stu-id="f625a-332">For more details, see [51degrees.mobi Foundation documentation](https://github.com/51Degrees/dotNET-Device-Detection).</span></span>

> [!NOTE]
> <span data-ttu-id="f625a-333">您*可以*使用 51Degrees.mobi Foundation 的重新導向功能，在 ASP.NET MVC 應用程式，但是您必須定義以純文字的 Url，不會根據路由的參數或將 MVC 篩選條件放入您重新導向設定在 [動作]。</span><span class="sxs-lookup"><span data-stu-id="f625a-333">You *can* use 51Degrees.mobi Foundation's redirection feature on ASP.NET MVC applications, but you will need to define your redirection configuration in terms of plain URLs, not in terms of routing parameters or by putting MVC filters on actions.</span></span> <span data-ttu-id="f625a-334">這是因為 （在寫入時間） 51Degrees.mobi Foundation 無法辨識或路由篩選器。</span><span class="sxs-lookup"><span data-stu-id="f625a-334">This is because (at the time of writing) 51Degrees.mobi Foundation does not recognize filters or routing.</span></span>


### <a name="disabling-transcoders-and-proxy-servers"></a><span data-ttu-id="f625a-335">停用轉錄和 Proxy 伺服器</span><span class="sxs-lookup"><span data-stu-id="f625a-335">Disabling Transcoders and Proxy Servers</span></span>

<span data-ttu-id="f625a-336">行動網路業者行動網際網路的方法中有兩個廣泛的目標：</span><span class="sxs-lookup"><span data-stu-id="f625a-336">Mobile network operators have two broad objectives in their approach to the mobile internet:</span></span>

1. <span data-ttu-id="f625a-337">提供做為儘可能多相關內容</span><span class="sxs-lookup"><span data-stu-id="f625a-337">Provide as much relevant content as possible</span></span>
2. <span data-ttu-id="f625a-338">可以共用限制的廣播網路頻寬的客戶數目最大化</span><span class="sxs-lookup"><span data-stu-id="f625a-338">Maximize the number of customers who can share the limited radio network bandwidth</span></span>

<span data-ttu-id="f625a-339">由於大部分的網頁是針對較大的桌面大小螢幕並快速修正列寬頻連線所設計，許多運算子會使用*轉錄*或*proxy 伺服器*，動態變更 web 內容。</span><span class="sxs-lookup"><span data-stu-id="f625a-339">Since most web pages were designed for large desktop-sized screens and fast fixed-line broadband connections, many operators use *transcoders* or *proxy servers* that dynamically alter web content.</span></span> <span data-ttu-id="f625a-340">它們可能會修改您的 HTML 標記或 CSS 以配合較小的螢幕 （特別是針對 「 功能的電話 」 缺少處理能力來處理複雜的配置），和它們可能會重新映像 （大幅減少其品質） 壓縮以改善網頁傳遞的速度。</span><span class="sxs-lookup"><span data-stu-id="f625a-340">They may modify your HTML markup or CSS to suit smaller screens (especially for "feature phones" that lack the processing power to handle complex layouts), and they may recompress your images (significantly reducing their quality) to improve page delivery speeds.</span></span>

<span data-ttu-id="f625a-341">但是，如果您已取得所花的心力產生行動最佳化您站台的版本，您可能不想干擾它任何進一步的網路業者。</span><span class="sxs-lookup"><span data-stu-id="f625a-341">But if you've taken the effort to produce a mobile-optimized version of your site, you probably don't want the network operator to interfere with it any further.</span></span> <span data-ttu-id="f625a-342">您可以將下行加入頁面\_中任何 ASP.NET Web Form 的載入事件：</span><span class="sxs-lookup"><span data-stu-id="f625a-342">You can add the following line to the Page\_Load event in any ASP.NET Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

<span data-ttu-id="f625a-343">或者，ASP.NET MVC 控制器，您可以加入下列方法覆寫，讓它套用到該控制器上的所有動作：</span><span class="sxs-lookup"><span data-stu-id="f625a-343">Or, for an ASP.NET MVC controller, you could add the following method override so that it applies to all actions on that controller:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

<span data-ttu-id="f625a-344">產生的 HTTP 訊息告知 W3C 相容轉錄且不改變內容的 proxy。</span><span class="sxs-lookup"><span data-stu-id="f625a-344">The resulting HTTP message informs W3C compliant transcoders and proxies not to alter content.</span></span> <span data-ttu-id="f625a-345">當然，是行動網路運算子會遵守此訊息不保證。</span><span class="sxs-lookup"><span data-stu-id="f625a-345">Of course, there is no guarantee that mobile network operators will respect this message.</span></span>

### <a name="styling-mobile-pages-for-mobile-browsers"></a><span data-ttu-id="f625a-346">設定樣式行動瀏覽器的行動裝置的頁面</span><span class="sxs-lookup"><span data-stu-id="f625a-346">Styling mobile pages for mobile browsers</span></span>

<span data-ttu-id="f625a-347">它超出範圍的這份文件中有詳細描述哪些類型的 HTML 標記工作正確，或哪些 web 設計技巧將特定裝置上的可用性最大化。</span><span class="sxs-lookup"><span data-stu-id="f625a-347">It's beyond the scope of this document to describe in great detail what kinds of HTML markup work correctly or which web design techniques maximize usability on particular devices.</span></span> <span data-ttu-id="f625a-348">它具有向上，尋找夠簡單的版面配置，讓您最佳化行動大小螢幕，而不使用不可靠 HTML 或 CSS 位置訣竅。</span><span class="sxs-lookup"><span data-stu-id="f625a-348">It's up to you to find a sufficiently simple layout, optimized for a mobile-sized screen, without using unreliable HTML or CSS positioning tricks.</span></span> <span data-ttu-id="f625a-349">不過，是一個重要的技術，值得一提，*檢視區 meta 標記*。</span><span class="sxs-lookup"><span data-stu-id="f625a-349">One important technique worth mentioning, however, is the *viewport meta tag*.</span></span>

<span data-ttu-id="f625a-350">某些現代化行動瀏覽器，適用於桌上型監視器，投入時間顯示網頁中的呈現在虛擬畫布上，也稱為 「 檢視區 」 頁面 （例如虛擬檢視區為 980 像素寬、 iPhone、 上和 850 像素寬、 Opera Mobile 上依預設），然後向下調整結果，以符合畫面的實體像素。</span><span class="sxs-lookup"><span data-stu-id="f625a-350">Certain modern mobile browsers, in an effort display web pages meant for desktop monitors, render the page on a virtual canvas, also called "viewport" (e.g., the virtual viewport is 980 pixels wide on iPhone, and 850 pixels wide on Opera Mobile by default) and then scale the result down to fit onto the screen's physical pixels.</span></span> <span data-ttu-id="f625a-351">使用者即可放大或放大的檢視區。</span><span class="sxs-lookup"><span data-stu-id="f625a-351">The user can then zoom in and pan around that viewport.</span></span> <span data-ttu-id="f625a-352">這樣做的好處，它可讓瀏覽器顯示頁面在預定的配置中，但也有缺點，它會強制縮放和平移的使用者很不方便。</span><span class="sxs-lookup"><span data-stu-id="f625a-352">This has the advantage that it lets the browser display the page in its intended layout, but it's also has the disadvantage that it forces zooming and panning, which is inconvenient for the user.</span></span> <span data-ttu-id="f625a-353">如果您在設計行動應用程式，最好設計窄的畫面，因此不需要的任何縮放或水平捲軸。</span><span class="sxs-lookup"><span data-stu-id="f625a-353">If you're designing for mobile, it's better to design for a narrow screen so that no zooming or horizontal scrolling is necessary.</span></span>

<span data-ttu-id="f625a-354">指示行動瀏覽器檢視區應該是寬度的方法是透過使用非標準*檢視區*meta 標記。</span><span class="sxs-lookup"><span data-stu-id="f625a-354">A way to tell the mobile browser how wide the viewport should be is through the nonstandard *viewport* meta tag.</span></span> <span data-ttu-id="f625a-355">例如，如果您的頁面標頭 區段中，加入下列</span><span class="sxs-lookup"><span data-stu-id="f625a-355">For example, if you add the following to your page's HEAD section,</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

<span data-ttu-id="f625a-356">…</span><span class="sxs-lookup"><span data-stu-id="f625a-356">…</span></span> <span data-ttu-id="f625a-357">然後支援智慧型手機瀏覽器會配置 480 像素的範圍虛擬畫布上的頁面。</span><span class="sxs-lookup"><span data-stu-id="f625a-357">then supporting smartphone browsers will lay out the page on a 480-pixel wide virtual canvas.</span></span> <span data-ttu-id="f625a-358">這表示，如果您的 HTML 項目會定義其寬度，以百分比表示，此百分比會解譯相對於這個 480 像素寬度，沒有預設檢視區寬度。</span><span class="sxs-lookup"><span data-stu-id="f625a-358">This means that if your HTML elements define their widths in percentage terms, the percentages will be interpreted with respect to this 480-pixel width, not the default viewport width.</span></span> <span data-ttu-id="f625a-359">如此一來，使用者是比較不可能對縮放和平移水平 – 大幅改善行動瀏覽經驗。</span><span class="sxs-lookup"><span data-stu-id="f625a-359">As a result, the user is less likely to have to zoom and pan horizontally – considerably improving the mobile browsing experience.</span></span>

<span data-ttu-id="f625a-360">如果您想要比對裝置的實體像素的檢視區寬度時，您可以指定下列各項：</span><span class="sxs-lookup"><span data-stu-id="f625a-360">If you want the viewport width to match the device's physical pixels, you can specify the following:</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

<span data-ttu-id="f625a-361">此正常運作，您必須明確地強制超過該寬度的項目 (例如，使用*寬度*屬性或 CSS 屬性)，否則瀏覽器將會強制在使用較大的檢視區而定。</span><span class="sxs-lookup"><span data-stu-id="f625a-361">For this to work correctly, you must not explicitly force elements to exceed that width (e.g., using a *width* attribute or CSS property), otherwise the browser will be forced to use a larger viewport regardless.</span></span> <span data-ttu-id="f625a-362">另請參閱：[更多詳細的非標準的檢視區標記](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html)。</span><span class="sxs-lookup"><span data-stu-id="f625a-362">See also: [more details about the nonstandard viewport tag](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span></span>

<span data-ttu-id="f625a-363">大多數最新型的智慧型手機支援*雙重方向*： 直向或橫向模式中可以保存它們。</span><span class="sxs-lookup"><span data-stu-id="f625a-363">Most modern smartphones support *dual orientation*: they can be held in either portrait or landscape mode.</span></span> <span data-ttu-id="f625a-364">因此，務必不提出任何假設的螢幕寬度 （像素）。</span><span class="sxs-lookup"><span data-stu-id="f625a-364">So, it's important not to make assumptions about the screen width in pixels.</span></span> <span data-ttu-id="f625a-365">請勿甚至假設的螢幕寬度固定的因為使用者可以重新設定他們的裝置，都在頁面上。</span><span class="sxs-lookup"><span data-stu-id="f625a-365">Don't even assume that the screen width is fixed, because the user can re-orient their device while they are on your page.</span></span>

<span data-ttu-id="f625a-366">下列中繼標籤中，通知他們內容的頁面已經過最佳化，行動應用程式，因此不應該轉換，可能也會接受較舊的 Windows Mobile 和 Blackberry 裝置。</span><span class="sxs-lookup"><span data-stu-id="f625a-366">Older Windows Mobile and Blackberry devices may also accept the following meta tags in the page header to inform them content has been optimized for mobile and therefore should not be transformed.</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a><span data-ttu-id="f625a-367">其他資源</span><span class="sxs-lookup"><span data-stu-id="f625a-367">Additional Resources</span></span>

<span data-ttu-id="f625a-368">如需行動裝置模擬器，模擬器可用來測試您行動裝置的 ASP.NET web 應用程式的清單，請參閱網頁[模擬熱門的行動裝置進行測試](../mobile/device-simulators.md)。</span><span class="sxs-lookup"><span data-stu-id="f625a-368">For a list of mobile device emulators and simulators you can use to test your mobile ASP.NET web application, see the page [Simulate popular mobile devices for testing](../mobile/device-simulators.md).</span></span>

## <a name="credits"></a><span data-ttu-id="f625a-369">參與名單</span><span class="sxs-lookup"><span data-stu-id="f625a-369">Credits</span></span>

- <span data-ttu-id="f625a-370">主要作者： Steven Sanderson</span><span class="sxs-lookup"><span data-stu-id="f625a-370">Primary author: Steven Sanderson</span></span>
- <span data-ttu-id="f625a-371">檢閱者 / 其他內容寫入器： James Rosewell、 黃冠 Söderström、 Scott Hanselman、 Scott 獵人</span><span class="sxs-lookup"><span data-stu-id="f625a-371">Reviewers / additional content writers: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span></span>
